!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.prototype.validateHost=function(t){return Promise.resolve()},t}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.on=function(t,e){window.addEventListener("message",function(n){var r=void 0,i=n.source;if(t===n.origin){try{r=JSON.parse(n.data)}catch(t){return}e(r).then(function(t){var e=void 0;(e="object"===(void 0===t?"undefined":o(t))?t:{status:"ok"}).id=r.id,e.action=r.action,e.handler=r.handler,"string"!=typeof e.status&&(e.status="ok"),i.postMessage(JSON.stringify(e),n.origin)})}},!1)},t}();var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tracker=e}return t.prototype.handleMessage=function(t){switch(t.action){case"set":return"userId"===t.target?this._setUserId(t.data):Promise.resolve({status:"error",errorMsg:"Unsupported set target: "+t.target});case"get":return"credentials"===t.target?this._getCredentials():"visitorId"===t.target?this._getVisitorId():Promise.resolve({status:"error",errorMsg:"Unsupported get target: "+t.target});default:return Promise.resolve({status:"error",errorMsg:"Unsupported action: "+t.action})}},t.prototype._setUserId=function(t){return this.tracker.set("userId",t.userId),this.tracker.send("event",{eventCategory:"User ID",eventAction:"Set",eventLabel:t.userId,nonInteraction:!0}),Promise.resolve({data:{userId:t.userId,visitorId:this.tracker.get("clientId")}})},t.prototype._getCredentials=function(){return Promise.resolve({data:{userId:this.tracker.get("userId"),visitorId:this.tracker.get("clientId")}})},t.prototype._getVisitorId=function(){return Promise.resolve({data:{visitorId:this.tracker.get("clientId")}})},t}();var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.prototype.handleMessage=function(t){if("hit"!==t.action)return Promise.resolve({status:"error",errorMsg:"Unsupported action: "+t.action});switch(t.target){case"page":return this._hitPage(t.data);case"timing":return this._hitTiming(t.data);case"event":return this._hitEvent(t.data);default:return Promise.resolve({status:"error",errorMsg:"Unsupported hit target: "+t.target})}},t.prototype._hitPage=function(t){return ga("set","page",t.pathname),ga("send","pageview"),Promise.resolve()},t.prototype._hitTiming=function(t){return ga("send","timing",t),Promise.resolve()},t.prototype._hitEvent=function(t){return ga("send","event",t),Promise.resolve()},t}();var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tracker=e}return t.prototype.handleMessage=function(t){return"set"===t.action?this._setFields(t.data):"get"===t.action?this._getField(t.data):Promise.resolve({status:"error",errorMsg:"Unsupported action: "+t.action})},t.prototype._setFields=function(t){return ga("set",t),Promise.resolve()},t.prototype._getField=function(t){var e;return Promise.resolve(((e={})[t.field]=this.tracker.get(t.field),e))},t}();function u(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return""+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function f(t,e){var n=t.replace(/[\]]/g,"\\$&"),r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)").exec(e);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}function d(t){return!isNaN(parseFloat(t))&&isFinite(t)}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var h=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.store=e,this.key=n,this.timeoutMs=r}return t.prototype.handleMessage=function(t){switch(t.action){case"set":return"start"===t.target?this._start():"end"===t.target?this._end():"extend"===t.target?this.extend():Promise.resolve({status:"error",errorMsg:"Unsupported set target: "+t.target});case"get":return this._getSession();default:return Promise.resolve({status:"error",errorMsg:"Unsupported action: "+t.action})}},t.prototype.extend=function(){var t=this;return this._getSession().then(function(e){return"object"===p(e.data.expiredSession)?e:t.store.set(t.key,e.data.session,t.timeoutMs).then(function(){return e})})},t.prototype._start=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e={id:u(),started_at:(new Date).toISOString(),timeout:this.timeoutMs,age:0};return t&&ga("send","event",{eventCategory:"Session",eventAction:"Start",eventLabel:e.id,sessionControl:"start"}),this.store.set(this.key,e,this.timeoutMs).then(function(){return{data:{session:e}}})},t.prototype._end=function(){var e=this;return this.store.get(this.key,!0).then(function(n){if("object"!==(void 0===n?"undefined":p(n)))return{};var r=n.isExpired?n.data:n;return ga("send","event",{eventCategory:"Session",eventAction:"End",eventLabel:r.id,sessionControl:"end"}),t.updateAge(r),e.store.remove(e.key).then(function(){return{data:{session:r}}})})},t.prototype._getSession=function(){var e=this;return this.store.get(this.key,!0).then(function(n){return"object"!==(void 0===n?"undefined":p(n))||n.isExpired?e._start(!1).then(function(t){"object"===(void 0===n?"undefined":p(n))&&n.isExpired&&(t.data.expiredSession=n.data,ga("send","event",{eventCategory:"Session",eventAction:"End",eventLabel:n.id,eventValue:n.age}));var e=(t?t.data:{}).session||{};return ga("send","event",{eventCategory:"Session",eventAction:"Start",eventLabel:e.id}),t}):(t.updateAge(n),{data:{session:n}})})},t.updateAge=function(t){t.age=Date.now()-Date.parse(t.started_at)},t}();var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.prototype.handleMessage=function(t){return Promise.resolve({data:t})},t}(),y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var v=function(){function t(){g(this,t),this.map={}}return t.prototype.setItem=function(t,e){this.map[t]=e},t.prototype.getItem=function(t){return void 0!==this.map[t]?this.map[t]:null},t.prototype.removeItem=function(t){this.map[t]=void 0},t}(),m=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments[2];g(this,t),this.prefix="",this.keys=[],this._keysKey="store_keys","string"==typeof r&&(this.prefix=r),this.store=e||new v,"string"==typeof o&&(this._keysKey=o),this.getKeys().then(function(t){n.keys=t})}return t.prototype.set=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this._getPrefixedKey(t);try{var i={data:e};return d(n)&&(i.exp=Date.now()+n),this.store.setItem(o,btoa(JSON.stringify(i))),r?Promise.resolve():this._updateKeys(t)}catch(t){return Promise.reject(t)}},t.prototype.get=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._getPrefixedKey(e),o=void 0;try{if(null===(o=this.store.getItem(r)))return Promise.resolve();if(o=JSON.parse(atob(o)),t.isExpired(o))return this.store.removeItem(r),n?Promise.resolve({data:o.data,isExpired:!0}):Promise.resolve()}catch(t){return Promise.reject(t)}return"object"===(void 0===o?"undefined":y(o))&&void 0!==o.data?Promise.resolve(o.data):Promise.resolve()},t.prototype.remove=function(t){try{this.hasKey(t)&&this.store.removeItem(this._getPrefixedKey(t))}catch(t){return Promise.reject(t)}return Promise.resolve()},t.prototype.flush=function(){var t=this;try{return this.keys.forEach(function(e){t.store.removeItem(t._getPrefixedKey(e))}),this.keys=[],this.remove(this._keysKey)}catch(t){return Promise.reject(t)}},t.prototype.getKeys=function(){return this.get(this._keysKey).then(function(t){return t||[]})},t.prototype.hasKey=function(t){return-1!==this.keys.indexOf(t)},t.isExpired=function(t){return!("object"!==(void 0===t?"undefined":y(t))||!d(t.exp))&&Date.now()>=t.exp},t.prototype._updateKeys=function(t){var e=this;if(this.hasKey(t))return Promise.resolve();var n=this.keys.slice();return n.push(t),this.set(this._keysKey,n,!1,!0).then(function(){e.keys.push(t)})},t.prototype._getPrefixedKey=function(t){return this.prefix+t},t}(),w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var b=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.loadRequired=function(t){var e=this.detectIE();!!e&&e<12?this.loadScript("https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.5.0/bluebird.core.min.js","bluebird-compat-dep",t):t()},t.detectIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}var r=t.indexOf("Edge/");return r>0&&parseInt(t.substring(r+5,t.indexOf(".",r)),10)},t.loadScript=function(t,e,n){var r=!0,o=!1;if("string"==typeof e&&""!==e){var i=document.getElementById(e);i&&"object"===(void 0===i?"undefined":w(i))&&(r=!1),o=!0}if(r){var s=document.createElement("script");s.src=t,o&&(s.id=e);var a=document.getElementsByTagName("script")[0];a?a.parentNode.insertBefore(s,a):document.getElementsByTagName("head")[0].appendChild(s),"function"==typeof n&&("function"==typeof s.addEventListener?s.addEventListener("load",n):setTimeout(function(){n()},1e3))}},t}();var _=[80,443,8443],S=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var e=void 0;try{e=localStorage}catch(t){console&&console.warn("Annoto DBA: Local storage Access denied, falling back to Memcache"),e=null}this.store=new m(e,"nn:"),this.authApi=new r,this.handlers={}}return t.prototype.start=function(){var e,n,r=this;if(window.parent===window)return Promise.resolve();try{var o=(e=f("parent_url",window.location.href),(n=document.createElement("a")).href=e,{protocol:n.protocol,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search,hash:n.hash,host:n.host,href:e}),i="https"===o.protocol?443:80;this.parentAppName=f("app_name",window.location.href),this.parentTitle=f("title",window.location.href),this.parentReferrer=f("referrer",window.location.href),this.parentLocation={href:o.href,host:o.host,hostname:o.hostname,protocol:o.protocol,pathname:o.pathname,search:o.search,hash:o.hash,port:d(o.port)?parseInt(o.port,10):i}}catch(e){return t.warn("error starting: "+e.message),Promise.resolve()}return this.store.get("ga:clientId").then(function(e){var n=f("ga_tracking_id",window.location.href),o=n&&"undefined"!==n?n:window.DBA.GA_TRACK_KEY;return ga("create",o,{storage:"none",clientId:e}),ga(function(e){r.tracker=e,r.handlers.userSession=new s(e),r.handlers.hitTracking=new a,r.handlers.analyticsFields=new c(e),r.handlers.visitSession=new h(r.store,"visit",18e5),r.handlers.echo=new l,r.store.set("ga:clientId",e.get("clientId"),63072e6).catch(function(e){t.error("setting clientId: ",e)})}),ga("set","location",r.parentLocation.href),ga("set","hostname",r.parentLocation.hostname),ga("set","page",""+r.parentLocation.pathname+(r.parentLocation.search?r.parentLocation.search:"")+(r.parentLocation.hash?r.parentLocation.hash:"")),ga("set","referrer",r.parentReferrer),ga("set","title",r.parentTitle),ga("set","appName",r.parentAppName),ga("set","anonymizeIp",!0),ga("send","pageview"),r.authApi.validateHost(r.parentLocation.href)}).then(function(){r.listen()})},t.prototype.listen=function(){var t=this,e=this.parentLocation.protocol+"//"+this.parentLocation.hostname;-1===_.indexOf(this.parentLocation.port)&&(e+=":"+this.parentLocation.port),i.on(e,function(e){return t.handleMessage(e)})},t.prototype.handleMessage=function(e){return this.handlers[e.handler]?this.handlers[e.handler].handleMessage(e):(t.warn("unknown handler: "+e.handler),Promise.resolve())},t.warn=function(){var t;window.console&&(t=window.console).warn.apply(t,arguments)},t.error=function(){var t;window.console&&(t=window.console).error.apply(t,arguments)},t}();b.loadRequired(function(){(new S).start().catch(function(t){S.error("starting: ",t)})})}]);
//# sourceMappingURL=main.map