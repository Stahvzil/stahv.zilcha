(window.webpackJsonpAnnoto=window.webpackJsonpAnnoto||[]).push([[3],{100:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var o=n(29),i=1,r=function(){function t(){}return t.nextNumberId=function(){var t=i;return i++,t},t.guid=function(){return Object(o.i)()},t}()},101:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var o=n(52),i=n(60),r=n(38),a=n(29),s=n(48),c=n(59),l=function(){function t(){}return t.buildComment=function(t,e){var n=new i.a;return this.mergeCommentObject(n,t,e),n},t.getPostComment=function(t,e){var n={body:t.body,data:t.data,ps:Math.floor(t.ps)};return t.emotion&&(n.emotion=t.emotion.type),t.anonymous&&(n.anonymous=t.anonymous),n.origin=c.a.origin,n.deep_link=c.a.mediaDeepLink(n.ps,e.player.cachedMediaSrc),n.group_id=e.groupId,n},t.getPatchComment=function(t){var e={body:t.body};return t.emotion&&(e.emotion=t.emotion.type),"boolean"==typeof t.anonymous&&(e.anonymous=t.anonymous),e},t.mergeCommentObject=function(t,e,n){Object(a.a)(t,"id",e.id),Object(a.a)(t,"threadId",e.thread_id),Object(a.a)(t,"createdAt",e.created_at,(function(){t.createdAt.setTime(Date.parse(e.created_at))})),Object(a.a)(t,"updatedAt",e.updated_at,(function(){t.updatedAt.setTime(Date.parse(e.updated_at))})),Object(a.a)(t,"state",e.state),Object(a.a)(t,"body",e.body),Object(a.a)(t,"data",e.data),Object(a.a)(t,"topic",e.topic),Object(a.a)(t,"path",e.path),Object(a.a)(t,"depth",e.depth),Object(a.a)(t,"ps",e.ps),Object(a.a)(t,"repliesCount",e.replies_count),Object(a.a)(t,"discussionCount",e.discussion_count),Object(a.a)(t,"emotionsCount",e.emotions_count),Object(a.a)(t,"emotionsVotes",e.emotions_votes),Object(a.a)(t,"rating",e.rating),Object(a.a)(t,"origin",e.origin),Object(a.a)(t,"deepLink",e.deep_link),Object(a.a)(t,"badges",e.badges),Object(a.a)(t,"anonymous",e.anonymous);var i=e.author||{};t.author?t.author.update(i,e.author_id):t.author=new o.a(e.author_id,i.name,i.photo_url,i.scopes),e.emotion&&e.emotion!==r.c.UNKNOWN?(t.emotion=s.a.createEmotion(e.emotion,n,t.id),t.emotion.disabled=!0):t.emotion=s.a.createUnknownEmotion()},t.parseComments=function(t,e,n){var o=[];if(t)for(var i=0;i<t.length;++i){var r=this.buildComment(t[i],n);r.ancestor=e,o.push(r)}return o},t.construct=function(t,e,n){isNaN(t.depth)&&(t.depth=0);var o=this.buildComment(t,n);if(e)for(var i=0;i<e.length;i++)e[i].depth=o.depth+1,e[i].ps=o.ps,e[i].ancestor=o,o.replies.push(e[i]);if(t.votes){for(i=0;i<t.votes.length;i++)t.votes[i].ps=o.ps;o.votes=t.votes}return o},t}()},102:function(t,e){},103:function(t,e){},104:function(t,e){},105:function(t,e){},106:function(t,e){},107:function(t,e,n){"use strict";var o;!function(t){t[t.open=0]="open",t[t.pending=1]="pending",t[t.deleted=2]="deleted",t[t.closed=3]="closed"}(o||(o={}))},108:function(t,e,n){"use strict";var o;!function(t){t[t.VISIBLE=0]="VISIBLE",t[t.PENDING=1]="PENDING",t[t.DELETED=2]="DELETED",t[t.SPAM=3]="SPAM",t[t.REMOVED_BY_PARENT=4]="REMOVED_BY_PARENT"}(o||(o={}))},109:function(t,e,n){"use strict";var o;!function(t){t[t.VISIBLE=0]="VISIBLE",t[t.DELETE=2]="DELETE"}(o||(o={}))},110:function(t,e){},111:function(t,e){},112:function(t,e){},113:function(t,e){},114:function(t,e){},115:function(t,e,n){"use strict";var o;n.d(e,"a",(function(){return o})),function(t){t[t.firstPlay=1]="firstPlay",t[t.commentTimetagTap=2]="commentTimetagTap",t[t.showReplyTap=3]="showReplyTap",t[t.noteTimetagTap=4]="noteTimetagTap",t[t.vote=5]="vote",t[t.threadSort=6]="threadSort",t[t.threadFollow=7]="threadFollow",t[t.commentKukuTap=8]="commentKukuTap",t[t.commentTap=9]="commentTap",t[t.noteKukuTap=10]="noteKukuTap",t[t.noteTap=11]="noteTap",t[t.timelineUgcTap=12]="timelineUgcTap",t[t.syncTap=13]="syncTap",t[t.comment=14]="comment",t[t.reply=15]="reply",t[t.note=16]="note",t[t.commentEdit=17]="commentEdit",t[t.commentDelete=18]="commentDelete",t[t.noteEdit=19]="noteEdit",t[t.noteDelete=20]="noteDelete",t[t.groupFollow=21]="groupFollow"}(o||(o={}))},116:function(t,e){},117:function(t,e){},118:function(t,e){},119:function(t,e){},120:function(t,e){},121:function(t,e){},122:function(t,e,n){"use strict";var o;!function(t){t[t.pending=0]="pending",t[t.active=1]="active",t[t.deleted=2]="deleted"}(o||(o={}))},123:function(t,e){},124:function(t,e){},125:function(t,e){},126:function(t,e){},127:function(t,e){},128:function(t,e,n){"use strict";var o;n.d(e,"a",(function(){return o})),function(t){t[t.hit=1]="hit",t[t.start=2]="start",t[t.cancel=3]="cancel",t[t.complete=4]="complete",t[t.skip=5]="skip",t[t.next=6]="next",t[t.back=7]="back"}(o||(o={}))},129:function(t,e){},130:function(t,e,n){"use strict";var o;n.d(e,"a",(function(){return o})),function(t){t[t.MODERATOR_LIKE=0]="MODERATOR_LIKE"}(o||(o={}))},131:function(t,e){},132:function(t,e){},133:function(t,e){},134:function(t,e){},135:function(t,e,n){"use strict";var o;!function(t){t[t.hidden=0]="hidden",t[t.active=1]="active",t[t.away=2]="away"}(o||(o={}))},136:function(t,e){},137:function(t,e){},138:function(t,e,n){"use strict";n(139),n(140),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148)},139:function(t,e){},140:function(t,e){},141:function(t,e){},142:function(t,e){},143:function(t,e){},144:function(t,e){},145:function(t,e){},146:function(t,e){},147:function(t,e){},148:function(t,e){},149:function(t,e,n){"use strict";n(150),n(151)},150:function(t,e){},151:function(t,e,n){"use strict";var o,i,r,a,s,c,l,u,p,d;!function(t){t.blocked="6",t.deleted="3",t.errorConverting="-1",t.errorImporting="-2",t.import="0",t.infected="virusScan.Infected",t.moderate="5",t.noContent="7",t.pending="4",t.preconvert="1",t.ready="2",t.scanFailure="virusScan.ScanFailure"}(o||(o={})),function(t){t[t.approved=2]="approved",t[t.autoApproved=6]="autoApproved",t[t.deleted=4]="deleted",t[t.flaggedForReview=5]="flaggedForReview",t[t.pendingModeration=1]="pendingModeration",t[t.rejected=3]="rejected"}(i||(i={})),function(t){t.automatic="-1",t.conferenceEntryServer="conference.CONFERENCE_ENTRY_SERVER",t.data="6",t.document="10",t.externalMedia="externalMedia.externalMedia",t.liveChannel="8",t.liveStream="7",t.mediaClip="1",t.mix="2",t.playlist="5",t.sipEntryServer="sip.SIP_ENTRY_SERVER"}(r||(r={})),function(t){t[t.afferoGpl=11]="afferoGpl",t[t.apache=14]="apache",t[t.bsd=13]="bsd",t[t.copyrighted=1]="copyrighted",t[t.creativecommonsAttribution=3]="creativecommonsAttribution",t[t.creativecommonsAttributionNonCommercial=6]="creativecommonsAttributionNonCommercial",t[t.creativecommonsAttributionNonCommercialNoDerivatives=8]="creativecommonsAttributionNonCommercialNoDerivatives",t[t.creativecommonsAttributionNonCommercialShareAlike=7]="creativecommonsAttributionNonCommercialShareAlike",t[t.creativecommonsAttributionNoDerivatives=5]="creativecommonsAttributionNoDerivatives",t[t.creativecommonsAttributionShareAlike=4]="creativecommonsAttributionShareAlike",t[t.gfdl=9]="gfdl",t[t.gpl=10]="gpl",t[t.lgpl=12]="lgpl",t[t.mozilla=15]="mozilla",t[t.none=0]="none",t[t.publicDomain=2]="publicDomain",t[t.unknown=-1]="unknown"}(a||(a={})),function(t){t.approvedButNotReady="1",t.failed="4",t.none="0",t.notReadyAndNotApproved="3",t.readyButNotApproved="2"}(s||(s={})),function(t){t[t.kalturaNetwork=2]="kalturaNetwork",t[t.none=0]="none",t[t.partnerOnly=1]="partnerOnly",t[t.system=-1]="system"}(c||(c={})),function(t){t.kaf="2",t.kalturaMeeting="7",t.kmc="0",t.kms="1",t.kmsGo="4",t.personalCapture="6",t.pitch="3",t.webcastApp="5"}(l||(l={})),function(t){t.long="long",t.medium="medium",t.notAvailable="notavailable",t.short="short"}(u||(u={})),function(t){t.akamaiLive="29",t.akamaiUniversalLive="31",t.clip="35",t.file="1",t.kalturaRecordedLive="36",t.lectureCapture="37",t.limelightLive="limeLight.LIVE_STREAM",t.liveChannel="33",t.liveStream="32",t.liveStreamOntextdataCaptions="42",t.manualLiveStream="30",t.recordedLive="34",t.searchProvider="6",t.url="5",t.velocixLive="velocix.VELOCIX_LIVE",t.webcam="2"}(p||(p={})),function(t){t[t.archiveOrg=22]="archiveOrg",t[t.ccmixter=10]="ccmixter",t[t.current=12]="current",t[t.flickr=3]="flickr",t[t.jamendo=9]="jamendo",t[t.kaltura=20]="kaltura",t[t.kalturaPartner=23]="kalturaPartner",t[t.kalturaUserClips=21]="kalturaUserClips",t[t.mediaCommons=13]="mediaCommons",t[t.metacafe=24]="metacafe",t[t.myspace=7]="myspace",t[t.nypl=11]="nypl",t[t.partnerSpecific=100]="partnerSpecific",t[t.photobucket=8]="photobucket",t[t.searchProxy=28]="searchProxy",t[t.youtube=4]="youtube"}(d||(d={}))},152:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var o=n(85),i=n(38),r=n(29),a=n(48),s=n(59),c=function(){function t(){}return t.buildNote=function(t,e){var n=new o.a;return this.mergeNoteObject(n,t,e),n},t.getPostNote=function(t,e){var n={};return n.topic=t.topic,n.body=t.body,n.ps=Math.floor(t.ps),t.emotion&&(n.emotion=t.emotion.type),n.origin=s.a.origin,n.deep_link=s.a.mediaDeepLink(n.ps,e.player.cachedMediaSrc),n.group_id=e.groupId,n},t.getPatchNote=function(t){var e={};return e.topic=t.topic,e.body=t.body,t.emotion&&(e.emotion=t.emotion.type),e},t.mergeNoteObject=function(t,e,n){Object(r.a)(t,"id",e.id),Object(r.a)(t,"threadId",e.thread_id),Object(r.a)(t,"authorId",e.author_id),Object(r.a)(t,"createdAt",e.created_at,(function(){t.createdAt.setTime(Date.parse(e.created_at))})),Object(r.a)(t,"updatedAt",e.updated_at,(function(){t.updatedAt.setTime(Date.parse(e.updated_at))})),Object(r.a)(t,"state",e.state),Object(r.a)(t,"body",e.body),Object(r.a)(t,"topic",e.topic),Object(r.a)(t,"ps",e.ps),Object(r.a)(t,"origin",e.origin),Object(r.a)(t,"deepLink",e.deep_link),e.emotion&&e.emotion!==i.c.UNKNOWN?(t.emotion=a.a.createEmotion(e.emotion,n,t.id),t.emotion.disabled=!0):t.emotion=a.a.createUnknownEmotion()},t.parseNotes=function(t,e){var n=[];if(!t)return n;for(var o=0;o<t.length;++o){var i=this.buildNote(t[o],e);n.push(i)}return n},t}()},153:function(t,e,n){"use strict";var o=new function(){this.disabledBrowsers={ie:["10","9","8","7"]},this.browserEncodeUri=["ie","edge"],this.fullscreenFullySupportedBrowsers={safari:!0,chrome:["63","62","61","60","59","58","57","56"]}};e.a=o},154:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var o=n(29),i=function(){function t(){this.map={}}return t.prototype.setItem=function(t,e){this.map[t]=e},t.prototype.getItem=function(t){return void 0!==this.map[t]?this.map[t]:null},t.prototype.removeItem=function(t){this.map[t]=void 0},t}(),r=function(){function t(t,e,n){this.prefix="",this.keys=[],this._keysKey="storage_keys","string"==typeof e&&(this.prefix=e),this.store=t||new i,"string"==typeof n&&(this._keysKey=n),this.keys=this.getKeys()}return t.isExpired=function(t){return!("object"!=typeof t||!Object(o.k)(t.exp))&&Date.now()>=t.exp},t.prototype.set=function(t,e,n,i){void 0===i&&(i=!1);var r=this._getPrefixedKey(t);try{var a={data:e};return n&&Object(o.k)(n)&&(a.exp=Date.now()+n),this.store.setItem(r,btoa(JSON.stringify(a))),i?Promise.resolve():this._updateKeys(t)}catch(t){return Promise.reject(t)}},t.prototype.get=function(e,n){void 0===n&&(n=!1);var o,i=this._getPrefixedKey(e);try{if(null===(o=this.store.getItem(i)))return Promise.resolve(null);if(o=JSON.parse(atob(o)),t.isExpired(o))return this.store.removeItem(i),n?Promise.resolve({data:o.data,isExpired:!0}):Promise.resolve(null)}catch(t){return Promise.reject(t)}return"object"==typeof o&&void 0!==o.data?Promise.resolve(o.data):Promise.resolve(null)},t.prototype.getSync=function(e,n){if(void 0===n&&(n=!1),!this.hasKey(e)&&e!==this._keysKey)return null;var o,i=this._getPrefixedKey(e);try{if(null===(o=this.store.getItem(i)))return null;if(o=JSON.parse(atob(o)),t.isExpired(o))return this.store.removeItem(i),n?{data:o.data,isExpired:!0}:null}catch(t){return this.logger&&this.logger.warn("error getting item ("+e+"): ",t),null}return"object"==typeof o&&void 0!==o.data?o.data:null},t.prototype.remove=function(t){try{this.hasKey(t)&&this.store.removeItem(this._getPrefixedKey(t))}catch(t){return Promise.reject(t)}return Promise.resolve()},t.prototype.flush=function(){var t=this;try{return this.keys.forEach((function(e){t.store.removeItem(t._getPrefixedKey(e))})),this.keys=[],this.remove(this._keysKey)}catch(t){return Promise.reject(t)}},t.prototype.getKeys=function(){return this.getSync(this._keysKey)||[]},t.prototype.hasKey=function(t){return-1!==this.keys.indexOf(t)},t.prototype._updateKeys=function(t){var e=this;if(this.hasKey(t))return Promise.resolve();var n=this.keys.slice();return n.push(t),this.set(this._keysKey,n,0,!0).then((function(){e.keys.push(t)}))},t.prototype._getPrefixedKey=function(t){return this.prefix+t},t}()},155:function(t,e,n){"use strict";n.d(e,"b",(function(){return h})),n.d(e,"a",(function(){return m}));var o=n("aurelia-framework"),i=n("aurelia-validation"),r=n(156),a=n(76),s=n(57),c=n.n(s),l=n(29),u=n(32),p=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(){function t(t){this.validationController=t,this.validationController.validateTrigger=i.validateTrigger.manual}var e;return e=t,t.prototype.parseConfig=function(t){var n=t,o=this.validationController,i=!1;if(Object(l.j)(t)){if(i=!0,e.warn("Legacy API detected, please updated the configuration according to latest docs."),1!=t.length){var r="Configuration array length must be 1";return e.error(r),Promise.reject(new Error(r))}n=t[0],m.applyLegacy(n)}if(o.addObject(n,f.rules),n.features&&o.addObject(n.features,g.rules),n.ux&&o.addObject(n.ux,b.rules),n.thread&&o.addObject(n.thread,y.rules),n.width&&o.addObject(n.width,v.rules),n.align&&o.addObject(n.align,w.rules),n.margins&&o.addObject(n.margins,O.rules),n.launchSource&&o.addObject(n.launchSource,_.rules),Object(l.j)(n.widgets))for(var a=0;a<n.widgets.length;a++){var s=n.widgets[a];o.addObject(s,x.rules),s.player&&o.addObject(s.player,E.rules),s.timeline&&(o.addObject(s.timeline,S.rules),s.timeline.embedded&&e.warn("Detected Deprecated Configuration: timeline.embedded is not supported")),s.stats&&o.addObject(s.stats,j.rules)}return o.validate().then((function(t){if(!t.valid){var o=t.results.reduce((function(t,e){return e.valid?t:t+e.message}),"");return e.error("Invalid configuration: "+o),Promise.reject(new Error(o))}return m.fullConfig(n,i)})).then((function(t){for(var e=(t.locale||"en").slice(0,2).toLowerCase(),o=0;o<u.a.rtlLocales.length;o++)if(-1!==e.indexOf(u.a.rtlLocales[o])){t.rtl=!0;break}return t.rtl&&"en"===t.locale&&(t.locale="he"),n.phonePosition||"left"!==t.position||(t.phonePosition="left"),"boolean"!=typeof(n.ux||{}).openOnLoad&&t.ux.sidePanelLayout&&!t.ux.sidePanelOverlay&&(t.ux.openOnLoad=!0),t.ux.maxWidth=t.ux.maxWidth||t.width.max,t}))},t.prototype.cleanAnalyticsCopy=function(t){var e=m.fullConfig(t,!1);e.relativePositionElement=void 0;for(var n=0;n<e.widgets.length;n++){var o=e.widgets[n];o.player.element=void 0,o.player.api=void 0,o.stats=void 0,o.host=void 0}return e},t.error=function(t){window.console&&console.error("Annoto: "+t)},t.warn=function(t){window.console&&console.warn("Annoto: "+t)},t.toWidgetAPI=function(t,e){var n=new a.b;return n.standAlone=!1,n.position=t.position,n.phonePosition=t.phonePosition,n.element=t.relativePositionElement,n.maxWidth=t.ux.maxWidth,n.align=t.align,n.margins=t.margins,n.rtl=t.rtl,n.locale=t.locale,n.ux=t.ux,n.thread=t.thread,n.demoMode=t.demoMode,n.launchSource=t.launchSource,n.player=e.player,n.timeline=e.timeline,n.open=e.openOnLoad||t.ux.openOnLoad,n.demoDiscussion=e.demoDiscussion,n.stats=e.stats,n.host=e.host,n.thread.type="page"===n.player.type?"text":"video",n.element||(n.element=n.player.element),"text"===n.thread.type&&(n.host||n.player.element===document.body||(n.host="string"==typeof n.player.element?o.d.getElementById(n.player.element):n.player.element)),n},t=e=p([Object(o.t)(o.i.of(i.ValidationController)),d("design:paramtypes",[i.ValidationController])],t)}(),m=function(){function t(){}return t.fullConfig=function(t,e){var n=c()(this.defaultConfig,t);e&&this.cleanLegacy(n);var o=c()(this.defaultConfig,n);t.features&&(o.features=c()(this.defaultFeatures,t.features)),t.ux&&(o.ux=c()(!0,this.defaultUx,t.ux)),t.thread&&(o.thread=c()(this.defaultThread,t.thread)),t.width&&(o.width=c()(this.defaultWidth,t.width)),t.align&&(o.align=c()(this.defaultAlign,t.align)),t.margins&&(o.margins=c()(this.defaultMargins,t.margins));for(var i=[],r=0;r<o.widgets.length;r++){var a=c()(this.defaultWidget,o.widgets[r]);a.player&&(a.player=c()(this.defaultPlayer,a.player)),a.timeline&&(a.timeline=c()(this.defaultTimeline,a.timeline)),a.stats&&(a.stats=c()(this.defaultStats,a.stats)),i.push(a)}return o.widgets=i,o},Object.defineProperty(t,"defaultConfig",{get:function(){return{clientId:null,position:"right",phonePosition:"right",relativePositionElement:void 0,align:this.defaultAlign,width:this.defaultWidth,margins:this.defaultMargins,rtl:!1,locale:"en",widgets:[],thread:this.defaultThread,demoMode:!1,launchSource:void 0,features:this.defaultFeatures,ux:this.defaultUx,zIndex:100,fsZIndex:100,helpUrl:void 0}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultWidth",{get:function(){return{max:u.a.widget.defaultMaxWidth}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultAlign",{get:function(){return{vertical:"center",horizontal:"element_edge"}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultUx",{get:function(){return{commentsTopToBottom:!1,sidePanelLayout:!1,sidePanelFullScreen:!1,sidePanelOverlay:!1,sidePanelFullScreenWidth:370,sidePanelOverlayWidth:370,maxWidth:u.a.widget.defaultMaxWidth,openOnLoad:!1,kukuCloseOnLoad:!1,draggableDisabled:!1,pauseTriggers:{authTrigger:!0,cta:!0,formOpen:!0,timelineUgcTap:!0,widgetOpenOnPhone:!0},theme:"default"}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultMargins",{get:function(){return{left:0,right:0,top:0,bottom:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFeatures",{get:function(){return{comments:!0,privateNotes:!0,tabs:!0,cta:!1,commentsSubmit:!0,privateNotesSubmit:!0,userPreferences:!0,darkTheme:!0,threadVote:!1,voteEmotions:!0,commentSentiment:!0,minibar:!0,timeline:!0,stats:!1,popout:!1}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultThread",{get:function(){return{showReplies:!1,sort:"most_recent"}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultWidget",{get:function(){return{player:this.defaultPlayer,timeline:this.defaultTimeline,openOnLoad:!1,demoDiscussion:"",host:void 0,stats:this.defaultStats}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultPlayer",{get:function(){return{type:void 0,element:void 0,api:void 0,wide:!0,params:{}}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultTimeline",{get:function(){return{embedded:!1,height:32,overlayVideo:!1,disableDockPadding:!1,positionTopInFullScreen:!1,scrubberAlwaysOn:!1,scrubberHeight:2,scrubberColor:void 0}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultStats",{get:function(){return{host:void 0}},enumerable:!1,configurable:!0}),t.applyLegacy=function(t){void 0===t.relativePositionElement&&(t.relativePositionElement=t.element);var e={player:t.player,timeline:t.timeline,openOnLoad:t.open,demoDiscussion:t.demoDiscussion};t.widgets=[e]},t.cleanLegacy=function(t){t.element=void 0,t.player=void 0,t.timeline=void 0,t.open=void 0,t.demoDiscussion=void 0},t}();r.a.customRule("stringOrObject",(function(t,e){return null==t||"string"==typeof t||"object"==typeof t||"function"==typeof t}),"${$displayName} must be element id or DOM object.");var f=r.a.ensure("clientId").satisfiesRule("string").ensure("widgets").required().satisfiesRule("isArray").then().minItems(1).maxItems(1).ensure("position").satisfiesRule("valid",["left","right"]).ensure("phonePosition").satisfiesRule("valid",["left","right"]).ensure("relativePositionElement").satisfiesRule("stringOrObject").ensure("rtl").satisfiesRule("boolean").ensure("locale").satisfiesRule("string").ensure("thread").satisfiesRule("object").ensure("width").satisfiesRule("object").ensure("align").satisfiesRule("object").ensure("margins").satisfiesRule("object").ensure("zIndex").satisfiesRule("number").ensure("fsZIndex").satisfiesRule("number").ensure("demoMode").satisfiesRule("boolean").ensure("launchSource").satisfiesRule("object").ensure("features").satisfiesRule("object").ensure("helpUrl").satisfiesRule("string").then().ensureObject().satisfies((function(t){return t.demoMode||t.clientId})).withMessage("clientId must be provided in non demoMode."),g=r.a.ensure("comments").satisfiesRule("boolean").ensure("tabs").satisfiesRule("boolean").ensure("privateNotes").satisfiesRule("boolean").ensure("cta").satisfiesRule("boolean").ensure("commentsSubmit").satisfiesRule("boolean").ensure("privateNotesSubmit").satisfiesRule("boolean").ensure("userPreferences").satisfiesRule("boolean").ensure("darkTheme").satisfiesRule("boolean").ensure("threadVote").satisfiesRule("boolean").ensure("minibar").satisfiesRule("boolean").ensure("timeline").satisfiesRule("boolean").ensure("stats").satisfiesRule("boolean").ensure("popout").satisfiesRule("boolean"),b=r.a.ensure("commentsTopToBottom").satisfiesRule("boolean").ensure("draggableDisabled").satisfiesRule("boolean").ensure("sidePanelLayout").satisfiesRule("boolean").ensure("sidePanelFullScreen").satisfiesRule("boolean").ensure("sidePanelOverlay").satisfiesRule("boolean").ensure("sidePanelFullScreenWidth").satisfiesRule("number").ensure("sidePanelOverlayWidth").satisfiesRule("number").ensure("maxWidth").satisfiesRule("number").ensure("openOnLoad").satisfiesRule("boolean").ensure("kukuCloseOnLoad").satisfiesRule("boolean").ensure("ssoAuthRequestHandle").satisfiesRule("function").ensure("logoutRequestHandle").satisfiesRule("function").ensure("pauseTriggers").satisfiesRule("object").ensure("theme").satisfiesRule("valid",["default","dark"]),y=r.a.ensure("showReplies").satisfiesRule("boolean").ensure("sort").satisfiesRule("valid",["most_recent","top_rated","by_timetag"]),v=r.a.ensure("min").satisfiesRule("number").ensure("max").satisfiesRule("number"),w=(r.a.ensure("min").satisfiesRule("number").ensure("max").satisfiesRule("number"),r.a.ensure("vertical").satisfiesRule("valid",["center","top","bottom"]).ensure("horizontal").satisfiesRule("valid",["screen_edge","element_edge","inner"])),O=r.a.ensure("top").satisfiesRule("number").ensure("bottom").satisfiesRule("number").ensure("left").satisfiesRule("number").ensure("right").satisfiesRule("number"),_=r.a.ensure("accessToken").satisfiesRule("string").ensure("consumerKey").satisfiesRule("string").required().ensure("origin").satisfiesRule("string").required(),x=r.a.ensure("player").satisfiesRule("object").required().ensure("timeline").satisfiesRule("object").ensure("openOnLoad").satisfiesRule("boolean").ensure("demoDiscussion").satisfiesRule("string").ensure("host").satisfiesRule("object").ensure("stats").satisfiesRule("object"),E=r.a.ensure("type").satisfiesRule("valid",a.a.array).required().ensure("element").satisfiesRule("stringOrObject").ensure("wide").satisfiesRule("boolean").ensure("api").satisfiesRule("object").ensure("params").satisfiesRule("object").ensure("mediaSrc").satisfiesRule("function").ensure("mediaDetails").satisfiesRule("function").then().ensureObject().satisfies((function(t){return t.type!==a.a.CUSTOM||t.api})).withMessage("player.api must be provided for custom player.type").ensureObject().satisfies((function(t){return t.type===a.a.CUSTOM||t.element})).withMessage("player.element must be provided for non custom player.type"),S=r.a.ensure("embedded").satisfiesRule("boolean").ensure("height").satisfiesRule("integerRange",24,256).ensure("overlayVideo").satisfiesRule("boolean").ensure("disableDockPadding").satisfiesRule("boolean").ensure("positionTopInFullScreen").satisfiesRule("boolean").ensure("scrubberAlwaysOn").satisfiesRule("boolean").ensure("scrubberHeight").satisfiesRule("integerRange",2,5).ensure("scrubberColor").satisfiesRule("string"),j=r.a.ensure("host").satisfiesRule("object")},156:function(t,e,n){"use strict";var o,i=n("aurelia-validation"),r=n(29),a=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});i.ValidationRules.customRule("boolean",(function(t,e){return null==t||!0===t||!1===t}),"${$displayName} must be a boolean."),i.ValidationRules.customRule("string",(function(t,e){return null==t||"string"==typeof t}),"${$displayName} must be a string."),i.ValidationRules.customRule("object",(function(t,e){return null==t||"object"==typeof t||"function"==typeof t}),"${$displayName} must be an object."),i.ValidationRules.customRule("function",(function(t,e){return null==t||"function"==typeof t}),"${$displayName} must be a function."),i.ValidationRules.customRule("isArray",(function(t,e){return null==t||Object(r.j)(t)}),"${$displayName} must be an array."),i.ValidationRules.customRule("valid",(function(t,e,n){return null==t||-1!==n.indexOf(t)}),"${$displayName} must be one of the values: ${$config.validValues}.",(function(t){return{validValues:t}})),i.ValidationRules.customRule("validItems",(function(t,e,n){if(null==t)return!0;for(var o=0;o<t.length;o++)if(-1===n.indexOf(t[o]))return!1;return!0}),"${$displayName} array must contain only the following values: ${$config.validItems}.",(function(t){return{validItems:t}})),i.ValidationRules.customRule("integerRange",(function(t,e,n,o){return null==t||Number.isInteger(t)&&t>=n&&t<=o}),"${$displayName} must be an integer between ${$config.min} and ${$config.max}.",(function(t,e){return{min:t,max:e}})),i.ValidationRules.customRule("number",(function(t,e){return null==t||Object(r.k)(t)}),"${$displayName} must be a number.");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(i.ValidationRules);e.a=s},157:function(t,e,n){"use strict";e.a={endpoint:"root",authPath:"/hosts/auth",tokenKey:"host_token",authHeader:"host-authorization",authTokenType:"Bearer",autoUpdateToken:!0,httpInterceptor:!0,expirationMargin:5}},158:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var o=function(){function t(){}return t.prototype.play=function(t){var e=t.player;return e&&e.isLive?Promise.resolve():e.play()},t.prototype.pause=function(t,e,n){void 0===n&&(n=!1);var o=t.player;return o&&o.isLive||!t.ux.pauseTriggers[e]?Promise.resolve():o.pause(n)},t.prototype.setCurrentTime=function(t,e){var n=t.player;return n&&n.isLive?Promise.resolve():n.setCurrentTime(e)},t}()},159:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var o=n("aurelia-framework"),i=n("aurelia-i18n"),r=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(){function t(t){this.i18n=t}return t.prototype.getLocale=function(){return this.i18n.getLocale()},t.prototype.getLanguageCode=function(){return this.getLocale().slice(0,2).toLowerCase()},t=r([Object(o.t)(i.I18N),a("design:paramtypes",[i.I18N])],t)}()},162:function(t,e,n){"use strict";function o(t){var e=document.querySelector("meta[name='"+t+"']");if(e)return e.getAttribute("content")}n.d(e,"a",(function(){return o}))},163:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));n("aurelia-framework");var o=function(){return(o=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=function(t,e){return t.analyticsController.recordGaEvent({collection:"user_space",action:"open",label:e&&e.defaultView||"feed"}),t.dialog.open({viewModel:"organs/user-space/dialog/nn-user-space-dialog",lock:!1,host:t.appCommon.appElement.getParent(),container:t.widget.auContainer,focusOnClose:!1,fixed:!0,model:o({},e),startingZIndex:(t.widget.overlay?t.widget.overlay.zIndex:t.settings.zIndex)+1})}},164:function(t,e){},165:function(t,e,n){"use strict";function o(t,e,n,o){void 0===n&&(n=1e3),void 0===o&&(o="easeOutQuad");var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},r=t.scrollTop,a=0,s=Math.max(.3,Math.min(Math.abs(r-e)/n,2)),c={easeOutSine:function(t){return Math.sin(t*(Math.PI/2))},easeInOutSine:function(t){return-.5*(Math.cos(Math.PI*t)-1)},easeInOutQuint:function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)}};return new Promise((function(n){var l=function(){var u=(a+=1/60)/s,p=c[o](u);u<1?(i(l),t.scrollTop=r+(e-r)*p):(t.scrollTop=e,n())};l()}))}function i(t,e,n){return void 0===e&&(e=1e3),void 0===n&&(n="easeOutQuad"),o(t,0,e,n)}function r(t,e,n){return void 0===e&&(e=1e3),void 0===n&&(n="easeOutQuad"),o(t,t.scrollHeight,e,n)}n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}))},166:function(t,e,n){"use strict";var o;n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return c}));var i={WELCOME:"welcome",SIGNUP:"signup",LOGIN:"login"},r={facebook:"facebook",google:"google",twitter:"twitter",linkedin:"linkedin"},a=function(t){return{"border-radius":"0 5px 5px 0",color:["#fff","important"],"text-transform":"none","min-width":"190px","background-color":[t,"important"]}},s=function(t){return{"border-radius":"5px 0 0 5px",color:["#fff","important"],width:"36px",height:"36px","background-color":[t,"important"]}},c=((o={})[r.google]={buttonStyle:a("#dc4e41"),iconStyle:s("#dc4e41"),text:"auth.social.google",iconClass:"annoto-icon annoto-icon-social_google_plus nn-icon-social_google_plus"},o[r.facebook]={buttonStyle:a("#3765a3"),iconStyle:s("#3765a3"),text:"auth.social.facebook",iconClass:"annoto-icon annoto-icon-social_facebook nn-icon-social_facebook"},o[r.twitter]={buttonStyle:a("#5ea9dd"),iconStyle:s("#5ea9dd"),text:"auth.social.twitter",iconClass:"annoto-icon annoto-icon-social_twitter nn-icon-social_twitter"},o[r.linkedin]={buttonStyle:a("#0274b3"),iconStyle:s("#0274b3"),text:"auth.social.linkedin",iconClass:"annoto-icon annoto-icon-social_linkedin nn-icon-social_linkedin"},o)},169:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var o=n("aurelia-framework"),i=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},r=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},a=function(){function t(t){this.startResult=t}return Object.defineProperty(t.prototype,"maxConcurency",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minPartSize",{get:function(){return 1048576},enumerable:!1,configurable:!0}),t.prototype.processPart=function(t){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,this.post(["resume="+(t.bytesOffset?"true":"false"),"finalChunk=false","resumeAt="+t.bytesOffset],t.data)];case 1:return e.sent(),[2]}}))}))},t.prototype.processEnd=function(t){return i(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return e=t[t.length-1],[4,this.post(["resume=true","finalChunk=true","resumeAt="+(e.bytesOffset+e.data.size)],new Blob)];case 1:return n.sent(),[2]}}))}))},t.prototype.post=function(t,e){return i(this,void 0,void 0,(function(){var n,o,i,a,s;return r(this,(function(r){switch(r.label){case 0:return n=this.startResult,o=n.uploadSignedUrl+"&"+t.join("&"),(i=new FormData).append("fileData",e),[4,fetch(o,{method:"POST",body:i})];case 1:if((a=r.sent()).status>=400)throw new Error(a.statusText);return[4,a.json()];case 2:if("KalturaAPIException"===(s=r.sent()).objectType)throw new Error("kaltura api exception ("+s.code+"): "+s.message);return[2]}}))}))},t}(),s=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},c=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},l=function(){function t(t,e){this.startResult=t,this.api=e}return Object.defineProperty(t.prototype,"maxConcurency",{get:function(){return 10},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minPartSize",{get:function(){return 5242880},enumerable:!1,configurable:!0}),t.prototype.processPart=function(t){return s(this,void 0,void 0,(function(){var e,n,o;return c(this,(function(i){switch(i.label){case 0:return e=this.startResult,[4,this.api.postAssetSignPart(e.asset,{partNumber:t.partNumber,uploadId:e.uploadId,provider:e.provider})];case 1:return n=i.sent(),[4,fetch(n.signedUrl,{body:t.data,method:"PUT"})];case 2:if((o=i.sent()).status>=400)throw new Error(o.statusText);return[2]}}))}))},t.prototype.processEnd=function(t){return s(this,void 0,void 0,(function(){return c(this,(function(t){return[2]}))}))},t}(),u=function(){return(u=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},p=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},d=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},h=function(){function t(t,e){this.api=t,this.queue=[],this.partChunks=[],this.concurency=0,this.listeners={},this.logger=o.h.getLogger("Annoto-asset-uploader"),this.options=u({concurency:1,partRetries:0,minPartSize:1048576},e)}return t.prototype.start=function(t,e){return p(this,void 0,void 0,(function(){var n;return d(this,(function(o){switch(o.label){case 0:if(this.status)throw new Error("upload already started");return[4,this.api.postAssetStart(t,e)];case 1:if("kaltura"===(n=o.sent()).provider)this.uploadHandler=new a(n);else{if("s3"!==n.provider)throw new Error("unsupported upload provider: "+n.provider);this.uploadHandler=new l(n,this.api)}return this.asset=n.asset,this.uploadId=n.uploadId,this.uploadSignedUrl=n.uploadSignedUrl,this.provider=n.provider,this.status="uploading",[2,u({},this.asset)]}}))}))},t.prototype.abort=function(){return p(this,void 0,void 0,(function(){var t,e,n,o,i,r=this;return d(this,(function(a){switch(a.label){case 0:if("aborted"===this.status)return[2,this.asset];if(!this.status)throw new Error("cannot abort not started upload");if("done"===this.status)throw new Error("cannot abort finished upload");return e=(t=this).uploadId,n=t.provider,o=t.uploadSignedUrl,this.status="aborted",[4,this.api.postAssetAbort(this.asset,{provider:n,uploadId:e,uploadSignedUrl:o})];case 1:return i=a.sent(),this.asset=i,setTimeout((function(){r.rejectEnd&&r.rejectEnd(new Error("aborted"))})),this.logger.debug("aborted"),[2,u({},i)]}}))}))},t.prototype.end=function(){return p(this,void 0,void 0,(function(){var t,e,n,o=this;return d(this,(function(i){if("done"===this.status)return[2,this.asset];if(!this.status)throw new Error("cannot end not started upload");if("aborted"===this.status)throw new Error("cannot end aborted upload");if("fail"===this.status)throw new Error("cannot end failed upload");return this.status="ending",t=new Promise((function(t,e){o.resolveEnd=t,o.rejectEnd=e})),this.partChunks.length>0&&(e=new Blob(this.partChunks),n=this.queue.length+1,this.logger.debug("push final part "+n+" ("+e.size+")"),this.queue.push({data:e,partNumber:n,bytesOffset:this.calcPartBytesOffset(n),status:"pending",failCount:0})),this.processQueue(),this.logger.debug("ending"),[2,t]}))}))},t.prototype.push=function(t){var e=this.options;if("uploading"!==this.status)throw new Error("invalid status, must be uploading");var n=t,o=Math.max(e.minPartSize,this.uploadHandler.minPartSize);if(t.size<o){if(this.logger.debug("added chunk "+(this.partChunks.length+1)+" ("+t.size+") to part "+(this.queue.length+1)),this.partChunks.push(t),this.partChunks.reduce((function(t,e){return t+e.size}),0)<o)return;n=new Blob(this.partChunks),this.partChunks=[]}var i=this.queue.length+1;this.logger.debug("push part "+i+" ("+n.size+")"),this.queue.push({data:n,partNumber:i,bytesOffset:this.calcPartBytesOffset(i),status:"pending",failCount:0}),this.processQueue()},t.prototype.getStatus=function(){return this.status},Object.defineProperty(t.prototype,"started",{get:function(){return!!this.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"finished",{get:function(){var t=this.status;return"fail"===t||"aborted"===t||"done"===t},enumerable:!1,configurable:!0}),t.prototype.onFail=function(t){this.listeners.fail=t},t.prototype.onProgress=function(t){this.listeners.progress=t},t.prototype.off=function(t){this.listeners[t]=void 0},t.prototype.calcPartBytesOffset=function(t){return void 0===t&&(t=this.queue.length),this.queue.reduce((function(e,n){return t>n.partNumber?e+n.data.size:e}),0)},t.prototype.shouldEnd=function(){return"ending"===this.status&&0===this.queue.filter((function(t){return"ok"!==t.status})).length},t.prototype.canProcess=function(){var t=this.concurency,e=this.options,n=this.status;return t<Math.min(e.concurency,this.uploadHandler.maxConcurency)&&("uploading"===n||"ending"===n)},t.prototype.processQueue=function(){var t=this,e=this,n=e.queue,o=e.rejectEnd,i=e.resolveEnd,r=e.options,a=e.provider,s=e.uploadId,c=e.uploadSignedUrl;if(this.canProcess())if(this.shouldEnd())this.postEnd().then((function(e){t.logger.debug("upload done: ",t.asset),i(e)})).catch((function(e){t.logger.error("post end error: ",e),o(e)}));else{var l=n.find((function(t){return"pending"===t.status||"fail"===t.status}));l&&this.processPart(l).finally((function(){var e=t.status;if("aborted"!==e&&"done"!==e&&"fail"!==e)return"fail"===l.status&&l.failCount>r.partRetries?(t.status="fail",t.api.postAssetAbort(t.asset,{provider:a,uploadId:s,uploadSignedUrl:c}).then((function(e){t.asset=e})).catch((function(e){t.logger.warn("error aborting failed upload: ",e)})).finally((function(){t.notifyFail(),t.rejectEnd&&t.rejectEnd(new Error("aborted"))}))):"fail"===l.status?setTimeout((function(){t.processQueue()}),2e3):void t.processQueue()}))}},t.prototype.processPart=function(t){return p(this,void 0,void 0,(function(){var e;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t.status="uploading",this.logger.debug("processing part: "+t.partNumber+" ("+t.status+")"),this.concurency+=1,[4,this.uploadHandler.processPart(t)];case 1:return n.sent(),t.status="ok",this.logger.debug("processing part: "+t.partNumber+" ("+t.status+")"),[3,3];case 2:return e=n.sent(),t.status="fail",t.failCount+=1,this.logger.warn("processing part "+t.partNumber+" ("+t.status+")["+t.failCount+"]: ",e),[3,3];case 3:return this.concurency=Math.max(0,this.concurency-1),[2,t]}}))}))},t.prototype.postEnd=function(){return p(this,void 0,void 0,(function(){var t,e,n,o,i,r;return d(this,(function(a){switch(a.label){case 0:e=(t=this).uploadId,n=t.provider,o=t.uploadSignedUrl,this.status="done",a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this.uploadHandler.processEnd(this.queue)];case 2:return a.sent(),[4,this.api.postAssetEnd(this.asset,{uploadId:e,provider:n,uploadSignedUrl:o,parts:this.queue.map((function(t){return{partNumber:t.partNumber}}))})];case 3:return i=a.sent(),this.asset=i,[3,5];case 4:throw r=a.sent(),this.status="fail",this.notifyFail(),r;case 5:return[2,u({},this.asset)]}}))}))},t.prototype.notifyFail=function(){if(this.listeners.fail)try{this.listeners.fail()}catch(t){}},t.prototype.notifyProgress=function(){if(this.listeners.progress)try{this.listeners.progress({parts:this.queue.length,uploaded:this.queue.filter((function(t){return"ok"===t.status})).length,uploading:this.queue.filter((function(t){return"uploading"===t.status})).length})}catch(t){}},t}()},170:function(t,e,n){"use strict";n.d(e,"a",(function(){return v}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n("aurelia-i18n"),a=n(50),s=n(55),c=n(49),l=n(87),u=n(52),p=n(38),d=n(29),h=n(48),m=function(){function t(){}return t.buildHint=function(t,e){var n=new l.a;return this.mergeHintObject(n,t,e),n},t.mergeHintObject=function(t,e,n){Object(d.a)(t,"id",e.id),Object(d.a)(t,"hostId",e.host_id),Object(d.a)(t,"createdAt",e.created_at,(function(){t.createdAt.setTime(Date.parse(e.created_at))})),Object(d.a)(t,"updatedAt",e.updated_at,(function(){t.updatedAt.setTime(Date.parse(e.updated_at))})),Object(d.a)(t,"data",e.data);var o=e.author||{};t.author?t.author.update(o,e.author_id):t.author=new u.a(e.author_id,o.name,o.photo_url,o.scopes),e.emotion&&e.emotion!==p.c.UNKNOWN?(t.emotion=h.a.createEmotion(e.emotion,n,t.id),t.emotion.disabled=!0):t.emotion=h.a.createUnknownEmotion(),t.body="user_hint_"+t.id+":body",t.topic="user_hint_"+t.id+":topic",t.options=e.options||{}},t.parseHints=function(t,e){var n=[];if(!t)return n;for(var o=0;o<t.length;++o){var i=this.buildHint(t[o],e);n.push(i)}return n},t}(),f=n(31),g=n(32),b=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},v=function(){function t(t,e,n,i,r){var a=this;this.hints=[],this.loaded=!1,this.loadHintsPromise=null,this.apiService=t,this.user=e,this.i18n=i,this.eventAggregator=r,this.settings=n,this.logger=o.h.getLogger("Annoto-user-hints"),this.eventAggregator.subscribe(f.a.USER_AUTHENTICATED,(function(){return a._loadHintsChain()})),this.eventAggregator.subscribe(f.a.USER_LOGOUT,(function(){return a._loadHintsChain()}))}return t.prototype.getHints=function(){return this.loaded?Promise.resolve(this.hints):this._loadHintsChain()},t.prototype.clearHeadHint=function(){var t=this,e=this.hints[0];return e instanceof l.a?this.user.demoMode?this._applyClearHeadHint():this.apiService.clearUserHint(e.id).then((function(){return t._applyClearHeadHint()})).catch((function(e){return t.logger.warn("Error clearing User hint"),t._applyClearHeadHint()})):Promise.resolve(null)},t.prototype._applyClearHeadHint=function(){var t=this,e=this.hints[0],n=this.hints;return Promise.resolve().then((function(){return t.hints=[],Object(d.p)()})).then((function(){t.hints=n.slice(1)})).then((function(){return e})).catch((function(e){return t.logger.error(e),t.loaded=!1,t.hints=[],null})).catch((function(e){t.logger.warn("Error applying User hint clear")})).finally((function(){t.publishUpdate()}))},t.prototype._loadHintsChain=function(){var t=this._loadHints();return this.loadHintsPromise=Object(d.u)(this.loadHintsPromise,t),this.loadHintsPromise},t.prototype._loadHints=function(){var t=this;return this.logger.debug("Loading user hints"),this.loaded=!1,this.hints=[],this.user.demoMode?this._applyHints(g.a.userHints.demo).catch((function(e){t.logger.error(e),t.hints=[],t.loaded=!1})).finally((function(){t.publishUpdate()})):this.user.authenticated?this.apiService.getUserHints().then((function(e){var n=e.results||[];return t._applyHints(n)})).catch((function(e){t.logger.error(e),t.hints=[],t.loaded=!1})).finally((function(){t.publishUpdate()})):(this.loaded=!0,Promise.resolve(this.hints).finally((function(){t.publishUpdate()})))},t.prototype._applyHints=function(t){var e=this;return Promise.resolve().then((function(){for(var n=function(n){var o=t[n];Object(d.f)(o.data,(function(t,n){e.i18n.i18next.addResourceBundle(t,"user_hint_"+o.id,n,!0,!0)}))},o=0;o<t.length;o++)n(o);return m.parseHints(t,e.settings)})).then((function(t){return e.hints=t,e.loaded=!0,t}))},t.prototype.publishUpdate=function(){this.eventAggregator.publish(f.a.USER_HINTS_UPDATE)},t=b([Object(o.t)(s.a,c.a,a.a,r.I18N,i.EventAggregator),y("design:paramtypes",[s.a,c.a,a.a,r.I18N,i.EventAggregator])],t)}()},171:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var o=n("aurelia-framework"),i=n(31),r=n(40),a=n(29),s=n(32),c=n(91),l=n(75),u=n(34),p=function(){function t(t){var e,n,i,r,u=this;this.disposables=[],this.handledEvents=new Set,this.handleLiveSessionInvite=function(t){var e=u.store;Promise.resolve().then((function(){if(e.user.authenticated)return e.interactiveController.setOffAndDoShow().then((function(){return e.dialog.open({viewModel:"organs/people/nn-live-session-invite-dialog",lock:!1,host:e.widget.containerElement,container:e.widget.auContainer,model:t,focusOnClose:!1})}))})).catch((function(t){u.logger.warn("eventsHandle: ",t)}))},this.updatePollHandle=function(){return u.updatePresence().then((function(){})).catch((function(t){u.logger.warn("update presence: ",t)}))},this.store=t,this.logger=o.h.getLogger("Annoto-presence-controller"),this.handleThrottledLiveSessionInvite=(e=this.handleLiveSessionInvite,n=3e4,function(){var t=this,o=arguments;r?(clearTimeout(i),i=setTimeout((function(){Date.now()-r>=n&&(e.apply(t,o),r=Date.now())}),n-(Date.now()-r))):(e.apply(t,o),r=Date.now())}),this.updatePoll=new c.a((function(){var t=s.a.presence.updateInterval;return Object(l.a)(t.min,t.max)}),this.updatePollHandle),Object(a.c)().then((function(){return u.addDisposables()}))}return t.prototype.dispose=function(){Object(a.d)(this.disposables),this.disposables=[],this.updatePollStop()},t.prototype.updatePresence=function(){var t=this.store;return t.presenceDisabled||!t.threadController.threadApplied?Promise.reject(new u.a(u.b.PEOPLE.UPDATE,"presence disabled")):t.apiService.updatePresence({groupId:t.groupId,threadId:t.threadId},{})},t.prototype.handleEvents=function(t){if(this.store.user.authenticated){var e=t[0];if(e&&e.type&&e.data)if("live_session_invite"===e.type){var n=e.data;this.handledEvents.has(n.id)||(this.handledEvents.add(n.id),this.handleThrottledLiveSessionInvite(n))}else this.logger.debug("unknown event: ",e.type)}},t.prototype.threadResetHandle=function(){this.updatePollStop()},t.prototype.threadAppliedHandle=function(){this.updatePollStart()},t.prototype.authChangeHandle=function(){this.store.user.authenticated?this.updatePollStart():this.updatePollStop()},t.prototype.addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.eventAggregator.subscribe(i.a.USER_AUTH_CHANGE,(function(){return t.authChangeHandle()}))),n.push(e.threadController.on(r.a.RESET,(function(){return t.threadResetHandle()}))),n.push(e.threadController.on(r.a.THREAD_APPLIED,(function(){return t.threadAppliedHandle()}))),n.push(e.threadController.on(r.a.METADATA_CHANGE,(function(){var n=e.threadController.model.events||[];t.handleEvents(n)})))},t.prototype.updatePollStart=function(){!this.store.presenceDisabled&&this.store.threadController.threadApplied&&this.updatePoll.start(!0)},t.prototype.updatePollStop=function(){this.updatePoll.stop()},t}()},192:function(t,e,n){"use strict";var o=n(169);n.d(e,"AssetUploader",(function(){return o.a}));n(164)},269:function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoAppBootstrap",(function(){return d}));var o,i=n(0),r=n(22),a=(n(15),n("aurelia-templating-resources")),s=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.sanitize=function(t){return t?t.replace(c,""):""},e}(a.HTMLSanitizer),u=n("aurelia-i18n"),p=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,i++)o[i]=r[a];return o},d=function(){function t(t){this.boot=t}return t.prototype.bootApp=function(){var t=this;return new Promise((function(e,n){Object(r.bootstrap)((function(o){return o.use.basicConfiguration(),i.DOM.createMutationObserver=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o,i=window;return i.Zone&&i.Zone.__symbol__&&(o=i[i.Zone.__symbol__("MutationObserver")]||i[i.Zone.__symbol__("WebKitMutationObserver")]),new((t=o||i.MutationObserver||i.WebKitMutationObserver).bind.apply(t,p([void 0],e)))},o.use.plugin("aurelia-api",(function(t){})),o.use.plugin("aurelia-validation"),o.use.plugin("aurelia-i18n",(function(t){var e=["t","i18n"];return u.TCustomAttribute.configureAliases(e),t.i18next.use(u.Backend.with(o.loader)),t.setup({backend:{loadPath:"locales/{{lng}}/{{ns}}.json",crossDomain:!0},attributes:e,fallbackLng:"en",cleanCode:!0,debug:!1})})),o.use.container.registerInstance("AnnotoBootstrap",t.boot),o.use.feature("vc/index"),o.use.feature("bb/index"),o.use.feature("components/index"),o.use.feature("dialog/index"),o.use.feature("auth/index"),o.use.feature("app-common/index"),o.use.feature("dap/index"),o.use.singleton(a.HTMLSanitizer,l),o.start().then((function(){return o.setRoot("annoto-app",t.boot.appEl)})).then((function(){e()})).catch((function(t){n(t)}))}))}))},t}()},29:function(t,e,n){"use strict";n.d(e,"i",(function(){return r})),n.d(e,"z",(function(){return a})),n.d(e,"l",(function(){return s})),n.d(e,"a",(function(){return c})),n.d(e,"q",(function(){return l})),n.d(e,"r",(function(){return u})),n.d(e,"y",(function(){return p})),n.d(e,"f",(function(){return d})),n.d(e,"A",(function(){return h})),n.d(e,"m",(function(){return m})),n.d(e,"g",(function(){return f})),n.d(e,"h",(function(){return g})),n.d(e,"e",(function(){return y})),n.d(e,"s",(function(){return v})),n.d(e,"j",(function(){return w})),n.d(e,"v",(function(){return O})),n.d(e,"o",(function(){return _})),n.d(e,"p",(function(){return x})),n.d(e,"u",(function(){return E})),n.d(e,"t",(function(){return S})),n.d(e,"c",(function(){return j})),n.d(e,"n",(function(){return C})),n.d(e,"x",(function(){return T})),n.d(e,"b",(function(){return P})),n.d(e,"k",(function(){return k})),n.d(e,"w",(function(){return A})),n.d(e,"d",(function(){return R}));var o=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},i=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};function r(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function a(t,e){return!(t!==e)}function s(t,e){if(!t)return!1;if("string"==typeof t){var n=t.toLowerCase();if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[1-4][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n))return!1;var o=n.charAt(14),i=o?parseInt(o):0;if(e&&i!==e)return!1;switch(i){case 1:case 2:return!0;case 3:case 4:return-1!==["8","9","a","b"].indexOf(n.charAt(19))}}return!1}function c(t,e,n,o){void 0!==n&&("function"==typeof o?o(t,e,n):t[e]=n)}function l(t,e){return u(t,e,"function")}function u(t,e,n){return("object"==typeof t||"function"==typeof t)&&typeof t[e]===n}function p(t){return t.charAt(0).toUpperCase()+t.slice(1)}function d(t,e,n){for(var o in t)t.hasOwnProperty(o)&&(n?e.call(n,o,t[o]):e(o,t[o]))}function h(t,e,n,o){for(var i=!0,r=0;r<t.length;r++)!0!==l(e,t[r])&&("function"==typeof n&&o&&n.call(o,"API cannot "+t[r]),i=!1);return i}function m(t,e){var n=!0,o=!1;if("string"==typeof e&&""!==e){var i=document.getElementById(e);i&&"object"==typeof i&&(n=!1),o=!0}if(n){var r=document.createElement("script");r.src=t,o&&(r.id=e);var a=document.getElementsByTagName("script")[0];a?a.parentNode.insertBefore(r,a):document.getElementsByTagName("head")[0].appendChild(r)}}function f(t,e){for(var n=e,o=t,i=window.getComputedStyle(n),r=window.getComputedStyle(o),a={top:0,left:0,right:0,bottom:0};o&&o!==n;)a.left+=o.offsetLeft,a.top+=o.offsetTop,o=o.offsetParent;return a.bottom=parseInt(i.height)-parseInt(r.height)-a.top,a.right=parseInt(i.width)-parseInt(r.width)-a.left,a}function g(t,e,n){var o=f(t,e),i=f(n,e);return{elPos:o,offsetPos:i,top:o.top-i.top,left:o.left-i.left,bottom:o.bottom-i.bottom,right:o.right-i.right}}function b(t){if(!t)return!1;var e=window.getComputedStyle(t,null),n=e.getPropertyValue("transform")||e.getPropertyValue("-moz-transform")||e.getPropertyValue("-webkit-transform")||e.getPropertyValue("-ms-transform")||e.getPropertyValue("-o-transform");return!(!n||"none"===n)&&n}function y(t){for(var e={},n=t.parentElement;n;){var o=b(n);if(o){e.element=n,e.matrix=o;break}n=n.parentElement}return e}function v(t){var e=function(t){return"string"!=typeof t?[]:t.replace(/[^0-9\-.,]/g,"").split(",")}(t),n={tx:0,ty:0};return 6===e.length?(n.tx=parseInt(e[4]),n.ty=parseInt(e[5])):16===e.length&&(n.tx=parseInt(e[12]),n.ty=parseInt(e[13])),n}function w(t){return t&&(t.constructor===Array||t instanceof Array||Array.isArray(t))}function O(t,e){var n=t.split("?");if(n.length>=2){for(var o=encodeURIComponent(e)+"=",i=n[1].split(/[&;]/g),r=i.length;r-- >0;)-1!==i[r].lastIndexOf(o,0)&&i.splice(r,1);return t=n[0]+(i.length>0?"?"+i.join("&"):"")}return t}function _(t){return function(){return setTimeout(t,0)}}function x(){return new Promise((function(t){setTimeout(t,0)}))}function E(t,e){return t?t.then((function(){return e})):e||Promise.resolve()}function S(t){if("function"!=typeof t)throw new TypeError("expected a function");return Promise.resolve().then((function(){return t()}))}function j(t){return void 0===t&&(t=0),new Promise((function(e){return setTimeout(e,t)}))}function C(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,Promise.all([t,j(e)])];case 1:return[2,n.sent()[0]]}}))}))}function T(t,e){return new Promise((function(n,o){t.then(n,o),j(e).then((function(){var t=new Error("Operation timed out");t.isTimeout=!0,o(t)}))}))}function P(){var t,e,n=new Promise((function(){t=arguments[0],e=arguments[1]}));return{resolve:t,reject:e,promise:n}}function k(t){return!isNaN(parseFloat(t))&&isFinite(t)}function A(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function R(t){for(var e=0;e<t.length;e++)t[e].dispose()}},31:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var o={USER_LOGOUT:"annoto:user:logout",USER_AUTHENTICATED:"annoto:user:authenticated",USER_AUTH_CHANGE:"annoto:user:auth-change",USER_PERMISSIONS_CHANGE:"annoto:user:perm-change",PRIVATE_MODE_CHANGED:"annoto:mode:privacy",PLAYER_FULL_SCREEN_CHANGE:"annoto:player:full-screen-change",METADATA_CHANGE:"annoto:metadata:change",UX_EVENT:"annoto:ux:event",WIDGET_ATTACHED:"annoto:widget:attach",WIDGET_DETACHED:"annoto:widget:detached",TIMELINE_ATTACHED:"annoto:timeline:attach",TIMELINE_DETTACHED:"annoto:timeline:detach",SCREEN_PARAMS_CHANGE:"annoto:screen-params-change",USER_HINTS_UPDATE:"annoto:user-hints:update",VIDEO_BENCHMARK_EVENT:"annoto:analytics:video-benchmark",STATS_EVENT:"annoto:analytics:stats",WIDGET_OPEN:"annoto:widget:open",TRIGGER_DRAWER_OPEN:"annoto:drawer:do-open",TRIGGER_DRAWER_HIDE:"annoto:drawer:do-hide",DRAWER_OPEN:"annoto:drawer:open",DRAWER_CLOSE:"annoto:drawer:close",COMMENT_FORM_OPEN:"annoto:comment-form:open",COMMENT_FORM_CLOSE:"annoto:comment-form:close",SOME_FORM_OPEN_CHANGE:"annoto:comment-form:some-change",COMMENT_FORM_FOCUS:"annoto:comment-form:focus",PAGES_SHOW:"annoto:pages:show",PAGES_NAV_COMPLETE:"annoto:pages:nav-complete",CTA_TOGGLE:"annoto:cta:toggle",FOCUS_ON_COMPONENT_REQUEST:"annoto:focus:component",FOLLOW_THREAD:"annoto:thread:follow",FOLLOW_GROUP:"annoto:group:follow",DAP_START:"annoto:dap:start",DAP_FINISH:"annoto:dap:finish",DAP_END:"annoto:dap:end",DEMO_ON:"annoto:demo:on",DEMO_OFF:"annoto:demo:off"}},32:function(t,e,n){"use strict";var o=n(11),i=n(153),r=n(42),a=r.noConflict(!0),s=new(function(){function t(){this.$=a,this.imagesUrl=o.b.IMAGES_URL,this.storagePrefix="nn_",this.widget={promoDelay:3e3,dateRefreshInterval:1e4,minHeight:200,minWidth:320,minHeightLarge:200,minWidthLarge:350,defaultMaxHeight:560,defaultMaxWidth:460,phoneSizeThreshold:1500,maxHeight:1,maxWidth:1,sizeHighMult:.667,sizeLowMult:.333,thinWidth:360,landscapeRatio:1.5,playerRatioWide:.625,playerRatio:3/4,autoScrollSpeed:500,smallPlayerHeightThreshold:350,containment:"document",scope:"annoto-widget",draggable:{opacity:.9,cancel:"input,textarea,button,select,option,p,i,span,nav,form,nnc-button,amdl-button,.annoto-menu-item",handle:".nn-draggable-handle",cursor:"auto",scroll:!1},resizable:{ghost:!1,animate:!0,animateDuration:300,helper:"annoto-widget-resizable-helper"},margins:{border:2,screenBorder:8,desktopScroll:18,fsTop:50,innerTop:36}},this.disabledBrowsers=i.a.disabledBrowsers,this.browserEncodeUri=i.a.browserEncodeUri,this.minibar={height:72,width:64,phoneHeight:64,phoneWidth:48},this.mini={height:210,width:270,fullScreenHeight:260,fullScreenWidth:350,kukuHeight:68,kukuWidth:280,minHeight:170,minWidth:270,kukuPlayerHeightThreshold:520},this.cta={enable:!0},this.thread={maxDepth:1,defaultChartResolution:100,SBSLayoutWidthThreshold:750,SBSLayoutRatioThreshold:2.5,voteInterval:10,minCommentsInterval:5,editInterval:24},this.player={initRetryPeriod:500,initTimeout:1e4,hackPlayTimeout:2e3,sizeChangeTimeout:100,fullScreenChangeTimeout:200,defaultShowDelay:50,defaultHideDelay:50},this.chart={stackedBars:{barWidth:12,barBoxWidth:14,minRightMargin:10,rightMargin:34}},this.timeline={minHeight:26,hiddenHeight:10,hideTimeout:1e3,progressLineHeight:6,pbHeight:16},this.validation={user:{name:{minLength:2,maxLength:64,expression:/^[a-zA-Z\u0590-\u05fe ]+$/},password:{minLength:6,maxLength:256,strength:/(?=.*\d)(?=.*[a-z])/,noSpace:/^\S+$/}},comment:{body:{minLength:1,maxLength:2048}}},this.endpointOptions={headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",mode:"cors"},this.analytics={queueCapacity:50,queueInterval:30,video:{benchmark:{steps:[.01,.02,.05,.1,.2,.3,.35,.4,.45,.5,.55,.6,.65,.7,.8,.9,.95,.98,.99,1],secondsThreshold:30}}},this.dba={transactionTimeout:3e3,echoTimeout:200},this.locales={bundledList:["en","he"]};try{this.debug={forceComments:sessionStorage.getItem("annoto_force_comments"),ssoOverride:sessionStorage.getItem("annoto_sso_override")}}catch(t){this.debug={}}this.userHints={demo:[{id:1,author:{id:"abc",name:"Annoto Team",photo_url:o.b.IMAGES_URL+"/logo_icon_v2.svg"},data:{en:{topic:"Welcome to Annoto Demo!",body:"Please notice your comments won't be saved."},he:{topic:"   Annoto!",body:"  ."}}}]},this.rt={livePoll:{min:3e3,max:5e3},poll:{min:25e3,max:3e4},peoplePoll:{min:1e4,max:15e3}},this.ux={forceMiniKuku:!1,disableTimeline:!1},this.rtlLocales=["he","ar"],this.presence={updateInterval:{min:25e3,max:3e4},activeThresholdSec:35}}return t.prototype.parse=function(t){},t}());e.a=s},34:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}));var o,i=n(29),r=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(t){function e(n,o){var i=t.call(this,"string"==typeof n?e.formatMessage(s.UNKNOWN,n):e.formatMessage(n,o))||this;return i.isAnnotoError=!0,i.code="string"==typeof n?s.UNKNOWN:n,i}return r(e,t),e.formatMessage=function(t,n){return e.codeString(t)+" ["+t.toString(16)+"]: "+n},e.fromObject=function(t,n){var o,i=s.UNKNOWN;if("object"==typeof t){if(e.isAError(t))return t;o=Response.prototype.isPrototypeOf(t)||t instanceof Response?t.statusText:t.message}else i=t||s.UNKNOWN,Response.prototype.isPrototypeOf(n)||n instanceof Response?o=n.statusText:n&&(o=n.message,e.isAError(n)&&(i=t||n.code));return new e(i,o)},e.isAError=function(t,e){return Boolean(t&&t.isAnnotoError&&(!Object(i.k)(e)||e===t.code))},e.trString=function(t){return"errors."+((t?c.get(t.code):null)||"default")},e.codeString=function(t){for(var e in s){var n=s[e];if("object"==typeof n){for(var o in n)if(n[o]===t)return o}else if(t===n)return e}return"UNKNOWN"},e}(function(t){function e(e){var n=this.constructor,o=t.call(this,e)||this;return Object.setPrototypeOf(o,n.prototype),o.name=o.constructor.name,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(o,n):o.stack=new Error(e).stack,o}return r(e,t),e}(Error)),s={UNKNOWN:0,HOST:{NOT_INIT:1,UNAUTHORIZED:2},AUTH:{NOT_INIT:257},USER:{NOT_INIT:513,SSO_REJECTED:514,STATIC_SSO_ERR:515,SSO_DISABLED:516,SSO_AUT_ERR:517,SSO_LOGOUT_ERR:518,SESSION_SET_ERR:519,VISITOR_SET_ERR:520,ANONYMOUS_DISABLED:521,ANONYMOUS_REJECTED:522},INIT:{NOT_INIT:769,INVALID_OPTIONS:770,NOT_SUPPORTED:771,INVALID_SETTINGS:772},PLAYER:{NOT_INIT:1025,INIT_INTERRUPTED:1026,INIT_ERR:1027,OPERATIONAL:1028},COMMENTS:{INIT:1281,SUBMIT:1282,SUBMIT_REPLY:1283,EDIT:1284,DEL:1285,PATCH_STATE:1286,VOTE:1287,GET_PAGE:1288,GET_REPLIES:1289,EXPORT:1290,ASSET_POST:1291,ASSET_NOT_FOUND:1292,ASSET_START:1293},NOTES:{INIT:1537,SUBMIT:1538,EDIT:1539,DEL:1540,GET_PAGE:1541,EXPORT:1542,EXPORT_GROUP:1543},THREAD:{INIT:1793,VOTE:1794},USER_SPACE:{FEED_GET:2049,PROFILE_GET:2050},PEOPLE:{GROUP_GET:2305,THREAD_GET:2306,UPDATE:2307,ONE_ON_ONE_INVITE:2308}},c=new Map;c.set(s.COMMENTS.SUBMIT,"ugc.action"),c.set(s.COMMENTS.SUBMIT_REPLY,"ugc.action"),c.set(s.COMMENTS.EDIT,"ugc.action"),c.set(s.COMMENTS.DEL,"ugc.action"),c.set(s.COMMENTS.VOTE,"ugc.action"),c.set(s.COMMENTS.EXPORT,"ugc.action"),c.set(s.NOTES.SUBMIT,"ugc.action"),c.set(s.NOTES.EDIT,"ugc.action"),c.set(s.NOTES.DEL,"ugc.action"),c.set(s.NOTES.EXPORT,"ugc.action"),c.set(s.THREAD.VOTE,"ugc.action")},35:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var o=n("aurelia-framework"),i=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},r=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=function(){function t(t,e){this.key=t,this.checkParent=e}var e;return e=t,t.prototype.get=function(t){if(t.parent&&t.parent.hasResolver(this.key,this.checkParent))return t.parent.get(this.key);throw new Error("Parent "+this.key+" does not exist!")},t.of=function(t,n){return void 0===n&&(n=!1),new e(t,n)},t=e=i([Object(o.x)(),r("design:paramtypes",[Object,Boolean])],t)}()},36:function(t,e,n){"use strict";var o=n("aurelia-framework"),i=n(48),r=n(38),a=n(101),s=n(152),c=n(100),l=function(){function t(t){this.store=t,this.logger=o.h.getLogger("Annoto-demo-data-compiler")}return t.prototype.userVotesInit=function(){for(var t=this.store,e=t.threadController.demoData.votes,n=t.threadController.demoData.userVotes,o=0;o<e.length;o++){var r=e[o];i.a.isUserVote(t.user,r)&&n.push(r)}},t.prototype.updateCounters=function(){var t=this.store,e=t.metaData,n=t.commentsController.demoData.comments,o=t.threadController.demoData.votes;e.comments.rootCount=n.length,e.comments.count=n.length,e.thread.rating=0;for(var i=0;i<t.settings.emotions.length;i++){var a=t.settings.emotions[i];e.comments.emotions[a.type]=0}for(i=0;i<n.length;i++){var s=n[i];e.comments.count+=s.discussionCount,e.thread.rating+=s.rating;a=s.emotion?s.emotion.type:r.c.UNKNOWN;e.comments.emotions[a]+=1}e.thread.rating+=o.length,this._updatePbMetrics()},t.prototype.updateCommentBranchCounters=function(t){for(this.updateCommentCounters(t);t.depth>0;)t.ancestor.updatedAt.setTime(t.updatedAt.getTime()),t=t.ancestor,this.updateCommentCounters(t);this.updateCounters()},t.prototype.convertComments=function(t,e){var n=[];if(e)for(var o=0;o<e.length;o++){var i=e[o];i.thread_id=t,i.id=this.nextObjId();var r=this.convertComments(t,i.replies),s=a.a.construct(i,r,this.store.settings);if(this.updateCommentCounters(s),n.push(s),s.votes)for(var c=0;c<s.votes.length;c++)s.votes[c].id=this.nextObjId()}return n},t.prototype.convertNotes=function(t,e){var n=[];if(e)for(var o=0;o<e.length;o++){var i=e[o];i.thread_id=t,i.id=this.nextObjId(),i.author_id=this.store.user.id;var r=s.a.buildNote(i,this.store.settings);n.push(r)}return n},t.prototype.updateCommentCounters=function(t){t.repliesCount=t.replies.length,t.discussionCount=t.repliesCount,t.emotionsCount=t.votes.length,t.rating=1,t.rating+=t.emotionsCount,t.emotionsVotes={};for(var e=0;e<t.votes.length;e++){var n=t.votes[e];t.emotionsVotes[n.value]?t.emotionsVotes[n.value]++:t.emotionsVotes[n.value]=1}for(e=0;e<t.replies.length;e++)t.discussionCount+=t.replies[e].discussionCount,t.rating+=t.replies[e].rating},t.prototype.updateNotesCounters=function(){var t=this.store,e=t.metaData,n=t.notesController.demoData.notes;e.notes.rootCount=n.length,e.notes.count=n.length;for(var o=0;o<t.settings.emotions.length;o++){var i=t.settings.emotions[o];e.notes.emotions[i.type]=0}for(o=0;o<n.length;o++){var a=n[o];i=a.emotion?a.emotion.type:r.c.UNKNOWN;e.notes.emotions[i]+=1}this._updateNotesMetrics()},t.prototype.nextObjId=function(){return c.a.nextNumberId()},t.prototype._updatePbMetrics=function(){for(var t=this.store,e=t.commentsController.demoData.comments,n=t.threadController.demoData.votes,o=[],i={},a=0;a<t.settings.emotions.length;a++){i[t.settings.emotions[a].type]={cn:0,vn:0,rcn:0,tvn:0}}i[r.c.UNKNOWN]={cn:0,vn:0,rcn:0,tvn:0},this._pbComments(o,i,e),this._pbVotes(o,i,n),t.pbMetricsController.demoData.metrics=o},t.prototype._pbComments=function(t,e,n){for(var o=this.store.player,i=0;i<n.length;i++){var a=n[i],s=a.hasPS?a.ps:o.pd,c=a.emotion?a.emotion.type:r.c.UNKNOWN,l=this._segment(s);l.data=JSON.parse(JSON.stringify(e)),l.data[c]?(l.data[c].cn+=1,l.data[c].rcn+=1):this.logger.warn("Emotion not in settings: ",c),this._pbCommentVotes(l,a.votes),this._pbReplies(l,a.replies),t.push(l)}},t.prototype._pbReplies=function(t,e){for(var n=0;n<e.length;n++){var o=e[n],i=o.emotion?o.emotion.type:r.c.UNKNOWN;t.data[i]?t.data[i].cn+=1:this.logger.warn("Emotion not in settings: ",i),this._pbCommentVotes(t,o.votes),this._pbReplies(t,o.replies)}},t.prototype._pbCommentVotes=function(t,e){for(var n=0;n<e.length;n++){var o=e[n].value;t.data[o]?t.data[o].vn+=1:this.logger.warn("Emotion not in settings: ",o)}},t.prototype._pbVotes=function(t,e,n){for(var o=this.store.player,i=0;i<n.length;i++){var r=n[i],a=r.hasPS?r.ps:o.pd,s=r.value,c=this._segment(a);c.data=JSON.parse(JSON.stringify(e)),c.data[s]?(c.data[s].vn+=1,c.data[s].tvn+=1):this.logger.warn("Emotion not in settings: ",s),t.push(c)}},t.prototype._updateNotesMetrics=function(){for(var t=this.store,e=t.notesController.demoData.notes,n=[],o={},i=0;i<t.settings.emotions.length;i++){o[(l=t.settings.emotions[i]).type]={cn:0,vn:0,rcn:0,tvn:0}}o[r.c.UNKNOWN]={cn:0,vn:0,rcn:0,tvn:0};var a=this.store.player;for(i=0;i<e.length;i++){var s=e[i],c=s.hasPS?s.ps:a.pd,l=s.emotion?s.emotion.type:r.c.UNKNOWN,u=this._segment(c);u.data=JSON.parse(JSON.stringify(o)),u.data[l]?(u.data[l].cn+=1,u.data[l].rcn+=1):this.logger.warn("Emotion not in settings: ",l),n.push(u)}t.notesController.demoData.notesMeta={progress_data:{metrics:n}}},t.prototype._segment=function(t){return{ps_low:t,ps_high:t,data:null}},t}(),u=n(29),p=function(){function t(t){this.data={commentsSeries:new Map,threadVotesSeries:new Map,pbMetricsSeries:new Map,notesSeries:new Map,notesMetricsSeries:new Map,pd:0,step:1},this.store=t,this.logger=o.h.getLogger("Annoto-data-compiler")}return t.canCompile=function(t,e){return!(!t||isNaN(e.pd)||isNaN(e.step))&&(e.step>0||0===t.length)},t.calcStep=function(t,e){return Math.max(1,t/e)},t.prototype.graphResolutionUpdateHandle=function(){var e=this.store,n=e.graphResolution,o=e.player.pd;if(this.logger.debug("handling graph update"),this.data.pd=Math.round(o),this.data.step=t.calcStep(this.data.pd,n),this.compileThreadVotes(),e.isPrivateMode)return this.compileNotes(),void this.compileNotesMetrics();this.compileComments(),this.compilePbMetrics()},t.prototype.compileComments=function(){var e=this.store.commentsController.comments,n=this.data;if(!t.canCompile(e,n))return this.logger.debug("unable to compile comments");this.logger.debug("compiling comments"),n.commentsSeries.clear();for(var o=0;o<e.length;o++)this._compileComment(e[o])},t.prototype.compileThreadVotes=function(){var e=this.store.threadController.votes,n=this.data;if(!t.canCompile(e,n))return this.logger.debug("unable to compile thread votes");this.logger.debug("compiling thread votes"),n.threadVotesSeries.clear();for(var o=0;o<e.length;o++)this._compileVote(e[o])},t.prototype.compilePbMetrics=function(){var e=this.store.pbMetricsController.metrics,n=this.data;if(!t.canCompile(e,n))return this.logger.debug("unable to compile pbMetrics");this.logger.debug("compiling pb metrics"),this.data.pbMetricsSeries.clear();for(var o=0;o<e.length;o++)this._compileMetric(e[o],n.pbMetricsSeries)},t.prototype.compileNotes=function(){var e=this.store.notesController.notes,n=this.data;if(!t.canCompile(e,n))return this.logger.debug("unable to compile notes");this.logger.debug("compiling notes"),n.notesSeries.clear();for(var o=0;o<e.length;o++)this._compileNote(e[o])},t.prototype.compileNotesMetrics=function(){var e=((this.store.notesController.notesMeta||{}).progress_data||{}).metrics,n=this.data;if(!t.canCompile(e,n))return this.logger.debug("unable to compile notes metrics");this.logger.debug("compiling notes metrics"),this.data.notesMetricsSeries.clear();for(var o=0;o<e.length;o++)this._compileMetric(e[o],n.notesMetricsSeries)},t.prototype.clearComments=function(){this.data.commentsSeries.clear()},t.prototype.clearThreadVotes=function(){this.data.threadVotesSeries.clear()},t.prototype.clearPbMetrics=function(){this.data.pbMetricsSeries.clear()},t.prototype.clearNotes=function(){this.data.notesSeries.clear()},t.prototype.clearNotesMetrics=function(){this.data.notesMetricsSeries.clear()},t.prototype.psNearest=function(t){var e=this.data.step;return Math.round(Math.round(t/e)*e)},t.prototype.psLow=function(t,e){void 0===e&&(e=!0);var n=this.data.step;return Math.floor(Math.floor(t/n)*n)},t.prototype.getDominantEmotion=function(t){var e=r.c.UNKNOWN,n=0;return Object(u.f)(t,(function(t,o){var i=o.cn+o.tvn+o.vn;n<i&&(n=i,e=t)})),{emotion:e,count:n}},t.prototype.findFirstInSeries=function(t,e){for(var n=e;n>=0;){var o=this.psLow(n),i=t.get(o);if(i&&i.items.length>0)return i;n=o-.1}},t._pushComment=function(t,e){var n=e.discussionCount;t.items.push(e),t.count+=1,t.count+=n},t.prototype._compileComment=function(e){var n=this.data;if(e.hasPS){var o=this.psLow(e.ps),i=n.commentsSeries.get(o);i||(i=new m,n.commentsSeries.set(o,i)),t._pushComment(i,e)}else this.logger.warn("Comment without ps")},t.prototype._initEmotionMap=function(t){var e=this.store;t.clear(),t.set(r.c.UNKNOWN,new d),t.set(r.c.NEUTRAL,new d);for(var n=0;n<e.settings.emotions.length;n++)t.set(e.settings.emotions[n].type,new d)},t.prototype._compileMetric=function(t,e){var n=this,o=this.psLow(t.ps_low,!0),i=e.get(o);i||(i=new Map,this._initEmotionMap(i),e.set(o,i)),Object(u.f)(t.data,(function(t,e){var o=i.get(t);if(o){var r=isNaN(e.vn)?0:e.vn,a=isNaN(e.rcn)?e.cn:e.rcn,s=isNaN(e.tvn)?0:e.tvn;o.cn=o.cn+e.cn,o.vn=o.vn+r,o.rcn=o.rcn+a,o.tvn=o.tvn+s}else n.logger.warn("Unknown metrics emotion: "+t)}),this)},t._pushVote=function(t,e){t.votes.push(e),t.vn+=1},t.prototype._compileVote=function(e){var n=this.data;if(e.hasPS){var o=this.psLow(e.ps),i=n.threadVotesSeries.get(o);i||(i=new h,n.threadVotesSeries.set(o,i)),t._pushVote(i,e)}else this.logger.warn("Vote without ps")},t.prototype._compileNote=function(t){var e=this.data;if(t.hasPS){var n=this.psLow(t.ps),o=e.notesSeries.get(n);o||(o=new m,e.notesSeries.set(n,o)),o.items.push(t),o.count+=1}else this.logger.warn("Note without ps")},t}(),d=function(){this.vn=0,this.cn=0,this.rcn=0,this.tvn=0},h=function(){this.votes=[],this.vn=0},m=function(){this.items=[],this.count=0},f=n(86),g=n(74),b=n(11),y=n(31),v=function(){return(v=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},w=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},O=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},_=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(t);i<o.length;i++)e.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(t,o[i])&&(n[o[i]]=t[o[i]])}return n},x=function(){function t(t){this.extendedEvents={},this.interactionCounter=0,this.store=t,this.logger=o.h.getLogger("Annoto-analytics-controller")}return Object.defineProperty(t.prototype,"service",{get:function(){return this.store.initializer.analytics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dbaService",{get:function(){return this.store.initializer.dbaService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visitSessionManager",{get:function(){return this.store.initializer.visitSessionManager},enumerable:!1,configurable:!0}),t.prototype.setGaDimensions=function(t){var e=this,n=Object.keys(t),o={};return n.forEach((function(e){o[b.d[e]]=t[e]})),0===Object.keys(o).length?Promise.resolve():(this.logger.debug("set dimensions: ",o),this.dbaService.setAction("analyticsFields",null,o).catch((function(t){e.logger.warn("error setting ga dimesions:",t)})))},t.prototype.recordDeferredEvents=function(){var t=this;return this.store.analyticsEnabled?this.service.recordDeferredEvents().catch((function(e){t.logger.error("recording deferred events: ",e)})):(this.logger.debug("skip recordDeferredEvents"),Promise.resolve())},t.prototype.recordVideoInteraction=function(t,e,n){return this.recordInteraction(f.b.video,t,e,n)},t.prototype.recordLegacyVideoBenchmark=function(t,e,n){return this.recordInteraction(f.b.videoBenchmark,t,e,n)},t.prototype.recordTimelineInteraction=function(t,e,n){return this.recordInteraction(f.b.timeline,t,e,n)},t.prototype.recordWidgetInteraction=function(t,e,n){return this.recordInteraction(f.b.widget,t,e,n)},t.prototype.recordMenuInteraction=function(t,e,n){return this.recordInteraction(f.b.menu,t,e,n)},t.prototype.recordUgcInteraction=function(t,e,n){return this.recordInteraction(f.b.ugc,t,e,n)},t.prototype.recordConversionInteraction=function(t,e,n){return this.recordInteraction(f.b.conversion,t,e,n)},t.prototype.recordVideoBenchmark=function(t){var e;return w(this,void 0,void 0,(function(){var n,o,i,r,a,s,c,l,u,p,d,h;return O(this,(function(m){switch(m.label){case 0:if(n=this.store,o=n.initializer.visitSessionManager.info,i=Math.round(n.player.pd),r=n.eventAggregator,!(n.threadController.threadApplied&&o&&o.id&&i))return[2,Promise.resolve()];if((a=Math.min(t.end,i))-t.start<1)return[2];if(s=n.threadController.info,c=n.user.info,l=n.threadController.model,!n.analyticsEnabled||!n.videoAnalyticsEnabled)return this.logger.debug("skip record video benchmark: ",{start:t.start,end:a}),[2,Promise.resolve()];u={duration:i,session_id:o.id,visitor_id:c.visitor_id,segment_start:t.start,segment_end:a},m.label=1;case 1:return m.trys.push([1,3,,4]),[4,n.apiService.postVideoBenchmark(v(v({},u),{thread_id:s.id,group_id:s.group_id}))];case 2:return p=m.sent(),d=v(v({},u),{media_src:l.source,group_id:null===(e=l.group)||void 0===e?void 0:e.group_id,completion:p.completion,watch_time:p.watch_time,heatmap:p.heatmap,acc_completion:p.acc_completion,acc_watch_time:p.acc_watch_time,acc_heatmap:p.acc_heatmap}),r.publish(y.a.VIDEO_BENCHMARK_EVENT,d),[3,4];case 3:return h=m.sent(),this.logger.warn("record video benchmark: ",h),[3,4];case 4:return[2]}}))}))},t.prototype.recordGaEvent=function(t){var e=this;return this.store.analyticsEnabled?Object(u.p)().then((function(){var n={eventCategory:Object(u.y)(t.collection.replace(/_/g," ")),eventAction:Object(u.y)(t.action.replace(/_/g," "))};return"string"==typeof t.label&&(n.eventLabel=Object(u.y)(t.label.replace(/_/g," "))),Object(u.k)(t.value)&&(n.eventValue=parseFloat(t.value.toString())),e.dbaService.hitAction("hitTracking","event",n)})).catch((function(t){e.logger.error("record ga event to dba: ",t)})):(this.logger.debug("skip record ga event: ",t),Promise.resolve())},t.prototype.recordInteraction=function(t,e,n,o){var i=this;return this.store.analyticsEnabled?Object(u.p)().then((function(){return i.visitSessionManager.extend()})).then((function(){var r,a=((r={event_type:e})[t]=n||void 0,r),s={eventCategory:Object(u.y)(t.replace(/_/g," ")),eventAction:Object(u.y)(e.replace(/_/g," "))};return o&&("string"==typeof o.label&&(s.eventLabel=Object(u.y)(o.label.replace(/_/g," "))),Object(u.k)(o.value)&&(s.eventValue=parseFloat(o.value.toString()))),i.logger.debug("recording event: "+t+" | "+a.event_type+" | "+("object"==typeof o?JSON.stringify(o):"")),Promise.all([i.processStatsEvent(t,e,a),i.dbaService.hitAction("hitTracking","event",s).catch((function(t){i.logger.error("record to dba: ",t)}))])})).then((function(){return null})).catch((function(t){i.logger.warn("record interaction: ",t)})):(this.logger.debug("skip record event: "+t+" | "+e),Promise.resolve())},t.prototype.processStatsEvent=function(t,e,n){var o=this,i=this.store;return i.analyticsEnabled?Promise.resolve().then((function(){if(i.threadController){var r=n[t],a={visitor_id:i.user.visitorId,thread_id:i.threadId,group_id:i.groupId,session_id:o.visitSessionManager.info.id};if("video_benchmark"===t){if("first_play"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.firstPlay}))}else if("ugc_interaction"===t){if("timetag_tap"===e){var s=r.comment?g.StatsType.commentTimetagTap:g.StatsType.noteTimetagTap,c=r.comment||r.note;return o.postStatsEvent(v(v({},a),{type:s,ugc_id:c.id,ps:c.ps}))}if("show_replies"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.showReplyTap,ugc_id:r.comment.id,ps:r.comment.ps}));if("vote_submit"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.vote,ugc_id:r.comment.id,ps:r.comment.ps}));if("sort"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.threadSort}));if("thread_follow"===e&&r.thread_follow)return o.postStatsEvent(v(v({},a),{type:g.StatsType.threadFollow}));if("kuku_tap"===e){s=i.isPrivateMode?g.StatsType.noteKukuTap:g.StatsType.commentKukuTap;return o.postStatsEvent(v(v({},a),{type:s,ugc_id:r.kuku_item.id,ps:r.kuku_item.ps}))}if("comment_tap"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.commentTap,ugc_id:r.comment.id,ps:r.comment.ps}));if("note_tap"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.noteTap,ugc_id:r.note.id,ps:r.note.ps}));if("sync_tap"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.syncTap,ps:i.player.info.current_time}));if("comment_submit"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.comment,ugc_id:r.comment.id,ps:r.comment.ps}));if("reply_submit"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.reply,ugc_id:r.ancestor.id,ps:r.ancestor.ps}));if("note_submit"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.note,ugc_id:r.note.id,ps:r.note.ps}));if("comment_edit"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.commentEdit,ugc_id:r.comment.id,ps:r.comment.ps}));if("comment_delete"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.commentDelete,ugc_id:r.comment.id,ps:r.comment.ps}));if("note_edit"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.noteEdit,ugc_id:r.note.id,ps:r.note.ps}));if("note_delete"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.noteDelete,ugc_id:r.note.id,ps:r.note.ps}));if("group_follow"===e&&r.group_follow)return o.postStatsEvent(v(v({},a),{type:g.StatsType.groupFollow}))}else if("timeline_interaction"===t&&"ugc_tap"===e)return o.postStatsEvent(v(v({},a),{type:g.StatsType.timelineUgcTap,ps:r.tap_time}))}})).catch((function(t){o.logger.warn("record to stats: ",t)})):Promise.resolve()},t.prototype.postStatsEvent=function(t){return w(this,void 0,void 0,(function(){var e,n,o,i,r,a;return O(this,(function(s){switch(s.label){case 0:return e=this.store.eventAggregator,n=this.store,o=n.threadController.model,[4,n.apiService.postEvent(t)];case 1:return s.sent(),t.thread_id,t.group_id,t.ugc_id,i=t.type,r=_(t,["thread_id","group_id","ugc_id","type"]),a=v(v({},r),{type:i,media_src:o.source,group_id:o.group.group_id}),e.publish(y.a.STATS_EVENT,a),[2]}}))}))},t}(),E=n(49),S=n(55),j=n(50),C=n(93),T=n(79),P=n(44),k=n(158),A=n(40),R=n(67),I=n(90),D=n(69),M=n(61),N=n("aurelia-event-aggregator"),H=n(68),z=n(77),L=function(){function t(t){this.store=t,this.userDoneAction=!1,this.oneTimeInteractiveOnDone=!1,this.logger=o.h.getLogger("Annoto-interactive-controller"),this.reset()}return t.prototype.recordUserAction=function(){this.userDoneAction=!0},Object.defineProperty(t.prototype,"isUserDoneAction",{get:function(){return this.userDoneAction},enumerable:!1,configurable:!0}),t.prototype.cancelOneTimeInteractiveOn=function(){this.oneTimeInteractiveOnDone=!0},t.prototype.autoShowOnStartup=function(t){var e=this;return Object(u.c)(3e3).then((function(){if(!e.oneTimeInteractiveOnDone&&!e.userDoneAction)return e.recordAutoOpenEvent(t),e.store.userHintsService.hints.length>0?(e.oneTimeInteractiveOnDone=!0,e.setOffAndDoShow()):e.setOnAndShow()})).then((function(){if(!e.oneTimeInteractiveOnDone&&!e.userDoneAction)return Object(u.c)(6e3)})).then((function(){if(!e.oneTimeInteractiveOnDone&&!e.userDoneAction)return e.store.widget.hide()}))},t.prototype.rtModerate=function(t){if(t.length>0&&!this.oneTimeInteractiveOnDone&&"closed"!==this.store.widgetStartupState)return this.oneTimeInteractiveOnDone=!0,this.store.widget.isOpen||this.userDoneAction?Promise.resolve():(this.recordAutoOpenEvent("rt_ugc"),this.store.userHintsService.hints.length>0?this.setOffAndDoShow():this.setOnAndShow());var e=this.store.isPrivateMode?this.store.notesController.sortOption:this.store.commentsController.sortOption;return this.store.isLive||this.interactive||e.type!==H.d.BY_TIMELINE||this.autoscrollOff?Promise.resolve():this.syncToTimelineHandle(t)},t.prototype.recordAutoOpenEvent=function(t){return this.store.analyticsController.recordWidgetInteraction("auto_open",{auto_open:t},{label:t,value:Object(z.e)()})},t.prototype.setOnAndShow=function(){var t=this.store;return this.interactive=!0,this.logger.debug("interactive mode on"),this.interactiveModeChangeHandle().then((function(){return t.widget.doShow()})).then((function(){var e={name:"widget:minimise",data:t.widget};t.eventAggregator.publish(y.a.UX_EVENT,e)})).then((function(){return Object(u.c)(200)}))},t.prototype.setOffAndDoShow=function(){var t=this;this.logger.debug("interactive mode off");var e=this.store,n=this.interactive;return this.interactive=!1,e.widget.doShow().then((function(){return t.interactiveModeChangeHandle()})).then((function(){if(n){var t={name:"widget:show",data:e.widget};e.eventAggregator.publish(y.a.UX_EVENT,t)}})).then((function(){return Object(u.c)(200)}))},t.prototype.setOffAndShow=function(){var t=this;this.logger.debug("interactive mode off");var e=this.store,n=this.interactive;return this.interactive=!1,e.widget.show().then((function(){return t.interactiveModeChangeHandle()})).then((function(){if(n){var t={name:"widget:show",data:e.widget};e.eventAggregator.publish(y.a.UX_EVENT,t)}})).then((function(){return Object(u.c)(200)}))},t.prototype.focusOnPP=function(t){var e=this;void 0===t&&(t=this.store.player.pp);var n=this.store;return Promise.resolve().then((function(){var o=n.dataCompiler;if(n.isPrivateMode){var i;if(!(i=o.findFirstInSeries(o.data.notesSeries,t)))return e.logger.info("no notes to focus on at: "+t),!1;var r=i.items.reduce((function(t,e){return t.ps<e.ps||t.ps===e.ps&&t.updatedAt>=e.updatedAt?t:e}),i.items[0]);return e.focusOnNote(r).then((function(){return!0}))}if(!(i=o.findFirstInSeries(o.data.commentsSeries,t)))return e.logger.info("no comments to focus on at: "+t),!1;var a=i.items.reduce((function(t,e){return t.ps<e.ps||t.ps===e.ps&&t.updatedAt>=e.updatedAt?t:e}),i.items[0]);return e.focusOnComment(a).then((function(){return!0}))}))},t.prototype.focusOnComment=function(t){var e=this,n=this.store;return this.showHome(),n.widget.show().then((function(){var t=n.commentsController.getSortOption(H.d.BY_TIMELINE)||n.commentsController.sortingOptions[0];return e.autoscrollOff=!0,n.commentsController.sortSetByUser(t)})).then((function(){return Object(u.c)()})).then((function(){var n={target:"comment",source:"ux",item:t};return e.store.pubSub.publish(y.a.FOCUS_ON_COMPONENT_REQUEST,n),Object(u.c)()})).then((function(){e.autoscrollOff=!1}))},t.prototype.focusOnNote=function(t){var e=this,n=this.store;return this.showHome(),n.widget.show().then((function(){var t=n.notesController.getSortOption(H.d.BY_TIMELINE)||n.notesController.sortingOptions[0];return e.autoscrollOff=!0,n.notesController.sortSetByUser(t)})).then((function(){return Object(u.c)()})).then((function(){var n={target:"note",source:"ux",item:t};return e.store.pubSub.publish(y.a.FOCUS_ON_COMPONENT_REQUEST,n),Object(u.c)()})).then((function(){e.autoscrollOff=!1}))},t.prototype.focusOnReplyForm=function(t){var e=this,n=this.store;return this.showHome(),n.widget.show().then((function(){var t=n.commentsController.getSortOption(H.d.BY_TIMELINE)||n.commentsController.sortingOptions[0];return e.autoscrollOff=!0,n.commentsController.sortSetByUser(t)})).then((function(){return Object(u.c)()})).then((function(){var n={target:"reply_form",source:"ux",item:t};return e.store.pubSub.publish(y.a.FOCUS_ON_COMPONENT_REQUEST,n),Object(u.c)()})).then((function(){e.autoscrollOff=!1}))},t.prototype.focusOnRootForm=function(){var t=this,e=this.store,n=e.isPrivateMode?e.notesController:e.commentsController;return this.showHome(),e.widget.show().then((function(){var e=n.getSortOption(H.d.BY_TIMELINE)||n.sortingOptions[0];return t.autoscrollOff=!0,n.sortSetByUser(e)})).then((function(){return Object(u.c)()})).then((function(){return t.store.pubSub.publish(y.a.FOCUS_ON_COMPONENT_REQUEST,{target:"root_form",source:"ux",item:null}),Object(u.c)()})).then((function(){t.autoscrollOff=!1}))},t.prototype.reset=function(){this.interactive=!1,this.autoscrollOff=!1},t.prototype.interactiveModeChangeHandle=function(){var t=this.store,e=[];return t.commentsController&&e.push(t.commentsController.interactiveModeChangeHandle()),t.pbMetricsController&&e.push(t.pbMetricsController.interactiveModeChangeHandle()),t.notesController&&e.push(t.notesController.interactiveModeChangeHandle()),Promise.all(e).then((function(){return null}))},t.prototype.syncToTimelineHandle=function(t){var e=this.store;if(t&&0!==t.length){var n,o=t.reduce((function(t,e){return t.ps<e.ps||t.ps===e.ps&&t.updatedAt>=e.updatedAt?t:e}),t[0]);return n={target:e.isPrivateMode?"note":"comment",source:"timeline_sync",item:o},this.store.pubSub.publish(y.a.FOCUS_ON_COMPONENT_REQUEST,n),Promise.resolve()}},t.prototype.showHome=function(){var t=this.store;t.pubSub.publish(y.a.PAGES_SHOW,{page:"home",frame:t.isPrivateMode?"notes":"comments"})},t}(),B=n(66),U=n("dialog/index"),F=n(88),V=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},q=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},W=function(){function t(t){var e=this;this.store=t,this._dapDemoIsActive=!1,this.logger=o.h.getLogger("Annoto-demo-controller"),this.store.pubSub.subscribe(y.a.DAP_START,(function(){return e.handleDapStart()})),this.store.pubSub.subscribe(y.a.DAP_FINISH,(function(){return e.handleDapFinish()})),this.store.pubSub.subscribe(y.a.DAP_END,(function(){return e.handleDapEnd()}))}return Object.defineProperty(t.prototype,"data",{get:function(){return this._dapDemoIsActive?this.dapData:this.importedData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"demoIsActive",{get:function(){return this.store.demoMode||this._dapDemoIsActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dapDemoIsActive",{get:function(){return this._dapDemoIsActive},enumerable:!1,configurable:!0}),t.prototype.setDapConfig=function(t){this.dapConfig=t,this.dapData=this.configToData(t)},t.prototype.importDemo=function(){var t=this,e=this.store;return n.e(6).then(n.bind(null,263)).then((function(n){var o=n.default,i=e.api.demoDiscussion;if(i&&-1!==i.indexOf("e-learning")?e.settings.applyElearning():e.settings.applyDefaults(),o[i]){var r=new(0,o[i]);t.importedConfig={source:r.video.source,id:r.video.id,comments:r.comments,ctas:r.ctas},t.importedData=t.configToData(t.importedConfig)}else t.logger.warn("Demo discussion "+i+" not found")})).catch((function(e){t.logger.error("importing Demo discussions: ",e)}))},t.prototype.configToData=function(t){var e=this.store;return{source:t.source,id:t.id,comments:e.demoDataCompiler.convertComments(t.id,t.comments),notes:e.demoDataCompiler.convertNotes(t.id,t.notes)}},t.prototype.handleDapStart=function(){this._dapDemoIsActive=!0,this.store.pubSub.publish(y.a.DEMO_ON),this.logger.info("dap start")},t.prototype.handleDapFinish=function(){var t=this;this._dapDemoIsActive&&setTimeout((function(){return t.store.pubSub.publish(y.a.DEMO_OFF)}),0),this._dapDemoIsActive=!1,this.logger.info("dap finish")},t.prototype.handleDapEnd=function(){var t=this;this._dapDemoIsActive&&setTimeout((function(){return t.store.pubSub.publish(y.a.DEMO_OFF)}),0),this._dapDemoIsActive=!1,this.logger.info("dap end")},V([Object(o.p)("store.demoMode","_dapDemoIsActive"),q("design:type",Object),q("design:paramtypes",[])],t.prototype,"demoIsActive",null),V([Object(o.p)("_dapDemoIsActive"),q("design:type",Object),q("design:paramtypes",[])],t.prototype,"dapDemoIsActive",null),t}(),G=n(34),$=function(){function t(t){this.store=t,this.logger=o.h.getLogger("Annoto-error-handler")}return t.prototype.alert=function(t,e,n,o){var i=this;void 0===n&&(n=this.logger);var r=G.a.fromObject(t,e);n.error("",r);var a=this.store;if(!a.demoIsActive){var s={message:G.a.trString(r)};a.widget.show().then((function(){a.widget.isOpen&&i.store.dialog.open({model:s,viewModel:"dialog/views/nn-alert",lock:!1,host:o||a.widget.containerElement,container:a.widget.auContainer}).catch((function(){}))}))}},t}(),K=n(171),Y=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},Q=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Z=function(){function t(t){this.widget=t,this.userSpaceOpen=!1,this.metaData={thread:{},comments:{},notes:{},visible:{},total:{}},this.dataCompiler=new p(this),this.demoDataCompiler=new l(this),this.demoController=new W(this),this.analyticsController=new x(this),this.interactiveController=new L(this),this.errorHandler=new $(this)}return Object.defineProperty(t.prototype,"id",{get:function(){return this.widget.instanceId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"widgetStartupState",{get:function(){return this.widget.startupState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"platform",{get:function(){return this.widget.platform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pubSub",{get:function(){return this.widget.pubSub},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dialog",{get:function(){return this.widget.dialog},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadController",{get:function(){return this.widget.threadController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this.threadController.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groupId",{get:function(){return this.threadController.groupId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadInitialized",{get:function(){return this.threadController.initialized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"interactiveMode",{get:function(){return this.interactiveController.interactive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"floorPP",{get:function(){return this.threadController.floorPP},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metaDataController",{get:function(){return this.widget.metaDataController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphResolution",{get:function(){return this.metaDataController.graphResolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentsController",{get:function(){return this.widget.commentsController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pbMetricsController",{get:function(){return this.widget.pbMetricsController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"notesController",{get:function(){return this.widget.notesController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presenceController",{get:function(){return this.widget.presenceController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"settings",{get:function(){return this.widget.settings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ux",{get:function(){return this.widget.settings.ux},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userSettings",{get:function(){return this.user.userSettings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loader",{get:function(){return this.widget.loader},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"api",{get:function(){return this.widget.api},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"player",{get:function(){return this.widget.player},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLive",{get:function(){return Boolean(this.widget.player&&this.widget.player.isLive)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playerFullScreen",{get:function(){return this.widget.playerFullScreen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apiService",{get:function(){return this.widget.apiService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authService",{get:function(){return this.user.authService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"eventAggregator",{get:function(){return this.widget.eventAggregator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this.initializer.user},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initializer",{get:function(){return this.widget.serviceInitializer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"app",{get:function(){return this.initializer.app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appCommon",{get:function(){return this.app.common},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playerUxFilter",{get:function(){return this.initializer.playerUxFilter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userHintsService",{get:function(){return this.initializer.userHintsService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"i18n",{get:function(){return this.initializer.i18n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaType",{get:function(){return this.api.thread.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rtl",{get:function(){return this.api.rtl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPhone",{get:function(){return this.widget.platform.phone},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"windowWidth",{get:function(){return this.widget.platform.windowWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"windowHeight",{get:function(){return this.widget.platform.windowHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"demoMode",{get:function(){return this.api.demoMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isELearning",{get:function(){return this.settings.isELearning},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPrivateMode",{get:function(){return this.userSettings.isPrivateMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasUGC",{get:function(){return this.settings.hasUGC},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analyticsEnabled",{get:function(){return this.settings.analyticsEnabled&&!this.demoIsActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoAnalyticsEnabled",{get:function(){return this.settings.videoAnalyticsEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentsEnabled",{get:function(){return this.settings.commentsEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentsSubmitEnabled",{get:function(){return this.settings.commentsSubmitEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"privateNotesEnabled",{get:function(){return this.settings.privateNotesEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"privateNotesSubmitEnabled",{get:function(){return this.settings.privateNotesSubmitEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tabsEnabled",{get:function(){return this.settings.tabsEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userPreferencesDisabled",{get:function(){return!(this.settings.userPreferencesEnabled&&this.userSettings.hasEmail&&this.settings.notificationsEnabled&&this.user.authenticated)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasUserPreferences",{get:function(){return this.settings.notificationsEnabled&&this.settings.userPreferencesEnabled&&(!this.user.authenticated||this.userSettings.hasEmail)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"voteEmotionsDisabled",{get:function(){return Boolean(this.isELearning||!this.settings.voteEmotionsEnabled)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawerEnabled",{get:function(){var t=!this.user.logoutActionDisabled,e=this.privateNotesEnabled&&this.commentsEnabled&&!this.tabsEnabled||this.settings.userPreferencesEnabled;return Boolean(t||e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anonymousCommentsEnabled",{get:function(){return this.settings.anonymousCommentsEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ugcExportEnabled",{get:function(){return this.settings.ugcExportEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userSpaceEnabled",{get:function(){return this.settings.userSpaceEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"peopleDisabled",{get:function(){return!this.settings.peopleEnabled||this.demoIsActive||!this.user.authenticated},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"presenceDisabled",{get:function(){return this.peopleDisabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timelineEnabled",{get:function(){return this.settings.timelineEnabled&&"video"===this.mediaType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidePs",{get:function(){return"text"===this.mediaType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dapService",{get:function(){return this.initializer.dapService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dapIsActive",{get:function(){return this.initializer.dapService.isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"demoIsActive",{get:function(){return this.demoController.demoIsActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dapDemoIsActive",{get:function(){return this.demoController.dapDemoIsActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tutTooltipEn",{get:function(){return this.userSettings.tutorialEn&&!this.platform.phone&&!this.dapDemoIsActive&&!this.dapIsActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentsTopToBottom",{get:function(){return this.ux.commentsTopToBottom||this.dapDemoIsActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasFollowControls",{get:function(){return Boolean(this.settings.notificationsEnabled&&(this.userSettings.hasEmail&&this.user.authenticated||!this.user.authenticated))},enumerable:!1,configurable:!0}),Y([Object(o.p)("widget.instanceId"),Q("design:type",Number),Q("design:paramtypes",[])],t.prototype,"id",null),Y([Object(o.p)("widget.startupState"),Q("design:type",String),Q("design:paramtypes",[])],t.prototype,"widgetStartupState",null),Y([Object(o.p)("widget.platform"),Q("design:type",B.a),Q("design:paramtypes",[])],t.prototype,"platform",null),Y([Object(o.p)("widget.pubSub"),Q("design:type",N.EventAggregator),Q("design:paramtypes",[])],t.prototype,"pubSub",null),Y([Object(o.p)("widget.dialog"),Q("design:type",U.DialogService),Q("design:paramtypes",[])],t.prototype,"dialog",null),Y([Object(o.p)("widget.threadController"),Q("design:type",A.b),Q("design:paramtypes",[])],t.prototype,"threadController",null),Y([Object(o.p)("threadController.id"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"threadId",null),Y([Object(o.p)("threadController.groupId"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"groupId",null),Y([Object(o.p)("threadController.initialized"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"threadInitialized",null),Y([Object(o.p)("interactiveController.interactive"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"interactiveMode",null),Y([Object(o.p)("threadController.floorPP"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"floorPP",null),Y([Object(o.p)("widget.metaDataController"),Q("design:type",R.a),Q("design:paramtypes",[])],t.prototype,"metaDataController",null),Y([Object(o.p)("metaDataController.resolution"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"graphResolution",null),Y([Object(o.p)("widget.commentsController"),Q("design:type",D.a),Q("design:paramtypes",[])],t.prototype,"commentsController",null),Y([Object(o.p)("widget.pbMetricsController"),Q("design:type",I.a),Q("design:paramtypes",[])],t.prototype,"pbMetricsController",null),Y([Object(o.p)("widget.notesController"),Q("design:type",M.a),Q("design:paramtypes",[])],t.prototype,"notesController",null),Y([Object(o.p)("widget.presenceController"),Q("design:type",K.a),Q("design:paramtypes",[])],t.prototype,"presenceController",null),Y([Object(o.p)("widget.settings"),Q("design:type",j.a),Q("design:paramtypes",[])],t.prototype,"settings",null),Y([Object(o.p)("widget.settings","widget.settings.ux"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"ux",null),Y([Object(o.p)("user.userSettings"),Q("design:type",C.a),Q("design:paramtypes",[])],t.prototype,"userSettings",null),Y([Object(o.p)("widget.loader"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"loader",null),Y([Object(o.p)("widget.api"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"api",null),Y([Object(o.p)("widget.player"),Q("design:type",P.a),Q("design:paramtypes",[])],t.prototype,"player",null),Y([Object(o.p)("widget.player","widget.player.isLive"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"isLive",null),Y([Object(o.p)("widget.playerFullScreen"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"playerFullScreen",null),Y([Object(o.p)("widget.apiService"),Q("design:type",S.a),Q("design:paramtypes",[])],t.prototype,"apiService",null),Y([Object(o.p)("user.authService"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"authService",null),Y([Object(o.p)("widget.eventAggregator"),Q("design:type",N.EventAggregator),Q("design:paramtypes",[])],t.prototype,"eventAggregator",null),Y([Object(o.p)("initializer.user"),Q("design:type",E.a),Q("design:paramtypes",[])],t.prototype,"user",null),Y([Object(o.p)("widget.serviceInitializer"),Q("design:type",T.a),Q("design:paramtypes",[])],t.prototype,"initializer",null),Y([Object(o.p)("initializer.playerUxFilter"),Q("design:type",k.a),Q("design:paramtypes",[])],t.prototype,"playerUxFilter",null),Y([Object(o.p)("api.thread.type"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"mediaType",null),Y([Object(o.p)("api","api.rtl"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"rtl",null),Y([Object(o.p)("widget.platform","widget.platform.phone"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"isPhone",null),Y([Object(o.p)("widget.platform","widget.platform.windowWidth"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"windowWidth",null),Y([Object(o.p)("widget.platform","widget.platform.windowHeight"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"windowHeight",null),Y([Object(o.p)("api","api.demoMode"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"demoMode",null),Y([Object(o.p)("settings.isELearning"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"isELearning",null),Y([Object(o.p)("userSettings.isPrivateMode"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"isPrivateMode",null),Y([Object(o.p)("settings.hasUGC"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"hasUGC",null),Y([Object(o.p)("settings.analyticsEnabled","demoIsActive"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"analyticsEnabled",null),Y([Object(o.p)("settings.videoAnalyticsEnabled"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"videoAnalyticsEnabled",null),Y([Object(o.p)("settings.commentsEnabled"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"commentsEnabled",null),Y([Object(o.p)("settings.commentsSubmitEnabled"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"commentsSubmitEnabled",null),Y([Object(o.p)("settings.privateNotesEnabled"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"privateNotesEnabled",null),Y([Object(o.p)("settings.privateNotesEnabled"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"privateNotesSubmitEnabled",null),Y([Object(o.p)("settings.tabsEnabled"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"tabsEnabled",null),Y([Object(o.p)("settings.userPreferencesEnabled","userSettings.hasEmail","settings.notificationsEnabled","user.authenticated"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"userPreferencesDisabled",null),Y([Object(o.p)("settings.notificationsEnabled","settings.userPreferencesEnabled","userSettings.hasEmail","user.authenticated"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"hasUserPreferences",null),Y([Object(o.p)("isELearning","settings.voteEmotionsEnabled"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"voteEmotionsDisabled",null),Y([Object(o.p)("user.logoutActionDisabled","privateNotesEnabled","tabsEnabled","commentsEnabled","settings.userPreferencesEnabled"),Q("design:type",Object),Q("design:paramtypes",[])],t.prototype,"drawerEnabled",null),Y([Object(o.p)("settings.anonymousCommentsEnabled"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"anonymousCommentsEnabled",null),Y([Object(o.p)("settings.ugcExportEnabled"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"ugcExportEnabled",null),Y([Object(o.p)("settings.userSpaceEnabled"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"userSpaceEnabled",null),Y([Object(o.p)("settings.peopleEnabled","demoIsActive","user.authenticated"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"peopleDisabled",null),Y([Object(o.p)("peopleDisabled"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"presenceDisabled",null),Y([Object(o.p)("settings.timelineEnabled","mediaType"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"timelineEnabled",null),Y([Object(o.p)("mediaType"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"hidePs",null),Y([Object(o.p)("initializer.dapService"),Q("design:type",F.a),Q("design:paramtypes",[])],t.prototype,"dapService",null),Y([Object(o.p)("initializer.dapService","initializer.dapService.isActive"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"dapIsActive",null),Y([Object(o.p)("demoController.demoIsActive"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"demoIsActive",null),Y([Object(o.p)("demoController.dapDemoIsActive"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"dapDemoIsActive",null),Y([Object(o.p)("userSettings.tutorialEn","platform.phone","dapDemoIsActive","dapIsActive"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"tutTooltipEn",null),Y([Object(o.p)("ux.commentsTopToBottom","dapDemoIsActive"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"commentsTopToBottom",null),Y([Object(o.p)("userSettings.hasEmail","user.authenticated","settings.notificationsEnabled"),Q("design:type",Boolean),Q("design:paramtypes",[])],t.prototype,"hasFollowControls",null),t}();e.a=Z},38:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return a}));var o={UNKNOWN:"unknown",NEUTRAL:"neutral",LIKE:"like",LIKE_O:"like-o",ANGRY:"angry",SAD:"sad",TOUCHED:"touched",BORED:"bored",LOL:"lol",WOW:"wow",NOT_OK:"not-ok",HELP_BUOY:"help-buoy",MARK:"mark",HELP:"help",IDEA:"idea",OK:"ok"},i={unknown:{iconClass:"annoto-icon-emotion_smile_o nn-icon-emotion_smile_o",iconSrc:null,colorClass:"nn-emotion-color-unknown",name:"emotion.unknown"},neutral:{iconClass:"annoto-icon-emotion_smile_o nn-icon-emotion_smile_o",iconSrc:null,colorClass:"nn-emotion-color-neutral",name:"emotion.neutral"},like:{iconClass:"annoto-icon-emotion_like nn-icon-emotion_like",iconSrc:null,colorClass:"nn-emotion-color-like",name:"emotion.like"},"like-o":{iconClass:"annoto-icon-emotion_like_o nn-icon-emotion_like_o",iconSrc:null,colorClass:"nn-emotion-color-like",name:"emotion.like"},lol:{iconClass:"annoto-icon-emotion_lol nn-icon-emotion_lol",iconSrc:null,colorClass:"nn-emotion-color-lol",name:"emotion.lol"},angry:{iconClass:"annoto-icon-emotion_angry nn-icon-emotion_angry",iconSrc:null,colorClass:"nn-emotion-color-angry",name:"emotion.angry"},sad:{iconClass:"annoto-icon-emotion_sad nn-icon-emotion_sad",iconSrc:null,colorClass:"nn-emotion-color-sad",name:"emotion.sad"},touched:{iconClass:"annoto-icon-emotion_sad nn-icon-emotion_touched",iconSrc:null,colorClass:"nn-emotion-color-touched",name:"emotion.touched"},bored:{iconClass:"annoto-icon-emotion_bored nn-icon-emotion_bored",iconSrc:null,colorClass:"nn-emotion-color-bored",name:"emotion.bored"},wow:{iconClass:"annoto-icon-emotion_wow nn-icon-emotion_wow",iconSrc:null,colorClass:"nn-emotion-color-wow",name:"emotion.wow"},"not-ok":{iconClass:"annoto-icon-emotion_not_ok nn-icon-emotion_not_ok",iconSrc:null,colorClass:"nn-emotion-color-not-ok",name:"emotion.not_ok"},"help-buoy":{iconClass:"annoto-icon-emotion_help_buoy nn-icon-emotion_help_buoy",iconSrc:null,colorClass:"nn-emotion-color-help-buoy",name:"emotion.help_buoy"},mark:{iconClass:"annoto-icon-emotion_mark nn-icon-emotion_mark",iconSrc:null,colorClass:"nn-emotion-color-mark",name:"emotion.mark"},help:{iconClass:"annoto-icon-emotion_help nn-icon-emotion_help",iconSrc:null,colorClass:"nn-emotion-color-help",name:"emotion.help"},idea:{iconClass:"annoto-icon-emotion_idea nn-icon-emotion_idea",iconSrc:null,colorClass:"nn-emotion-color-idea",name:"emotion.idea"},ok:{iconClass:"annoto-icon-emotion_ok nn-icon-emotion_ok",iconSrc:null,colorClass:"nn-emotion-color-ok",name:"emotion.ok"}},r={unknown:0,neutral:1,like:2,"like-o":2,angry:3,touched:4,bored:5,lol:6,wow:7,"not-ok":8,mark:9,help:10,idea:11,ok:12,"help-buoy":13,sad:14},a={iconSize:50,defaultSelectorSize:32}},40:function(t,e,n){"use strict";n.d(e,"a",(function(){return g})),n.d(e,"b",(function(){return b}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(34),a=n(48),s=n(55),c=n(31),l=n(44),u=n(59),p=n(250),d=n(29),h=n(32),m=n(162),f=function(){return(f=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},g={INITIALIZED:1,THREAD_APPLIED:2,RESET:3,METADATA_CHANGE:4,FLOOR_PP_CHANGE:5,VISIBLE_THREAD_VOTE_CHANGE:6,PREFERENCES_CHANGE:7},b=function(){function t(t){this.store=t,this.data={votes:[],userVotes:[]},this.demoData={votes:[],userVotes:[]},this.oldPd=0,this.disposables=[],this.pubSub=new i.EventAggregator,this.logger=o.h.getLogger("Annoto-thread-controller")}return Object.defineProperty(t.prototype,"votes",{get:function(){return this.store.demoIsActive?this.demoData.votes:this.data.votes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userVotes",{get:function(){return this.store.demoIsActive?this.demoData.userVotes:this.data.userVotes},enumerable:!1,configurable:!0}),t.prototype.setup=function(){var t=this,e=this.disposables,n=this.store;return this._reset().then((function(){e.push(n.eventAggregator.subscribe(c.a.USER_LOGOUT,(function(){return t._userAuthChangeHandle()}))),e.push(n.eventAggregator.subscribe(c.a.USER_AUTHENTICATED,(function(){return t._userAuthChangeHandle()}))),"video"===n.mediaType&&(e.push(n.player.on(l.b.TIME_UPDATE,(function(){return t._timeUpdateHandle()}))),e.push(n.player.on(l.b.SEEK,(function(){return t._timeUpdateHandle()}))),e.push(n.player.on(l.b.DURATION_CHANGE,(function(){return t._pdChangedHandle()})))),e.push(n.player.on(l.b.MEDIA_CHANGE,(function(){return t._mediaChangeHandle()}))),e.push(n.player.on(l.b.READY,(function(){return t._playerReadyHandle()})))}))},t.prototype.dispose=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this._reset()},t.prototype.forceRtModerate=function(){var t=this.store;this._timeUpdateHandle(),t.isPrivateMode&&t.notesController?t.notesController.forceRtModerate():(t.commentsController&&t.commentsController.forceRtModerate(),t.pbMetricsController&&t.pbMetricsController.forceRtModerate())},t.prototype.postVote=function(t){var e=this,n=this.store;return t.ps=Math.floor(n.player.pp),n.demoIsActive?(t.id=n.demoDataCompiler.nextObjId(),this.demoData.votes.unshift(t),this.demoData.userVotes.unshift(t),n.demoDataCompiler.updateCounters(),this._dataChangeHandle(y.NEW_THREAD_VOTE),this._dataChangeHandle(y.METADATA),n.pbMetricsController.loadMetrics().then((function(){return t}))):this._postVote(t).then((function(e){var o=t.info;return n.analyticsController.recordUgcInteraction("thread_vote_submit",{vote:o},{label:o.value,value:Math.round(t.ps/n.player.pd*100)}),e})).catch((function(t){return e.errorHandle(r.b.THREAD.VOTE,t),null}))},t.prototype.on=function(t,e){return t===g.THREAD_APPLIED&&this.threadApplied&&setTimeout((function(){return e()}),0),t===g.INITIALIZED&&this.initialized&&setTimeout((function(){return e()}),0),this.pubSub.subscribe(t.toString(),e)},t.prototype.loadPreferences=function(){return this._loadPreferences()},t.prototype.getMetaData=function(){return this.id?Promise.resolve():this.loadMetaData()},t.prototype.loadMetaData=function(){var t=this;return this.store.demoIsActive?(this.logger.debug("updated meta data"),this._dataChangeHandle(y.METADATA),Promise.resolve()):(this.loadMetaPromise||(this.loadMetaPromise=this._loadMetaData().then((function(){t.loadMetaPromise=null})).catch((function(e){throw t.loadMetaPromise=null,e}))),this.loadMetaPromise)},t.prototype.clearMetadataDiffCounters=function(){var t=this.store.metaData;t.comments.countDiff=0,t.comments.rootCountDiff=0,t.thread.ratingDiff=0,this.logger.debug("clearMetadataDiffCounters"),this._dataChangeHandle(y.METADATA)},t.prototype.demoSourceIsValid=function(){return this.store.demoController.data&&this.store.demoController.data.source===this.source},Object.defineProperty(t.prototype,"info",{get:function(){var t=this.store.metaData;if(!this.initialized)return{initialized:!1};var e={initialized:!0,id:this.id,created_at:t.thread.createdAt.toISOString(),updated_at:t.thread.updatedAt.toISOString(),rating:t.thread.rating,emotions_votes:t.thread.emotionsVotes,emotions_count:t.thread.emotionsCount};return this.model&&this.groupId&&(e.group_id=this.groupId),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groupId",{get:function(){if(this.model)return this.model.group?this.model.group.id:this.model.group_id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"groupTitle",{get:function(){var t,e;return null===(e=null===(t=this.model)||void 0===t?void 0:t.group)||void 0===e?void 0:e.title},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){var t,e;return null===(e=null===(t=this.model)||void 0===t?void 0:t.metadata)||void 0===e?void 0:e.title},enumerable:!1,configurable:!0}),t.prototype._notify=function(t,e){(this.initialized||this.threadApplied)&&this.pubSub.publish(t.toString(),e)},t.prototype._reset=function(){var t=this,e=this.store.metaData,n=Object(d.t)((function(){t.demoData={votes:[],userVotes:[]},t.data={votes:[],userVotes:[]},t.threadApplied=!1,t.id=void 0,t.model=void 0,t.source=void 0,t.visibleUserVote=!1,t.mediaDetails=null,e.thread.emotionsVotes={},e.thread.emotionsCount=0,e.thread.rating=0,e.thread.ratingDiff=0,e.thread.createdAt=new Date,e.thread.updatedAt=new Date,e.thread.pbResolution=h.a.thread.defaultChartResolution,e.comments.rootCount=0,e.comments.count=0,e.comments.emotions={},e.comments.countDiff=0,e.comments.rootCountDiff=0,t.preferences=null,t.normPP=0,t.floorPP=0,t.logger.debug("reset"),t._notify(g.RESET),t.initialized=!1}));return this.initPromise=Object(d.u)(this.initPromise,n),this.initPromise},t.prototype._canInit=function(){return!(this.initPromise&&this.source===this.newSource||!this.newSource||!this.validPd())},t.prototype._init=function(){var t=this,e=this.store,n=Object(d.t)((function(){if(!t.initialized){if(t.logger.info("init start"),t.source=t.newSource,t.oldPd=e.player.pd,e.demoMode)return e.player.mediaDetails().then((function(n){t.initialized=!0,t.initPromise=null,t.threadApplied=!0;var o=e.demoController.data;t.id=o?o.id:void 0,t.logger.info("media details: ",n),e.demoDataCompiler.userVotesInit(),t._notify(g.THREAD_APPLIED),t._dataChangeHandle(y.METADATA),t._notify(g.INITIALIZED),t.logger.info("initialized (demo mode)"),Object(d.o)((function(){return e.analyticsController.recordDeferredEvents()}))})).catch((function(e){return t.errorHandle(r.b.THREAD.INIT,e)}));var n=new s.h(t.slugObject());return n.includeMeta(!0),e.player.mediaDetails().then((function(o){return t.mediaDetails=o,t.validMediaGroup()&&n.setGroup(o.group.id.toString(),o.group.privateThread),e.apiService.getThreadBySlug(n)})).then((function(e){return t._applyThreadData(e)})).then((function(){t.initPromise=null})).catch((function(n){return n.status!==p.d?t.errorHandle(r.b.THREAD.INIT,n):e.player&&e.user.canPostThread?t._postSelf().then((function(){t.initPromise=null})).catch((function(e){return t.initPromise=null,t.errorHandle(r.b.THREAD.INIT,e)})):(t.initPromise=null,t.errorHandle(r.b.THREAD.INIT,n))}))}t.logger.warn("Already initialized")}));return this.initPromise=Object(d.u)(this.initPromise,n),this.initPromise},t.prototype._applyThreadData=function(t){var e=this,n=this.store;if(this.logger.debug("Applying thread data"),!t)return Promise.reject(new r.a("invalid thread object"));if(!Object(d.l)(t.id))return Promise.reject(new r.a("invalid thread id: "+t.id));this.id=t.id,this._updateMetadata(t);var o=n.settings.applyEmotions(this.model.settings?this.model.settings.emotions:void 0);return r.a.isAError(o)?Promise.reject(o):(this.threadApplied=!0,this._notify(g.THREAD_APPLIED),this.applyDimensions(),Promise.all([this._loadUserThreadEmotions(),this._loadPreferences()]).then((function(){e.initialized=!0,e.logger.info("initialized"),n.analyticsController.recordDeferredEvents(),e.applyThreadDetails(t,e.mediaDetails),e.applyThreadGroup(t,e.groupFromMediaDetails()),e._notify(g.INITIALIZED)})))},t.prototype.applyDimensions=function(){if(this.threadApplied&&this.model){var t={group:"",media:""},e=this.model;e.metadata&&e.metadata.title&&(t.media=e.metadata.title),e.group&&e.group.title&&(t.group=e.group.title),this.store.analyticsController.setGaDimensions(t)}},t.prototype.applyThreadDetails=function(t,e){var n=this,o=this.store,i=!1;return Promise.resolve().then((function(){if(e){if(o.user.in&&(o.user.isModerator||!t.metadata)){var r={};return Object(d.a)(r,"media_title",e.title),Object(d.a)(r,"media_description",e.description),Object(d.a)(r,"media_author_name",e.authorName),Object(d.a)(r,"media_duration",t.pd),Object(d.a)(r,"page_title",document.title),Object(d.a)(r,"page_description",Object(m.a)("description")),i=!0,t.metadata?o.apiService.patchThreadDetails(t.id,r,t.metadata.id):o.apiService.postThreadDetails(t.id,r)}n.logger.info("Skipping Media Details apply")}else n.logger.info("Media Details not provided")})).then((function(){i&&n.logger.info("Applied Thread Details")})).catch((function(t){n.logger.warn("Applying Thread Details: ",t)}))},t.prototype.applyThreadGroup=function(t,e){var n=this,o=this.store,i=!1;return Promise.resolve().then((function(){if(e)if(t.group&&t.group.group_id===e.group_id||!o.user.in)n.logger.info("Skipping Thread Group apply");else{if(!e.private_thread)return i=!0,o.apiService.upsertGroup(e,{thread_id:t.id});n.logger.warn("ThreadGroup is private, applyThreadGroup is not supported")}else n.logger.info("Thread Group not provided")})).then((function(t){i&&(n.model&&(n.model.group=t),n.logger.info("Applied Thread Group"))})).catch((function(t){n.logger.warn("Applying Thread Group: ",t)}))},t.prototype._postSelf=function(){var t=this,e=this.store,n=this.postObject();return this.logger.debug("Posting new thread"),e.apiService.postThread(n).then((function(e){return t._applyThreadData(e)}))},t.prototype._updateMetadata=function(t){var e=this.store.metaData;this.model=f(f({},this.model),t);var n=e.comments.count||0,o=e.comments.rootCount||0,i=e.thread.rating||0;Object(d.a)(e.comments,"rootCount",t.root_comments_count),Object(d.a)(e.comments,"count",t.comments_count),Object(d.a)(e.comments,"emotions",t.comments_emotions),Object(d.a)(e.thread,"emotionsCount",t.emotions_count),Object(d.a)(e.thread,"emotionsVotes",t.emotions_votes),Object(d.a)(e.thread,"rating",t.rating),Object(d.a)(e.thread,"live",t.live),Object(d.a)(e.thread,"createdAt",t.created_at,(function(){e.thread.createdAt.setTime(Date.parse(t.created_at))})),Object(d.a)(e.thread,"updatedAt",t.updated_at,(function(){e.thread.updatedAt.setTime(Date.parse(t.updated_at))})),Object(d.a)(e.thread,"pbResolution",t.pb_resolution),e.comments.countDiff+=e.comments.count-n,e.comments.rootCountDiff+=e.comments.rootCount-o,e.thread.ratingDiff+=e.thread.rating-i,this._dataChangeHandle(y.METADATA)},t.prototype._dataChangeHandle=function(t){var e=this.store;switch(t){case y.USER_THREAD_VOTES:case y.NEW_THREAD_VOTE:this._threadVoteModerate();break;case y.VISIBLE_THREAD_VOTE:this._notify(g.VISIBLE_THREAD_VOTE_CHANGE,this.visibleUserVote);break;case y.METADATA:this._notify(g.METADATA_CHANGE,e.metaData);break;case y.USER_PREFERENCES:this._notify(g.PREFERENCES_CHANGE,this.preferences);break;default:this.logger.warn("Unknown data change: ",t)}},t.prototype._userAuthChangeHandle=function(){var t=this;if(!this.store.demoMode&&this.initialized)return Promise.all([this._loadUserThreadEmotions(),this._loadPreferences()]).catch((function(e){t.logger.error("auth handle: ",r.a.fromObject(e))}))},t.prototype.errorHandle=function(t,e){this.store.errorHandler.alert(t,e,this.logger)},t.prototype.validPd=function(){var t=this.store.player;return!!(Object(d.k)(t.pd)&&(t.pd>0||t.isLive)||"text"===this.store.mediaType)},t.prototype.slugObject=function(){var t=this.store,e={media:t.mediaType,source:this.source};return e.player=t.player.type,e.live=t.player.isLive?1:0,e.pd=t.player.pd,e},t.prototype.validMediaGroup=function(){var t=this.mediaDetails;return Boolean(t&&t.group&&t.group.id)},t.prototype.groupFromMediaDetails=function(){if(!this.validMediaGroup())return null;var t=this.mediaDetails.group,e={group_id:t.id.toString()};return Object(d.a)(e,"type",t.type),Object(d.a)(e,"private_thread",t.privateThread),Object(d.a)(e,"title",t.title),Object(d.a)(e,"description",t.description),Object(d.a)(e,"thumbnails",t.thumbnails),e},t.prototype.postObject=function(){var t=this.store,e={media:t.mediaType,source:this.source,origin:u.a.origin};e.player=t.player.type,e.pd=t.player.pd,e.live=t.player.isLive;var n=this.groupFromMediaDetails();return n&&(e.group=n),e},t.prototype._loadUserThreadEmotions=function(){var t=this,e=this.store;if(!e.user.in)return this.data.userVotes=[],this._dataChangeHandle(y.USER_THREAD_VOTES),Promise.resolve();var n=new s.i(this.id);return n.onlyMeta(),n.forAuthor(e.user.id),e.apiService.getThreadEmotions(n).then((function(n){t.logger.debug("Loaded user thread votes"),n&&n.results?t.data.userVotes=a.a.parseUserEmotions(n.results,e.user.author):t.data.userVotes=[],t._dataChangeHandle(y.USER_THREAD_VOTES)}))},t.prototype._loadPreferences=function(){var t=this,e=this.store;return e.user.in&&this.id&&this.model?e.authService.getPreferencesForThread(this.id,this.groupId).then((function(n){t.logger.debug("Loaded thread user preferences"),t.preferences=n,e.user.updatePermissions(n.permissions),e.userSettings.setNotificationsPreferences(n.notifications),t._dataChangeHandle(y.USER_PREFERENCES)})):(this.preferences=null,e.user.updatePermissions(),e.userSettings.setNotificationsPreferences(),this._dataChangeHandle(y.USER_PREFERENCES),Promise.resolve())},t.prototype._loadMetaData=function(){var t=this;return this.initialized?this.store.apiService.getThreadById(this.id,{metrics_only:1,include_events:this.store.settings.peopleEnabled&&this.store.user.authenticated?1:0}).then((function(e){t._updateMetadata(e)})):Promise.reject(new r.a("Not initialized"))},t.prototype._postVote=function(t){var e=this,n=this.store;return n.apiService.postThreadVote(this.id,t.type,a.a.getPostObject(t,n)).then((function(n){if(!a.a.mergeObject(t,n))throw new r.a("merging thread vote exception");e.logger.debug("Posted new vote")})).then((function(){return Promise.all([e._loadMetaData(),n.pbMetricsController.loadMetrics()])})).then((function(){return e.data.votes.unshift(t),e.data.userVotes.unshift(t),e._dataChangeHandle(y.NEW_THREAD_VOTE),t}))},t.prototype._timeUpdateHandle=function(){var t=this.store.player,e=Math.floor(t.pp);this.floorPP!==e&&(this.floorPP=e,this._threadVoteModerate(),this._notify(g.FLOOR_PP_CHANGE,e))},t.prototype._mediaUpdateAndInit=function(){var t=this,e=this.store,n=e.player.mediaSrc().then((function(n){t.newSource=n;var o=t.newSource!==t.source;if(t.logger.debug("Media update and init handle: initialized("+t.initialized+") media changed("+o+") newSource("+t.newSource+"), pd("+e.player.pd+")"),o&&t.initialized&&t._reset(),o&&t._canInit())return t._init()}));return this.mediaChangePromise=Object(d.u)(this.mediaChangePromise,n),this.mediaChangePromise},t.prototype._playerReadyHandle=function(){this.logger.info("Player ready handle"),this._mediaUpdateAndInit()},t.prototype._mediaChangeHandle=function(){this.logger.info("Media Source change handle"),this._mediaUpdateAndInit()},t.prototype._pdChangedHandle=function(){this._canInit()&&!this.initialized&&(this.logger.debug("Initializing on pd change"),this._init())},t.prototype._threadVoteModerate=function(){var t=this.store;if(!t.player)return this.visibleUserVote=null,void this._dataChangeHandle(y.VISIBLE_THREAD_VOTE);var e=t.player.pp-h.a.thread.voteInterval,n={psMin:e>0?e:0,psMax:t.player.pp+h.a.thread.voteInterval},o=a.a.getUserVote(t.user,this.userVotes,n);o!==this.visibleUserVote&&(this.visibleUserVote=o,this._dataChangeHandle(y.VISIBLE_THREAD_VOTE))},t}(),y={INIT:100,USER_THREAD_VOTES:101,NEW_THREAD_VOTE:102,VISIBLE_THREAD_VOTE:103,METADATA:104,USER_PREFERENCES:105}},43:function(t,e,n){"use strict";n.d(e,"e",(function(){return s})),n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return r}));function o(t,e,n,o){return t.addEventListener(e,n,o),{dispose:()=>{t.removeEventListener(e,n,o)}}}function i(t){for(let e=0;e<t.length;e++)t[e].dispose()}const r=(t=document)=>{const e=document,n=["fullscreenElement","webkitCurrentFullScreenElement","msFullscreenElement","mozFullScreenElement"];for(let o of n)if(t[o]||e[o])return t[o]||e[o]},a=(t=document)=>{t.exitFullscreen?t.exitFullscreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen&&t.mozCancelFullScreen()};function s(t,e){let n=[];switch(e){case"enter":n=["Enter"];break;case"space":n=[" ","Spacebar"];break;case"tab":n=["Tab"];break;case"esc":n=["Escape","Esc"];break;case"down":n=["ArrowDown","Down"];break;case"up":n=["ArrowUp","Up"];break;case"home":n=["Home"];break;case"end":n=["End"];break;case"left":n=["ArrowLeft","Left"];break;case"right":n=["ArrowRight","Right"]}return Boolean(-1!==n.indexOf(t.key))}var c;n(268),n(247),n(248),n(249);!function(t){t[t.slow=1e3]="slow",t[t.moderate=500]="moderate",t[t.regular=300]="regular",t[t.fast=200]="fast",t[t.insane=150]="insane"}(c||(c={}))},44:function(t,e,n){"use strict";n.d(e,"b",(function(){return _})),n.d(e,"a",(function(){return x}));var o=n("aurelia-framework"),i=n(29),r=n(32),a=n("aurelia-event-aggregator"),s=n(34),c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t){this.disposables=[],this.domEvents=[],this.ctx=t,this.bindingEngine=t.bindingEngine,this.pubSub=new a.EventAggregator,this.logger=o.h.getLogger("Annoto-player-events"),this.mouseMoveListener={n:"mousemove",f:this.mouseMoveP.bind(this)},this.callbacks=[],this.reset()}return t.prototype.remove=function(){this.dispose(),this.reset(),this.callbacks=[],this._removed=!0},t.prototype.reset=function(){this.ctx._mediaSrc=void 0,this._initHackPlay=!1,this._mouseInP=!1,this._mouseInPTimeout=!1,this._mouseMoveP=!1,this._hideOnPlay=!1,this._ready=!1,this.firstCShow=!0,this._firstPlay=!0,this._firstPause=!0,this._removed=!1},t.prototype.dispose=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();if(this.disposables=[],this.ctx.element&&this.ctx.element.removeEventListener){for(t=0;t<this.domEvents.length;t++)this.ctx.element.removeEventListener(this.domEvents[t].n,this.domEvents[t].f);this.domEvents=[],(this.ctx.cd.mouse||{}).trackMove&&this.ctx.element.removeEventListener(this.mouseMoveListener.n,this.mouseMoveListener.f)}this._mouseMoveTimer&&(clearTimeout(this._mouseMoveTimer),this._mouseMoveTimer=0),this._mouseInTimer&&(clearTimeout(this._mouseInTimer),this._mouseInTimer=0,this._mouseInPTimeout=!1),this._hackPlayTimer&&(clearTimeout(this._hackPlayTimer),this._hackPlayTimer=0),this._sizeChangeTimer&&(clearTimeout(this._sizeChangeTimer),this._sizeChangeTimer=0),this._fullScreenTimer&&(clearTimeout(this._fullScreenTimer),this._fullScreenTimer=0),this._controlsShowTimer&&(clearTimeout(this._controlsShowTimer),this._controlsShowTimer=0),this._controlsHideTimer&&(clearTimeout(this._controlsHideTimer),this._controlsHideTimer=0)},Object.defineProperty(t.prototype,"ready",{get:function(){return this._ready},enumerable:!1,configurable:!0}),t.prototype.playHack=function(t){var e=this,n=this.ctx;return!this.ready||this._removed?Promise.reject(new s.a(s.b.PLAYER.NOT_INIT,"not ready")):Promise.all([n.duration(),n.autoplay(),n.paused()]).then((function(o){var r=o[0],a=o[1],s=o[2];if(n.pd=r,e.callbacks[_.TIME_UPDATE](),!a&&(!Object(i.k)(r)||r<=0)&&s)return e._initHackPlay=t,n.play()}))},t.prototype.registerHandlers=function(){var t=this,e=this.ctx||{},n=e._player,o=this.callbacks;return this._updateProgressParams().then((function(){t._setCallbackHandlers(),n.onReady(o[_.READY]),n.onPlay(o[_.PLAY]),n.onPause(o[_.PAUSE]),n.onSeek(o[_.SEEK]),n.onTimeUpdate(o[_.TIME_UPDATE]),n.onMediaChange(o[_.MEDIA_CHANGE]),Object(i.q)(n,"onRemove")&&n.onRemove(o[_.ADAPTOR_REMOVE]),Object(i.q)(n,"onSizeChange")&&n.onSizeChange(o[_.SIZE_CHANGE]),Object(i.q)(n,"onFullScreen")&&n.onFullScreen(o[_.FULL_SCREEN_CHANGE]),e._controlsStateSupported&&(n.onControlsShow(o[_.CONTROLS_SHOW]),n.onControlsHide(o[_.CONTROLS_HIDE])),Object(i.q)(n,"onControlsEnter")&&n.onControlsEnter(o[_.CONTROLS_ENTER]),Object(i.q)(n,"onControlsLeave")&&n.onControlsLeave(o[_.CONTROLS_LEAVE])}))},t.prototype._setCallbackHandlers=function(){var t=this,e=this.callbacks;e[_.READY]=function(){return t._removed?t.removedWarn("READY"):t._readyHandle()},e[_.ADAPTOR_REMOVE]=function(){return t._removed?t.removedWarn("ADAPTOR_REMOVE"):t.onAdaptorRemoveHandle()},e[_.TIME_UPDATE]=function(){return t._removed?t.removedWarn("TIME_UPDATE"):t._timeUpdateHandle()},e[_.MEDIA_CHANGE]=function(){return t._removed?t.removedWarn("MEDIA_CHANGE"):t._mediaChangeHandle()},e[_.PLAY]=function(){return t._removed?t.removedWarn("PLAY"):t._playHandle()},e[_.PAUSE]=function(){return t._removed?t.removedWarn("PAUSE"):t._pauseHandle()},e[_.SEEK]=function(){return t._removed?t.removedWarn("SEEK"):t._seekHandle()},e[_.SIZE_CHANGE]=function(){return t._removed?t.removedWarn("SIZE_CHANGE"):t._sizeChangeHandle()},e[_.FULL_SCREEN_CHANGE]=function(e){return t._removed?t.removedWarn("FULL_SCREEN_CHANGE"):t._fullScreenHandle(e)},e[_.CONTROLS_SHOW]=function(){return t._removed?t.removedWarn("CONTROLS_SHOW"):t._controlsShowHandle()},e[_.CONTROLS_HIDE]=function(){return t._removed?t.removedWarn("CONTROLS_HIDE"):t._controlsHideHandle()},e[_.CONTROLS_ENTER]=function(){return t._removed?t.removedWarn("CONTROLS_ENTER"):t._controlsEnterHandle()},e[_.CONTROLS_LEAVE]=function(){return t._removed?t.removedWarn("CONTROLS_LEAVE"):t._controlsLeaveHandle()}},t.prototype.removedWarn=function(t){this.logger.warn(t+" event called after widget close")},t.prototype._readyHandle=function(){var t=this,e=this.ctx,n=e._player,o=this.callbacks;if(!this._ready){var r=e.api.element;if("string"==typeof r&&(r=document.getElementById(r)),e.element=r,!r)return this.logger.warn("invalid player element"),Promise.resolve();if(Object(i.q)(n,"onSizeChange")||(this.disposables.push(this.bindingEngine.propertyObserver(r,"offsetWidth").subscribe((function(){return o[_.SIZE_CHANGE]()}))),this.disposables.push(this.bindingEngine.propertyObserver(r,"offsetHeight").subscribe((function(){return o[_.SIZE_CHANGE]()})))),!e._controlsStateSupported){var a={n:"mouseenter",f:this.mouseEnterP.bind(this)};r.addEventListener(a.n,a.f),this.domEvents.push(a),a={n:"mouseleave",f:this.mouseLeaveP.bind(this)},r.addEventListener(a.n,a.f),this.domEvents.push(a)}}return this.ctx.width(),this.ctx.height(),Promise.all([e.mediaSrc(),e.paused(),e.getIslive()]).then((function(n){var i=n[0],r=n[1];return e._mediaSrc=i,e._paused=r,r||(e.playCounter=1),t._ready||(t._ready=!0),t._callSubscribers(_.READY),o[_.TIME_UPDATE]()})).catch((function(e){t.logger.warn("player ready handle: ",e)}))},t.prototype.onAdaptorRemoveHandle=function(){this.dispose(),this.reset();var t=this.ctx;this._callSubscribers(_.ADAPTOR_REMOVE),t._mediaSrc=void 0,t.pd=0,t.pp=0,t.playCounter=0,t._paused=!0},t.prototype._timeUpdateHandle=function(){var t=this,e=this.ctx;return this._updateProgressParams().then((function(n){if(t._initHackPlay&&Object(i.k)(e.pd)&&e.pd>0&&e.pause(),n)return t._callSubscribers(_.TIME_UPDATE),e.paused().then((function(n){if(e._paused=n,!n)return t._firstPlayHandle()}))})).catch((function(e){t.logger.warn("player time update: ",e)}))},t.prototype._mediaChangeHandle=function(){var t=this,e=this.ctx;return e.mediaSrc().then((function(n){if(e._mediaSrc!==n&&(e._mediaSrc||n))return e._mediaSrc=n,e.playCounter=0,t._firstPlay=!0,t._firstPause=!0,t._updateProgressParams()})).then((function(){return t._callSubscribers(_.MEDIA_CHANGE)})).catch((function(e){t.logger.warn("player media change: ",e)}))},t.prototype._playHandle=function(){var t=this,e=this.ctx;return this._initHackPlay?Promise.all([e.duration(),e.paused()]).then((function(n){var o=n[0],r=n[1];if(Object(i.k)(o)&&!(o<=0)&&(t._hackPlayTimer&&(clearTimeout(t._hackPlayTimer),t._hackPlayTimer=0),t._hackPlayTimer=setTimeout((function(){t._hackPlayTimer=0,t._initHackPlay=!1}),300),e._paused=r,!r))return Object(i.p)().then((function(){return e.paused()})).then((function(t){if(e._paused=t,!t)return e.pause()}))})).catch((function(e){t.logger.warn("player play handle: ",e)})):(e.cd.hideOnPlay&&(this._hideOnPlay=!0),e.playCounter++,this._firstPlayHandle(),this._callSubscribers(_.PLAY),this._updateControlsState().catch((function(e){t.logger.warn("player play handle: ",e)})))},t.prototype._pauseHandle=function(){var t=this;return this.ctx._paused=!0,this.ctx.playCounter>0&&(this._firstPauseHandle(),this._callSubscribers(_.PAUSE)),this._updateControlsState().catch((function(e){t.logger.warn("player pause handle: ",e)}))},t.prototype._seekHandle=function(){var t=this;return this._updateProgressParams().then((function(){t._firstPlayHandle(),t._callSubscribers(_.SEEK)})).catch((function(e){t.logger.warn("player seek handle: ",e)}))},t.prototype._sizeChangeHandle=function(){var t=this,e=this.ctx;this._sizeChangeTimer&&(clearTimeout(this._sizeChangeTimer),this._sizeChangeTimer=0),this._sizeChangeTimer=setTimeout((function(){t._sizeChangeTimer=0;var n=e._player||{};if(t.ctx.width(),t.ctx.height(),t._callSubscribers(_.SIZE_CHANGE),!Object(i.q)(n,"onFullScreen")){var o=e.fullScreen();o!==t._isFullScreen&&(t._isFullScreen=o,t.callbacks[_.FULL_SCREEN_CHANGE]())}}),r.a.player.sizeChangeTimeout)},t.prototype._fullScreenHandle=function(t){var e=this,n=this.ctx;n._isFullScreen=!0===t||!1===t?t:void 0,this._fullScreenTimer=setTimeout((function(){e._callSubscribers(_.FULL_SCREEN_CHANGE)}),r.a.player.fullScreenChangeTimeout)},t.prototype._controlsShowHandle=function(){var t=this,e=this.ctx.cd,n=e.showDelay?e.showDelay:r.a.player.defaultShowDelay;e.firstShowDelay&&this.firstCShow&&(this.firstCShow=!1,n=e.firstShowDelay),this.ctx._controlsHidden=!1,this._controlsShowTimer=setTimeout((function(){t._callSubscribers(_.CONTROLS_SHOW)}),n)},t.prototype._controlsHideHandle=function(){var t=this,e=this.ctx.cd,n=e.hideDelay?e.hideDelay:r.a.player.defaultHideDelay;this.ctx._controlsHidden=!0,this._controlsHideTimer=setTimeout((function(){t._callSubscribers(_.CONTROLS_HIDE)}),n)},t.prototype._controlsEnterHandle=function(){this._callSubscribers(_.CONTROLS_ENTER)},t.prototype._controlsLeaveHandle=function(){this._callSubscribers(_.CONTROLS_LEAVE)},t.prototype.on=function(t,e){return t===_.READY&&this._ready&&setTimeout((function(){e()}),0),this.pubSub.subscribe(t.toString(),e)},t.prototype.onOneTime=function(t,e){if(t===_.READY&&this._ready)setTimeout((function(){e()}),0);else if(t!==_.FIRST_PLAY||!this._ready||this._firstPlay){if(t!==_.FIRST_PAUSE||!this._ready||this._firstPause)return this.pubSub.subscribeOnce(t.toString(),e);setTimeout((function(){e()}),0)}else setTimeout((function(){e()}),0)},t.prototype._callSubscribers=function(t){this._removed||this.pubSub.publish(t.toString())},t.prototype._firstPlayHandle=function(){this._firstPlay&&!this._initHackPlay&&(this._firstPlay=!1,this._callSubscribers(_.FIRST_PLAY))},t.prototype._firstPauseHandle=function(){this._firstPause&&!this._initHackPlay&&(this._firstPause=!1,this._callSubscribers(_.FIRST_PAUSE))},t.prototype._updateProgressParams=function(){var t=this,e=this.ctx,n=!1;return Promise.all([e.duration(),e.currentTime(),e.getIslive()]).then((function(o){var i=o[0],r=o[1];if(e.pd===i&&e.pp===r||(n=!0),e.pp=r,e.isLive&&i<r&&(i=r),i!==e.pd){if(e.pd=i,!t._ready)return n;t._callSubscribers(_.DURATION_CHANGE)}return n}))},t.prototype.mouseEnterP=function(t){var e=this;if(!this._mouseInP){var n=this.ctx.cd.mouse||{};return this._mouseInP=!0,this._mouseInPTimeout=!1,n.trackMove&&this.ctx.element&&(this.ctx.element.removeEventListener(this.mouseMoveListener.n,this.mouseMoveListener.f),this.ctx.element.addEventListener(this.mouseMoveListener.n,this.mouseMoveListener.f)),n.enterTimeout&&this._mouseInTimer&&clearTimeout(this._mouseInTimer),this._updateControlsState().then((function(){n.enterTimeout&&(e._mouseInTimer=setTimeout((function(){return e._mouseInPTimeout=!0,e._mouseInTimer=0,e._updateControlsState().catch((function(t){e.logger.warn("player mouse enter: ",t)}))}),n.enterTimeout))})).catch((function(t){e.logger.warn("player mouse enter: ",t)}))}},t.prototype.mouseLeaveP=function(t){var e=this,n=this.ctx.cd.mouse||{};this._mouseInP=!1,n.trackMove&&this.ctx.element.removeEventListener(this.mouseMoveListener.n,this.mouseMoveListener.f),this._mouseInTimer&&n.hideOnLeave&&(clearTimeout(this._mouseInTimer),this._mouseInTimer=0,this._mouseInPTimeout=!1),this._updateControlsState().catch((function(t){e.logger.warn("player mouse leave: ",t)}))},t.prototype.mouseMoveP=function(t){var e=this,n=this.ctx,o=n.cd.mouse||{};this._mouseMoveP=!0,this._mouseMoveTimer&&(clearTimeout(this._mouseMoveTimer),this._mouseMoveTimer=0);var r=Promise.resolve();return n._controlsHidden&&(r=this._updateControlsState()),r.then((function(){var r=n.controlsHeight();r!==e._controlsHeight&&(e._controlsHeight=r,e._callSubscribers(_.CONTROLS_SIZE_CHANGE));var a=t.pageY;e._mouseMoveTimer=setTimeout((function(){e._mouseMoveTimer=0,e._mouseMoveP=!1;var t=Object(i.g)(n.element,n.store.platform.rootElement),o=n.controlsHeight(),r=t.top+n.height();a<=r&&a>=r-o&&e._mouseInP||e._updateControlsState().catch((function(t){e.logger.warn("player mouse move timeout: ",t)}))}),o.moveTimeout)})).catch((function(t){e.logger.warn("player mouse move: ",t)}))},t.prototype._updateControlsState=function(){var t=this,e=this.ctx;if(e._controlsStateSupported)return Promise.resolve();var n=e.cd.mouse||{};return e.paused().then((function(o){var i=!((t._mouseInP||!n.hideOnLeave)&&(!t._mouseInPTimeout||t._mouseMoveP))&&!o||t._hideOnPlay;t._hideOnPlay&&t._mouseMoveTimer&&(clearTimeout(t._mouseMoveTimer),t._mouseMoveTimer=0),t._hideOnPlay=!1,e._controlsHidden!==i&&(e._controlsHidden=i,i?t.callbacks[_.CONTROLS_HIDE]():t.callbacks[_.CONTROLS_SHOW]())}))},c([Object(o.p)("_ready"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"ready",null),t}(),p=n(76),d=function(){return(d=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},h=function(){function t(t){this.widgetApi=t,this.api=t.player,this._reset(),this.logger=o.h.getLogger("Annoto-player-adaptor")}return t.prototype.init=function(){var t=this,e=this,n=new Promise((function(t,n){e.initResolve=t,e.initReject=n}));return this.player=null,this._removed=!1,this._initRetryTimer=0,setTimeout((function(){return t.doInit()}),0),n},t.prototype.remove=function(){if(this.player&&"function"==typeof this.player.remove)try{this.player.remove()}catch(t){this.logger.warn("error removing: ",t)}this._reset(),this._removed=!0},t.prototype.doInit=function(){var e=this,n=this.api,o=this.logger;if(this._initRetryTimer=0,this._initRetry>this._initRetryNum)return o.error("Initialization timeout out after "+Math.round(this._initTimeout/1e3)+" seconds, retry num: "+this._initRetry+". Configuration player.element should be DOM element or element ID."),this.initReject();this._initRetry++;var r=n.element;if("string"==typeof r&&(r=document.getElementById(r)),r&&("object"==typeof r||"function"==typeof r))return this.getAdaptor().then((function(a){return Object(i.A)(t.actions,a,o.warn,o)?(e.type=n.type,Object(i.A)(t.controlsStateMethods,a)&&(e.controlsStateSupported=!0),Promise.resolve().then((function(){return a.init(r,d(d({},n.params),{widgetApi:e.widgetApi}))})).then((function(t){if(e._removed)return"function"==typeof a.remove&&a.remove(),e.initReject(new s.a(s.b.PLAYER.INIT_INTERRUPTED,"removed"));if(!t)throw new s.a(s.b.PLAYER.INIT_ERR,"returned "+t);return e.player=a,Object(i.q)(a,"controlsDescriptor")&&(e.controlsDescriptor=a.controlsDescriptor()),e.controlsHidden=e.controlsDescriptor&&!e.controlsDescriptor.shownOnLoad,e.initResolve(r)})).catch((function(t){e.logger.debug("error initializing adaptor: ",s.a.fromObject(s.b.PLAYER.INIT_ERR,t)),e._initRetryTimer=setTimeout((function(){return e.doInit()}),e._initRetryPeriod)}))):e.initReject(new s.a(s.b.PLAYER.INIT_ERR,"Invalid media player "+n.type+" adaptor api"))})).catch((function(t){e.initReject(t)}));this._initRetryTimer=setTimeout((function(){return e.doInit()}),this._initRetryPeriod)},t.prototype._reset=function(){this._initRetryTimer&&(clearTimeout(this._initRetryTimer),this._initRetryTimer=0),this.player=null,this.type="",this.controlsStateSupported=!1,this.controlsHidden=!1,this.controlsDescriptor=null,this._initRetryPeriod=r.a.player.initRetryPeriod,this._initTimeout=r.a.player.initTimeout,this._initRetryNum=Math.round(this._initTimeout/this._initRetryPeriod),this._initRetry=0,this._removed=!1},t.prototype.getAdaptor=function(){var t=this,e=this.api;return e.type===p.a.CUSTOM?e.api?Promise.resolve(e.api):Promise.reject(new s.a(s.b.PLAYER.INIT_ERR,"Player API must be provided for custom player type")):Promise.resolve().then((function(){var n=e.type+"Import";if(t[n])return t[n]();throw new s.a(s.b.PLAYER.INIT_ERR,"Invalid media player type provided "+e.type)})).then((function(t){return new t}))},t.prototype.html5Import=function(){return n.e(30).then(n.bind(null,254)).then((function(t){return t.default}))},t.prototype.youtubeImport=function(){return n.e(40).then(n.bind(null,255)).then((function(t){return t.default}))},t.prototype.jw6Import=function(){return n.e(32).then(n.bind(null,256)).then((function(t){return t.default}))},t.prototype.jw7Import=function(){return this.jwImport()},t.prototype.jwImport=function(){return n.e(31).then(n.bind(null,257)).then((function(t){return t.default}))},t.prototype.videojsImport=function(){return n.e(38).then(n.bind(null,270)).then((function(t){return t.default}))},t.prototype.kalturaImport=function(){return n.e(33).then(n.bind(null,258)).then((function(t){return t.default}))},t.prototype.vimeoImport=function(){return n.e(37).then(n.bind(null,259)).then((function(t){return t.default}))},t.prototype.flowplayerImport=function(){return n.e(28).then(n.bind(null,267)).then((function(t){return t.default}))},t.prototype.h5pImport=function(){return n.e(29).then(n.bind(null,260)).then((function(t){return t.default}))},t.prototype.wistiaImport=function(){return n.e(39).then(n.bind(null,271)).then((function(t){return t.default}))},t.prototype.openedxImport=function(){return n.e(35).then(n.bind(null,261)).then((function(t){return t.default}))},t.prototype.pageImport=function(){return n.e(36).then(n.bind(null,262)).then((function(t){return t.default}))},t.prototype.kplaykitImport=function(){return n.e(34).then(n.bind(null,272)).then((function(t){return t.default}))},t.actions=["init","play","pause","currentTime","setCurrentTime","duration","paused","mediaSrc","onReady","onPlay","onPause","onSeek","onTimeUpdate","onMediaChange"],t.controlsStateMethods=["onControlsShow","onControlsHide"],t.controlsProperties=["controlsHeight","trackLeftMargin","trackRightMargin","controlsHidden"],t}(),m=n(77),f=n(40),g=function(){function t(t){this.disposables=[],this.deferedEvents=[],this.store=t,this.stopWatch=new m.c,this.pStopWatch=new m.a,this.sessionId=void 0,this.timeCompletion=new b(r.a.analytics.video.benchmark.steps),this.contentCompletion=new b(r.a.analytics.video.benchmark.steps),this.timeoutTimer=new m.d(1500),this.pulseTimer=new m.b(2e4)}return t.prototype.init=function(){var t=this,e=this.store.player;return this.stopWatch.pause().reset(),this.pStopWatch.resetSeconds(e.pp),this.sessionId=Object(i.i)(),this.timeCompletion.reset(),this.contentCompletion.reset(),this.timeoutTimer.clear(),this.pulseTimer.clear(),Promise.resolve().then((function(){t.disposables.push(t.store.threadController.on(f.a.THREAD_APPLIED,(function(){return t.onThreadApplied()}))),e.on(_.READY,(function(){return t._onReady()})),e.on(_.ADAPTOR_REMOVE,(function(){return t.onAdaptorRemove()})),e.on(_.FIRST_PLAY,(function(){return t._onFirstPlay()})),e.on(_.PLAY,(function(){return t._onPlay()})),e.on(_.PAUSE,(function(){return t._onPause()})),e.on(_.SEEK,(function(){return t._onSeek()})),e.on(_.TIME_UPDATE,(function(){return t._onTimeUpdate()})),e.on(_.MEDIA_CHANGE,(function(){return t._onMediaChange()})),e.on(_.FULL_SCREEN_CHANGE,(function(){return t._onFullScreenChange()})),t.pStopWatch.onSegment((function(e){return t.handleStopwatchSegment(e)}))}))},t.prototype.remove=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this.deferedEvents=[],this.timeoutTimer.clear(),this.pulseTimer.clear(),this.stopWatch.pause().reset(),this.pStopWatch.reset()},Object.defineProperty(t.prototype,"benchmarkInfo",{get:function(){var t=this.store.player,e=this.stopWatch.seconds(),n=this.pStopWatch.seconds(),o=Math.min(1,t.pd?Object(i.w)(e/t.pd,3):0),r=Math.min(1,t.pd?Object(i.w)(n/t.pd,3):0);return{session_id:this.sessionId,watchthrough:{time:e,content:n,time_portion:o,content_portion:r},completion:{time:this.timeCompletion.currentStep,content:this.contentCompletion.currentStep}}},enumerable:!1,configurable:!0}),t.prototype.onThreadApplied=function(){for(var t=0;t<this.deferedEvents.length;t++){var e=this.deferedEvents[t];this.store.analyticsController[e.handler](e.data.type,e.data.data,e.data.gaData)}this.deferedEvents=[]},t.prototype._onReady=function(){var t=this.store;this.stopWatch.pause().reset(),this.pStopWatch.resetSeconds(t.player.pp),this.timeoutTimer.clear(),this.pulseTimer.clear(),this.recordLegacyVideoBenchmark("ready",null,{label:"player_"+t.player.type,value:Object(m.e)()})},t.prototype.onAdaptorRemove=function(){this.stopWatch.pause().reset()},t.prototype._onFirstPlay=function(){var t=this.store;this.stopWatch.pause().reset(),this.pStopWatch.resetSeconds(t.player.pp),this.timeoutTimer.clear(),this.pulseTimer.clear(),this.recordLegacyVideoBenchmark("first_play",null,{label:"player_"+t.player.type,value:Object(m.e)()})},t.prototype._onPlay=function(){var t=this;this.stopWatch.start(),this.timeoutTimer.set((function(){return t.pStopWatch.consumeSegment()})),this.pulseTimer.clear()},t.prototype._onPause=function(){var t=this;this.stopWatch.pause(),this.timeoutTimer.set((function(){return t.pStopWatch.consumeSegment()})),this.pulseTimer.clear()},t.prototype._onSeek=function(){var t=this.store;this.pStopWatch.trackSeconds(t.player.pp),this.pulseTimer.clear()},t.prototype._onTimeUpdate=function(){var t=this,e=this.store.player;this.pStopWatch.trackSeconds(e.pp),this.timeoutTimer.set((function(){return t.pStopWatch.consumeSegment()})),this.pulseTimer.isSet||this.pulseTimer.set((function(){return t.pStopWatch.consumeSegment()}));var n=this.stopWatch.seconds(),o=this.pStopWatch.seconds(),i=Math.min(1,e.pd?n/e.pd:0),r=Math.min(1,e.pd?o/e.pd:0);this.timeCompletion.completed(i)&&this.timeCompletion.next(),this.contentCompletion.completed(r)&&(this.contentCompletion.next(),this.recordLegacyVideoBenchmark("progress",null,{label:"completion_"+Math.floor(100*this.contentCompletion.currentStep),value:Math.floor(100*i)}))},t.prototype._onMediaChange=function(){var t=this.store;this.stopWatch.pause().reset(),this.pStopWatch.resetSeconds(t.player.pp),this.timeoutTimer.clear(),this.pulseTimer.clear(),this.sessionId=Object(i.i)(),this.timeCompletion.reset(),this.contentCompletion.reset()},t.prototype._onFullScreenChange=function(){var t=this.store,e=t.player.fullScreen();this.recordVideoInteraction("fullscreen",null,{label:e?"player_fullscreen_on":"player_fullscreen_off",value:t.player.playCounter})},t.prototype.handleStopwatchSegment=function(t){this.pulseTimer.clear();var e=Math.round(t.start/1e3),n=Math.round(t.end/1e3);this.store.analyticsController.recordVideoBenchmark({start:e,end:n})},t.prototype.recordVideoInteraction=function(t,e,n){var o=this.store;if(o.threadController.threadApplied)return o.analyticsController.recordVideoInteraction(t,e,n);this.deferedEvents.push({handler:"recordVideoInteraction",data:{type:t,data:e,gaData:n}})},t.prototype.recordLegacyVideoBenchmark=function(t,e,n){var o=this.store;if(o.threadController.threadApplied)return o.analyticsController.recordLegacyVideoBenchmark(t,e,n);this.deferedEvents.push({handler:"recordLegacyVideoBenchmark",data:{type:t,data:e,gaData:n}})},t}(),b=function(){function t(t){this.currentStep=0,this.nextStep=0,this.steps=t.sort((function(t,e){return t-e}))}return t.prototype.next=function(){var t=this.steps.indexOf(this.nextStep);-1===t?(this.currentStep=0,this.nextStep=this.steps[0]):(this.currentStep=this.steps[Math.min(this.steps.length,t)],this.nextStep=this.steps[Math.min(this.steps.length,t+1)])},t.prototype.reset=function(){this.currentStep=0,this.nextStep=this.steps[0]},t.prototype.completed=function(t){return t>=this.nextStep},t}(),y=n(153),v=n(45),w=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},O=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},_={READY:0,PLAY:1,PAUSE:2,SEEK:3,TIME_UPDATE:4,MEDIA_CHANGE:5,SIZE_CHANGE:6,FULL_SCREEN_CHANGE:7,CONTROLS_SHOW:8,CONTROLS_HIDE:9,CONTROLS_SIZE_CHANGE:10,FIRST_PLAY:11,DURATION_CHANGE:12,FIRST_PAUSE:13,CONTROLS_ENTER:14,CONTROLS_LEAVE:15,ADAPTOR_REMOVE:16},x=function(){function t(t,e){this._defaultCd=Object(v.a)(),this.bindingEngine=t,this.store=e,this.api=e.api.player,this.analytics=new g(e),this.pp=0,this.pd=0,this.w=0,this.h=0,this.playCounter=0,this._player=null,this._cd=null,this._controlsStateSupported=!1,this._controlsHidden=!1,this._paused=!0,this._live=!1,this._mediaSrc=void 0,this.eventHandler=new u(this),this.adaptor=new h(e.api),this.logger=o.h.getLogger("Annoto-player")}return t.prototype.init=function(){var t=this,e=this.adaptor;return this._player=null,this.logger.debug("initializing..."),e.init().then((function(n){return t._cd=e.controlsDescriptor,t._controlsHidden=e.controlsHidden,t._controlsStateSupported=e.controlsStateSupported,t._player=e.player,t.element=n,t.eventHandler.registerHandlers()})).then((function(){return t.analytics.init()})).then((function(){t.logger.info("Initialized: ",t.api.type)}))},t.prototype.remove=function(){try{this.eventHandler.remove(),this.adaptor.remove()}catch(t){this.logger.warn("player remove",t)}this.element=void 0,this.pp=0,this.pd=0,this.w=0,this.h=0,this.playCounter=0,this._player=null,this._cd=null,this._isFullScreen=void 0,this._controlsStateSupported=!1,this._controlsHidden=!1,this._paused=!0,this._live=!1,this._mediaSrc=void 0,this.hackPlayTimer&&(clearTimeout(this.hackPlayTimer),this.hackPlayTimer=0)},Object.defineProperty(t.prototype,"ready",{get:function(){return!!this.eventHandler&&this.eventHandler.ready},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.adaptor?this.adaptor.type:""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cd",{get:function(){return this._player&&Object(i.q)(this._player,"updateControlsDescriptor")&&this._player.updateControlsDescriptor(this.store.isPhone,this.fullScreen()),this._cd||this._defaultCd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cdTransitions",{get:function(){return this.cd.transitions||this._defaultCd.transitions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cdTimeline",{get:function(){return this.cd.timeline||this._defaultCd.timeline},enumerable:!1,configurable:!0}),t.prototype.playHack=function(t){var e=this;void 0===t&&(t=!1),this.isLive||"text"===this.store.mediaType||this.hackPlayTimer||(this.hackPlayTimer=setTimeout((function(){e._player&&e.eventHandler.playHack(t).then((function(){e.logger.debug("playHack done")})).catch((function(t){e.logger.error("playHack: ",t)}))}),r.a.player.hackPlayTimeout))},t.prototype.play=function(){var t=this;return this._player?Promise.resolve().then((function(){return t._player.play()})).catch((function(e){t.logger.error("adapter play: ",e)})):(this.logger.warn("play error. not ready"),Promise.resolve())},t.prototype.pause=function(t){var e=this;return void 0===t&&(t=!1),this._player?this.paused().then((function(n){if(!n||t)return Promise.resolve().then((function(){return e._player.pause()}))})).catch((function(t){e.logger.error("adapter pause: ",t)})):(this.logger.warn("pause error. not ready"),Promise.resolve())},t.prototype.setCurrentTime=function(t){var e=this;return this._player?Object(i.k)(t)?("string"==typeof t&&(t=parseFloat(t)),Promise.resolve().then((function(){return e._player.setCurrentTime(t)})).catch((function(t){e.logger.error("adapter setCurrentTime: ",t)}))):(this.logger.warn("time must be a number: ",t),Promise.resolve()):(this.logger.warn("setCurrentTime error. not ready"),Promise.resolve())},t.prototype.currentTime=function(){var t=this;return this._player?Promise.resolve().then((function(){return t._player.currentTime()})).then((function(t){return void 0===t||!Object(i.k)(t)||t<0?0:parseFloat(t)})).catch((function(e){return t.logger.error("adapter getCurrentTime: ",e),Promise.resolve(0)})):Promise.resolve(0)},t.prototype.duration=function(){var t=this;return this._player?Promise.resolve().then((function(){return t._player.duration()})).then((function(t){return void 0===t||!Object(i.k)(t)||t<0?0:Math.floor(parseInt(t))})).catch((function(e){return t.logger.error("adapter duration: ",e),Promise.resolve(0)})):Promise.resolve(0)},t.prototype.paused=function(){var t=this;return this._player?Promise.resolve().then((function(){return t._player.paused()})).catch((function(e){return t.logger.error("adapter paused: ",e),!0})):(this.logger.warn("paused error. not ready"),Promise.resolve(!0))},t.prototype.mediaSrc=function(){var t=this;if(!this._player)return this.logger.warn("mediaSrc error. not ready"),Promise.resolve();var e="function"==typeof this.api.mediaSrc?this.api.mediaSrc:this._player.mediaSrc,n="function"==typeof this.api.mediaSrc?this:this._player;return Promise.resolve().then((function(){return e.call(n)})).then((function(t){return t&&"string"==typeof t&&""!==t?t:void 0})).catch((function(e){t.logger.error("adapter mediaSrc: ",e)}))},Object.defineProperty(t.prototype,"cachedMediaSrc",{get:function(){return this._mediaSrc},enumerable:!1,configurable:!0}),t.prototype.mediaDetails=function(){var t=this;return this._player?Promise.resolve().then((function(){if(Object(i.q)(t._player,"mediaMetadata"))return t._player.mediaMetadata()})).then((function(e){return"function"==typeof t.api.mediaDetails?t.api.mediaDetails(e):e})).catch((function(e){return t.logger.error("adapter mediaDetails: ",e),null})):(this.logger.warn("mediaMetadata error. not ready"),Promise.resolve(null))},t.prototype.autoplay=function(){var t=this;return this._player?Object(i.q)(this._player,"autoplay")?Promise.resolve().then((function(){return t._player.autoplay()})).catch((function(e){t.logger.error("adapter autoplay: ",e)})):Promise.resolve(null):(this.logger.warn("autoplay error. not ready"),Promise.resolve(null))},t.prototype.getIslive=function(){var t=this;return this._player?Object(i.q)(this._player,"isLive")?Promise.resolve().then((function(){return t._player.isLive()})).then((function(e){return t._live=Boolean(e),t._live})).catch((function(e){return t.logger.error("adapter getIslive: ",e),t._live=!1,!1})):(this._live=!1,Promise.resolve(!1)):(this.logger.warn("isLive error. not ready"),this._live=!1,Promise.resolve(!1))},t.prototype._defaultEmbeddableElement=function(){var t=this.element;return"string"==typeof t&&(t=document.getElementById(t)),t},t.prototype.isEmbeddableElement=function(t){return void 0===t&&(t=this.embeddableElement()),Boolean(t&&"IFRAME"!==t.tagName)},t.prototype.embeddableElement=function(){if(this._player&&Object(i.q)(this._player,"embeddableElement")){var t=void 0;try{t=this._player.embeddableElement()}catch(t){this.logger.warn("embeddableElement error: ",t)}return t}return this._defaultEmbeddableElement()},t.prototype.fixFullScreen=function(){if(this._player&&Object(i.q)(this._player,"fixFullScreen"))try{return this._player.fixFullScreen()}catch(t){this.logger.warn("fixFullScreen error: ",t)}return!0},t.prototype.fullScreenSupported=function(){var t=this.embeddableElement();if(this.isEmbeddableElement(t))return!0;var e=this.store.initializer.browser,n=y.a.fullscreenFullySupportedBrowsers;if(!0===n[e.name])return!0;if(Object(i.j)(n[e.name])){var o=parseInt(e.version);return Boolean(-1!==n[e.name].indexOf(o.toString()))}return!1},t.prototype.fullScreen=function(){if(this._player){if(Object(i.q)(this._player,"fullScreen")){var t=void 0;try{t=Boolean(this._player.fullScreen())}catch(t){this.logger.warn("fullscreen error: ",t)}return t}return!0===this._isFullScreen||!1===this._isFullScreen?this._isFullScreen:this.isCalculatedFullScreen()}},t.prototype.isCalculatedFullScreen=function(){var t=this._width(),e=this._height();if(Object(i.k)(t)&&Object(i.k)(e)){var n=window.innerWidth,o=window.innerHeight,r=window.outerWidth,a=window.outerHeight,s=(o/a).toPrecision(2),c=(n/r).toPrecision(2),l=Boolean(s!==c),u=Boolean(t>=r-10||e>=a-10);return t>=n-50&&e>=o-50&&(!l||u)}},t.prototype.isFullInIframe=function(){var t=!0;try{t=self!==window.parent}catch(t){}if(!t)return!1;var e=this._height();if(!Object(i.k)(e))return!1;var n=window.innerHeight;return Boolean(e>=n-50)},t.prototype.width=function(){if(this._player){var t=this._width();if(Object(i.q)(this._player,"width"))return t;try{if(this.fullScreen())return this.store.windowWidth}catch(t){this.logger.warn("width error: ",t)}return t}},t.prototype._width=function(){if(this._player){var t=void 0;if(Object(i.q)(this._player,"width")){try{t=this._player.width()}catch(t){this.logger.warn("width error: ",t)}if("string"==typeof t){if(-1===t.indexOf("%"))return this.w=parseInt(t),this.w}else if(Object(i.k)(t))return this.w=t,t}try{t=this._elementWidth()}catch(t){this.logger.warn("width error: ",t)}return this.w=t,t}},t.prototype._elementWidth=function(){if(this.element)return this.element.getBoundingClientRect().width},t.prototype.videoRatio=function(){var t=null;if(Object(i.q)(this._player,"videoRatio"))try{t=this._player.videoRatio()||null}catch(t){this.logger.warn("videoRatio: ",t)}return t},t.prototype.playerRatio=function(){return this.width()/this.height()},t.prototype.videoRatioOffsets=function(){var t=this.cd,e={top:0,left:0};if(!t.fixVideoRatioOffsets)return e;var n=this.videoRatio();if(!n)return e;var o=this.height(),i=this.width();return n/(i/o)>1?e.top=o-i/n:e.left=i-o*n,t.videoRatioOffsets&&(t.videoRatioOffsets.center&&(e.top=e.top/2,e.left=e.left/2),e.top&&t.videoRatioOffsets.top&&(e.top=e.top-t.videoRatioOffsets.top),t.videoRatioOffsets.left&&(e.left=e.left-t.videoRatioOffsets.left)),e},t.prototype.height=function(){if(this._player){var t=this._height();if(Object(i.q)(this._player,"height"))return t;try{if(this.fullScreen())return this.store.windowHeight}catch(t){this.logger.warn("height error: ",t)}return t}},t.prototype._height=function(){if(this._player){var t=void 0;if(Object(i.q)(this._player,"height")){try{t=this._player.height()}catch(t){this.logger.warn("height error: ",t)}if("string"==typeof t){if(-1!==t.indexOf("px"))return this.h=parseInt(t),this.h}else if(Object(i.k)(t))return this.h=t,t}try{t=this._elementHeight()}catch(t){this.logger.warn("height error: ",t)}return this.h=t,t}},t.prototype._elementHeight=function(){if(this.element)return this.element.getBoundingClientRect().height},t.prototype.controlsElement=function(){if(this._player&&Object(i.q)(this._player,"controlsElement"))try{return this._player.controlsElement()}catch(t){this.logger.warn("controlsElement error: ",t)}return null},t.prototype.controlsHeight=function(){if(this._player){if(Object(i.q)(this._player,"controlsHeight")){var e=void 0;try{e=t.parseStyleVal(this._player.controlsHeight())}catch(t){e=!1,this.logger.warn("controlsHeight error: ",t)}if(!1!==e)return e}var n=this.cd;return this.fullScreen()?n.fullScreen.height:n.height}},t.prototype.trackMarginLeft=function(){if(this._player){if(Object(i.q)(this._player,"trackMarginLeft")){var e=void 0;try{e=t.parseStyleVal(this._player.trackMarginLeft())}catch(t){e=!1,this.logger.warn("trackMarginLeft error: ",t)}if(!1!==e)return e}return this._getTrackMargins().ml}},t.prototype.trackMarginRight=function(){if(this._player){if(Object(i.q)(this._player,"trackMarginRight")){var e=void 0;try{e=t.parseStyleVal(this._player.trackMarginRight())}catch(t){e=!1,this.logger.warn("trackMarginRight error: ",t)}if(!1!==e)return e}return this._getTrackMargins().mr}},t.prototype._getTrackMargins=function(){var t=this.fullScreen(),e=t&&this.positionBarAtTop(),n=this.cd;if(e&&t&&n.fullScreen.topTrack){var o=n.fullScreen.topTrack.margins||0;return{ml:o,mr:o}}try{var i=t?n.fullScreen.track.marginLeft:n.track.marginLeft,r=t?n.fullScreen.track.marginRight:n.track.marginRight,a=t?n.fullScreen.track.maxWidth:n.track.maxWidth,s=t?n.fullScreen.track.widthPercentage:n.track.widthPercentage;if(a||s){var c=this.width(),l=a||c;s&&(l=Math.min(a,Math.round(c*s-(i+r))));if(c>l){var u=Math.round((c-l)/2);i+=u,r+=u}}return{ml:i,mr:r}}catch(t){return this.logger.warn("trackMargins error: ",t),{ml:0,mr:0}}},t.prototype.controlsHidden=function(){if(this._player){if(Object(i.q)(this._player,"controlsHidden")){var t=!1;try{t=Boolean(this._player.controlsHidden())}catch(t){this.logger.warn("controlsHidden error: ",t)}return t}return this._controlsHidden}},t.prototype.positionBarAtTop=function(){var t=this.fullScreen(),e=(this.store.api||{}).timeline||{};return Boolean(t&&e.positionTopInFullScreen)},Object.defineProperty(t.prototype,"scrubberOnInOverlay",{get:function(){return Boolean(this._cd&&(this._cd.scrubberOnInOverlay||this.store.api.timeline.scrubberAlwaysOn))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPaused",{get:function(){return this._paused},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLive",{get:function(){return this._live},enumerable:!1,configurable:!0}),t.prototype.on=function(t,e){return this.eventHandler.on(t,e)},t.prototype.onOneTime=function(t,e){return this.eventHandler.onOneTime(t,e)},Object.defineProperty(t.prototype,"info",{get:function(){return{player_ready:this.ready,player_type:this.type,current_time:Math.floor(this.pp),duration:Math.floor(this.pd),is_paused:this._paused,is_live:this._live,media_src:this._mediaSrc,play_counter:this.playCounter,play_state:this.playStateInfo,view_info:{is_full_screen:this.fullScreen(),height:this.height(),width:this.width(),controls_hidden:this.controlsHidden(),controls_height:this.controlsHeight(),controls_margin_left:this.trackMarginLeft(),controls_margin_right:this.trackMarginRight(),bar_at_top:this.positionBarAtTop()},benchmark:this.analytics.benchmarkInfo}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playStateInfo",{get:function(){var t=1===this.playCounter?"first_play":"another_play";return 0===this.playCounter&&(t="not_played"),t},enumerable:!1,configurable:!0}),t.parseStyleVal=function(t){if("string"==typeof t){if(-1!==t.indexOf("px"))return parseInt(t)}else if(Object(i.k)(t))return t;return!1},w([Object(o.p)("eventHandler","eventHandler.ready"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"ready",null),w([Object(o.p)("_cd","_cd.scrubberOnInOverlay","store.api","store.api.timeline.scrubberAlwaysOn"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"scrubberOnInOverlay",null),w([Object(o.p)("_paused"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"isPaused",null),w([Object(o.p)("_live"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"isLive",null),t}()},45:function(t,e,n){"use strict";function o(){return{height:0,scrubberOnInOverlay:!1,track:{marginRight:0,marginLeft:0,maxWidth:0,widthPercentage:0},fullScreen:{height:0,topTrack:{margins:0},track:{marginRight:0,marginLeft:0,maxWidth:0,widthPercentage:0}},mouse:{trackMove:!1,moveTimeout:0,hideOnLeave:!1,showOnEnter:!1,enterTimeout:0},transitions:{showTiming:"0s linear",hideTiming:"0s linear"},timeline:{fadeInOut:!1},hideOnPlay:!1,showDelay:0,firstShowDelay:0,hideDelay:0,shownOnLoad:!1,fixVideoRatioOffsets:!1,videoRatioOffsets:{center:!0,top:0,left:0}}}n.d(e,"a",(function(){return o}))},48:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var o=n(65),i=n(73),r=n(11),a=n(38),s=n(29),c=n(59),l=n(100),u=function(){function t(){}return t.getPostObject=function(t,e){var n={};if(t.type===r.c.EMOTION)return n.type=t.value,n.ps=t.ps?Math.floor(t.ps):t.ps,n.origin=c.a.origin,n.group_id=e.groupId,n},t.mergeObject=function(t,e){return t.type===r.c.EMOTION&&(this.mergeEmotionObject(t,e),!0)},t.mergeEmotionObject=function(t,e){t.type=r.c.EMOTION,Object(s.a)(t,"id",e.id),Object(s.a)(t,"createdAt",e.created_at,(function(){t.createdAt.setTime(Date.parse(e.created_at))})),Object(s.a)(t,"value",e.type),Object(s.a)(t,"ps",e.ps),Object(s.a)(t,"commentId",e.comment_id)},t.parseUserEmotions=function(t,e){var n=[];if(t)for(var o=0;o<t.length;++o){var i=this.createVoteFromEmotion(t[o],e);this.mergeEmotionObject(i,t[o]),n.push(i)}return n},t.createEmotion=function(t,e,n){return new i.a(n,t,e.emotionsParams[t])},t.createEmotionFromVote=function(t,e){var n=null,o=e.emotionsParams;return t&&t.type===r.c.EMOTION&&o[t.value]&&(n=new i.a(t.id,t.value,o[t.value])),n},t.createVoteFromEmotion=function(t,e){return new o.a(e.model,r.c.EMOTION,t.type,void 0)},t.createUnknownEmotion=function(){return new i.a(l.a.nextNumberId(),a.c.UNKNOWN,a.b[a.c.UNKNOWN])},t.createLikeOEmotion=function(){return new i.a(l.a.nextNumberId(),a.c.LIKE_O,a.b[a.c.LIKE_O])},t.createLikeEmotion=function(){return new i.a(l.a.nextNumberId(),a.c.LIKE,a.b[a.c.LIKE])},t.createEmotionsList=function(t,e){void 0===e&&(e=!1);for(var n=[],o=t.emotions,r=0;r<o.length;r++)if(!e||o[r].type!==a.c.LIKE){var s=new i.a(l.a.nextNumberId(),o[r].type,o[r].params);n.push(s)}return n},t.findEmotionForVote=function(t,e){var n=null;if(t instanceof o.a&&t.type===r.c.EMOTION)for(var i=0;i<e.length;i++)if(t.value===e[i].type){n=e[i];break}return n},t.isUserVote=function(t,e){return!(!e.author||!Object(s.z)(t.id,e.author.id))},t.getUserVote=function(t,e,n){for(var o=n.psMin,i=n.psMax,r=0;r<e.length;r++){var a=e[r];if(this.isUserVote(t,a)){if(!1!==isNaN(o)||!1!==isNaN(i)||!1!==isNaN(a.ps))return a;if(a.ps>=o&&a.ps<=i)return a}}return!1},t}()},49:function(t,e,n){"use strict";n.d(e,"a",(function(){return v}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(250),a=n(29),s=n(75),c=n(32),l=n(93),u=n(50),p=n(11),d=n("auth/index"),h=n(31),m=n(52),f=n(34),g=n(81),b=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},v=function(){function t(t,e,n,i,r,s){var l=this;this.defaultId=Object(a.i)(),this.name="generic.guest_username",this.photoUrl="",this.defaultPhoto=c.a.imagesUrl+p.b.DEFAULT_AVATAR,this.authenticated=!1,this.demoMode=!1,this._superModerator=!1,this._moderator=!1,this.scopes=[],this.hostScopes=[],this._sso=!1,this._ready=!1,this._ssoOverride=c.a.debug.ssoOverride,this.eventAggregator=t,this.bindingEngine=e,this.authService=n,this.userSettings=r,this.settings=s,this.dbaService=i,this.logger=o.h.getLogger("Annoto-user"),this.authenticated=this.authService.authenticated,this.bindingEngine.propertyObserver(this.authService,"authenticated").subscribe((function(t){return l._authenticationChanged(t)})),this.id=this.defaultId,this.visitorId=this.defaultId,this.author=new m.a(this.defaultId,this.name,this.defaultPhoto)}return t.prototype.init=function(t){var e=this;return this.logger.debug("Initializing"),"string"==typeof t?this.getSSOPerm().then((function(){if(!e.sso)throw new f.a(f.b.USER.SSO_REJECTED,"SSO is not permitted. Please setup first.");return e.initSSO()})).then((function(){return e.authenticateSSOPrepare()})).then((function(){return e.doAuthSSOWithRetry(t)})).then((function(){return e._applyCredentials()})).then((function(){e._ready=!0,e.authState=e.authenticated,e._notifyAuthChange(),e.logger.debug("initialized with static SSO")})).catch((function(t){return e.logger.debug("Static SSO init err: ",t),e.initErrorHandle(new f.a(f.b.USER.STATIC_SSO_ERR,"Static authentication was rejected."))})):this.getSSOPerm().then((function(){if(e.logger.debug("Got SSO permissions"),e.sso)return e.initSSO()})).then((function(){return e._applyCredentials()})).then((function(){e.logger.debug("Initialized"),e._ready=!0,e.authState=e.authenticated,e._notifyAuthChange()})).catch((function(t){return e.initErrorHandle(t)}))},t.prototype.initErrorHandle=function(t){var e=this;if(!this.authenticated)return this._reset().then((function(){throw e.authState=e.authenticated,e._notifyAuthChange(),t}));throw this.authState=this.authenticated,this._notifyAuthChange(),t},t.prototype.initSSO=function(){var t=this;return this.authService.initSSO().then((function(){t.logger.debug("initSSO: ",t.authenticated)}))},t.prototype.setDemoMode=function(){return this.demoMode=!0,this.authenticated=!0,this._reset()},t.prototype.login=function(t){return this.ready?this.authService.login(t):this.notSetupReject()},t.prototype.signup=function(t){return this.ready?this.authService.signup(t):this.notSetupReject()},t.prototype.anonymousLogin=function(t){return this.ready?this.anonymousEnabled?this.authService.anonymousLogin(t):Promise.reject(new f.a(f.b.USER.ANONYMOUS_DISABLED,"anonymous is disabled")):this.notSetupReject()},t.prototype.anonymousSignup=function(t){return this.ready?this.anonymousEnabled?this.authService.anonymousSignup(t):Promise.reject(new f.a(f.b.USER.ANONYMOUS_DISABLED,"anonymous is disabled")):this.notSetupReject()},t.prototype.authenticate=function(t){return this.ready?this.authService.authenticate(t):this.notSetupReject()},t.prototype.logout=function(){return this.demoMode?Promise.resolve():this.ready?this.authService.logout():this.notSetupReject()},t.prototype.authenticateSSO=function(t){var e=this;return this.demoMode?Promise.resolve():this.ready?this.authenticateSSOPrepare().then((function(){return e.getSSOPerm()})).then((function(){if(!e.sso)throw new f.a(f.b.USER.SSO_REJECTED,"SSO is not permitted. Please setup first");return e.doAuthSSOWithRetry(t)})).catch((function(t){if(f.a.isAError(t))throw t;throw new f.a(f.b.USER.SSO_AUT_ERR,"SSO auth error")})):this.notSetupReject()},t.prototype.notSetupReject=function(){return Promise.reject(new f.a(f.b.USER.NOT_INIT,"User is not setup"))},t.prototype.doAuthSSOWithRetry=function(t){var e=this;return this.doAuthSSO(t).then((function(n){if(n.isConflict)return e.logger.info("SSO auto retry"),Object(a.c)(Object(s.a)(50,200)).then((function(){return e.doAuthSSO(t).then((function(t){if(t.err)throw t.err}))}));if(n.err)throw n.err}))},t.prototype.doAuthSSO=function(t){var e=this;return this.authService.authenticateSSO(t).then((function(){return e._authenticationChanged(e.authService.authenticated)})).then((function(){return e.logger.debug("authenticated SSO"),{}})).catch((function(t){var n=t instanceof Response;(!n||t&&t.status>=500)&&e.logger.error("SSO authenticate: ",t);var o=Boolean(n&&t.status===r.b);return{err:f.a.isAError(t)?t:new f.a(f.b.USER.SSO_AUT_ERR,"SSO auth error"),isConflict:o}}))},t.prototype.authenticateSSOPrepare=function(){return this.authenticated?(this.authenticated=!1,this._applyCredentials(!1)):Promise.resolve()},t.prototype.getSSOPerm=function(){var t=this;return Promise.resolve().then((function(){var e=Boolean(t.settings.hostSettings&&t.settings.hostSettings.enableSSO);e!==t.sso&&(t.sso=e,t.logger.debug("SSO permissions changed: ",e))}))},t.prototype.setPrivateMode=function(t){var e=t;e||this.settings.commentsEnabled||(this.logger.warn("Unable to set social Mode: Comments Disabled"),e=!0),e&&(this.settings.privateNotesEnabled||(this.logger.warn("Unable to set private Mode: Disabled"),e=!1));var n=this.userSettings.isPrivateMode;this.userSettings.setPrivateMode(e),this.userSettings.isPrivateMode!==n&&this.eventAggregator.publish(h.a.PRIVATE_MODE_CHANGED,this.userSettings.isPrivateMode)},t.prototype.updatePermissions=function(t){var e=t||{scopes:[],hostScopes:[]};this.scopes=e.scopes||[],this.hostScopes=e.hostScopes||[],this.author.set(this.id,this.name,this.photoUrl,this.hostScopes),this.superModerator=Boolean(-1!==this.scopes.indexOf("super-mod")),this.moderator=Boolean(-1!==this.scopes.indexOf("moderator")),this.logger.info("updated permissions"),this.eventAggregator.publish(h.a.USER_PERMISSIONS_CHANGE)},t.prototype.ssoAuthRequestHandle=function(){var t=this;return this.ssoAuthRequestPromise?this.ssoAuthRequestPromise:("function"==typeof this.settings.ux.ssoAuthRequestHandle?this.ssoAuthRequestPromise=Promise.resolve().then((function(){return t.settings.ux.ssoAuthRequestHandle()})).then((function(){t.logger.info("ssoAuthRequestHandle done")})):(this.logger.warn("ssoAuthRequestHandle requested but not set"),this.ssoAuthRequestPromise=Promise.resolve()),this.ssoAuthRequestPromise.catch((function(e){t.logger.error("ssoAuthRequestHandle: ",e)})).then((function(){t.ssoAuthRequestPromise=null})))},Object.defineProperty(t.prototype,"ready",{get:function(){return this._ready&&this.authService.ready},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canPostThread",{get:function(){return this.authService&&this.authService.hostAuthenticated},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canPost",{get:function(){return this.authenticated},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"superModerator",{set:function(t){t!==this._superModerator&&(this._superModerator=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSuperModerator",{get:function(){return this._superModerator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"moderator",{set:function(t){t!==this._moderator&&(this._moderator=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isModerator",{get:function(){return this._moderator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sso",{get:function(){return this._sso},set:function(t){t!==this._sso&&(this._sso=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canModerate",{get:function(){return this.authenticated&&this.isModerator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"in",{get:function(){return this.authenticated},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authActionsDisabled",{get:function(){return Boolean((this.sso&&"function"!=typeof this.settings.ux.ssoAuthRequestHandle||this.anonymousEnabled)&&!this._ssoOverride)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"logoutActionDisabled",{get:function(){return Boolean(this.sso&&"function"!=typeof this.settings.ux.logoutRequestHandle&&!this._ssoOverride)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ssoNotAuthenticated",{get:function(){return!this.authenticated&&this.sso},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anonymousEnabled",{get:function(){var t=this.settings.hostSettings;return Boolean(t&&t.enableAnonymous)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ssoId",{get:function(){return this.authService.ssoId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return!this.authenticated||this.demoMode?{auth:!1,id:this.id,visitor_id:this.visitorId,root_id:this.id}:{auth:!0,id:this.id,visitor_id:this.visitorId,sso:this.sso,root_id:this.credentials&&this.credentials.parentId?this.credentials.parentId:this.id}},enumerable:!1,configurable:!0}),t.prototype._reset=function(t){return void 0===t&&(t=!0),this.logger.info("reset"),this.photoUrl=this.defaultPhoto,this.name="generic.guest_username",this.credentials=void 0,this.superModerator=!1,this.moderator=!1,this.scopes=[],this.hostScopes=[],this._applyVisitorSessionId(t)},t.prototype._applyCredentials=function(t){var e=this;if(void 0===t&&(t=!0),this.authenticated&&!this.demoMode){this.logger.info("applyCredentials");var n=this.authService.getUserCredentials();return this.id=n.id,this.photoUrl=n.photoUrl||this.defaultPhoto,this.name=n.name,this.credentials=n,this.author.set(this.id,this.name,this.photoUrl),this.superModerator=!1,this.moderator=!1,this.scopes=[],this.hostScopes=[],this.clearSetSessionUserIdRetries(),this.setSessionUserId(t).then((function(){return e.logger.debug("Set session user id")}))}return this._reset(t)},t.prototype._applyVisitorSessionId=function(t){var e=this;return void 0===t&&(t=!0),this.dbaService.getAction("userSession","credentials").then((function(t){if(!t||!t.visitorId)throw new f.a(f.b.USER.VISITOR_SET_ERR,"invalid response");e.visitorId=t.visitorId,e.authenticated&&!e.demoMode||(e.id=t.visitorId,e.author.set(e.id,e.name,e.photoUrl),e.logger.debug("applyVisitorSessionId"))})).catch((function(n){e.authenticated&&!e.demoMode||e.author.set(e.id,e.name,e.photoUrl),e.logger.warn("getting visitor id: ",n),t&&setTimeout((function(){e.authenticated&&!e.demoMode||e._applyVisitorSessionId(!1)}),2e3)}))},t.prototype.clearSetSessionUserIdRetries=function(){this._setSessionUserIdRetry=0},t.prototype.setSessionUserId=function(t){var e=this;return void 0===t&&(t=!0),this._setSessionUserIdRetry>5?(this.logger.warn("Gave up setting session user id"),Promise.resolve()):(this._setSessionUserIdRetry++,this.dbaService.setAction("userSession","userId",{userId:this.id}).then((function(t){if(!t||!t.visitorId)throw new f.a(f.b.USER.SESSION_SET_ERR,"invalid response");e.visitorId=t.visitorId,e.logger.debug("setSessionUserId")})).catch((function(n){e.logger.warn("setting session user id ("+e._setSessionUserIdRetry+"): ",n),t&&setTimeout((function(){e.authenticated&&e.setSessionUserId()}),0)})))},t.prototype._authenticationChanged=function(t){var e=this;if(this.authenticated!==t&&(this.authenticated=t,this.ready))return this._applyCredentials().then((function(){e._notifyAuthChange(),e.authState!==e.authenticated&&(e.authState=e.authenticated,e.eventAggregator.publish(h.a.USER_AUTH_CHANGE,e.authState))}))},t.prototype._notifyAuthChange=function(){this.authenticated?this.eventAggregator.publish(h.a.USER_AUTHENTICATED):this.eventAggregator.publish(h.a.USER_LOGOUT),this.logger.info("notifyAuthChange: ",this.authenticated)},b([Object(o.p)("_ready","authService.ready"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"ready",null),b([Object(o.p)("authService.hostAuthenticated"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"canPostThread",null),b([Object(o.p)("authenticated"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"canPost",null),b([Object(o.p)("_superModerator"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"isSuperModerator",null),b([Object(o.p)("_moderator"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"isModerator",null),b([Object(o.p)("_sso"),y("design:type",Object),y("design:paramtypes",[Object])],t.prototype,"sso",null),b([Object(o.p)("authenticated","isModerator"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"canModerate",null),b([Object(o.p)("authenticated"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"in",null),b([Object(o.p)("sso","settings.ux","settings.ux.ssoAuthRequestHandle","anonymousEnabled","_ssoOverride"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"authActionsDisabled",null),b([Object(o.p)("sso","settings.ux","settings.ux.logoutRequestHandle","_ssoOverride"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"logoutActionDisabled",null),b([Object(o.p)("authenticated","sso"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"ssoNotAuthenticated",null),b([Object(o.p)("settings.hostSettings"),y("design:type",Boolean),y("design:paramtypes",[])],t.prototype,"anonymousEnabled",null),b([Object(o.p)("authService.ssoId"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"ssoId",null),t=b([Object(o.t)(i.EventAggregator,o.b,d.AnnotoAuthService,g.a,l.a,u.a),y("design:paramtypes",[i.EventAggregator,o.b,d.AnnotoAuthService,g.a,l.a,u.a])],t)}()},50:function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var o=n("aurelia-framework"),i=n(57),r=n.n(i),a=n(38),s=n(34),c=n(29),l=n(11),u=n(155),p=n(32),d=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},h=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},m=function(){function t(){this.apiConfig=u.a.defaultConfig,this.emotions=[],this.isELearning=!1,this.mergedUx={},this.hostUx={},this.interactiveEnabled=!0,this.applyDefaults()}return t.prototype.applyDefaults=function(){this.emotions=[],this.emotionsParams=a.b;var e=this.emotionsParams;this.emotions.push(t.emotion(a.c.ANGRY,e)),this.emotions.push(t.emotion(a.c.TOUCHED,e)),this.emotions.push(t.emotion(a.c.BORED,e)),this.emotions.push(t.emotion(a.c.LOL,e)),this.emotions.push(t.emotion(a.c.WOW,e)),this.emotions.push(t.emotion(a.c.LIKE,e))},t.prototype.applyHostSettings=function(t){t&&(this.hostSettings=t,t.ux&&(this.hostUx=t.ux,this.overrideUxByHostSettings()))},t.prototype.applyThreadSettings=function(t){this.threadSettings=t,this.applyEmotions(t.emotions),this.isELearning=!!t.emotions_set&&-1!==t.emotions_set.indexOf("e-learning")},t.prototype.applyEmotionsSettings=function(t){this.emotionsSettings=t,this.applyEmotionsParams(t.params)},t.prototype.applyElearning=function(){this.emotions=[];var e=this.emotionsParams;this.emotions.push(t.emotion(a.c.NOT_OK,e)),this.emotions.push(t.emotion(a.c.MARK,e)),this.emotions.push(t.emotion(a.c.HELP,e)),this.emotions.push(t.emotion(a.c.IDEA,e)),this.emotions.push(t.emotion(a.c.OK,e)),this.emotions.push(t.emotion(a.c.LIKE,e)),this.isELearning=!0},t.prototype.applyEmotionsParams=function(t){var e=JSON.parse(JSON.stringify(a.b));Object(c.f)(e,(function(e,n){if(t[e]){if(t[e].iconSrc)return n.iconSrc=l.b.EMOTIONS_URL+"/"+t[e].iconSrc,void(n.iconClass=null);t[e].iconClass&&(n.iconClass=t[e].iconClass,n.iconSrc=null)}}),this),this.emotionsParams=e},t.prototype.applyEmotions=function(e){if(this.emotions=[],!e)return this.applyDefaults(),new s.a("no thread emotions");for(var n=0;n<e.length;n++){var o=e[n];if(!this.emotionsParams[o])return this.applyDefaults(),new s.a("unknown thread emotion: "+o);o!==a.c.UNKNOWN&&o!==a.c.NEUTRAL&&this.emotions.push(t.emotion(o,this.emotionsParams))}return!(this.emotions.length>6||this.emotions.length<3)||(this.applyDefaults(),new s.a("emotions count should be 3-6, got: "+this.emotions.length))},t.emotion=function(t,e){return{type:t,params:e[t]}},t.prototype.applyApiConfig=function(t){this.apiConfig!==t&&(this.apiConfig=t,this.mergedUx=t.ux,this.overrideUxByHostSettings())},Object.defineProperty(t.prototype,"ctaEnabled",{get:function(){return Boolean(p.a.cta.enable&&this.apiConfig.features.cta)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analyticsEnabled",{get:function(){return Boolean(!this.apiConfig.demoMode)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentsEnabled",{get:function(){var t=p.a.debug.forceComments;return Boolean(this.apiConfig.features.comments||"true"===t||!0===t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentsSubmitEnabled",{get:function(){return Boolean(this.apiConfig.features.commentsSubmit)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"privateNotesEnabled",{get:function(){return Boolean(this.apiConfig.features.privateNotes)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"privateNotesSubmitEnabled",{get:function(){return Boolean(this.apiConfig.features.privateNotesSubmit)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasUGC",{get:function(){return Boolean(this.privateNotesEnabled||this.commentsEnabled)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tabsEnabled",{get:function(){return Boolean(this.apiConfig.features.tabs)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userPreferencesEnabled",{get:function(){return Boolean(this.apiConfig.features.userPreferences)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"darkThemeEnabled",{get:function(){return Boolean(this.apiConfig.features.darkTheme)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minibarEnabled",{get:function(){return Boolean(this.apiConfig.features.minibar)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadVoteEnabled",{get:function(){return Boolean(this.apiConfig.features.threadVote)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"voteEmotionsEnabled",{get:function(){return Boolean(this.apiConfig.features.voteEmotions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentSentimentEnabled",{get:function(){return Boolean(this.apiConfig.features.commentSentiment)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"popoutEnabled",{get:function(){return Boolean(this.apiConfig.features.popout)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"helpUrl",{get:function(){return this.apiConfig.helpUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ux",{get:function(){return this.mergedUx},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timelineEnabled",{get:function(){return this.apiConfig.features.timeline&&!p.a.ux.disableTimeline},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statsEnabled",{get:function(){return this.apiConfig.features.stats},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"features",{get:function(){var t,e;return(null===(e=null===(t=this.threadSettings)||void 0===t?void 0:t.preferences)||void 0===e?void 0:e.features)||{}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"limits",{get:function(){var t,e;return(null===(e=null===(t=this.threadSettings)||void 0===t?void 0:t.preferences)||void 0===e?void 0:e.limits)||{videoCommentDuraion:180}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anonymousCommentsEnabled",{get:function(){return Boolean(this.features.anonymous_comments)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ugcExportEnabled",{get:function(){return Boolean(this.features.ugc_export)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userSpaceEnabled",{get:function(){return Boolean(this.features.user_space)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"peopleEnabled",{get:function(){return Boolean(this.features.people)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoAnalyticsEnabled",{get:function(){return Boolean(this.features.videoAnalytics)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoCommentsEnabled",{get:function(){return Boolean(this.features.videoComments)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"notificationsEnabled",{get:function(){return Boolean(this.threadSettings&&this.threadSettings.notifications&&!this.threadSettings.notifications.followersEmailsDisable)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apiUrl",{get:function(){var t=this.apiConfig.backend||{};return""+(t.domain?"https://api."+t.domain:t.apiUrl||l.b.API_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apiV2Url",{get:function(){var t=this.apiConfig.backend||{};return""+(t.domain?"https://api-v2."+t.domain:t.apiV2Url||l.b.APIV2_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authUrl",{get:function(){var t=this.apiConfig.backend||{};return""+(t.domain?"https://auth."+t.domain:t.authUrl||l.b.AUTH_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"insightsUrl",{get:function(){var t=this.apiConfig.backend||{};return""+(t.domain?"https://insights."+t.domain:t.insightsUrl||l.b.INSIGHTS_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this.apiConfig.zIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fsZIndex",{get:function(){return this.apiConfig.fsZIndex},enumerable:!1,configurable:!0}),t.prototype.overrideUxByHostSettings=function(){var t=this.mergedUx,e=this.hostUx;Object(c.a)(t,"commentsTopToBottom",e.commentsTopToBottom),Object(c.a)(t,"draggableDisabled",e.draggableDisabled),Object(c.a)(t,"sidePanelLayout",e.sidePanelLayout),Object(c.a)(t,"sidePanelFullScreen",e.sidePanelFullScreen),Object(c.a)(t,"sidePanelOverlay",e.sidePanelOverlay),Object(c.a)(t,"sidePanelOverlayWidth",e.sidePanelOverlayWidth),Object(c.a)(t,"sidePanelFullScreenWidth",e.sidePanelFullScreenWidth),Object(c.a)(t,"maxWidth",e.maxWidth),Object(c.a)(t,"openOnLoad",e.openOnLoad),Object(c.a)(t,"kukuCloseOnLoad",e.kukuCloseOnLoad),e.pauseTriggers&&r()(!0,t.pauseTriggers,e.pauseTriggers)},d([Object(o.p)("config.cta.enable","apiConfig","apiConfig.features","apiConfig.features.cta"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"ctaEnabled",null),d([Object(o.p)("apiConfig.demoMode"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"analyticsEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.comments"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"commentsEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.commentsSubmit"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"commentsSubmitEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.privateNotes"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"privateNotesEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.privateNotesSubmit"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"privateNotesSubmitEnabled",null),d([Object(o.p)("privateNotesEnabled","commentsEnabled"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"hasUGC",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.tabs"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"tabsEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.userPreferences"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"userPreferencesEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.darkTheme"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"darkThemeEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.minibar"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"minibarEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.threadVote"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"threadVoteEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.voteEmotions"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"voteEmotionsEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.commentSentiment"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"commentSentimentEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features","apiConfig.features.popout"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"popoutEnabled",null),d([Object(o.p)("apiConfig","apiConfig.helpUrl"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"helpUrl",null),d([Object(o.p)("mergedUx"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"ux",null),d([Object(o.p)("apiConfig","apiConfig.features.timeline"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"timelineEnabled",null),d([Object(o.p)("apiConfig","apiConfig.features.stats"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"statsEnabled",null),d([Object(o.p)("threadSettings"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"features",null),d([Object(o.p)("threadSettings"),h("design:type",Object),h("design:paramtypes",[])],t.prototype,"limits",null),d([Object(o.p)("features"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"anonymousCommentsEnabled",null),d([Object(o.p)("features"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"ugcExportEnabled",null),d([Object(o.p)("features"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"userSpaceEnabled",null),d([Object(o.p)("features"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"peopleEnabled",null),d([Object(o.p)("features"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"videoAnalyticsEnabled",null),d([Object(o.p)("features"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"videoCommentsEnabled",null),d([Object(o.p)("threadSettings","threadSettings.notifications","threadSettings.notifications.followersEmailsDisable"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"notificationsEnabled",null),d([Object(o.p)("apiConfig.backend"),h("design:type",String),h("design:paramtypes",[])],t.prototype,"apiUrl",null),d([Object(o.p)("apiConfig.backend"),h("design:type",String),h("design:paramtypes",[])],t.prototype,"apiV2Url",null),d([Object(o.p)("apiConfig.backend"),h("design:type",String),h("design:paramtypes",[])],t.prototype,"authUrl",null),d([Object(o.p)("apiConfig.backend"),h("design:type",String),h("design:paramtypes",[])],t.prototype,"insightsUrl",null),t}()},52:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(29),i=function(){function t(t,e,n,o){this.set(t,e,n,o)}return t.prototype.set=function(t,e,n,i){this.id=t||Object(o.i)(),this.name=e||"Anonymous",this.photoUrl=n&&""!==n?n:"",this.scopes=i||[]},t.prototype.update=function(t,e){var n=e||t.id;this.id===n?(Object(o.a)(this,"name",t.name),Object(o.a)(this,"photoUrl",t.photo_url),this.scopes=t.scopes||[]):this.set(n,t.name,t.photo_url,t.scopes)},Object.defineProperty(t.prototype,"model",{get:function(){return{id:this.id,name:this.name,photo_url:this.photoUrl,scopes:this.scopes}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isModerator",{get:function(){return this.scopes&&this.scopes.includes("moderator")},enumerable:!1,configurable:!0}),t.fromModel=function(e){return new t(e.id,e.name,e.photo_url,e.scopes)},t}()},54:function(t,e,n){"use strict";var o=n("components/accessability/nn-focusable");n.d(e,"a",(function(){return o.Focusable}));n("components/accessability/nn-interaction")},55:function(t,e,n){"use strict";n.d(e,"a",(function(){return v})),n.d(e,"h",(function(){return w})),n.d(e,"d",(function(){return O})),n.d(e,"b",(function(){return _})),n.d(e,"c",(function(){return x})),n.d(e,"g",(function(){return E})),n.d(e,"i",(function(){return S})),n.d(e,"e",(function(){return j})),n.d(e,"f",(function(){return C}));var o=n("aurelia-framework"),i=n(6),r=n("aurelia-api"),a=n(250),s=n(29),c=n(11),l=n(32),u=n(80),p=n("auth/index"),d=n(34),h=n(60),m=n(50),f=n(157),g=function(){return(g=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},b=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},v=function(){function t(t,e,n,i){this.apiConfig=t,this.authService=e,this.settings=n,this.getHostService=i,this.logger=o.h.getLogger("Annoto-api")}var e;return e=t,t.prototype.init=function(t,e){var n=this,o=this.apiConfig,i=this.settings,r=o.getEndpoint(null);return r?r.client.configure((function(t){t.withBaseUrl(""+i.authUrl)})):(o.registerEndpoint("root",i.authUrl,l.a.endpointOptions),o.setDefaultEndpoint("root"),r=o.getEndpoint(null)),o.registerEndpoint("annoto-api",i.apiUrl+"/",l.a.endpointOptions),this.apiEndpoint=o.getEndpoint("annoto-api"),o.registerEndpoint("annoto-api-v2",i.apiV2Url+"/",l.a.endpointOptions),this.apiV2Endpoint=o.getEndpoint("annoto-api-v2"),o.registerEndpoint("annoto-insights",i.insightsUrl+"/",l.a.endpointOptions),this.insightsEndpoint=o.getEndpoint("annoto-insights"),this.authEndpoint=r,this.authService.setupEndpoints(r,["root","annoto-api","annoto-api-v2","annoto-insights"]),this.hostService=this.getHostService(),this.hostService.init(t,e).then((function(t){if(!t)throw new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized");return n.authService.init()}))},t.prototype.getThreadBySlug=function(t){return t&&t.isValid?this.get(T.getThread(),t.query):e.reject("getThreadBySlug")},t.prototype.getThreadById=function(t,n){return t?this.get(T.getThread(t),n):e.reject("getThreadById")},t.prototype.postThread=function(t){return this.post(T.postThread(),t)},t.prototype.postThreadDetails=function(t,n){return n&&Object(s.l)(t)?this.post(T.postThreadDetails(t),n):e.reject("postThreadDetails")},t.prototype.patchThreadDetails=function(t,n,o){return n&&o&&Object(s.l)(t)?this.patch(T.patchThreadDetails(t),o,n):e.reject("patchThreadDetails")},t.prototype.upsertGroup=function(t,n){return t?this.post(T.upsertGroup(n),t):e.reject("postThreadGroup")},t.prototype.getComments=function(t){return t&&t.isValid?this.get(T.getComments(t.threadId),t.query):e.reject("getComments")},t.prototype.postComment=function(t,n){return n&&Object(s.l)(t)?this.post(T.postComment(t),n,this.apiV2Endpoint):e.reject("postComment")},t.prototype.postReply=function(t,n,o){return n&&Object(s.l)(t)&&o&&o.isValid?this.post(T.postReply(t,o),n,this.apiV2Endpoint):e.reject("postReply")},t.prototype.patchComment=function(t,n,o){return o&&Object(s.l)(t)?this.patch(T.postComment(t),n,o,this.apiV2Endpoint):e.reject("patchComment")},t.prototype.deleteComment=function(t,n){return Object(s.l)(t)?this.destroy(T.postComment(t),n,this.apiV2Endpoint):e.reject("deleteComment")},t.prototype.getComment=function(t){return t&&t.isValid?this.get(T.getComment(t.threadId,t.id),t.query):e.reject("getComment")},t.prototype.postAsset=function(t,e,n){var o=new FormData;return o.append("type",e.type),o.append("asset",n),this.postMultipartForm("assets/groups/"+t.groupId+"/threads/"+t.threadId,o,this.apiV2Endpoint)},t.prototype.postAssetStart=function(t,e){return this.post("assets/groups/"+t.groupId+"/threads/"+t.threadId+"/start",e,this.apiV2Endpoint)},t.prototype.postAssetSignPart=function(t,e){return this.post("assets/"+t.id+"/part",e,this.apiV2Endpoint)},t.prototype.postAssetEnd=function(t,e){return this.post("assets/"+t.id+"/end",e,this.apiV2Endpoint)},t.prototype.postAssetAbort=function(t,e){return this.post("assets/"+t.id+"/abort",e,this.apiV2Endpoint)},t.prototype.getCommentMedia=function(t){return this.get("threads/"+t.threadId+"/comments/"+t.id+"/media",void 0,this.apiV2Endpoint)},t.prototype.postThreadVote=function(t,n,o){var i=T.postThreadVote(t,n);return o&&Object(s.l)(t)?this.post(i,o):e.reject("postThreadVote")},t.prototype.postCommentVote=function(t,n,o,i){var r=T.postCommentVote(t,n,o);return i&&Object(s.l)(t)&&r?this.post(r,i):e.reject("postCommentVote")},t.prototype.getProgressBarMetrics=function(t){return Object(s.l)(t)?this.get(T.getProgressBarMetrics(t)):e.reject("getProgressBarMetrics")},t.prototype.getThreadEmotions=function(t){return t&&t.isValid?this.get(T.getThreadEmotions(t.threadId),t.query):e.reject("getThreadEmotions")},t.prototype.getCommentEmotions=function(t){return t&&t.isValid?this.get(T.getCommentEmotions(t.threadId,t.commentId),t.query):e.reject("getCommentEmotions")},t.prototype.getCommentsEmotions=function(t){return t&&t.isValid?this.get(T.getCommentsEmotions(t.threadId),t.query):e.reject("getCommentsEmotions")},t.prototype.patchCommentState=function(t){return t&&t.isValid?this.post(T.patchCommentState(t.threadId,t.id),t.state):e.reject("patchCommentState")},t.prototype.getEmotionsSettings=function(){return this.get(T.getEmotionsSettings(),void 0,this.apiV2Endpoint)},t.prototype.getThreadSettings=function(){return this.get(T.getThreadSettings(),void 0,this.apiV2Endpoint)},t.prototype.postNote=function(t,n){return n&&Object(s.l)(t)?this.post(T.postNote(t),n):e.reject("postNote")},t.prototype.patchNote=function(t,n,o){return o&&Object(s.l)(t)?this.patch(T.postNote(t),n,o):e.reject("patchNote")},t.prototype.deleteNote=function(t,n){return Object(s.l)(t)?this.destroy(T.postNote(t),n):e.reject("deleteComment")},t.prototype.getNotes=function(t){return t&&t.isValid?this.get(T.getNotes(t.threadId),t.query):e.reject("getNotes")},t.prototype.getNotesMeta=function(t){return Object(s.l)(t)?this.get(T.getNotesMeta(t)):e.reject("getNotesMeta")},t.prototype.getUserHints=function(){return this.get(T.getUserHints(),{filter_cleared:1},this.apiV2Endpoint)},t.prototype.clearUserHint=function(t){return Object(s.k)(t)?this.post(T.clearUserHint(t),void 0,this.apiV2Endpoint):e.reject("clearUserHint")},t.prototype.exportThreadNotes=function(t,e,n){return void 0===e&&(e="docx"),this.downloadFile("export/notes/threads/"+t+"?"+Object(i.buildQueryString)({format:e,group_id:n}),e,this.apiV2Endpoint)},t.prototype.exportGroupNotes=function(t,e){return void 0===e&&(e="docx"),this.downloadFile("export/notes/groups/"+t+"?"+Object(i.buildQueryString)({format:e}),e,this.apiV2Endpoint)},t.prototype.postEvent=function(t){return t&&t.type&&Object(s.l)(t.thread_id)?this._post("events/stats",t,void 0,this.insightsEndpoint):e.reject("postEvent")},t.prototype.postVideoBenchmark=function(t){return this._post("events/video_benchmark",t,void 0,this.insightsEndpoint)},t.prototype.dapStartQuery=function(t){return this.get("daps/start",t,this.insightsEndpoint)},t.prototype.postDapEvent=function(t,e){return this._post("daps/"+t+"/events",e,void 0,this.insightsEndpoint)},t.prototype.getUserFeed=function(t){return this.get("me/feed",t,this.insightsEndpoint)},t.prototype.getUserProfile=function(t){return this.get("me/profile",t,this.insightsEndpoint)},t.prototype.getUserById=function(t){return this.get("/users/"+t,void 0,this.authEndpoint)},t.prototype.patchUserDetails=function(t){return this.patch("/me/details",void 0,t,this.authEndpoint)},t.prototype.updatePresence=function(t,e){return this._post("me/presence/update/groups/"+t.groupId+"/threads/"+t.threadId,e,void 0,this.insightsEndpoint)},t.prototype.getGroupPeople=function(t,e){return this.get("presence/groups/"+t.groupId,e,this.insightsEndpoint)},t.prototype.getThreadPeople=function(t,e){return this.get("presence/groups/"+t.groupId+"/threads/"+t.threadId,e,this.insightsEndpoint)},t.prototype.postLiveSessionInvite=function(t,e){return this.post("threads/"+t.threadId+"/live_session_invite/"+t.invitedUserId,e)},t.prototype.get=function(t,e,n,o){var i=this;return void 0===n&&(n=this.apiEndpoint),this._get(t,e,n,o).catch((function(t){return i._logoutOnUnauthorizedAndReject(t)}))},t.prototype._get=function(t,e,n,o){if(n){var i=e||{};return this.hostService.isAuthenticated()?n.find(t,i,o):this.hostService.authenticate().then((function(e){return e?n.find(t,i,o):Promise.reject(new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized"))}))}return Promise.reject(new ReferenceError("API endpoint to set"))},t.prototype.post=function(t,e,n,o){var i=this;return void 0===n&&(n=this.apiEndpoint),this._post(t,e,o,n).catch((function(t){return i._logoutOnUnauthorizedAndReject(t)}))},t.prototype._post=function(t,e,n,o){return void 0===o&&(o=this.apiEndpoint),o?this.hostService.isAuthenticated()?o.post(t,e,n):this.hostService.authenticate().then((function(i){return i?o.post(t,e,n):Promise.reject(new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized"))})):Promise.reject(new ReferenceError("API endpoint to set"))},t.prototype.patch=function(t,e,n,o,i){var r=this;return void 0===o&&(o=this.apiEndpoint),this._patch(t,e,n,o,i).catch((function(t){return r._logoutOnUnauthorizedAndReject(t)}))},t.prototype._patch=function(t,e,n,o,i){return o?this.hostService.isAuthenticated()?o.patch(t,e,n,i):this.hostService.authenticate().then((function(r){return r?o.patch(t,e,n,i):Promise.reject(new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized"))})):Promise.reject(new ReferenceError("API endpoint to set"))},t.prototype.destroy=function(t,e,n,o){var i=this;return void 0===n&&(n=this.apiEndpoint),this._destroy(t,e,n,o).catch((function(t){return i._logoutOnUnauthorizedAndReject(t)}))},t.prototype._destroy=function(t,e,n,o){return this.apiEndpoint?this.hostService.isAuthenticated()?n.destroy(t,e,o):this.hostService.authenticate().then((function(i){return i?n.destroy(t,e,o):Promise.reject(new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized"))})):Promise.reject(new ReferenceError("API endpoint to set"))},t.prototype._logoutOnUnauthorizedAndReject=function(t){return t&&t.status===a.e?this.authService.logout().then((function(){throw t})):Promise.reject(t)},t.prototype.downloadFile=function(t,e,n){void 0===e&&(e="txt"),void 0===n&&(n=this.apiEndpoint);var o="default."+e;return n.client.fetch(t,g(g({},l.a.endpointOptions),{method:"GET"})).then((function(t){if(t.status>=200&&t.status<400){var e=t.headers.get("content-disposition")||t.headers.get("Content-Disposition");if(e){var n=e.match(/.*filename=\"?([^;\"]+)\"?.*/);n[1]&&(o=(o=n[1]).replace(/[<>:"\/\\|?*]+/g,"_"))}return t.blob()}throw t})).then((function(t){if(t.lastModifiedDate=new Date,t.name=o,window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,o);else{var e=URL.createObjectURL(t),n=document.createElement("a");n.download=o,n.href=e,document.body.appendChild(n),n.onclick=function(t){t.stopPropagation()},n.click(),setTimeout((function(){document.body.removeChild(n),URL.revokeObjectURL(e)}),50)}}))},t.prototype.postMultipartForm=function(t,e,n,o){return void 0===o&&(o="fetch"),"xhr"===o?this.xhr("POST",t,e,n):n.client.fetch(t,g(g({},l.a.endpointOptions),{method:"POST",headers:{},body:e})).then((function(t){if(t.status>=200&&t.status<400)return t.json();throw t}))},t.prototype.xhr=function(t,e,n,o){var i=this;return void 0===o&&(o=this.apiV2Endpoint),new Promise((function(r,a){var s=new XMLHttpRequest,c=!1;s.withCredentials=!0,s.open(t,""+o.client.baseUrl+e,!0),s.setRequestHeader(f.a.authHeader,f.a.authTokenType+" "+i.hostService.token),s.setRequestHeader("authorization","Bearer "+i.authService.getToken()),s.onload=function(){if(!c){if(s.status<400)try{r(JSON.parse(s.responseText))}catch(t){a(t)}else a(new Error("upload error"));c=!0}},s.onerror=function(){c||(a(new Error("XMLHttpRequest network error")),c=!0)},s.send(n)}))},t.reject=function(t){return Promise.reject(new TypeError("invalid "+t+" params"))},t=e=b([Object(o.t)(r.Config,p.AnnotoAuthService,m.a,o.f.of(u.a)),y("design:paramtypes",[r.Config,p.AnnotoAuthService,m.a,Function])],t)}(),w=function(){function t(t){this.slug=t}return t.prototype.includeMeta=function(t){var e=t?1:0;this.slug.include_metadata=e},t.prototype.setGroup=function(t,e){this.slug.group=t,this.slug.group_private=e?1:0},Object.defineProperty(t.prototype,"isValid",{get:function(){return!!this.slug},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this.slug},enumerable:!1,configurable:!0}),t}(),O=function(){function t(t,e){this._valid=!1,this._q={},t&&Object(s.l)(t)&&(this._id=t,e&&(this._q=e),this._valid=!0)}return t.prototype.parent=function(t){this._q.parent_id=t},t.prototype.page=function(t,e){this._q.page=t,this._q.size=e},t.prototype.psRange=function(t,e){this._q.pslow=t,this._q.pshigh=e},t.prototype.filterEmotion=function(t){this._q.filter_emotion=t},t.prototype.sort=function(e,n){-1!==t.validSortProp.indexOf(e)&&-1!==t.validSortOrder.indexOf(n)?(this._q.sort_by=e,this._q.sort_order=n):this._valid=!1},Object.defineProperty(t.prototype,"isValid",{get:function(){return this._valid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this._q},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.validSortProp=["updated_at","rating","ps"],t.validSortOrder=["asc","desc"],t}(),_=function(){function t(t,e,n){this._valid=!1,this._q={},t&&e&&Object(s.l)(t)&&(this._threadId=t,this._id=e,n&&(this._q=n),this._valid=!0)}return t.prototype.onlyMeta=function(){this._q.metadata_only=1},Object.defineProperty(t.prototype,"isValid",{get:function(){return this._valid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this._q},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this._threadId},enumerable:!1,configurable:!0}),t}(),x=function(){function t(t,e,n){this._valid=!1,this._q={},t&&e&&Object(s.l)(t)&&(n===h.a.state.visible||n===h.a.state.deleted)&&(this._threadId=t,this._id=e,this._state=n,this._valid=!0)}return Object.defineProperty(t.prototype,"isValid",{get:function(){return this._valid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return{state:this._state}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this._threadId},enumerable:!1,configurable:!0}),t}(),E=function(){function t(t,e){t&&(this._q={parent_id:t,parent_path:e})}return Object.defineProperty(t.prototype,"isValid",{get:function(){return!!this._q},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this._q},enumerable:!1,configurable:!0}),t.prototype.stringify=function(){return"parent_id="+this._q.parent_id+(this._q.parent_path?"&parent_path="+this._q.parent_path:"")},t}(),S=function(){function t(t,e){this._valid=!1,this._q={},t&&Object(s.l)(t)&&(this._threadId=t,e&&(this._q=e),this._valid=!0)}return t.prototype.onlyMeta=function(){this._q.metadata_only=1},t.prototype.forAuthor=function(t){t&&Object(s.l)(t)&&(this._q.author_id=t)},Object.defineProperty(t.prototype,"isValid",{get:function(){return this._valid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this._q},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this._threadId},enumerable:!1,configurable:!0}),t}(),j=(function(){function t(t,e,n){this._valid=!1,this._q={},t&&Object(s.l)(t)&&e&&(this._threadId=t,this._commentId=e,n&&(this._q=n),this._valid=!0)}t.prototype.onlyMeta=function(){this._q.metadata_only=1},t.prototype.forAuthor=function(t){t&&Object(s.l)(t)&&(this._q.author_id=t)},Object.defineProperty(t.prototype,"isValid",{get:function(){return this._valid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this._q},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this._threadId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentId",{get:function(){return this._commentId},enumerable:!1,configurable:!0})}(),function(){function t(t,e){this._valid=!1,this._q={},t&&Object(s.l)(t)&&(this._threadId=t,e&&(this._q=e),this._valid=!0)}return t.prototype.onlyMeta=function(){this._q.metadata_only=1},Object.defineProperty(t.prototype,"isValid",{get:function(){return this._valid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this._q},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this._threadId},enumerable:!1,configurable:!0}),t}()),C=function(){function t(t,e){this._valid=!1,this._q={},t&&Object(s.l)(t)&&(this._id=t,e&&(this._q=e),this._valid=!0)}return t.prototype.page=function(t,e){this._q.page=t,this._q.size=e},t.prototype.psRange=function(t,e){this._q.pslow=t,this._q.pshigh=e},t.prototype.filterEmotion=function(t){this._q.filter_emotion=t},t.prototype.sort=function(e,n){-1!==t.validSortProp.indexOf(e)&&-1!==t.validSortOrder.indexOf(n)?(this._q.sort_by=e,this._q.sort_order=n):this._valid=!1},Object.defineProperty(t.prototype,"isValid",{get:function(){return this._valid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"query",{get:function(){return this._q},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadId",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.validSortProp=["updated_at","emotion","ps"],t.validSortOrder=["asc","desc"],t}(),T=function(){function t(){}return t.getThread=function(t){return this._threads+(t?"/"+t:"")},t.postThread=function(){return""+this._threads},t.postThreadDetails=function(t){return this._threads+"/"+t+"/"+this._threadDetails},t.patchThreadDetails=function(t){return this._threads+"/"+t+"/"+this._threadDetails},t.upsertGroup=function(t){return this._groups+(t?"?"+Object(i.buildQueryString)(t):"")},t.getComments=function(t){return this._threads+"/"+t+"/"+this._comments},t.postComment=function(t){return this._threads+"/"+t+"/"+this._comments},t.patchCommentState=function(t,e){return this._threads+"/"+t+"/"+this._comments+"/"+e+"/state"},t.postReply=function(t,e){return this._threads+"/"+t+"/"+this._comments+"?"+e.stringify()},t.getComment=function(t,e){return this._threads+"/"+t+"/"+this._comments+"/"+e},t.postThreadVote=function(t,e){if(e===c.c.EMOTION)return this._threads+"/"+t+"/"+this._emotions},t.getThreadEmotions=function(t){return this._threads+"/"+t+"/"+this._emotions},t.postCommentVote=function(t,e,n){if(n===c.c.EMOTION)return this._threads+"/"+t+"/"+this._comments+"/"+e+"/"+this._emotions},t.getCommentEmotions=function(t,e){return this._threads+"/"+t+"/"+this._comments+"/"+e+"/"+this._emotions},t.getCommentsEmotions=function(t){return this._threads+"/"+t+"/"+this._comments+"/"+this._emotions},t.getProgressBarMetrics=function(t){return this._threads+"/"+t+"/"+this._pbMetrics},t.getEmotionsSettings=function(){return this._settings+"/"+this._emotions},t.getThreadSettings=function(){return this._settings+"/"+this._threads},t.getNotes=function(t){return this._threads+"/"+t+"/"+this._notes},t.postNote=function(t){return this._threads+"/"+t+"/"+this._notes},t.getNotesMeta=function(t){return this._threads+"/"+t+"/"+this._notes+"/"+this._notesMeta},t.getUserHints=function(){return""+this._userHints},t.clearUserHint=function(t){return this._userHints+"/"+t+"/clear"},t._threads="threads",t._threadDetails="metadata",t._comments="comments",t._emotions="emotions",t._pbMetrics="metrics",t._settings="settings",t._notes="notes",t._notesMeta="metrics",t._userHints="hints",t._groups="groups",t}()},59:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n("aurelia-framework"),i=function(){function t(){}return Object.defineProperty(t,"href",{get:function(){return o.j.global.location.href},enumerable:!1,configurable:!0}),Object.defineProperty(t,"host",{get:function(){return o.j.global.location.host},enumerable:!1,configurable:!0}),Object.defineProperty(t,"origin",{get:function(){return this.originProvider&&"function"==typeof this.originProvider.getPageUrl&&this.originProvider.getPageUrl()||this.href},enumerable:!1,configurable:!0}),t.mediaDeepLink=function(t,e){if(this.originProvider&&"function"==typeof this.originProvider.getMediaDeepLinkUrl)return this.originProvider.getMediaDeepLinkUrl(t,e)},t.setOriginPoriver=function(t){this.originProvider=t},t}()},60:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var o=n("aurelia-framework"),i=n(29),r=n(74),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(){this.depth=0,this.repliesCount=0,this.discussionCount=0,this.emotionsCount=0,this.rating=1,this.createdAt=new Date,this.updatedAt=new Date,this.state=0,this.replies=[],this.votes=[],this.userVoted=!1,this.badges=[]}return Object.defineProperty(t.prototype,"hasPS",{get:function(){return Object(i.k)(this.ps)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return 0===this.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 1===this.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDeleted",{get:function(){return 2===this.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSpam",{get:function(){return 3===this.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasModLikeBadge",{get:function(){return Boolean(this.isVisible&&this.author&&!this.author.isModerator&&this.badges&&this.badges.find((function(t){return t.type===r.CommentBadgeType.MODERATOR_LIKE})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){var t;return(null===(t=this.body)||void 0===t?void 0:t.length)||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){var t,e;return(null===(e=null===(t=this.data)||void 0===t?void 0:t.media)||void 0===e?void 0:e.type)||"text"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return{id:this.id,author_id:this.author.id,depth:this.depth,path:this.path?this.path:void 0,replies_count:this.repliesCount,discussion_count:this.discussionCount,rating:this.rating,emotions_count:this.emotionsCount,state:this.state,ps:this.ps,emotion:this.emotion?this.emotion.type:void 0,body:this.body,body_len:this.length,topic:this.topic?this.topic:void 0,topic_len:"string"==typeof this.topic?this.topic.length:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"state",{get:function(){return{visible:0,pending:1,deleted:2,spam:3}},enumerable:!1,configurable:!0}),t.compare=function(t,e){return Boolean(t.id===e.id&&t.rating===e.rating&&t.length===e.length&&t.emotion.type===e.emotion.type&&t.state===e.state)},a([Object(o.p)("ps"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"hasPS",null),a([Object(o.p)("state"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"isVisible",null),a([Object(o.p)("state"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"isPending",null),a([Object(o.p)("state"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"isDeleted",null),a([Object(o.p)("state"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"isSpam",null),a([Object(o.p)("isVisible","badges","author"),s("design:type",Boolean),s("design:paramtypes",[])],t.prototype,"hasModLikeBadge",null),a([Object(o.p)("body"),s("design:type",Number),s("design:paramtypes",[])],t.prototype,"length",null),a([Object(o.p)("data"),s("design:type",String),s("design:paramtypes",[])],t.prototype,"type",null),t}()},61:function(t,e,n){"use strict";n.d(e,"b",(function(){return d})),n.d(e,"a",(function(){return h}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(34),a=n(152),s=n(55),c=n(31),l=n(40),u=n(29),p=n(68),d={INITIALIZED:1,RESET:2,VISIBLE_NOTES_CHANGE:3,METADATA_CHANGE:4,VISIBLE_METRICS_CHANGE:5,CLEAR:6,SORT_CONFIG_START:7,SORT_CONFIG_CHANGE:9,NOTE_POSTED:10,AUTH_HANDLED:11,NOTE_DELETED:12},h=function(){function t(t){var e,n=this;this.data={notes:[]},this.demoData={notes:[]},this.loadNotesQueryParams={},this.disposables=[],this.sortingOptions=[],this.store=t,this.pubSub=new i.EventAggregator,this.logger=o.h.getLogger("Annoto-notes-controller"),this._reset(),this.sortConfigs=((e={})[p.d.MOST_RECENT]={property:"updatedAt",order:"desc",comparison:"date",enabled:!1,value:"updated_at"},e[p.d.BY_TIMELINE]={property:"ps",order:"asc",comparison:"number",enabled:!1,value:"ps"},e),this.sortConfig=this.sortConfigs[p.d.BY_TIMELINE],this.sortConfig.enabled=t.demoMode,Object(u.o)((function(){return n._addDisposables()}))()}return t.prototype._addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.eventAggregator.subscribe(c.a.USER_LOGOUT,(function(){return t._userLogoutHandle()}))),n.push(e.eventAggregator.subscribe(c.a.USER_AUTHENTICATED,(function(){return t._userAuthHandle()}))),n.push(e.pubSub.subscribe(c.a.DEMO_ON,(function(){return t.demoToggleHandle()}))),n.push(e.pubSub.subscribe(c.a.DEMO_OFF,(function(){return t.demoToggleHandle()}))),n.push(e.threadController.on(l.a.FLOOR_PP_CHANGE,(function(){return t._ppChangeHandle()}))),n.push(e.threadController.on(l.a.RESET,(function(){return t._threadResetHandle()}))),n.push(e.threadController.on(l.a.THREAD_APPLIED,(function(){return t.threadAppliedHandle()})))},Object.defineProperty(t.prototype,"notes",{get:function(){return this.store.demoIsActive?this.demoData.notes:this.data.notes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"notesMeta",{get:function(){return this.store.demoIsActive?this.demoData.notesMeta:this.data.notesMeta},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();return this.disposables=[],this._reset()},t.prototype.on=function(t,e){var n=this;return t===d.INITIALIZED&&this.initialized&&setTimeout((function(){return e(n.initialized)}),1),this.pubSub.subscribe(t.toString(),e)},t.prototype.forceRtModerate=function(){this._rtModerate(!0)},t.prototype.interactiveModeChangeHandle=function(){var t=this;return Promise.resolve().then((function(){return t._rtModerate(!0)}))},t.prototype.postNote=function(t){var e=this,n=this.store,o=a.a.buildNote(t,n.settings);return n.demoIsActive?(o.authorId=n.user.author.id,o.id=n.demoDataCompiler.nextObjId(),this.demoData.notes.unshift(o),n.demoDataCompiler.updateNotesCounters(),Object(u.c)(100).then((function(){return e._dataChangeHandle(m.NEW_NOTE,o),o}))):this._postNote(o).then((function(){var t=o.info,i=n.interactiveMode?"mini":"thread";return n.analyticsController.recordUgcInteraction("note_submit",{element:i,note:t},{label:i,value:o.length}).catch((function(t){return e.logger.warn(t)})),o})).catch((function(t){return e.errorHandle(r.b.NOTES.SUBMIT,t),null}))},t.prototype.editNote=function(t,e){var n=this,o=this.store;if(o.demoIsActive)return Object(u.c)(50).then((function(){return e.author_id=t.authorId,a.a.mergeNoteObject(t,e,o.settings),t.updatedAt=new Date,o.demoDataCompiler.updateNotesCounters(),n._dataChangeHandle(m.EDIT_NOTE),t}));var i=a.a.buildNote(e,o.settings);return this._editNote(t,i).then((function(){var e=t.info,n=o.interactiveMode?"mini":"thread";return o.analyticsController.recordUgcInteraction("note_edit",{element:n,note:e},{label:n,value:t.length}),t})).catch((function(t){return n.errorHandle(r.b.NOTES.EDIT,t),null}))},t.prototype.deleteNote=function(t){var e=this,n=this.store;return n.demoIsActive?Object(u.c)(50).then((function(){e.removeDeletedNote(t,e.demoData.notes),n.demoDataCompiler.updateNotesCounters(),e._dataChangeHandle(m.DELETE_NOTE,t)})):this._deleteNote(t).then((function(){var e=t.info,o=n.interactiveMode?"mini":"thread";n.analyticsController.recordUgcInteraction("note_delete",{element:o,note:e},{label:o,value:t.length})})).catch((function(t){e.errorHandle(r.b.NOTES.DEL,t)}))},t.prototype.getNotes=function(t){var e=this;return this.store.demoIsActive?(this.logger.debug("Loaded notes"),Object(u.c)(100).then((function(){return e._dataChangeHandle(m.NOTES),Promise.resolve({notes:e.demoData.notes,total:e.demoData.notes.length})}))):this.store.user.authenticated?(t&&(this.loadNotesQueryParams.page=t),this._loadNotes().catch((function(t){return e.errorHandle(r.b.NOTES.GET_PAGE,t),null}))):Object(u.p)().then((function(){return e._dataChangeHandle(m.NOTES),{total:0,notes:[]}}))},t.prototype.getNotesMeta=function(){return this.notesMeta?Promise.resolve():this.loadNotesMeta()},t.prototype.loadNotesMeta=function(){var t=this;return this.store.demoIsActive?(this.logger.debug("Loaded Notes Meta"),this._dataChangeHandle(m.NOTES_META),Promise.resolve()):this.store.user.authenticated?(this.loadMetaPromise||(this.loadMetaPromise=this._loadNotesMeta().then((function(){t.loadMetaPromise=null})).catch((function(e){throw t.loadMetaPromise=null,e}))),this.loadMetaPromise):Promise.resolve().then((function(){if(t.store.isPrivateMode)return t._clear()}))},Object.defineProperty(t.prototype,"info",{get:function(){var t=this.store.metaData;if(this.initialized)return{count:t.notes.count,root_count:t.notes.rootCount,emotions:t.notes.emotions}},enumerable:!1,configurable:!0}),t.prototype.sortSetByUser=function(t){var e=this;if(t!==this.sortOption)return this._notify(d.SORT_CONFIG_START),this.sortOption=t,this.sortConfig.enabled=!1,this.sortConfig=this.sortConfigs[t.type],this.sortConfig.enabled=this.store.demoMode,this.loadNotesQueryParams.sort={property:this.sortConfig.value,order:this.sortConfig.order},this.getNotes().then((function(){return Object(u.c)(0)})).then((function(){return e._notify(d.SORT_CONFIG_CHANGE),Object(u.c)(500)}))},t.prototype.getSortOption=function(t){return Object(p.g)(t,this.sortingOptions)},t.prototype.demoToggleHandle=function(){var t=this,e=this.store;if(e.demoIsActive){var n=e.demoController.data;this.demoData={notes:n?n.notes:[]},e.demoDataCompiler.updateNotesCounters()}Promise.all([this.getNotes(),this.loadNotesMeta()]).then((function(){t._notify(d.SORT_CONFIG_CHANGE)})).catch((function(e){t.logger.warn("demoToggleHandle: ",e)}))},t.prototype._init=function(){var t=this,e=this.store,n=Object(u.t)((function(){if(t.initialized)t.logger.warn("Already initialized");else{if(e.demoMode)return e.demoDataCompiler.updateNotesCounters(),Object(u.c)(200).then((function(){t.initialized=!0,t.initPromise=null,t.logger.info("initialized (demo mode)")}));if(!e.user.authenticated)return Object(u.u)(t.initPromise,Object(u.t)((function(){t.logger.info("initialized (not authenticated)"),t.initialized=!0,t.initPromise=null})));t.initPromise=null,t.initialized=!0,t.logger.info("initialized")}}));return this.initPromise=Object(u.u)(this.initPromise,n),this.initPromise},t.prototype._reset=function(){var t=this,e=Object(u.t)((function(){t._clear(),t.loadNotesQueryParams={},t.logger.debug("reset"),t._notify(d.RESET),t.initialized=!1}));return this.initPromise=Object(u.u)(this.initPromise,e),this.initPromise},t.prototype._clear=function(){var t=this.store,e=t.metaData;this.visibleNotes=[],this.data={notes:[]},this.demoData={notes:[]},this.rtNotes=[],this.visibleMetrics=void 0,t.dataCompiler.clearNotes(),t.dataCompiler.clearNotesMetrics(),e.notes.rootCount=0,e.notes.count=0,e.notes.emotions={},this.logger.debug("clear"),this._notify(d.CLEAR)},t.prototype._notify=function(t,e){this.initialized&&this.pubSub.publish(t.toString(),e)},t.prototype._loadNotes=function(){var t=this,e=this.store,n=this.loadNotesQueryParams,o=new s.f(e.threadId,{group_id:e.groupId});return n.filterEmotion&&o.filterEmotion(n.filterEmotion),n.sort&&o.sort(n.sort.property,n.sort.order),n.page&&o.page(n.page.number,n.page.size),e.apiService.getNotes(o).then((function(n){t.logger.debug("Loaded notes");var o=n.total;return t.data.notes=a.a.parseNotes(n.results,e.settings),t._dataChangeHandle(m.NOTES),{notes:t.data.notes,total:o}}))},t.prototype._loadNotesMeta=function(){var t=this,e=this.store;return e.apiService.getNotesMeta(e.threadId).then((function(e){t.logger.debug("Loaded notesMeta"),t.data.notesMeta=e,t._updateNotesMeta(),t._dataChangeHandle(m.NOTES_META)}))},t.prototype._postNote=function(t){var e=this,n=this.store;return n.apiService.postNote(n.threadId,a.a.getPostNote(t,n)).then((function(o){if(!o||!o.note||!o.meta)throw new r.a("empty postNote response");return e.logger.debug("Posted new note"),a.a.mergeNoteObject(t,o.note,n.settings),e.data.notesMeta=o.meta,e.data.notes.unshift(t),e._updateNotesMeta(),e._dataChangeHandle(m.NEW_NOTE,t),t}))},t.prototype._editNote=function(t,e){var n=this,o=this.store;return o.apiService.patchNote(o.threadId,t.id,a.a.getPatchNote(e)).then((function(e){if(!e||!e.note||!e.meta)throw new r.a("empty edit response");return n.logger.debug("Edited note"),a.a.mergeNoteObject(t,e.note,o.settings),n.data.notesMeta=e.meta,n._updateNotesMeta(),n._dataChangeHandle(m.EDIT_NOTE),t}))},t.prototype._deleteNote=function(t){var e=this,n=this.store;return n.apiService.deleteNote(n.threadId,t.id).then((function(n){if(!n||!n.meta)throw new r.a("empty deleteNote response");e.logger.debug("Deleted note"),e.data.notesMeta=n.meta,e.removeDeletedNote(t,e.data.notes),e._updateNotesMeta(),e._dataChangeHandle(m.DELETE_NOTE,t)}))},t.prototype._dataChangeHandle=function(t,e){var n=this.store.dataCompiler;switch(t){case m.NEW_NOTE:n.compileNotes(),n.compileNotesMetrics(),this._notify(d.METADATA_CHANGE,this.notesMeta),this._rtModerate(!0),this._notify(d.NOTE_POSTED,e);break;case m.EDIT_NOTE:n.compileNotesMetrics(),this._notify(d.METADATA_CHANGE,this.notesMeta);break;case m.DELETE_NOTE:n.compileNotes(),n.compileNotesMetrics(),this._notify(d.METADATA_CHANGE,this.notesMeta),this._rtModerate(!0),this._notify(d.NOTE_DELETED,e);break;case m.NOTES:n.compileNotes(),this._rtModerate(!0);break;case m.VISIBLE_NOTES:this._notify(d.VISIBLE_NOTES_CHANGE,this.visibleNotes);break;case m.VISIBLE_META:this._notify(d.VISIBLE_METRICS_CHANGE,this.visibleMetrics);break;case m.NOTES_META:n.compileNotesMetrics(),this._notify(d.METADATA_CHANGE,this.notesMeta),this._rtModerate(!0);break;default:this.logger.warn("Unknown data change: ",t)}},t.prototype.errorHandle=function(t,e){this.store.errorHandler.alert(t,e,this.logger)},t.prototype._updateNotesMeta=function(){var t=this.store.metaData,e=(this.data.notesMeta||{}).counters||{};Object(u.a)(t.notes,"rootCount",e.count),Object(u.a)(t.notes,"count",e.count),Object(u.a)(t.notes,"emotions",e.emotions),this.logger.debug("updated notes meta")},t.prototype.removeDeletedNote=function(t,e){for(var n=!1,o=e.length;o--;){if(e[o].id===t.id){n=!0;break}}return n&&e.splice(o,1),n},t.prototype._threadResetHandle=function(){this._reset()},t.prototype.threadAppliedHandle=function(){var t=this;return this.sortOptionsInit(),this._init().then((function(){t._notify(d.INITIALIZED)})).catch((function(e){return t.logger.warn("Init on thread apply err: ",e),t._reset()}))},t.prototype.sortOptionsInit=function(){var t=this.store;t.isLive?this.sortingOptions=p.a:"text"===t.mediaType?this.sortingOptions=p.e:this.sortingOptions=p.b,this.sortOption=this.getSortOption(t.api.thread.sort)||this.getSortOption(p.d.BY_TIMELINE)||this.sortingOptions[0],this.sortConfigs[p.d.MOST_RECENT].flipOrder=!1,this.sortConfigs[p.d.BY_TIMELINE].flipOrder=!1,this.sortConfig.enabled=!1,this.sortConfig=this.sortConfigs[this.sortOption.type],this.sortConfig.enabled=t.demoMode,this.loadNotesQueryParams.sort={property:this.sortConfig.value,order:this.sortConfig.order}},t.prototype._userAuthHandle=function(){var t=this,e=this.store;if(!e.demoMode&&this.initialized&&e.isPrivateMode)return Promise.all([this._loadNotes(),this._loadNotesMeta()]).then((function(){var n=e.user;t.logger.debug("loaded notes for "+n.name+" ("+n.id+")"),t._notify(d.AUTH_HANDLED)})).catch((function(e){t.logger.error("auth handle: ",r.a.fromObject(e))}))},t.prototype._userLogoutHandle=function(){this._clear()},t.prototype._ppChangeHandle=function(){this._rtModerate()},t.prototype._rtModerate=function(t){void 0===t&&(t=!1);var e=this.store,n=e.player,o=e.dataCompiler;if(this.initialized){var i=o.psLow(n.pp);if(t||i!==this.normPP){this.normPP=i;var r=o.findFirstInSeries(o.data.notesSeries,n.pp);this.rtNotes=r?r.items:[];var a=e.interactiveMode?this.rtNotes:this.notes;(a!==this.visibleNotes||t)&&(this.visibleNotes=a,this._dataChangeHandle(m.VISIBLE_NOTES));var s=o.data.notesMetricsSeries.get(i);(s!==this.visibleMetrics||t)&&(this.visibleMetrics=s,this._dataChangeHandle(m.VISIBLE_META)),e.isPrivateMode&&e.interactiveController.rtModerate(this.rtNotes)}}},t}(),m={INIT:500,NOTES:501,NOTES_META:502,VISIBLE_NOTES:503,VISIBLE_META:504,NEW_NOTE:505,EDIT_NOTE:506,DELETE_NOTE:507}},62:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var o,i=n(5),r=n(0),a=n(1),s=n(3),c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e){this.container=t,this.compositionEngine=e}return t.prototype.createCompositionContext=function(t,e,n){return{host:e,container:n.container||this.container,bindingContext:!n.viewModel&&n.bindingContext?n.bindingContext:null,viewResources:null,model:n.model,view:n.view,viewModel:n.viewModel,viewSlot:new s.o(e,!0)}},t.prototype.ensureViewModel=function(t){if("function"==typeof t.viewModel){var e=a.Origin.get(t.viewModel).moduleId;if(!e)return Promise.reject(new Error('Can not resolve "moduleId" of "'+t.viewModel.name+'".'));t.viewModel=e}return"string"==typeof t.viewModel?this.compositionEngine.ensureViewModel(t):Promise.resolve(t)},t.prototype.composeAndShow=function(t){return this.compositionEngine.compose(t).then((function(t){return t.attached(),t}))},t.prototype.compose=function(t){var e=this;o||(o=r.DOM.querySelectorAll("body")[0]);var n=t.host||o,i=r.DOM.createElement(t.tagName);t.firstChildOfHost?n.insertBefore(i,n.firstChild):n.appendChild(i);var a=this.createCompositionContext(n,i,t);return this.ensureViewModel(a).then((function(){return e.composeAndShow(a)})).then((function(t){return{controller:t,host:n,element:i}}))},t.prototype.decompose=function(t){try{t.host.removeChild(t.element)}catch(t){}t.controller.detached(),t.controller.unbind()},t=c([Object(i.inject)(i.Container,s.e),l("design:paramtypes",[i.Container,s.e])],t)}()},64:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var o=n(98),i=n(99);var r=function(){function t(t,e,n,o){this.resolve=n,this.reject=o,this.settings=e,this.renderer=t}return t.prototype.releaseResources=function(t){var e=this;return Object(i.a)(this.controller.viewModel||{},"deactivate",t).then((function(){return e.renderer.hideDialog(e)})).then((function(){return e.controller.unbind()}))},t.prototype.ok=function(t){return this.close(!0,t)},t.prototype.cancel=function(t){return this.close(!1,t)},t.prototype.error=function(t){var e=this,n=function(t){var e=new Error;return e.wasCancelled=!1,e.output=t,e}(t);return this.releaseResources(n).then((function(){e.reject(n)}))},t.prototype.close=function(t,e){var n=this;if(this.closePromise)return this.closePromise;var o={wasCancelled:!t,output:e};return this.closePromise=Object(i.a)(this.controller.viewModel||{},"canDeactivate",o).catch((function(t){return n.closePromise=void 0,Promise.reject(t)})).then((function(t){return t?n.releaseResources(o).then((function(){return n.resolve(o),{wasCancelled:!1}})).catch((function(t){return n.closePromise=void 0,Promise.reject(t)})):(n.closePromise=void 0,{wasCancelled:!0})}))},t.inject=[o.a],t}()},65:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(52),i=function(){function t(t,e,n,i){this.createdAt=new Date,this._author=o.a.fromModel(t),this.type=e,this.value=n,this.ps=i}return Object.defineProperty(t.prototype,"author",{get:function(){return this._author instanceof o.a||(this._author=new o.a),this._author},set:function(t){this._author=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return{id:this.id,author_id:this._author.id,type:this.type,value:this.value,comment_id:this.commentId,ps:this.ps}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPS",{get:function(){return Boolean(this.ps&&!1===Number.isNaN(this.ps)||0===this.ps)},enumerable:!1,configurable:!0}),t}()},66:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var o=n(29),i=n("aurelia-event-aggregator"),r=n("aurelia-framework"),a=n(32),s=n(31),c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t){this.eventAggregator=t,this.registeredDetector=null,this.defaultDetector=null,this.defaultDetector=new p,this.refreshScreenParams(),r.j.global.addEventListener("resize",this.windowResizeHandler.bind(this))}return t.prototype.registerDetector=function(t){this.registeredDetector=t,this.refreshScreenParams()},Object.defineProperty(t.prototype,"detector",{get:function(){return this.registeredDetector||this.defaultDetector},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rootElement",{get:function(){return document.documentElement||document.body.parentElement||document.body},enumerable:!1,configurable:!0}),t.prototype.canDetect=function(){return!!this.detector},t.prototype.isSmallScreen=function(){return this.detector.isSmallScreen()},t.prototype.isPhone=function(){return this.detector.isPhone()},t.prototype.isTablet=function(){return this.detector.isTablet()},t.prototype.isDesktop=function(){return this.detector.isDesktop()},t.prototype.isLandscape=function(){return Object(o.q)(this.detector,"isLandscape")?this.detector.isLandscape():this.defaultDetector.isLandscape()},Object.defineProperty(t.prototype,"touchScreen",{get:function(){return this.phone||this.tablet},enumerable:!1,configurable:!0}),t.prototype.windowResizeHandler=function(t){if(t.target===window){this.refreshScreenParams(),this.phone?this.wasPhone=!0:this.wasPhone&&(this.wasPhone=!1);var e={publisher:this,data:{windowHeight:this.windowHeight,windowWidth:this.windowWidth,isSmallScreen:this.isSmallScreen,isPhone:this.isPhone,isTablet:this.isTablet}};this.eventAggregator.publish(s.a.SCREEN_PARAMS_CHANGE,e)}},t.prototype.refreshScreenParams=function(){Object(o.q)(this.detector,"detect")&&this.detector.detect(),this.windowHeight=window.innerHeight,this.windowWidth=window.innerWidth,this.smallScreen=this.isSmallScreen(),this.phone=this.isPhone(),this.tablet=this.isTablet(),this.landscape=this.isLandscape()},c([Object(r.p)("phone","tablet"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"touchScreen",null),t=c([Object(r.t)(i.EventAggregator),l("design:paramtypes",[i.EventAggregator])],t)}(),p=function(){function t(){this._isPhone=!1,this._isTablet=!1}return t.prototype.detect=function(){window.innerWidth<=1024?this.isSmall=!0:this.isSmall=!1;var t=AnnotoComponents.config.platform;t.detect(),this._isPhone=t.is("mobile")&&window.outerWidth<=1024||t.is("android")||t.is("iphone"),this._isTablet=t.is("tablet")||t.is("ipad")||t.is("phablet")},t.prototype.isSmallScreen=function(){return this.isSmall},t.prototype.isPhone=function(){return!!this.isSmallScreen()&&this._isPhone},t.prototype.isLandscape=function(){return window.innerHeight/window.innerWidth<a.a.widget.landscapeRatio},t.prototype.isTablet=function(){return!!this.isSmallScreen()&&this._isTablet},t.prototype.isDesktop=function(){return!this.isSmallScreen()},t}()},67:function(t,e,n){"use strict";n.d(e,"b",(function(){return d})),n.d(e,"a",(function(){return h}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(34),a=n(40),s=n(61),c=n(31),l=n(29),u=n(32),p=n(90),d={INITIALIZED:1,RESET:2,METADATA_CHANGE:3,VISIBLE_METADATA_CHANGE:4,CHART_DATA_CHANGE:5,CLEAR:6},h=function(){function t(t){var e=this;this.disposables=[],this.store=t,this.pubSub=new i.EventAggregator,this.logger=o.h.getLogger("Annoto-metadata-controller"),this._reset(),Object(l.o)((function(){return e._addDisposables()}))()}return t.prototype._addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.threadController.on(a.a.RESET,(function(){return t._threadResetHandle()}))),n.push(e.threadController.on(a.a.THREAD_APPLIED,Object(l.o)((function(){return t._threadAppliedHandle()})))),n.push(e.threadController.on(a.a.METADATA_CHANGE,(function(){return t._metaDataChangeHandle()}))),e.pbMetricsController&&(n.push(e.pbMetricsController.on(p.b.METRICS_CHANGE,(function(){e.isPrivateMode||t._chartDataChangeHandle()}))),n.push(e.pbMetricsController.on(p.b.VISIBLE_METRICS_CHANGE,(function(){e.isPrivateMode||t._visibleMetaDataChangeHandle()}))),n.push(e.pbMetricsController.on(p.b.CLEAR,(function(){e.isPrivateMode||t._clear()})))),e.notesController&&(n.push(e.notesController.on(s.b.METADATA_CHANGE,(function(){e.isPrivateMode&&t._notesMetaDataChangeHandle()}))),n.push(e.notesController.on(s.b.VISIBLE_METRICS_CHANGE,(function(){e.isPrivateMode&&t._visibleMetaDataChangeHandle()}))),n.push(e.notesController.on(s.b.CLEAR,(function(){e.isPrivateMode&&t._clear()})))),n.push(e.eventAggregator.subscribe(c.a.PRIVATE_MODE_CHANGED,(function(){t.loadMetaData().catch((function(e){t.logger.error("Loading Metadata on private mode change: ",e)}))})))},t.prototype.dispose=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();return this.disposables=[],this._reset()},t.prototype.on=function(t,e){var n=this;return t===d.INITIALIZED&&this.initialized&&setTimeout((function(){return e(n.initialized)}),1),this.pubSub.subscribe(t.toString(),e)},t.prototype.setResolution=function(t,e){void 0===e&&(e=!1);var n=this.store.metaData;(e||t!==this.graphResolution)&&Object(l.k)(t)&&(n.thread.live?this.graphResolution=Math.max(t,1):this.graphResolution=Math.max(Math.min(t,n.thread.pbResolution),1),this._dataChangeHandle(m.CHART_RESOLUTION),this.store.threadController.forceRtModerate())},t.prototype.getChartData=function(){var t=this.store;return t.isPrivateMode?t.notesController.getNotesMeta():t.pbMetricsController.getMetrics()},t.prototype.getMetaData=function(){var t=this.store;return t.isPrivateMode?t.notesController.getNotesMeta():Promise.all([t.pbMetricsController.getMetrics(),t.threadController.getMetaData()])},t.prototype.loadChartData=function(){var t=this.store;return t.isPrivateMode?t.notesController.loadNotesMeta():t.pbMetricsController.loadMetrics()},t.prototype.loadMetaData=function(){var t=this.store;return t.isPrivateMode?t.notesController.loadNotesMeta():Promise.all([t.pbMetricsController.loadMetrics(),t.threadController.loadMetaData()])},Object.defineProperty(t.prototype,"visibleInfo",{get:function(){var t=this.store.metaData;if(this.initialized)return{count:t.visible.count,root_count:t.visible.rootCount,replies:t.visible.count-t.visible.rootCount,emotions:t.visible.emotions}},enumerable:!1,configurable:!0}),t.prototype._init=function(){var t=this,e=this.store,n=Object(l.t)((function(){t.initialized?t.logger.warn("Already initialized"):(t.initialized=!0,t.initPromise=null,e.timelineEnabled||t.setResolution(e.player.pd/u.a.thread.minCommentsInterval),e.demoMode?t.logger.info("initialized (demo mode)"):t.logger.info("initialized"))}));return this.initPromise=Object(l.u)(this.initPromise,n),this.initPromise},t.prototype._reset=function(){var t=this,e=Object(l.t)((function(){t._clear(),t.graphResolution=u.a.thread.defaultChartResolution,t.logger.debug("reset"),t._notify(d.RESET),t.initialized=!1}));return this.initPromise=Object(l.u)(this.initPromise,e),this.initPromise},t.prototype._clear=function(){var t=this.store.metaData;t.total.count=0,t.total.rootCount=0,t.total.emotions={},t.visible.count=0,t.visible.rootCount=0,t.visible.emotions={},this.logger.debug("clear"),this._notify(d.CLEAR)},t.prototype._notify=function(t,e){this.initialized&&(this.pubSub.publish(t.toString(),e),t!==d.METADATA_CHANGE&&t!==d.VISIBLE_METADATA_CHANGE||this.store.eventAggregator.publish(c.a.METADATA_CHANGE,this.store))},t.prototype._dataChangeHandle=function(t){var e=this.store.dataCompiler;switch(t){case m.CHART_RESOLUTION:e.graphResolutionUpdateHandle(),this._chartDataChangeHandle();break;default:this.logger.warn("Unknown data change: ",t)}},t.prototype._errorHandle=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(this.logger.error("error ("+t+")",e),e){if(Error.prototype.isPrototypeOf(e[0]))return r.a.fromObject(e[0]);if(Response.prototype.isPrototypeOf(e[0]))return new r.a(e[0].statusText)}return new r.a},t.prototype._threadResetHandle=function(){this._reset()},t.prototype._threadAppliedHandle=function(){var t=this;return this._init().then((function(){t._metaDataChangeHandle(),t._notify(d.INITIALIZED)})).catch((function(e){t.logger.error(e),t._reset().then((function(){t._errorHandle(m.INIT,e)}))}))},t.prototype._notesMetaDataChangeHandle=function(){this._metaDataChangeHandle(),this._chartDataChangeHandle()},t.prototype._metaDataChangeHandle=function(){var t=this.store,e=t.metaData,n=e.comments;t.isPrivateMode&&(n=e.notes),e.total.count=n.count,e.total.rootCount=n.rootCount,e.total.emotions=n.emotions,e.total.countDiff=n.countDiff||0,e.total.rootCountDiff=n.rootCountDiff||0,this._notify(d.METADATA_CHANGE,e.total)},t.prototype._chartDataChangeHandle=function(){var t=this.store,e=t.dataCompiler.data;this.chartData={series:e.pbMetricsSeries,pd:e.pd,step:e.step},t.isPrivateMode&&(this.chartData.series=e.notesMetricsSeries),this._notify(d.CHART_DATA_CHANGE,this.chartData)},t.prototype._visibleMetaDataChangeHandle=function(){var t=this.store,e=t.metaData,n=t.pbMetricsController.visibleMetrics;t.isPrivateMode&&(n=t.notesController.visibleMetrics);var o=0,i=0,r={};n&&n.forEach((function(t,e){o+=t.rcn,i+=t.cn,r[e]=t})),e.visible.rootCount=o,e.visible.count=i,e.visible.emotions=r,this._notify(d.VISIBLE_METADATA_CHANGE,e.visible)},t}(),m={INIT:400,CHART_RESOLUTION:401}},68:function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return l})),n.d(e,"f",(function(){return u})),n.d(e,"e",(function(){return p})),n.d(e,"g",(function(){return d}));var o={MOST_RECENT:0,TOP_RATED:1,BY_TIMELINE:2},i="thread.sort.recent",r="thread.sort.rating",a="thread.sort.tag",s=[{index:0,type:o.MOST_RECENT,text:i,name:"most_recent"},{index:1,type:o.TOP_RATED,text:r,name:"top_rated"},{index:2,type:o.BY_TIMELINE,text:a,name:"by_timetag"}],c=[{index:0,type:o.MOST_RECENT,text:i,name:"most_recent"}],l=[{index:0,type:o.MOST_RECENT,text:i,name:"most_recent"},{index:2,type:o.BY_TIMELINE,text:a,name:"by_timetag"}],u=[{index:0,type:o.MOST_RECENT,text:i,name:"most_recent"},{index:1,type:o.TOP_RATED,text:r,name:"top_rated"}],p=[{index:0,type:o.MOST_RECENT,text:i,name:"most_recent"}];function d(t,e){for(var n,o=0;o<e.length;o++){if(e[o].type===t){n=e[o];break}if("string"==typeof t&&e[o].name===t){n=e[o];break}}return n}},69:function(t,e,n){"use strict";n.d(e,"b",(function(){return g})),n.d(e,"a",(function(){return b}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(34),a=n(60),s=n(101),c=n(55),l=n(31),u=n(48),p=n(40),d=n(29),h=n(68),m=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},f=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g={INITIALIZED:1,RESET:2,VISIBLE_COMMENTS_CHANGE:3,COMMENT_DELETED:4,COMMENT_POSTED:5,SORT_CONFIG_CHANGE:6,CLEAR:7,SORT_CONFIG_START:8},b=function(){function t(t){var e,n=this;this.data={comments:[]},this.demoData={comments:[]},this.userCommentsVotes=new Map,this.loadCommentsQueryParams={sort:{property:"updated_at",order:"desc"}},this.disposables=[],this.sortingOptions=[],this.submitCommentRatingToBeOnTop=1e6,this.store=t,this.pubSub=new i.EventAggregator,this.logger=o.h.getLogger("Annoto-comments-controller"),this._reset(),this.sortConfigs=((e={})[h.d.MOST_RECENT]={property:"updatedAt",order:"desc",comparison:"date",enabled:!1,value:"updated_at"},e[h.d.TOP_RATED]={property:"rating",order:"desc",comparison:"number",enabled:!1,value:"rating"},e[h.d.BY_TIMELINE]={property:"ps",order:"asc",comparison:"number",enabled:!1,value:"ps"},e),this.sortConfig=this.sortConfigs[h.d.MOST_RECENT],this.sortConfig.enabled=t.demoMode,Object(d.o)((function(){return n._addDisposables()}))()}return t.prototype._addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.eventAggregator.subscribe(l.a.USER_LOGOUT,(function(){return t._userLogoutHandle()}))),n.push(e.eventAggregator.subscribe(l.a.USER_AUTHENTICATED,(function(){return t._userAuthHandle()}))),n.push(e.pubSub.subscribe(l.a.DEMO_ON,(function(){return t.demoToggleHandle()}))),n.push(e.pubSub.subscribe(l.a.DEMO_OFF,(function(){return t.demoToggleHandle()}))),n.push(e.threadController.on(p.a.FLOOR_PP_CHANGE,(function(){return t._ppChangeHandle()}))),n.push(e.threadController.on(p.a.RESET,(function(){return t._threadResetHandle()}))),n.push(e.threadController.on(p.a.THREAD_APPLIED,(function(){return t.threadAppliedHandle()})))},Object.defineProperty(t.prototype,"comments",{get:function(){return this.store.demoIsActive?this.demoData.comments:this.data.comments},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();return this.disposables=[],this._reset()},t.prototype.on=function(t,e){var n=this;return t===g.INITIALIZED&&this.initialized&&setTimeout((function(){return e(n.initialized)}),1),this.pubSub.subscribe(t.toString(),e)},t.prototype.forceRtModerate=function(){this._rtModerate(!0)},t.prototype.interactiveModeChangeHandle=function(){var t=this;return Promise.resolve().then((function(){return t._rtModerate(!0)}))},t.prototype.postComment=function(t){var e=this,n=this.store,o=s.a.buildComment(t,n.settings);return n.demoIsActive?(o.author=n.user.author,o.id=n.demoDataCompiler.nextObjId(),this.demoData.comments.unshift(o),n.demoDataCompiler.updateCommentBranchCounters(o),this._loadMetaData().then((function(){return Object(d.c)(100)})).then((function(){return o.rating=e.submitCommentRatingToBeOnTop,e.submitCommentRatingToBeOnTop++,e._dataChangeHandle(y.NEW_COMMENT,o),o}))):this._postComment(o).then((function(){var t=o.info,e=n.interactiveMode?"mini":"thread";return n.analyticsController.recordUgcInteraction("comment_submit",{element:e,comment:t},{label:o.type,value:o.length}),1===n.metaData.comments.rootCountDiff&&n.threadController.clearMetadataDiffCounters(),o})).catch((function(t){return e.errorHandle(r.b.COMMENTS.SUBMIT,t),null}))},t.prototype.postReply=function(t,e){var n=this,o=this.store,i=s.a.buildComment(e,o.settings);return i.ps=t.ps,o.demoIsActive?(i.author=o.user.author,i.id=o.demoDataCompiler.nextObjId(),i.ancestor=t,i.depth=t.depth+1,t.replies.unshift(i),o.demoDataCompiler.updateCommentCounters(i),o.demoDataCompiler.updateCommentBranchCounters(t),this._dataChangeHandle(y.NEW_REPLY),this._loadMetaData().then((function(){return i}))):this._postReply(t,i).then((function(){var e=i.info,n=o.interactiveMode?"mini":"thread";o.analyticsController.recordUgcInteraction("reply_submit",{element:n,ancestor:t.info,comment:e},{label:i.type,value:i.length});var r=o.metaData.comments;return 0===r.rootCountDiff&&1===r.countDiff&&o.threadController.clearMetadataDiffCounters(),i})).catch((function(t){return n.errorHandle(r.b.COMMENTS.SUBMIT_REPLY,t),null}))},t.prototype.editComment=function(t,e){var n=this,o=this.store;if(o.demoIsActive)return Object(d.c)(50).then((function(){return e.author=t.author.model,s.a.mergeCommentObject(t,e,o.settings),t.updatedAt=new Date,o.demoDataCompiler.updateCommentBranchCounters(t),n._dataChangeHandle(y.EDIT_COMMENT),n._loadMetaData().then((function(){return Object(d.c)(50)})).then((function(){return t}))}));var i=s.a.buildComment(e,o.settings);return this._editComment(t,i).then((function(){var e=t.info,n=o.interactiveMode?"mini":"thread";return o.analyticsController.recordUgcInteraction("comment_edit",{element:n,comment:e},{label:t.type,value:t.length}),t})).catch((function(t){return n.errorHandle(r.b.COMMENTS.EDIT,t),null}))},t.prototype.deleteComment=function(t){var e=this,n=this.store;return n.demoIsActive?(this.removeDeletedComment(t,t.ancestor?t.ancestor.replies:this.demoData.comments),n.demoDataCompiler.updateCommentBranchCounters(t),this._loadMetaData().then((function(){return Object(d.c)(100)})).then((function(){e._dataChangeHandle(y.DELETE_COMMENT,t)}))):this._deleteComment(t).then((function(){var e=t.info,o=n.interactiveMode?"mini":"thread";n.analyticsController.recordUgcInteraction("comment_delete",{element:o,comment:e},{label:t.type,value:t.length})})).catch((function(t){return e.errorHandle(r.b.COMMENTS.DEL,t),null}))},t.prototype.patchCommentState=function(t,e){var n=this,o=this.store;if(!o.demoIsActive)return this._patchCommentState(t,e).then((function(){var n=t.info,i=o.interactiveMode?"mini":"thread";o.analyticsController.recordUgcInteraction("comment_moderate",{element:i,comment:n},{label:t.type,value:e})})).catch((function(t){return n.errorHandle(r.b.COMMENTS.PATCH_STATE,t),null}))},t.prototype.postCommentVote=function(t,e){var n=this,o=this.store;return o.demoIsActive?(e.commentId=t.id,e.id=o.demoDataCompiler.nextObjId(),t.votes.unshift(e),t.userVote=e,t.userEmotion=u.a.createEmotionFromVote(e,o.settings),t.userVoted=!0,o.demoDataCompiler.updateCommentBranchCounters(t),this._dataChangeHandle(y.NEW_COMMENT_VOTE),this._loadMetaData().then((function(){return e}))):this._postCommentVote(t,e).then((function(){var n=t.info,i=e.info,r=o.interactiveMode?"mini":"thread";return o.analyticsController.recordUgcInteraction("vote_submit",{element:r,vote:i,comment:n},{label:t.type,value:t.length}),e})).catch((function(t){return n.errorHandle(r.b.COMMENTS.VOTE,t),null}))},t.prototype.getComments=function(t){var e=this;return this.store.demoIsActive?(this._dataChangeHandle(y.COMMENTS),Promise.resolve({comments:this.demoData.comments,total:this.demoData.comments.length})):(t&&t.page&&(this.loadCommentsQueryParams.page=t.page),this._loadComments(t).catch((function(n){return t.noAlertOnError?e.logger.debug("trouble updating comments",n):e.errorHandle(r.b.COMMENTS.GET_PAGE,n),null})))},t.prototype.getReplies=function(t,e){var n=this;return this.store.demoIsActive?Promise.resolve({comment:t,replies:t.replies}):this._getReplies(t,e).catch((function(t){return n.errorHandle(r.b.COMMENTS.GET_REPLIES,t),null}))},t.prototype.sortSetByUser=function(t){var e=this;return t===this.sortOption?Object(d.c)():(this._notify(g.SORT_CONFIG_START),this.sortOption=t,this.sortConfig.enabled=!1,this.sortConfig=this.sortConfigs[t.type],this.sortConfig.enabled=this.store.demoMode,this.loadCommentsQueryParams.sort={property:this.sortConfig.value,order:this.sortConfig.order},this.getComments({noMerge:this.loadCommentsQueryParams.sort.order!==this.sortConfig.value}).then((function(){return Object(d.c)()})).then((function(){return e._notify(g.SORT_CONFIG_CHANGE),Object(d.c)(1e3)})))},t.prototype.getSortOption=function(t){return Object(h.g)(t,this.sortingOptions)},Object.defineProperty(t.prototype,"info",{get:function(){var t=this.store.metaData;if(this.initialized)return{count:t.comments.count,root_count:t.comments.rootCount,replies:t.comments.count-t.comments.rootCount,emotions:t.comments.emotions}},enumerable:!1,configurable:!0}),t.prototype.demoToggleHandle=function(){var t=this,e=this.store;if(e.demoIsActive){var n=e.demoController.data;this.demoData={comments:n?n.comments:[]},e.demoDataCompiler.updateCounters()}this._loadMetaData().then((function(){t._dataChangeHandle(y.COMMENTS),t._notify(g.SORT_CONFIG_CHANGE)})).catch((function(e){t.logger.warn("demoToggleHandle: ",e)}))},t.prototype._init=function(){var t=this,e=this.store,n=Object(d.t)((function(){if(!t.initialized){if(e.demoMode){if(e.threadController.demoSourceIsValid()){var n=e.demoController.data;t.demoData.comments=n?n.comments:[]||!1}else t.demoData.comments=[],t.logger.warn("demo video source does not match player video source");return e.demoDataCompiler.updateCounters(),Object(d.c)(200).then((function(){t.initialized=!0,t.initPromise=null,t.logger.info("initialized (demo mode)")}))}return t._loadUserCommentsEmotions().then((function(){t.initPromise=null,t.initialized=!0,t.logger.info("initialized")}))}t.logger.warn("Already initialized")}));return this.initPromise=Object(d.u)(this.initPromise,n),this.initPromise},t.prototype._reset=function(){var t=this,e=Object(d.t)((function(){t._clear(),t.loadCommentsQueryParams={sort:{property:"updated_at",order:"desc"}},t.logger.debug("reset"),t._notify(g.RESET),t.initialized=!1}));return this.initPromise=Object(d.u)(this.initPromise,e),this.initPromise},t.prototype._clear=function(){this.visibleComments=[],this.data={comments:[]},this.demoData={comments:[]},this.rtComments=[],this.userCommentsVotes.clear(),this.store.dataCompiler.clearComments(),this.logger.debug("clear"),this._notify(g.CLEAR)},t.prototype._notify=function(t,e){this.initialized&&this.pubSub.publish(t.toString(),e)},t.prototype._dataChangeHandle=function(t,e){var n=this.store.dataCompiler;switch(t){case y.COMMENTS:this._applyUserCommentsVotes(this.comments),n.compileComments(),this._rtModerate(!0);break;case y.NEW_COMMENT:n.compileComments(),this._rtModerate(!0),this._notify(g.COMMENT_POSTED,e);break;case y.NEW_REPLY:n.compileComments();break;case y.EDIT_COMMENT:break;case y.DELETE_COMMENT:n.compileComments(),this._rtModerate(!0),this._notify(g.COMMENT_DELETED,e);break;case y.REPLIES:case y.PATCH_COMMENT_STATE:case y.NEW_COMMENT_VOTE:break;case y.VISIBLE_COMMENTS:this._notify(g.VISIBLE_COMMENTS_CHANGE,this.visibleComments);break;case y.USER_COMMENTS_VOTES:this._applyUserCommentsVotesToAll();break;default:this.logger.warn("Unknown data change: ",t)}},t.prototype.errorHandle=function(t,e){this.store.errorHandler.alert(t,e,this.logger)},t.prototype._threadResetHandle=function(){this._reset()},t.prototype.threadAppliedHandle=function(){var t=this;return this.sortOptionsInit(),this._init().then((function(){t._notify(g.INITIALIZED)})).catch((function(e){return t.logger.warn("Init on thread apply err: ",e),t._reset()}))},t.prototype.sortOptionsInit=function(){var t=this.store;t.isLive?this.sortingOptions=h.a:"text"===t.mediaType?this.sortingOptions=h.f:this.sortingOptions=h.c,this.sortOption=this.getSortOption(t.api.thread.sort)||this.getSortOption(h.d.MOST_RECENT)||this.sortingOptions[0],t.commentsTopToBottom?(this.sortConfigs[h.d.MOST_RECENT].flipOrder=!1,this.sortConfigs[h.d.BY_TIMELINE].flipOrder=!1,this.sortConfigs[h.d.TOP_RATED].flipOrder=!1):(this.sortConfigs[h.d.MOST_RECENT].flipOrder=!0,this.sortConfigs[h.d.BY_TIMELINE].flipOrder=!0,this.sortConfigs[h.d.TOP_RATED].flipOrder=!0),this.sortConfig.enabled=!1,this.sortConfig=this.sortConfigs[this.sortOption.type],this.sortConfig.enabled=t.demoMode,this.loadCommentsQueryParams.sort={property:this.sortConfig.value,order:this.sortConfig.order}},t.prototype._userAuthHandle=function(){var t=this,e=this.store;if(!e.demoMode&&this.initialized&&!e.isPrivateMode)return Promise.all([this._loadComments(),this._loadUserCommentsEmotions()]).then((function(){t.logger.debug("authentication change handled")})).catch((function(e){t.logger.error("auth handle: ",r.a.fromObject(e))}))},t.prototype._userLogoutHandle=function(){return this._userAuthHandle()},t.prototype._ppChangeHandle=function(){this._rtModerate()},t.prototype._rtModerate=function(t){void 0===t&&(t=!1);var e=this.store,n=e.player,o=e.dataCompiler;if(this.initialized){var i=o.psLow(n.pp);if(t||i!==this.normPP){this.normPP=i;var r=o.findFirstInSeries(o.data.commentsSeries,n.pp);this.rtComments=r?r.items:[];var a=e.interactiveMode?this.rtComments:this.comments;(a!==this.visibleComments||t)&&(this.visibleComments=a,this._dataChangeHandle(y.VISIBLE_COMMENTS)),e.isPrivateMode||e.interactiveController.rtModerate(this.rtComments)}}},t.prototype._applyUserCommentsVotes=function(t){for(var e=0;e<t.length;e++){var n=t[e],o=this.userCommentsVotes.get(n.id);o?(n.userVote=o,n.userEmotion=u.a.createEmotionFromVote(o,this.store.settings),n.userVoted=!0):(n.userVote=void 0,n.userVoted=!1)}},t.prototype._applyUserCommentsVotesToAll=function(){var t=this,e=function(n){for(var o=0;o<n.length;o++)t._applyUserCommentsVotes(n[o].replies),e(n[o].replies)};this._applyUserCommentsVotes(this.comments),e(this.comments)},t.prototype._postComment=function(t){var e=this,n=this.store;return n.apiService.postComment(n.threadId,s.a.getPostComment(t,n)).then((function(o){return s.a.mergeCommentObject(t,o,n.settings),e.logger.debug("Posted new comment"),e._loadMetaData()})).then((function(){return e.data.comments.unshift(t),t.rating=e.submitCommentRatingToBeOnTop,e.submitCommentRatingToBeOnTop++,e._dataChangeHandle(y.NEW_COMMENT,t),t}))},t.prototype._postReply=function(t,e){var n=this,o=this.store,i=new c.g(t.id,t.path);return o.apiService.postReply(o.threadId,s.a.getPostComment(e,o),i).then((function(i){return n.logger.debug("Posted new reply"),s.a.mergeCommentObject(e,i,o.settings),n._updateCommentBranchMetadata(t)})).then((function(){return e.ancestor=t,t.replies.unshift(e),n._dataChangeHandle(y.NEW_REPLY),e}))},t.prototype._editComment=function(t,e){var n=this,o=this.store;return o.apiService.patchComment(o.threadId,t.id,s.a.getPatchComment(e)).then((function(e){return s.a.mergeCommentObject(t,e,o.settings),n.logger.debug("Edited comment"),0==t.depth?n._loadMetaData():n._updateCommentBranchMetadata(t)})).then((function(){return n._dataChangeHandle(y.EDIT_COMMENT),t}))},t.prototype._deleteComment=function(t){var e=this,n=this.store;return n.apiService.deleteComment(n.threadId,t.id).then((function(){return e.logger.debug("Deleted comment"),t.ancestor?e._updateCommentBranchMetadata(t.ancestor):e._loadMetaData()})).then((function(){e.removeDeletedComment(t,t.ancestor?t.ancestor.replies:e.data.comments),e._dataChangeHandle(y.DELETE_COMMENT,t)}))},t.prototype._patchCommentState=function(t,e){var n=this,o=this.store,i=new c.c(o.threadId,t.id,e);return o.apiService.patchCommentState(i).then((function(e){return n.logger.debug("patched comment state"),s.a.mergeCommentObject(t,e,o.settings),n._updateCommentBranchMetadata(t)})).then((function(){return n._dataChangeHandle(y.PATCH_COMMENT_STATE),t}))},t.prototype._postCommentVote=function(t,e){var n=this,o=this.store;return o.apiService.postCommentVote(o.threadId,t.id,e.type,u.a.getPostObject(e,o)).then((function(o){if(!u.a.mergeObject(e,o))throw new r.a("merging comment vote exception");return n.logger.debug("Posted new comment vote"),n._updateCommentBranchMetadata(t)})).then((function(){return t.votes.unshift(e),t.userVote=e,t.userEmotion=u.a.createEmotionFromVote(e,o.settings),t.userVoted=!0,n.userCommentsVotes.set(t.id,e),n._dataChangeHandle(y.NEW_COMMENT_VOTE),e}))},t.prototype._loadComments=function(t){var e=this,n=this.store,o=this.loadCommentsQueryParams,i=new c.d(n.threadId);return o.filterEmotion&&i.filterEmotion(o.filterEmotion),o.sort&&i.sort(o.sort.property,o.sort.order),o.page&&i.page(o.page.number,o.page.size),n.apiService.getComments(i).then((function(o){e.logger.debug("Loaded Comments");var i=o.total,r=s.a.parseComments(o.results,void 0,n.settings)||[];if(0===e.data.comments.length&&r.length>0||t&&t.noMerge)e.data.comments=r;else{var a=e.pushPopComments(r);a&&Object(d.c)(300).then((function(){var t={target:"comment",source:"ux",item:a};e.store.pubSub.publish(l.a.FOCUS_ON_COMPONENT_REQUEST,t)}))}return e._dataChangeHandle(y.COMMENTS),{comments:e.data.comments,total:i}}))},t.prototype._getReplies=function(t,e){var n=this,o=this.store,i=new c.d(o.threadId);return i.parent(t.id),i.sort("updated_at",e),Promise.all([o.apiService.getComments(i),this._updateCommentBranchMetadata(t)]).then((function(e){var i=e[0];return t.replies=s.a.parseComments(i.results,t,o.settings),n._applyUserCommentsVotes(t.replies),n._dataChangeHandle(y.REPLIES),n.logger.debug("got replies for: "+t.id),{comment:t,replies:t.replies}}))},t.prototype._loadUserCommentsEmotions=function(){var t=this,e=this.store;if(!e.user.in)return this.userCommentsVotes.clear(),this._dataChangeHandle(y.USER_COMMENTS_VOTES),Promise.resolve();var n=new c.e(e.threadId);return n.onlyMeta(),e.apiService.getCommentsEmotions(n).then((function(n){if(t.logger.debug("Loaded user comments votes"),n&&n.results)for(var o=u.a.parseUserEmotions(n.results,e.user.author),i=0;i<o.length;i++)t.userCommentsVotes.set(o[i].commentId,o[i]);else t.userCommentsVotes.clear();t._dataChangeHandle(y.USER_COMMENTS_VOTES)}))},t.prototype._loadMetaData=function(){var t=this.store;return Promise.all([t.pbMetricsController.loadMetrics(),t.threadController.loadMetaData()])},t.prototype._updateCommentMetadata=function(t){var e=this,n=this.store,o=new c.b(n.threadId,t.id);return o.onlyMeta(),n.apiService.getComment(o).then((function(o){return s.a.mergeCommentObject(t,o,n.settings),e.logger.debug("updated comment ("+t.id+") meta data"),t}))},t.prototype._updateCommentBranchMetadata=function(t){var e=[];e.push(this._loadMetaData()),e.push(this._updateCommentMetadata(t));for(var n=t;n.depth>0;)n=n.ancestor,e.push(this._updateCommentMetadata(n));return Promise.all(e)},t.prototype.pushPopComments=function(t){var e,n=this.data.comments,o=new Map,i=new Set;t.forEach((function(t){i.add(t.id)}));for(var r=n.length;r--;)i.has(n[r].id)||n.splice(r,1);return n.forEach((function(t,e){o.set(t.id,e)})),t.forEach((function(t,i){var r=n[i];if(!a.a.compare(r,t))if(r.id!==t.id){var s=o.get(t.id);if(void 0!==s){var c=n[s];if(n.splice(s,1),c&&c.vm&&c.vm.formVm&&c.vm.formVm.isOpen)return n.splice(i,0,c),void(e=c)}n.splice(i,0,t)}else{if(r.vm&&r.vm.formVm&&r.vm.formVm.isOpen)return;n.splice(i,1,t)}})),n.splice(t.length),e},t.prototype.removeDeletedComment=function(t,e){for(var n=!1,o=e.length;o--;){if(e[o].id===t.id){n=!0;break}}return n&&e.splice(o,1),n},m([Object(o.p)("demoIsActive","demoData.comments","data.comments"),f("design:type",Array),f("design:paramtypes",[])],t.prototype,"comments",null),t}(),y={INIT:200,COMMENTS:201,REPLIES:202,VISIBLE_COMMENTS:203,NEW_COMMENT:204,NEW_REPLY:205,NEW_COMMENT_VOTE:206,USER_COMMENTS_VOTES:207,PATCH_COMMENT_STATE:208,COMMENT_META:209,EDIT_COMMENT:210,DELETE_COMMENT:211}},73:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(29),i=function(){function t(t,e,n){this.set(e,n,t)}return t.prototype.set=function(t,e,n){Object(o.k)(n)&&(this.id=n),this.type=t,this.iconClass=e.iconClass,this.iconSrc=e.iconSrc,this.colorClass=e.colorClass,this.name=e.name,this.iconClasses="annoto-icon nn-paint "+this.iconClass,this.params=e},t.prototype.clone=function(){return new t(this.id,this.type,this.params)},t}()},74:function(t,e,n){"use strict";var o=n(102);n.o(o,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return o.CommentBadgeType})),n.o(o,"DapEventType")&&n.d(e,"DapEventType",(function(){return o.DapEventType})),n.o(o,"StatsType")&&n.d(e,"StatsType",(function(){return o.StatsType}));var i=n(103);n.o(i,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return i.CommentBadgeType})),n.o(i,"DapEventType")&&n.d(e,"DapEventType",(function(){return i.DapEventType})),n.o(i,"StatsType")&&n.d(e,"StatsType",(function(){return i.StatsType}));var r=n(104);n.o(r,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return r.CommentBadgeType})),n.o(r,"DapEventType")&&n.d(e,"DapEventType",(function(){return r.DapEventType})),n.o(r,"StatsType")&&n.d(e,"StatsType",(function(){return r.StatsType}));var a=n(105);n.o(a,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return a.CommentBadgeType})),n.o(a,"DapEventType")&&n.d(e,"DapEventType",(function(){return a.DapEventType})),n.o(a,"StatsType")&&n.d(e,"StatsType",(function(){return a.StatsType}));var s=n(106);n.o(s,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return s.CommentBadgeType})),n.o(s,"DapEventType")&&n.d(e,"DapEventType",(function(){return s.DapEventType})),n.o(s,"StatsType")&&n.d(e,"StatsType",(function(){return s.StatsType}));n(107),n(108),n(109);var c=n(110);n.o(c,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return c.CommentBadgeType})),n.o(c,"DapEventType")&&n.d(e,"DapEventType",(function(){return c.DapEventType})),n.o(c,"StatsType")&&n.d(e,"StatsType",(function(){return c.StatsType}));var l=n(111);n.o(l,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return l.CommentBadgeType})),n.o(l,"DapEventType")&&n.d(e,"DapEventType",(function(){return l.DapEventType})),n.o(l,"StatsType")&&n.d(e,"StatsType",(function(){return l.StatsType}));var u=n(112);n.o(u,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return u.CommentBadgeType})),n.o(u,"DapEventType")&&n.d(e,"DapEventType",(function(){return u.DapEventType})),n.o(u,"StatsType")&&n.d(e,"StatsType",(function(){return u.StatsType}));var p=n(113);n.o(p,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return p.CommentBadgeType})),n.o(p,"DapEventType")&&n.d(e,"DapEventType",(function(){return p.DapEventType})),n.o(p,"StatsType")&&n.d(e,"StatsType",(function(){return p.StatsType}));var d=n(114);n.o(d,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return d.CommentBadgeType})),n.o(d,"DapEventType")&&n.d(e,"DapEventType",(function(){return d.DapEventType})),n.o(d,"StatsType")&&n.d(e,"StatsType",(function(){return d.StatsType}));var h=n(115);n.d(e,"StatsType",(function(){return h.a}));var m=n(116);n.o(m,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return m.CommentBadgeType})),n.o(m,"DapEventType")&&n.d(e,"DapEventType",(function(){return m.DapEventType}));var f=n(117);n.o(f,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return f.CommentBadgeType})),n.o(f,"DapEventType")&&n.d(e,"DapEventType",(function(){return f.DapEventType}));var g=n(118);n.o(g,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return g.CommentBadgeType})),n.o(g,"DapEventType")&&n.d(e,"DapEventType",(function(){return g.DapEventType}));var b=n(119);n.o(b,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return b.CommentBadgeType})),n.o(b,"DapEventType")&&n.d(e,"DapEventType",(function(){return b.DapEventType}));var y=n(120);n.o(y,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return y.CommentBadgeType})),n.o(y,"DapEventType")&&n.d(e,"DapEventType",(function(){return y.DapEventType}));var v=n(121);n.o(v,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return v.CommentBadgeType})),n.o(v,"DapEventType")&&n.d(e,"DapEventType",(function(){return v.DapEventType}));n(122);var w=n(123);n.o(w,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return w.CommentBadgeType})),n.o(w,"DapEventType")&&n.d(e,"DapEventType",(function(){return w.DapEventType}));var O=n(124);n.o(O,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return O.CommentBadgeType})),n.o(O,"DapEventType")&&n.d(e,"DapEventType",(function(){return O.DapEventType}));var _=n(125);n.o(_,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return _.CommentBadgeType})),n.o(_,"DapEventType")&&n.d(e,"DapEventType",(function(){return _.DapEventType}));var x=n(126);n.o(x,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return x.CommentBadgeType})),n.o(x,"DapEventType")&&n.d(e,"DapEventType",(function(){return x.DapEventType}));var E=n(127);n.o(E,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return E.CommentBadgeType})),n.o(E,"DapEventType")&&n.d(e,"DapEventType",(function(){return E.DapEventType}));var S=n(128);n.d(e,"DapEventType",(function(){return S.a}));var j=n(129);n.o(j,"CommentBadgeType")&&n.d(e,"CommentBadgeType",(function(){return j.CommentBadgeType}));var C=n(130);n.d(e,"CommentBadgeType",(function(){return C.a}));n(131),n(132),n(133),n(134),n(135),n(136),n(137),n(138),n(149)},75:function(t,e,n){"use strict";function o(t,e){return Math.random()*(e-t)+t}n.d(e,"a",(function(){return o}))},76:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return i}));var o={HTML5:"html5",YT:"youtube",JW6:"jw6",JW7:"jw7",JW:"jw",VJS:"videojs",KALTURA:"kaltura",VIMEO:"vimeo",FLOW:"flowplayer",H5P:"h5p",WISTIA:"wistia",OPENEDX:"openedx",PAGE:"page",KPLAYKIT:"kplaykit",CUSTOM:"custom",get array(){return[this.YT,this.HTML5,this.JW6,this.JW7,this.JW,this.VJS,this.KALTURA,this.VIMEO,this.FLOW,this.H5P,this.WISTIA,this.OPENEDX,this.PAGE,this.KPLAYKIT,this.CUSTOM]}},i=function(){function t(){this._closed=!1,this.standAlone=!0,this.position="right",this.phonePosition="right",this.element=void 0,this.align={vertical:"center",horizontal:"element_edge"},this.maxWidth=0,this.margins={left:0,right:0,top:0,bottom:0},this.open=!1,this.rtl=!1,this.locale="en",this.player={type:void 0,element:void 0,wide:!0,api:void 0,params:void 0},this.timeline={height:32,overlayVideo:!1,disableDockPadding:!1,positionTopInFullScreen:!1,scrubberAlwaysOn:!1,scrubberHeight:2,scrubberColor:void 0},this.thread={type:"video",sort:"most_recent",showReplies:!1},this.demoMode=!1,this.demoDiscussion="",this.launchSource=void 0,this.ux={}}return t.prototype.close=function(){return this._widget?this._widget.close():(this._closed=!0,Promise.resolve())},t.prototype.reload=function(){return this._widget?(this._closed=!1,this._widget.reload(this)):Promise.reject(new Error("Widget not initialized"))},t.prototype.show=function(){return this._widget?this._widget.showByApi():Promise.reject(new Error("Not initialized"))},t.prototype.hide=function(){return this._widget?this._widget.hideByApi():Promise.reject(new Error("Not initialized"))},t.prototype.getMetadata=function(){return this._widget?this._widget.store.metaData:null},t.prototype.isFullPlayerSize=function(){return!!this._widget&&(!!this._widget.overlay&&this._widget.overlay.isFullPlayerSize())},t.prototype._init=function(t){this._widget=t},t}()},77:function(t,e,n){"use strict";n.d(e,"e",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"b",(function(){return c}));var o=n(29);function i(){return performance.timing&&performance.timing.domComplete?Math.round(Date.now()-performance.timing.domComplete):Math.round(performance.now())}var r=function(){function t(t){void 0===t&&(t=200),this.counter=0,this.timerID=0,this.step=Math.max(Math.floor(t),100),this.secondsDiv=1e3/this.step}return t.prototype.start=function(){var t=this;return this.timerID||(this.timerID=setInterval((function(){t.counter++}),this.step)),this},t.prototype.pause=function(){return this.timerID&&(clearInterval(this.timerID),this.timerID=0),this},t.prototype.reset=function(){return this.counter=0,this},t.prototype.value=function(){return this.counter*this.step},t.prototype.seconds=function(){return Math.floor(this.counter/this.secondsDiv)},t}(),a=function(){function t(t){void 0===t&&(t=2e3),this.ts=0,this.period=0,this.segmentPeriod=0,this.threshold=t,this.start=0}return t.prototype.track=function(t){if(!Object(o.k)(t))return this;var e=Math.floor(t),n=e-this.ts;return e>this.ts&&n<this.threshold?(this.period+=n,this.segmentPeriod+=n):(this.notifyOnSegment(),this.start=e,this.segmentPeriod=0),this.ts=e,this},t.prototype.trackSeconds=function(t){return this.track(1e3*t)},t.prototype.reset=function(t){return void 0===t&&(t=0),this.ts=Object(o.k)(t)?Math.floor(t):0,this.period=0,this.start=this.ts,this.segmentPeriod=0,this},t.prototype.resetSeconds=function(t){void 0===t&&(t=0);var e=Object(o.k)(t)?1e3*t:0;return this.reset(e)},t.prototype.value=function(){return this.period},t.prototype.seconds=function(){return Math.floor(this.period/1e3)},t.prototype.onSegment=function(t){this.onSegmentCb=t},t.prototype.segment=function(){return{start:this.start,end:this.start+this.segmentPeriod}},t.prototype.consumeSegment=function(){this.notifyOnSegment(),this.start=this.ts,this.segmentPeriod=0},t.prototype.notifyOnSegment=function(){if("function"==typeof this.onSegmentCb&&this.segmentPeriod>1e3){var t={start:this.start,end:this.start+this.segmentPeriod};if(!Object(o.k)(t.start)||!Object(o.k)(t.end))return;this.onSegmentCb(t)}},t}(),s=function(){function t(t){void 0===t&&(t=1e3),this.defaultTimeout=t}return t.prototype.set=function(t,e){var n=this;this.clear(),this.timerID=setTimeout((function(){t(),n.timerID=0}),e||this.defaultTimeout)},t.prototype.clear=function(){this.timerID&&clearTimeout(this.timerID),this.timerID=0},t}(),c=function(){function t(t){void 0===t&&(t=1e3),this.defaultInterval=t}return t.prototype.set=function(t,e){this.clear(),this.timerID=setInterval((function(){t()}),e||this.defaultInterval)},Object.defineProperty(t.prototype,"isSet",{get:function(){return Boolean(this.timerID)},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this.timerID&&clearInterval(this.timerID),this.timerID=0},t}()},79:function(t,e,n){"use strict";n.d(e,"a",(function(){return A}));var o=n("aurelia-framework"),i=n("aurelia-validation"),r=n("aurelia-i18n"),a=n(19),s=n(32),c=n(156),l=n(50),u=n(49),p=n(55),d=n(80),h=n(86),m=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},f=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=function(){function t(t,e){this.singletoneExtensions={},this.logger=o.h.getLogger("Annoto-analytics"),this.user=t,this._getHostService=e}return t.prototype.init=function(t){return t?(this._clientGetter=t,this.hostService=this._getHostService(),this.logger.info("initialized"),Promise.resolve()):(this.logger.warn("not initialized: client getter missing"),Promise.resolve())},t.prototype.recordAppEvent=function(t){var e=this;return this.recordEvent(h.b.app,t).catch((function(t){e.logger.warn("Error recording app event: ",t)}))},t.prototype.recordEvent=function(t,e){var n=this;return new Promise((function(o,i){return e.client_timestamp=(new Date).toISOString(),n._call("recordEvent",t,e,(function(t,e){return t?i(t):o(e)}))}))},t.prototype.deferEvent=function(t,e){var n=this;return e.client_timestamp=(new Date).toISOString(),Promise.resolve().then((function(){return n._call("deferEvent",t,e)}))},t.prototype.recordDeferredEvents=function(){var t=this;return Promise.resolve().then((function(){return t._call("recordDeferredEvents")}))},t.prototype.extendEventPush=function(t,e){return this._call("extendEvent",t,e)},t.prototype.extendEventSingletone=function(t,e){var n=this.singletoneExtensions[t];return n?(n.objOrFunction=e,Promise.resolve()):(n={extensionBridge:function(){return"function"==typeof this.objOrFunction?this.objOrFunction():this.objOrFunction},objOrFunction:e},this.singletoneExtensions[t]=n,this.extendEventPush(t,n.extensionBridge.bind(n)))},t.prototype._call=function(t,e,n,o){return Promise.resolve().then((function(){"function"==typeof o&&o()}))},t=m([Object(o.t)(u.a,o.f.of(d.a)),f("design:paramtypes",[u.a,Object])],t)}(),b=n(81),y=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},v=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},w=function(){function t(t,e){this.KEEN_VISIT_SESSION_ADDON={name:"keen:date_time_parser",input:{date_time:"visit_session.started_at"},output:"visit_session.started_at_info"},this.dbaService=t,this.analytics=e,this.logger=o.h.getLogger("Annoto-visit-session")}return t.prototype.extend=function(){var t=this;return this.dbaService.setAction("visitSession","extend").then((function(e){if(e&&e.session){t.session=e.session;var n=e.expiredSession;if("object"==typeof n){var o=new Date(Date.parse(n.started_at)+n.age).toISOString();t.analytics.recordAppEvent({event_type:h.a.sessionEnd,visit_session:n,client_timestamp:o,keen:{timestamp:o,addons:[t.KEEN_VISIT_SESSION_ADDON]}})}t.session&&0===t.session.age&&t.analytics.recordAppEvent({event_type:h.a.sessionStart,visit_session:t.session,keen:{addons:[t.KEEN_VISIT_SESSION_ADDON]}})}else t.logger.warn("Got empty extend visit session response")}))},Object.defineProperty(t.prototype,"info",{get:function(){if(this.session&&"object"==typeof this.session)return this.session},enumerable:!1,configurable:!0}),t=y([Object(o.t)(b.a,g),v("design:paramtypes",[b.a,g])],t)}(),O=n(34),_=n(29),x=n(158),E=n(11),S=n(170),j=n(88),C=n(20),T=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},P=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},k=Object(a.a)(),A=function(){function t(t,e,n,i,r,a,s,c,l,u,p,d){this.visitSessionManager=l,this.playerUxFilter=u,this.userHintsService=p,this.dapService=d,this.initPromise=null,this.initDone=!1,this.browser=k,this.validator=t,this.loader=e,this.i18n=n,this.user=i,this.apiService=r,this.settings=a,this.analytics=s,this.dbaService=c,this.logger=o.h.getLogger("Annoto-service-initializer"),this.assetLoader=new C.a}return t.prototype.init=function(t){var e=this;return this.initDone?Promise.resolve():(this.initPromise||(this.options=t,this.app=t.app,this.initPromise=this.validator.validateObject(t,R).then((function(t){var n;if(t.reduce((function(t,e){return e.valid||(n=t=t+" "+e),t}),""),n)throw new O.a(O.b.INIT.INVALID_OPTIONS,n);return e.applyApiConfig(e.options.apiConfig),e.logger.debug("Initializing analytics and dba"),Promise.all([e.analytics.init(e.options.getAnalyticsClient),e.dbaService.init(e.options.getDBAElement)])})).then((function(){return e.logger.debug("Initializing User and Misc"),Promise.all([e._checkBrowserCompatibility(),e._loadLocalisation(),e._importJQueryPlugins(),e._initUserAndAPI()])})).then((function(){return e.logger.debug("Initializing visit session"),e._initVisitSessionRetry=0,e.initVisitSession()})).then((function(){return e.applyPrivateModeSetting()})).then((function(){e.initDone=!0,e.initPromise=null})).catch((function(t){throw e.initPromise=null,e.logger.error("services init: ",t),t}))),this.initPromise)},t.prototype.applyApiConfig=function(t){this.settings.applyApiConfig(t)},t.prototype.applyPrivateModeSetting=function(){if(this.settings.hasUGC){var t=Boolean(!this.settings.commentsEnabled&&this.settings.privateNotesEnabled);this.user.setPrivateMode(t)}},t.prototype._checkBrowserCompatibility=function(){var t=parseInt(k.version);if(s.a.disabledBrowsers[k.name]&&-1!==s.a.disabledBrowsers[k.name].indexOf(t.toString()))throw new O.a(O.b.INIT.NOT_SUPPORTED,"browser "+k.name+" version "+t+" is not compatible");return Promise.resolve()},t.prototype._initUserAndAPI=function(){var t=this,e=this.options,n=e.launchSource,o=n?n.accessToken:null,i=this.settings,r=this.apiService,a=this.logger;return this.logger.debug("Initializing User and API"),e.demoMode?Object(_.c)(50).then((function(){return t.user.setDemoMode().then((function(){t.logger.debug("Initialized User and API")}))})):r.init(e.clientId,n).then((function(){var e;return t.logger.debug("Initialized API"),Promise.all([r.getThreadSettings().then((function(e){return t.logger.debug("Got thread settings"),e})),r.getEmotionsSettings().then((function(e){return t.logger.debug("Got emotions settings"),e})),t.user.init(o).then((function(){return t.logger.debug("Initialized User")})),r.hostService.name?t.dbaService.setAction("analyticsFields",null,(e={},e[E.d.customer]=r.hostService.name,e)).catch((function(e){return t.logger.warn("error setting host name:",e)})):null])})).then((function(e){t.logger.debug("Initialized User and API");var n=e[0],o=e[1];if(!n||!n.emotions)throw new O.a(O.b.INIT.INVALID_SETTINGS,"invalid thread settings");if(!o||!o.params)throw new O.a(O.b.INIT.INVALID_SETTINGS,"invalid emotions settings");a.info("got emotions settings"),a.info("got thread settings"),i.applyEmotionsSettings(o),i.applyThreadSettings(n)})).catch((function(t){throw a.error("Init user and api: ",t),t}))},t.prototype._loadLocalisation=function(){var t=this,e=this.i18n;return e.i18nextReady().then((function(){return t._setLocale()})).then((function(){AnnotoComponents.config.set({i18n:{t:e.i18next.t.bind(e.i18next)}}),t.logger.debug("Localisation loaded")})).catch((function(e){throw t.logger.error("Localisation load error: ",e),e}))},t.prototype._setLocale=function(){var t=this,e=this.options.locale;return this.i18n.setLocale(e).then((function(){t.logger.info("Locale set to: ",e)})).catch((function(e){t.logger.warn("Locale set: ",e)}))},t.prototype._importJQueryPlugins=function(){var t=this,e=(this.options,this.loader),n=[];return this.logger.debug("Importing JQuery"),"function"!=typeof s.a.$().draggable&&n.push(e.loadModule("jquery-ui/ui/widgets/draggable").then((function(){})).catch((function(e){throw t.logger.error("Failed to import jquery-ui draggable: ",e),e}))),"function"!=typeof s.a.$().resizable&&n.push(e.loadModule("jquery-ui/ui/widgets/resizable").then((function(){})).catch((function(e){throw t.logger.error("Failed to import jquery-ui resizable: ",e),e}))),Promise.all(n).then((function(){t.logger.debug("Imported JQuery")}))},t.prototype.initVisitSession=function(){var t=this;return this._initVisitSessionRetry>8?(this.logger.error("Gave up on Initializing visit session"),Promise.resolve()):(this._initVisitSessionRetry++,this.visitSessionManager.extend().catch((function(e){setTimeout((function(){t.initVisitSession()}),0),t.logger.warn("Initializing visit session ("+t._initVisitSessionRetry+"): ",e)})))},t=T([Object(o.t)(i.Validator,o.g,r.I18N,u.a,p.a,l.a,g,b.a,w,x.a,S.a,j.a),P("design:paramtypes",[i.Validator,o.g,r.I18N,u.a,p.a,l.a,g,b.a,w,x.a,S.a,j.a])],t)}(),R=c.a.ensure("demoMode").required().ensure("clientId").satisfiesRule("string").ensure("locale").required().ensure("launchSource").satisfiesRule("object").ensure("apiConfig").satisfiesRule("object").ensure("getAnalyticsClient").satisfiesRule("function").ensure("getDBAElement").satisfiesRule("function").rules},80:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var o=n("aurelia-framework"),i=n("aurelia-api"),r=n(50),a=n(157),s=n(59),c=n(34);function l(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("Illegal base64url string!")}try{return function(t){return decodeURIComponent(atob(t).replace(/(.)/g,(function(t,e){var n=e.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(e)}catch(t){return atob(e)}}function u(t,e){if("string"!=typeof t)throw new Error("Invalid token specified");var n,o=!0===(e||{}).header?0:1;try{return n=l(t.split(".")[o]),JSON.parse(n)}catch(t){if("string"==typeof n)return n;throw new Error("Invalid token specified: "+t.message)}}var p=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(){function t(t,e){this.apiConfig=t,this.clientId=null,this._ready=!1,this._auth=!1,this._session=null,this._decoded={},this._timerID=0,this._launchSource=null,this.localIat=NaN,this.logger=o.h.getLogger("Annoto-host-service"),this.settings=e,this.host=s.a.host}return Object.defineProperty(t.prototype,"id",{get:function(){var t=this.hostId;return this._launchSource&&(t=this._launchSource.id),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endpoint",{get:function(){return this.apiConfig.getEndpoint(a.a.endpoint)},enumerable:!1,configurable:!0}),t.prototype.init=function(t,e){if(this._ready)return Promise.resolve(this.token);var n=this.apiConfig;if(a.a.httpInterceptor)for(var o=Object.keys(n.endpoints),i=0;i<o.length;i++)n.getEndpoint(o[i]).client.interceptors.push(this.interceptor);if(this.endpoint&&"string"==typeof t&&""!==t){this.clientId=t;try{this.hostId=u(t),this._launchSource=e?{id:u(e.consumerKey),consumer_key:e.consumerKey,origin:e.origin}:void 0}catch(t){return Promise.reject(new TypeError("invalid clientId format"))}this._ready=!0}return this.authenticate()},Object.defineProperty(t.prototype,"authenticated",{get:function(){return this._auth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"token",{get:function(){return this._session?this._session[a.a.tokenKey]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"origin",{get:function(){return s.a.href},enumerable:!1,configurable:!0}),t.prototype.authenticate=function(){var t=this;if(this._ready){var e=this._launchSource,n={origin:this.origin,client_id:this.clientId,launch_source:e?{consumer_key:e.consumer_key,origin:e.origin}:void 0};return this.endpoint.post(a.a.authPath,n).then((function(e){return e&&e[a.a.tokenKey]?(t.settings.applyHostSettings(e.settings),t._applySession(e)):(t.revoke(),null)})).catch((function(e){var n=e instanceof Response;return t.logger.error("authenticate error: ",n?e.statusText:e),t.revoke(),null}))}return Promise.reject(new c.a(c.b.HOST.NOT_INIT,"Host service is not ready"))},t.prototype.revoke=function(){this._session=null,this._decoded={},this.localIat=NaN,this._auth=!1,this.name=void 0,this._clearTimeout()},t.prototype.isAuthenticated=function(){var t=this._isAuthenticated();return t!==this._auth&&(this._auth=t),t},t.prototype._isAuthenticated=function(){var t=this._isTokenExpired();return void 0===t?!!this.token:!t},Object.defineProperty(t.prototype,"info",{get:function(){var t=(this._session||{}).settings||{},e=this._decoded||{},n=this.id;return this.authenticated?{id:e.jti,auth:!0,sso:t.enableSSO}:{id:n,auth:!1}},enumerable:!1,configurable:!0}),t.prototype._applySession=function(t){var e=u(t[a.a.tokenKey]);if(e&&e.sub===this.host){if(this._session=t,this._decoded=e,this.localIat=(new Date).getTime(),this.name=t.name,this._updateAuthenticated(),this._auth)return t[a.a.tokenKey];this.logger.warn("session token already expired: ",this._getTtl())}this.revoke(),this.logger.warn("session security violation: ",t)},t.prototype._updateAuthenticated=function(){this._clearTimeout();var t=this._auth;this._auth=this._isAuthenticated(),this._auth&&!Number.isNaN(this._getExp())&&(this._setTimeout(1e3*Math.max(0,this._getTtl()-a.a.expirationMargin)),a.a.autoUpdateToken&&this._sheduleAutoUpdate()),t!==this._auth&&this.logger.info("Host authentication changed to: "+this._auth)},t.prototype._clearTimeout=function(){this._timerID&&(o.j.global.clearTimeout(this._timerID),this._timerID=0)},t.prototype._setTimeout=function(t){var e=this;this._clearTimeout(),this._timerID=o.j.global.setTimeout((function(){e._updateAuthenticated()}),t)},t.prototype._sheduleAutoUpdate=function(){var t=this;this._clearAutoUpdate();var e=this._getTtl(),n=isNaN(e)?1e3:1e3*Math.max(0,e-2*a.a.expirationMargin);this._autoUpdateTimerID=o.j.global.setTimeout((function(){t.authenticate()}),Math.max(1e3,n))},t.prototype._clearAutoUpdate=function(){this._autoUpdateTimerID&&(o.j.global.clearTimeout(this._autoUpdateTimerID),this._autoUpdateTimerID=0)},t.prototype._getExp=function(){return parseInt(this._decoded.exp)||NaN},t.prototype._getIat=function(){return parseInt(this._decoded.iat)||NaN},t.prototype._getTtl=function(){var t=this._getExp(),e=this._getIat(),n=this.getLocalLiveTime();return Number.isNaN(t)||Number.isNaN(e)||Number.isNaN(n)?0:t-e-n},t.prototype.getLocalLiveTime=function(){return this.localIat?Math.round(((new Date).getTime()-this.localIat)/1e3):NaN},t.prototype._isTokenExpired=function(){return this._getTtl()<a.a.expirationMargin+1},Object.defineProperty(t.prototype,"interceptor",{get:function(){var t=this;return{request:function(e){var n=t.token;return a.a.httpInterceptor&&t.isAuthenticated()&&n?(a.a.authTokenType&&(n=a.a.authTokenType+" "+n),e.headers.set(a.a.authHeader,n),e):e}}},enumerable:!1,configurable:!0}),p([Object(o.p)("_auth"),d("design:type",Object),d("design:paramtypes",[])],t.prototype,"authenticated",null),p([Object(o.p)("_session"),d("design:type",String),d("design:paramtypes",[])],t.prototype,"token",null),t=p([Object(o.t)(i.Config,r.a),d("design:paramtypes",[i.Config,r.a])],t)}()},81:function(t,e,n){"use strict";var o=n("aurelia-framework"),i=n(32),r=n(29),a=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,i++)o[i]=r[a];return o},s=function(){function t(t){this.timeoutMs=t}return t.prototype.run=function(t,e){for(var n=this,o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];return this.response=Object(r.b)(),e.call.apply(e,a([t],o)).then((function(){return Object(r.x)(n.response.promise,n.timeoutMs)}))},t.prototype.resolve=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=this.response).resolve.apply(t,e)},t.prototype.reject=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=this.response).reject.apply(t,e)},t}(),c=n(11),l=function(){function t(){this.logger=o.h.getLogger("Annoto-dba-service"),this.msgId=1,this.transactions=new Map}return t.prototype.init=function(t){var e=this;return t?(this._dbaElementGetter=t,this._dba=this.dba,Object(r.p)().then((function(){return e.loopUntilEcho()})).then((function(){return e.logger.info("initialized")}))):(this.logger.warn("not initialized: dba getter missing"),Promise.resolve())},t.prototype.setAction=function(t,e,n){return void 0===n&&(n={}),this.postWithResponse({action:"set",handler:t,target:e,data:n})},t.prototype.hitAction=function(t,e,n){return this.postMessage({action:"hit",handler:t,target:e,data:n})},t.prototype.getAction=function(t,e){return this.postWithResponse({action:"get",handler:t,target:e})},t.prototype.loopUntilEcho=function(){var t=this;return new Promise((function(e){var n=function(){return t.postWithResponse({action:"echo",handler:"echo"},i.a.dba.echoTimeout).catch((function(){return t.logger.debug("Echo timeout"),Object(r.p)().then((function(){return n()}))}))};n().then(e)}))},t.prototype.postWithResponse=function(t,e){var n=this;void 0===e&&(e=i.a.dba.transactionTimeout);var o=new s(e),r=this.msgId;return this.transactions.set(r,o),o.run(this,this.postMessage,t).then((function(t){return n.transactions.delete(r),t})).catch((function(t){throw n.transactions.delete(r),t}))},t.prototype.postMessage=function(t){var e=this.dba,n=this.msgId;if(this.msgId++,!e)return Promise.reject(new Error("dba service not ready"));t.id=n;try{e.postMessage(JSON.stringify(t),c.b.DBA_URL)}catch(t){return Promise.reject(t)}return Promise.resolve()},t.prototype._handleDBAMessage=function(t){var e,n=t.data;if(c.b.DBA_URL===t.origin){try{if(!(e=JSON.parse(n))||!e.status)throw new TypeError("not an object/invalid object")}catch(t){return void this.logger.error("Error parsing DBA data: ",t)}var o=e.id,i=this.transactions.get(o);i?"ok"===e.status?i.resolve(e.data):i.reject(new Error(e.errorMsg)):"hit"!==e.action&&this.logger.warn("Out of bound message: id ("+e.id+"), status ("+e.status+"), action ("+e.action+"), handler ("+e.handler+")")}},Object.defineProperty(t.prototype,"dba",{get:function(){return this._dba||this._initDBA()},enumerable:!1,configurable:!0}),t.prototype._initDBA=function(){var t=this;return this._dbaElementGetter&&(this._dbaElement=this._dbaElementGetter()),this._dbaElement&&this._dbaElement.contentWindow&&(this._dba={postMessage:function(){for(var e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];(e=t._dbaElement.contentWindow).postMessage.apply(e,n)}},o.j.addEventListener("message",(function(e){return t._handleDBAMessage(e)}),!1)),this._dba},t}();e.a=l},85:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var o=n("aurelia-framework"),i=n(29),r=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(){function t(){this.body="",this.createdAt=new Date,this.updatedAt=new Date,this.state=0,this.type="text"}return Object.defineProperty(t.prototype,"hasPS",{get:function(){return Object(i.k)(this.ps)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return 0===this.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDeleted",{get:function(){return 2===this.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){var t;return(null===(t=this.body)||void 0===t?void 0:t.length)||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){return{id:this.id,author_id:this.authorId,state:this.state,ps:this.ps,emotion:this.emotion?this.emotion.type:void 0,body:this.body,topic:this.topic?this.topic:void 0,body_len:this.length,topic_len:"string"==typeof this.topic?this.topic.length:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"state",{get:function(){return{visible:0,deleted:2}},enumerable:!1,configurable:!0}),r([Object(o.p)("ps"),a("design:type",Object),a("design:paramtypes",[])],t.prototype,"hasPS",null),r([Object(o.p)("state"),a("design:type",Object),a("design:paramtypes",[])],t.prototype,"isVisible",null),r([Object(o.p)("state"),a("design:type",Object),a("design:paramtypes",[])],t.prototype,"isDeleted",null),r([Object(o.p)("body"),a("design:type",Number),a("design:paramtypes",[])],t.prototype,"length",null),t}()},86:function(t,e,n){"use strict";var o,i,r,a,s,c,l,u,p;n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return i})),function(t){t.app="app_interaction",t.video="video_interaction",t.videoBenchmark="video_benchmark",t.timeline="timeline_interaction",t.widget="widget_interaction",t.menu="menu_interaction",t.ugc="ugc_interaction",t.conversion="conversion_interaction"}(o||(o={})),function(t){t.start="start",t.startError="start_error",t.sessionStart="session_start",t.sessionEnd="session_end"}(i||(i={})),function(t){t.open="open",t.close="close",t.minimize="minimize",t.autoOpen="auto_open",t.helpTap="help_tap",t.resized="resized",t.dragged="dragged",t.hintTap="hint_tap"}(r||(r={})),function(t){t.open="open",t.select="select",t.optionTap="option_tap"}(a||(a={})),function(t){t.timetagTap="timetag_tap",t.sort="sort",t.noteSubmit="note_submit",t.noteEdit="note_edit",t.noteDelete="note_delete",t.voteSubmit="vote_submit",t.commentDelete="comment_delete",t.commentEdit="comment_edit",t.commentSubmit="comment_submit",t.commentModerate="comment_moderate",t.replySubmit="reply_submit",t.showReplies="show_replies",t.threadVoteSubmit="thread_vote_submit",t.replyTap="reply_tap",t.commentTap="comment_tap",t.noteTap="note_tap",t.kukuTap="kuku_tap",t.syncToTimeline="sync_tap",t.scrollToStart="scroll_tap",t.threadFollow="thread_follow",t.exportNotes="export_notes",t.exportGroupNotes="export_group_notes",t.exportComments="export_comments",t.anonymousTap="anonymous_tap"}(s||(s={})),function(t){t.tap="tap",t.ugcTap="ugc_tap"}(c||(c={})),function(t){t.play="play",t.pause="pause",t.seek="seek",t.fullscreen="fullscreen"}(l||(l={})),function(t){t.ready="ready",t.firstPlay="first_play",t.progress="progress"}(u||(u={})),function(t){t.authTrigger="auth_trigger",t.login="login",t.logout="logout",t.ctaTap="cta_tap"}(p||(p={}))},87:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var o=function(){this.createdAt=new Date,this.updatedAt=new Date}},88:function(t,e,n){"use strict";n.d(e,"a",(function(){return g}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(74),a=n(55),s=n(49),c=n(66),l=n(81),u=n(159),p=n(29),d=n(31),h=function(){return(h=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},m=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},f=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=function(){function t(t,e,n,i,r,a){var s=this;this.apiService=t,this.user=e,this.platform=n,this.dbaService=i,this.eventAggregator=r,this.locale=a,this.state=null,this.logger=o.h.getLogger("dap-service"),this.eventAggregator.subscribe(d.a.USER_AUTHENTICATED,(function(){s.activated=!1}))}return Object.defineProperty(t.prototype,"isActive",{get:function(){return this.state&&("start"===this.state.type||"show"===this.state.type)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCanceled",{get:function(){return this.state&&"cancel"===this.state.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isComplete",{get:function(){return this.state&&"complete"===this.state.type},enumerable:!1,configurable:!0}),t.prototype.startQuery=function(){var t=this;return this.user.demoMode?Promise.resolve():this.activated?(this.logger.debug("startQuery: skip, already actived"),Promise.resolve()):this.apiService.dapStartQuery({device:this.platform.isPhone()?"mobile":"desktop",product:"widget",visitor_id:this.user.visitorId,locale:this.locale.getLanguageCode()}).then((function(e){if(t.activated)t.logger.debug("startQuery: skip dap, already actived");else if(t.activated=!0,e.err)t.logger.info("startQuery err: ",e.err);else if("done"!==e.action)if(e.dap){if("idle"===e.action)return t.logger.info("startQuery: idle"),void t.recordEvent(e.dap,{type:r.DapEventType.hit},null);if("start"===e.action)return t.logger.info("startQuery: starting"),e.dap;t.logger.info("startQuery: not starting")}else t.logger.info("startQuery: dap not found");else t.logger.info("startQuery: done")})).catch((function(e){t.logger.error("startQuery: ",e)}))},t.prototype.recordEvent=function(t,e,n){var o=this,i={eventCategory:("DAP - "+t.name).slice(0,150),eventAction:Object(p.y)(r.DapEventType[e.type])};return e.step_name&&(i.eventLabel=Object(p.y)(e.step_name)),this.state=n,this.logger.debug("record event: ",i),Promise.all([this.apiService.postDapEvent(t.id,h(h({},e),{visitor_id:this.user.visitorId})).catch((function(t){o.logger.error("record dap event: ",t)})),this.dbaService.hitAction("hitTracking","event",i).catch((function(t){o.logger.error("record to dba: ",t)}))])},m([Object(o.p)("state","state.type"),f("design:type",Boolean),f("design:paramtypes",[])],t.prototype,"isActive",null),m([Object(o.p)("state","state.type"),f("design:type",Boolean),f("design:paramtypes",[])],t.prototype,"isCanceled",null),m([Object(o.p)("state","state.type"),f("design:type",Boolean),f("design:paramtypes",[])],t.prototype,"isComplete",null),t=m([Object(o.t)(a.a,s.a,c.a,l.a,i.EventAggregator,u.a),f("design:paramtypes",[a.a,s.a,c.a,l.a,i.EventAggregator,u.a])],t)}()},90:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return l}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(34),a=n(40),s=n(29),c={INITIALIZED:1,RESET:2,METRICS_CHANGE:3,VISIBLE_METRICS_CHANGE:4,CLEAR:5},l=function(){function t(t){var e=this;this.data={},this.demoData={},this.disposables=[],this.store=t,this.pubSub=new i.EventAggregator,this.logger=o.h.getLogger("Annoto-pb-metrics-controller"),this._reset(),Object(s.o)((function(){return e._addDisposables()}))()}return t.prototype._addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.threadController.on(a.a.FLOOR_PP_CHANGE,(function(){return t._ppChangeHandle()}))),n.push(e.threadController.on(a.a.RESET,(function(){return t._threadResetHandle()}))),n.push(e.threadController.on(a.a.THREAD_APPLIED,Object(s.o)((function(){return t._threadAppliedHandle()}))))},Object.defineProperty(t.prototype,"metrics",{get:function(){return this.store.demoIsActive?this.demoData.metrics:this.data.metrics},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();return this.disposables=[],this._reset()},t.prototype.on=function(t,e){var n=this;return t===c.INITIALIZED&&this.initialized&&setTimeout((function(){return e(n.initialized)}),1),this.pubSub.subscribe(t.toString(),e)},t.prototype.forceRtModerate=function(){this._rtModerate(!0)},t.prototype.interactiveModeChangeHandle=function(){var t=this;return Promise.resolve().then((function(){return t._rtModerate(!0)}))},t.prototype.getMetrics=function(){return this.metrics?Promise.resolve():this.loadMetrics()},t.prototype.loadMetrics=function(){var t=this;return this.store.demoIsActive?(this.logger.debug("Loaded Pb Metrics"),this._dataChangeHandle(u.METRICS),Promise.resolve()):(this.loadMetricsPromise||(this.loadMetricsPromise=this._loadMetrics().then((function(){t.loadMetricsPromise=null})).catch((function(e){throw t.loadMetricsPromise=null,e}))),this.loadMetricsPromise)},t.prototype._init=function(){var t=this,e=this.store,n=Object(s.t)((function(){if(t.initialized)t.logger.warn("Already initialized");else{if(e.demoMode)return t.initialized=!0,t.initPromise=null,t.logger.info("initialized (demo mode)"),void t._dataChangeHandle(u.METRICS);t.initPromise=null,t.initialized=!0,t.logger.info("initialized")}}));return this.initPromise=Object(s.u)(this.initPromise,n),this.initPromise},t.prototype._reset=function(){var t=this,e=Object(s.t)((function(){t._clear(),t.logger.debug("reset"),t._notify(c.RESET),t.initialized=!1}));return this.initPromise=Object(s.u)(this.initPromise,e),this.initPromise},t.prototype._clear=function(){this.store.dataCompiler.clearPbMetrics(),this.data={},this.demoData={},this.visibleMetrics=void 0,this.logger.debug("clear"),this._notify(c.CLEAR)},t.prototype._notify=function(t,e){this.initialized&&this.pubSub.publish(t.toString(),e)},t.prototype._dataChangeHandle=function(t){var e=this.store.dataCompiler;switch(t){case u.METRICS:e.compilePbMetrics(),this._rtModerate(!0),this._notify(c.METRICS_CHANGE,this.metrics);break;case u.VISIBLE_METRICS:this._notify(c.VISIBLE_METRICS_CHANGE,this.visibleMetrics);break;default:this.logger.warn("Unknown data change: ",t)}},t.prototype._errorHandle=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(this.logger.error("error ("+t+")",e),e){if(Error.prototype.isPrototypeOf(e[0]))return r.a.fromObject(e[0]);if(Response.prototype.isPrototypeOf(e[0]))return new r.a(e[0].statusText)}return new r.a},t.prototype._threadResetHandle=function(){this._reset()},t.prototype._threadAppliedHandle=function(){var t=this;return this._init().then((function(){t._notify(c.INITIALIZED)})).catch((function(e){return t.logger.error(e),t._reset().then((function(){return t._errorHandle(u.INIT,e)}))}))},t.prototype._ppChangeHandle=function(){this._rtModerate()},t.prototype._rtModerate=function(t){void 0===t&&(t=!1);var e=this.store,n=e.player,o=e.dataCompiler;if(this.initialized){var i=o.psLow(n.pp);if(t||i!==this.normPP){this.normPP=i;var r=o.data.pbMetricsSeries.get(i);(r!==this.visibleMetrics||t)&&(this.visibleMetrics=r,this._dataChangeHandle(u.VISIBLE_METRICS))}}},t.prototype._loadMetrics=function(){var t=this,e=this.store;return e.apiService.getProgressBarMetrics(e.threadId).then((function(e){t.logger.debug("Loaded Pb Metrics"),t.data.metrics=e,t._dataChangeHandle(u.METRICS)})).catch((function(e){return t._errorHandle(u.METRICS,e)}))},t}(),u={INIT:300,METRICS:301,VISIBLE_METRICS:302}},91:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var o=function(){function t(t,e){this.interval=t,this.pollCb=e,this.running=!1}return t.prototype.start=function(t){void 0===t&&(t=!1),this.running||(this.running=!0,this.pollCycle(t))},t.prototype.stop=function(){if(this.runningTimer&&(clearTimeout(this.runningTimer),this.runningTimer=0),this.running=!1,this.polled){var t=this.polled;return this.polled=null,t}return Promise.resolve()},t.prototype.poll=function(){var t=this;return this.pollCb().then((function(){t.polled=null,t.pollCycle(!1)})).catch((function(){t.polled=null,t.pollCycle(!1)}))},t.prototype.pollCycle=function(t){var e=this,n=t?0:this.interval;"function"==typeof n&&(n=n()),this.running&&(this.runningTimer=setTimeout((function(){e.polled=e.poll()}),n))},t}()},93:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));var o,i=n("aurelia-framework"),r=n(154),a=n(32),s=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=function(t){function e(){var e,n=this;try{e=localStorage}catch(t){e=null}return(n=t.call(this,e,a.a.storagePrefix)||this).logger=i.h.getLogger("Annoto-local-storage"),e||setTimeout((function(){n.logger.warn("Falling back to memcache (unauthorized to use localStorage)")}),0),n}return s(e,t),e}(r.b),l=(function(t){function e(){var e,n=this;try{e=sessionStorage}catch(t){e=null}return(n=t.call(this,e,a.a.storagePrefix)||this).logger=i.h.getLogger("Annoto-session-storage"),e||setTimeout((function(){n.logger.warn("Falling back to memcache (unauthorized to use sessionStorage)")}),0),n}s(e,t)}(r.b),function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a}),u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},p=function(){function t(t){this.storage=t,this.tutorialEn=!0,this.isPrivateMode=!1,this.preferences={notifications:null};var e=this.storage.getSync("preferences");e&&(this.preferences.widgetState=e.widgetState),this.logger=i.h.getLogger("Annoto-user-settings")}return Object.defineProperty(t.prototype,"hasEmail",{get:function(){return Boolean(this.preferences.notifications&&this.preferences.notifications.email)},enumerable:!1,configurable:!0}),t.prototype.cacheLocalPreferences=function(){var t=this;return this.storage.set("preferences",this.preferences).catch((function(e){t.logger.warn(e)}))},t.prototype.setPrivateMode=function(t){t!==this.isPrivateMode&&(this.isPrivateMode=t)},t.prototype.setNotificationsPreferences=function(t){this.preferences.notifications=t},l([Object(i.p)("preferences.notifications","preferences.notifications.email"),u("design:type",Boolean),u("design:paramtypes",[])],t.prototype,"hasEmail",null),t=l([Object(i.t)(c),u("design:paramtypes",[c])],t)}()},97:function(t,e,n){"use strict";function o(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2F;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#96;")}function i(t){return t.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#x2F;/g,"/").replace(/&#x5C;/g,"\\").replace(/&#96;/g,"`")}n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return i}))},98:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var o=function(){function t(){}return t.prototype.getDialogContainer=function(){throw new Error("DialogRenderer must implement getDialogContainer().")},t.prototype.showDialog=function(t){throw new Error("DialogRenderer must implement showDialog().")},t.prototype.hideDialog=function(t){throw new Error("DialogRenderer must implement hideDialog().")},t}()},99:function(t,e,n){"use strict";function o(t,e,n){return"function"==typeof t[e]?new Promise((function(o){o(t[e](n))})).then((function(t){return null==t||t})):Promise.resolve(!0)}n.d(e,"a",(function(){return o}))},"annoto-app":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoApp",(function(){return _}));var o=n("aurelia-framework"),i=n("aurelia-templating-resources"),r=n(34),a=n(21),s=n(31),c=n(155),l=n(79),u=n(66),p=n(29),d=n("aurelia-event-aggregator"),h=n(49),m=n(59),f=n(264),g=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,i++)o[i]=r[a];return o},b=function(){function t(){}return t.prototype.debug=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];console.debug.apply(console,g(["DEBUG ("+this.timestamp+") ["+t.id+"]"],e))},t.prototype.info=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];console.info.apply(console,g(["INFO ("+this.timestamp+") ["+t.id+"]"],e))},t.prototype.warn=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];console.warn.apply(console,g(["WARN ("+this.timestamp+") ["+t.id+"]"],e))},t.prototype.error=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];console.error.apply(console,g(["ERROR ("+this.timestamp+") ["+t.id+"]"],e))},Object.defineProperty(t.prototype,"timestamp",{get:function(){return Object(f.a)(new Date,"HH:mm:ss.SSS")},enumerable:!1,configurable:!0}),t}(),y=n("app-common/index"),v=(n(0),function(){function t(t,e,n){this.common=t,this.widgetsContainer=e,this.api=n}return t.prototype.init=function(){var t=this;return this.api.host?this.common.composer.compose({viewModel:"organs/widget/nn-widget",tagName:"nn-widget",host:this.api.host,container:this.common.container,model:this.api}).then((function(e){t.controller=e})):this.common.composer.compose({viewModel:"organs/widget/nn-widget-overlay",tagName:"nn-widget-overlay",host:this.widgetsContainer,container:this.common.container,model:this.api}).then((function(e){t.controller=e}))},t.prototype.dispose=function(){var t=this;return Promise.resolve().then((function(){t.controller&&(t.common.composer.decompose(t.controller),t.controller=null)}))},t.prototype.reload=function(t,e){return this.api=t,this.api._init(e),this.api.reload()},t}()),w=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},O=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},_=function(){function t(t,e,n,i,r,s,c,l,u){var p=this;this.aurelia=e,this.common=s,this.ready=!1,this.starting=!1,this.widgets=[],this.logger=o.h.getLogger("Annoto-app"),this.serviceInitializer=c,this.bindingEngine=n,this.signaler=i,this.eventAggregator=r,this.bootstrap=t,o.h.addAppender(new b),t.developmentLogging?o.h.setLevel(o.h.logLevel.debug):o.h.setLevel(o.h.logLevel.warn),this.parser=l,this.analytics=c.analytics,this.platform=u,t.api instanceof a.a?this._start():this.apiDisposable=this.bindingEngine.propertyObserver(this.bootstrap,"api").subscribe((function(){return p._apiChanged()}))}return t.prototype.close=function(t,e){var n=this;return void 0===t&&(t=0),this.logger.info("closing widget number: "+t),this.cbOrPromiseReturn(this.getWidgetByIndex(0).catch((function(){return null})).then((function(e){if(e)return e.api.close().then((function(){return e.dispose()})).then((function(){n.widgets.splice(t,1),n.logger.info("closed widget number: "+t)}));n.logger.warn("(close) widget number: "+t+" does not exist")})),e)},t.prototype.load=function(t,e){var n,o=this;if(this.logger.info("reloading application"),!this.ready){this.logger.error("unable to reload. application not ready.");var i=new r.a("unable to reload. application not ready.");return"function"==typeof e&&e(i),Promise.reject(i)}return this._parseConfig(t).then((function(t){o.logger.debug("parsed new configuration"),n=t})).then((function(){return o.serviceInitializer.applyApiConfig(n),Object(p.p)()})).then((function(){return o.serviceInitializer.applyPrivateModeSetting(),Object(p.p)()})).then((function(){o.logger.info("loading widgets");var t,e=n.widgets,i=o.widgets,r=[];for(t=0;t<Math.min(e.length,i.length);++t){var a=i[t].api._widget;a&&r.push(i[t].reload(c.b.toWidgetAPI(n,e[t]),a))}return Promise.all(r).then((function(r){o.logger.debug("attaching new widgets");for(var a=[];t<e.length;++t){var s=c.b.toWidgetAPI(n,e[t]);s.index=t;var l=new v(o.common,o.widgetsContainerElement,s);i.push(l),a.push(l.init())}for(;t<i.length;)a.push(i[t].dispose()),i.pop();return Promise.all(a)}))})).then((function(){o.logger.info("loaded new configuration"),"function"==typeof e&&e(null)})).catch((function(t){if(o.logger.error("unable to load new configuration ",t),"function"!=typeof e)throw t;e(t)}))},t.prototype.auth=function(t,e){var n=this;return this.logger.info("SSO Auth"),this.cbOrPromiseReturn(Promise.resolve().then((function(){if(!n.ready){var e=new r.a("unable to authenticate user. application not ready.");return Promise.reject(e)}return n.user.authenticateSSO(t)})),e)},t.prototype.logout=function(t){var e=this;return this.logger.info("User Logout"),this.cbOrPromiseReturn(Promise.resolve().then((function(){if(!e.ready){var t=new r.a("unable to logout user. application not ready.");return Promise.reject(t)}return e.user.logout()})),t)},t.prototype.registerDeviceDetector=function(t,e){var n=this;return this.cbOrPromiseReturn(Promise.resolve().then((function(){return n.platform.registerDetector(t)})),e)},t.prototype.registerOriginProvider=function(t,e){return this.cbOrPromiseReturn(Promise.resolve().then((function(){return m.a.setOriginPoriver(t)})),e)},t.prototype.appendAppContainerAsChildOf=function(t){t.appendChild(this.appContainerEl)},t.prototype.appendAppContainerElToDefaultParent=function(){this.common.appElement.getOriginalParent().appendChild(this.appContainerEl)},t.prototype.show=function(t){return this.cbOrPromiseReturn(this.getWidgetByIndex(0).then((function(t){return t.api.show()})),t)},t.prototype.hide=function(t){return this.cbOrPromiseReturn(this.getWidgetByIndex(0).then((function(t){return t.api.hide()})),t)},t.prototype.getMetadata=function(){var t={comments:{},thread:{}};if(!this.widgets[0])return t;var e=this.widgets[0].api.getMetadata();return e?(t.thread=e.thread,t.comments=e.comments,t.notes=e.notes,t.visible=e.visible,JSON.parse(JSON.stringify(t))):t},Object.defineProperty(t.prototype,"user",{get:function(){return this.serviceInitializer.user},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appContainerEl",{get:function(){return this.common.appElement.get()},enumerable:!1,configurable:!0}),t.prototype.cbOrPromiseReturn=function(t,e){var n=this;return t.then((function(){"function"==typeof e&&e(null)})).catch((function(t){if(n.logger.error("operation error: ",t),"function"!=typeof e)throw t;e(t)}))},t.prototype.getWidgetByIndex=function(t){if(!this.ready||this.widgets.length<t+1){var e=new r.a("widget number: "+t+" does not exist");return Promise.reject(e)}return Promise.resolve(this.widgets[t])},t.prototype._apiChanged=function(){this.bootstrap.api instanceof a.a&&this._start()},t.prototype._start=function(){var t=this;if(this.starting)this.logger.warn("Already started");else if(this.ready)this.logger.warn("Already running");else{this._initListeners(),this.apiDisposable&&(this.apiDisposable.dispose(),this.apiDisposable=null);var e=this.bootstrap;this.api=e.api;var n=this.api;this.starting=!0,this._parseConfig(n.config).then((function(o){return t.config=o,n._app=t,t.serviceInitializer.init({app:t,demoMode:o.demoMode,clientId:o.clientId,locale:o.locale,launchSource:o.launchSource,apiConfig:o,getAnalyticsClient:function(){return e.analyticsClient()},getDBAElement:function(){return t.bootstrap.dbaAppEl}})})).then((function(){return t.ready=!0,Object(p.p)()})).then((function(){return t.logger.info("Started"),t._applyConfig(),t._publishToAPI("ready",n),Object(p.p)()})).then((function(){var e=new o.e(t.aurelia);return t.serviceInitializer.settings.ctaEnabled&&e.feature("cta/index"),t.serviceInitializer.settings.timelineEnabled&&e.feature("timeline/index"),t.serviceInitializer.settings.statsEnabled&&e.feature("stats/index"),e.apply()})).catch((function(e){t.logger.error("Start: ",e)}))}},t.prototype._parseConfig=function(t){return this.parser.parseConfig(t)},t.prototype._applyConfig=function(){for(var t=this.config,e=[],n=0;n<t.widgets.length;n++){var o=c.b.toWidgetAPI(t,t.widgets[n]);o.index=n;var i=new v(this.common,this.widgetsContainerElement,o);this.widgets.push(i),e.push(i.init())}return Promise.all(e)},t.prototype._initListeners=function(){var t=this,e=document.getElementById("annoto-app"),n=document.getElementById("annoto-app-default");this.eventAggregator.subscribe(s.a.PLAYER_FULL_SCREEN_CHANGE,(function(o){var i=o.data?t.serviceInitializer.settings.fsZIndex:t.serviceInitializer.settings.zIndex;e&&(e.style.zIndex=i.toString()),n&&(n.style.zIndex=i.toString())}));var o=this.getMetadata();this.eventAggregator.subscribe(s.a.METADATA_CHANGE,(function(){var e=t.getMetadata(),n=!1;o.thread.rating==e.thread.rating&&o.thread.ratingDiff===e.thread.ratingDiff||(n=!0);var i=o.visible||{},r=e.visible||{};i.count!==r.count&&(n=!0);var a=o.notes||{},s=e.notes||{};a.count!==s.count&&(n=!0),o=e,n&&t._publishToAPI("metadata",o)})),this.eventAggregator.subscribe(s.a.UX_EVENT,(function(e){var n={name:e.name};setTimeout((function(){t._publishToAPI("ux",n)}),0)})),this.eventAggregator.subscribe(s.a.STATS_EVENT,(function(e){t._publishToAPI("stats_events",e)})),this.eventAggregator.subscribe(s.a.VIDEO_BENCHMARK_EVENT,(function(e){t._publishToAPI("video_benchmark",e)})),this.eventAggregator.subscribe(s.a.USER_AUTH_CHANGE,(function(){t.signaler.signal("annoto-auth-update")})),this.eventAggregator.subscribe(s.a.USER_PERMISSIONS_CHANGE,(function(){t.signaler.signal("annoto-auth-update")}))},t.prototype._publishToAPI=function(t,e){this.api&&this.api.pubSub&&this.api.pubSub.publish(t,e)},w([Object(o.p)("serviceInitializer.user"),O("design:type",h.a),O("design:paramtypes",[])],t.prototype,"user",null),t=w([Object(o.t)("AnnotoBootstrap",o.Aurelia,o.b,i.BindingSignaler,d.EventAggregator,y.AppCommon,l.a,c.b,u.a),O("design:paramtypes",[Object,o.Aurelia,o.b,i.BindingSignaler,d.EventAggregator,y.AppCommon,l.a,c.b,u.a])],t)}()},"annoto-app.html":function(t,e,n){t.exports='<template>\n    <require from="./css/annoto-app.scss"></require>\n    <require from="./organs/widget/nn-widget"></require>\n\n    <div if.bind="ready" ref="widgetsContainerElement">\n    </div>\n</template>\n'},"app-common/index":function(t,e,n){"use strict";n.r(e),n.d(e,"configure",(function(){return l})),n.d(e,"WidgetsSet",(function(){return u})),n.d(e,"TimelinesSet",(function(){return p})),n.d(e,"AppElement",(function(){return d})),n.d(e,"AppCommon",(function(){return h}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(31),a=n(62),s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};function l(t){t.container.registerSingleton(h)}var u=function(){function t(t){var e=this;this.eventAggregator=t,this.set=new Set,this.eventAggregator.subscribe(r.a.WIDGET_ATTACHED,(function(t){e.set.add(t)})),this.eventAggregator.subscribe(r.a.WIDGET_DETACHED,(function(t){e.set.delete(t)}))}return t=s([Object(o.t)(i.EventAggregator),c("design:paramtypes",[i.EventAggregator])],t)}(),p=function(){function t(t){var e=this;this.eventAggregator=t,this.set=new Set,this.eventAggregator.subscribe(r.a.TIMELINE_ATTACHED,(function(t){e.set.add(t)})),this.eventAggregator.subscribe(r.a.TIMELINE_DETTACHED,(function(t){e.set.delete(t)}))}return t=s([Object(o.t)(i.EventAggregator),c("design:paramtypes",[i.EventAggregator])],t)}(),d=function(){function t(t){this.bootstrap=t}return t.prototype.get=function(){return this.bootstrap.appContainerEl},t.prototype.getOriginalParent=function(){return this.bootstrap.appContainerElParent},t.prototype.getParent=function(){return this.get().parentElement},t=s([Object(o.t)("AnnotoBootstrap"),c("design:paramtypes",[Object])],t)}(),h=function(){function t(t,e,n,o,i){this.container=t,this.composer=e,this.widgets=n,this.appElement=i}return t=s([Object(o.t)(o.c,a.a,u,p,d),c("design:paramtypes",[o.c,a.a,u,p,d])],t)}()},"async!components/index":function(t,e,n){t.exports=function(t){Promise.all([n.e(46),n.e(4)]).then(function(e){t(n(228))}.bind(null,n)).catch(n.oe)}},"async!cta/index":function(t,e,n){t.exports=function(t){n.e(5).then(function(e){t(n(243))}.bind(null,n)).catch(n.oe)}},"async!locales/ar/translation.json":function(t,e,n){t.exports=function(t){n.e(7).then(function(e){t(n(227))}.bind(null,n)).catch(n.oe)}},"async!locales/cs/translation.json":function(t,e,n){t.exports=function(t){n.e(8).then(function(e){t(n(209))}.bind(null,n)).catch(n.oe)}},"async!locales/da/translation.json":function(t,e,n){t.exports=function(t){n.e(9).then(function(e){t(n(210))}.bind(null,n)).catch(n.oe)}},"async!locales/de/translation.json":function(t,e,n){t.exports=function(t){n.e(10).then(function(e){t(n(211))}.bind(null,n)).catch(n.oe)}},"async!locales/es/translation.json":function(t,e,n){t.exports=function(t){n.e(11).then(function(e){t(n(212))}.bind(null,n)).catch(n.oe)}},"async!locales/fr/translation.json":function(t,e,n){t.exports=function(t){n.e(12).then(function(e){t(n(213))}.bind(null,n)).catch(n.oe)}},"async!locales/he/translation.json":function(t,e,n){t.exports=function(t){n.e(13).then(function(e){t(n(208))}.bind(null,n)).catch(n.oe)}},"async!locales/hi/translation.json":function(t,e,n){t.exports=function(t){n.e(14).then(function(e){t(n(214))}.bind(null,n)).catch(n.oe)}},"async!locales/it/translation.json":function(t,e,n){t.exports=function(t){n.e(15).then(function(e){t(n(215))}.bind(null,n)).catch(n.oe)}},"async!locales/ja/translation.json":function(t,e,n){t.exports=function(t){n.e(16).then(function(e){t(n(216))}.bind(null,n)).catch(n.oe)}},"async!locales/ko/translation.json":function(t,e,n){t.exports=function(t){n.e(17).then(function(e){t(n(217))}.bind(null,n)).catch(n.oe)}},"async!locales/nl/translation.json":function(t,e,n){t.exports=function(t){n.e(18).then(function(e){t(n(218))}.bind(null,n)).catch(n.oe)}},"async!locales/no/translation.json":function(t,e,n){t.exports=function(t){n.e(19).then(function(e){t(n(219))}.bind(null,n)).catch(n.oe)}},"async!locales/pl/translation.json":function(t,e,n){t.exports=function(t){n.e(20).then(function(e){t(n(220))}.bind(null,n)).catch(n.oe)}},"async!locales/pt/translation.json":function(t,e,n){t.exports=function(t){n.e(21).then(function(e){t(n(221))}.bind(null,n)).catch(n.oe)}},"async!locales/ru/translation.json":function(t,e,n){t.exports=function(t){n.e(22).then(function(e){t(n(222))}.bind(null,n)).catch(n.oe)}},"async!locales/sv/translation.json":function(t,e,n){t.exports=function(t){n.e(23).then(function(e){t(n(223))}.bind(null,n)).catch(n.oe)}},"async!locales/tr/translation.json":function(t,e,n){t.exports=function(t){n.e(24).then(function(e){t(n(224))}.bind(null,n)).catch(n.oe)}},"async!locales/ua/translation.json":function(t,e,n){t.exports=function(t){n.e(25).then(function(e){t(n(225))}.bind(null,n)).catch(n.oe)}},"async!locales/zh/translation.json":function(t,e,n){t.exports=function(t){n.e(26).then(function(e){t(n(226))}.bind(null,n)).catch(n.oe)}},"async!stats/index":function(t,e,n){t.exports=function(t){n.e(43).then(function(e){t(n(245))}.bind(null,n)).catch(n.oe)}},"async!timeline/index":function(t,e,n){t.exports=function(t){Promise.all([n.e(47),n.e(44)]).then(function(e){t(n(244))}.bind(null,n)).catch(n.oe)}},"auth/index":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoAuthService",(function(){return a})),n.d(e,"configure",(function(){return S}));var o,i="AnnotoAuthService must implement",r="AnnotoAuthService does not support",a=function(){function t(){}return t.prototype.setupEndpoints=function(t,e){throw new Error(i+" setupEndpoints")},t.prototype.init=function(){throw new Error(i+" init")},t.prototype.initSSO=function(){throw new Error(i+" initSSO")},Object.defineProperty(t.prototype,"hostAuthenticated",{get:function(){throw new Error(i+" hostAuthenticated")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authenticated",{get:function(){throw new Error(i+" authenticated")},enumerable:!1,configurable:!0}),t.prototype.getToken=function(){throw new Error(i+" getToken")},Object.defineProperty(t.prototype,"ready",{get:function(){throw new Error(i+" ready")},enumerable:!1,configurable:!0}),t.prototype.getUserCredentials=function(){throw new Error(i+" getUserCredentials")},t.prototype.getUserToken=function(){throw new Error(i+" getUserToken")},t.prototype.logout=function(t){return void 0===t&&(t=!1),Promise.reject(new Error(i+" logout"))},t.prototype.postFollowingGroup=function(t,e){return Promise.reject(new Error(i+" postFollowingGroup"))},t.prototype.postFollowingThread=function(t,e){return Promise.reject(new Error(i+" postFollowingThread"))},t.prototype.postFollowingComment=function(t,e,n){return Promise.reject(new Error(i+" postFollowingComment"))},t.prototype.patchNotificationsPreference=function(t,e){return Promise.reject(new Error(i+" patchNotificationsPreference"))},t.prototype.getPreferencesForThread=function(t,e){return Promise.reject(new Error(i+" getPreferencesForThread"))},t.prototype.login=function(t){return Promise.reject(new Error(r+" login"))},t.prototype.authenticate=function(t){return Promise.reject(new Error(r+" authenticate"))},t.prototype.signup=function(t){return Promise.reject(new Error(r+" signup"))},t.prototype.authenticateSSO=function(t){return Promise.reject(new Error(r+" authenticateSSO"))},Object.defineProperty(t.prototype,"ssoId",{get:function(){},enumerable:!1,configurable:!0}),t.prototype.anonymousLogin=function(t){return Promise.reject(new Error(r+" login"))},t.prototype.anonymousSignup=function(t){return Promise.reject(new Error(r+" signup"))},t}(),s=n("aurelia-framework"),c=n("aurelia-authentication"),l=n(11),u={endpoint:"root",configureEndpoints:[],globalValueConverters:[],storage:"annotoAuthStorage",loginRoute:"#/",signupRedirect:"#/",logoutRedirect:"",storageKey:"nn_user_session",accessTokenProp:"access_token",expiredReload:0,storageChangedReload:0,providers:{google:{url:"/auth/google",redirectUri:l.e.ENV.AUTH_URL+"/auth/google",requiredUrlParams:["scope"],scope:["profile","email"],display:"popup",popupOptions:{width:452,height:633},clientId:l.e.ENV.AUTH.GOOGLE_CLIENT_ID,optionalUrlParams:["display","state"],state:location.origin},facebook:{name:"facebook",url:"/auth/facebook",redirectUri:l.e.ENV.AUTH_URL+"/auth/facebook",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",popupOptions:{width:580,height:400},clientId:l.e.ENV.AUTH.FACEBOOK_CLIENT_ID,optionalUrlParams:["state"],state:location.origin}}},p=n(80),d=n(34),h=n(50),m=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),f=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},g=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},b=function(t){function e(e,n){var o=t.call(this)||this;return o.settings=n,o._ready=!1,o.logger=s.h.getLogger("Annoto-auth-service"),o.getHostService=e,o}return m(e,t),e.prototype.setupEndpoints=function(t,e){this._ready=!0,this.hostService=this.getHostService(),this.rest=t},e.prototype.init=function(){this.throwIfNotReady();var t=this.getUserToken(),e=this.settings.hostSettings&&this.settings.hostSettings.enableAnonymous;return this.authenticated&&t&&t.anonymous&&!e?this.logout():Promise.resolve()},Object.defineProperty(e.prototype,"ready",{get:function(){return this._ready},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostAuthenticated",{get:function(){return Boolean(this.hostService&&this.hostService.authenticated)},enumerable:!1,configurable:!0}),e.prototype.getUserCredentials=function(){var t=this.getUserToken();if(t)return{id:t.sub,name:t.name,photoUrl:t.photo_url,parentId:t.parent_id,anonymous:t.anonymous}},e.prototype.postFollowingGroup=function(t,e){return this.throwIfNotReady(),this.hostAuthAndPost("/me/following/groups/"+t,{following:e})},e.prototype.postFollowingThread=function(t,e){return this.throwIfNotReady(),this.hostAuthAndPost("/me/following/threads/"+t,{following:e})},e.prototype.postFollowingComment=function(t,e,n){return this.throwIfNotReady(),this.hostAuthAndPost("/me/following/threads/"+t+"/comments/"+e,{following:n})},e.prototype.getPreferencesForThread=function(t,e){return this.throwIfNotReady(),this.hostAuthAndGet("/me/preferences/threads/"+t,e?{group_id:e}:void 0)},e.prototype.patchNotificationsPreference=function(t,e){return this.throwIfNotReady(),this.hostAuthAndPatch("/me/notifications",t,{state:e})},e.prototype.postLogoutHandle=function(t){var e=this;return t||"function"!=typeof this.settings.ux.logoutRequestHandle?Promise.resolve():Promise.resolve().then((function(){return e.settings.ux.logoutRequestHandle()})).then((function(){e.logger.info("logoutRequestHandle done")}))},e.prototype.throwIfNotReady=function(){if(!this._ready)throw new d.a(d.b.AUTH.NOT_INIT,"AnnotoAuthService is not setup")},e.prototype.hostAuthAndGet=function(t,e,n){var o=this,i=e||{};return this.hostService.isAuthenticated()?this.rest.find(t,i,n):this.hostService.authenticate().then((function(e){if(e)return o.rest.find(t,i,n);throw new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized")}))},e.prototype.hostAuthAndPost=function(t,e,n){var o=this;return this.hostService.isAuthenticated()?this.rest.post(t,e,n):this.hostService.authenticate().then((function(i){if(i)return o.rest.post(t,e,n);throw new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized")}))},e.prototype.hostAuthAndPatch=function(t,e,n,o){var i=this;return this.hostService.isAuthenticated()?this.rest.patch(t,e,n,o):this.hostService.authenticate().then((function(r){if(r)return i.rest.patch(t,e,n,o);throw new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized")}))},f([Object(s.p)("_ready"),g("design:type",Boolean),g("design:paramtypes",[])],e.prototype,"ready",null),f([Object(s.p)("hostService","hostService.authenticated"),g("design:type",Boolean),g("design:paramtypes",[])],e.prototype,"hostAuthenticated",null),e=f([Object(s.t)(s.f.of(p.a),h.a),g("design:paramtypes",[Object,h.a])],e)}(a),y=n(154),v=n(29),w=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),O=function(){return(O=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},_=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},x=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};var E=function(t){function e(e,n,o,i,r){var a=t.call(this,e,n)||this;return a.settings=n,a.authService=o,a.fetchConfig=i,a.baseConfig=r,a}return w(e,t),e.prototype.setupEndpoints=function(e,n){t.prototype.setupEndpoints.call(this,e,n),this.authService.config.client=e,this.authService.config.configure(O(O({},u),{configureEndpoints:n})),this.authService.authentication.responseAnalyzed=!1,this.authService.getAccessToken(),this.authService.updateAuthenticated(),this.fetchConfig.configure(n)},e.prototype.initSSO=function(){s.j.removeEventListener("storage",this.authService.storageEventHandler);var t=s.j.global[u.storage],e=this.getUserToken(),n=this.settings.hostSettings&&this.settings.hostSettings.enableAnonymous,o=n&&e&&e.anonymous&&t;if(n&&(this.annonStorage=t),!(s.j.global[u.storage]instanceof y.a)&&(s.j.global[u.storage]=new y.a,o))try{s.j.global[u.storage].setItem(u.storageKey,t.getItem(u.storageKey))}catch(t){}return o||this.authService.setResponseObject(null),Object(v.c)(0)},Object.defineProperty(e.prototype,"authenticated",{get:function(){return this.authService.authenticated},enumerable:!1,configurable:!0}),e.prototype.getToken=function(){return this.authService.getAccessToken()},e.prototype.logout=function(t){var e=this;return void 0===t&&(t=!1),this.throwIfNotReady(),this.hostAuthAndCall("logout","").then((function(){return e.postLogoutHandle(t)})).then((function(){try{var t=e.annonStorage;e.annonStorage&&t!==s.j.global[u.storage]&&t.removeItem(u.storageKey)}catch(t){}}))},e.prototype.login=function(t){this.throwIfNotReady();var e=t||{};return this.hostAuthAndCall("login",e,[],"")},e.prototype.authenticate=function(t){return this.throwIfNotReady(),this.hostAuthAndCall("authenticate",t,"")},e.prototype.signup=function(t){this.throwIfNotReady();var e=t||{};return this.hostAuthAndCall("signup",e,[],"")},e.prototype.authenticateSSO=function(t){var e=this;return this.throwIfNotReady(),this.hostAuthAndPost("/auth/sso",{token:t}).then((function(t){return e._ssoId=t.sso_id,e.setToken(t[u.accessTokenProp])}))},Object.defineProperty(e.prototype,"ssoId",{get:function(){return this._ssoId},enumerable:!1,configurable:!0}),e.prototype.anonymousLogin=function(t){var e=this;return this.throwIfNotReady(),this.hostAuthAndPost("/auth/anonymous_login",t).then((function(t){return e.setToken(t[u.accessTokenProp])})).then((function(){e.anonymousAfterAuth()}))},e.prototype.anonymousSignup=function(t){var e=this;return this.throwIfNotReady(),this.hostAuthAndPost("/auth/anonymous_signup",t).then((function(t){return e.setToken(t[u.accessTokenProp])})).then((function(){e.anonymousAfterAuth()}))},e.prototype.anonymousAfterAuth=function(){var t;try{var e=this.annonStorage;e&&e!==s.j.global[u.storage]&&e.setItem(u.storageKey,JSON.stringify(((t={})[u.accessTokenProp]=this.authService.getAccessToken(),t)))}catch(t){}},e.prototype.getUserToken=function(){return this.authService.getTokenPayload()},e.prototype.setToken=function(t){var e;return this.authService.setResponseObject(((e={})[u.accessTokenProp]=t,e))},e.prototype.hostAuthAndCall=function(t){for(var e,n=this,o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return this.hostService.isAuthenticated()?(e=this.authService)[t].apply(e,o):this.hostService.authenticate().then((function(e){var i;if(e)return(i=n.authService)[t].apply(i,o);throw new d.a(d.b.HOST.UNAUTHORIZED,"host not authorized")}))},_([Object(s.p)("authService.authenticated"),x("design:type",Boolean),x("design:paramtypes",[])],e.prototype,"authenticated",null),e=_([Object(s.t)(s.f.of(p.a),h.a,c.AuthService,c.FetchConfig,c.BaseConfig),x("design:paramtypes",[Object,h.a,c.AuthService,c.FetchConfig,c.BaseConfig])],e)}(b);function S(t){t.singleton(a,E),function(t){var e;try{e=localStorage}catch(t){e=new y.a}u.storage&&-1!==u.storage.indexOf("annoto")&&(s.j.global[u.storage]=e),t.plugin("aurelia-authentication",(function(t){t.configure(O(O({},u),{endpoint:null,configureEndpoints:[]}))}))}(t)}},"bb/index":function(t,e,n){"use strict";n.r(e),n.d(e,"configure",(function(){return o}));n("aurelia-framework");function o(t){t.globalResources(["./scroll-direction"])}},"bb/scroll-direction":function(t,e,n){"use strict";function o(t){var e=this.scrollDirectioState,n=e.target,o=Boolean(n.scrollTop+n.offsetHeight>=n.scrollHeight),i=0===n.scrollTop;if(n.scrollTop>e.scrollTop&&e.detected>-1)e.detected=-1,e.scrollTop=e.target.scrollTop,e.atBottom=o,e.atTop=i,t.scrollDirection="down",t.scrollDirectionChanged=!0,t.scrollAtBottom=o,t.scrollAtTop=i,e.rawHandler&&e.rawHandler.call(this.source.bindingContext,t),this.scrollDirectionMethod(t);else if(n.scrollTop<e.scrollTop&&e.detected<1)e.detected=1,e.scrollTop=n.scrollTop,e.atBottom=o,e.atTop=i,t.scrollDirection="up",t.scrollDirectionChanged=!0,t.scrollAtBottom=o,t.scrollAtTop=i,e.rawHandler&&e.rawHandler.call(this.source.bindingContext,t),this.scrollDirectionMethod(t);else{if(e.scrollTop=n.scrollTop,t.scrollDirectionChanged=!1,t.scrollDirection=e.detected>0?"up":"down",t.scrollAtBottom=o,t.scrollAtTop=i,e.rawHandler&&e.rawHandler.call(this.source.bindingContext,t),e.atBottom===o&&e.atTop===i)return;e.atBottom=o,e.atTop=i,this.scrollDirectionMethod(t)}}n.r(e),n.d(e,"ScrollDirectionBindingBehavior",(function(){return i}));var i=function(){function t(){}return t.prototype.bind=function(t,e,n){if(t.callSource&&"scroll"===t.targetEvent){t.scrollDirectionMethod=t.callSource,t.callSource=o;var i=t.target,r={rawHandler:n,scrollTop:i.scrollTop,detected:0,target:i,atBottom:!1,atTop:!1};t.scrollDirectioState=r}},t.prototype.unbind=function(t,e){t.callSource=t.scrollDirectionMethod,t.scrollDirectionMethod=null,t.scrollDirectioState=null},t}()},"components/accessability/nn-focusable":function(t,e,n){"use strict";n.r(e),n.d(e,"Focusable",(function(){return l}));var o=n("aurelia-framework"),i=n(43),r=function(){return(r=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,i++)o[i]=r[a];return o},l=function(){function t(t){this.element=t,this.index=0,this.onFocus=function(){},this.onBlur=function(){},this.disposables=[]}var e;return e=t,t.prototype.bind=function(){var t=this;this.element.classList.add("nn-focusable"),this.labelChanged(),this.disabledChanged(),this.indexChanged(),this.disposables.push(Object(i.a)(this.element,"keyup",(function(e){if(e.target===t.element&&Object(i.e)(e,"tab")){var n=t.element.classList.contains("nn-focused");t.element.classList.add("nn-focused"),n||t.onFocus()}}))),this.disposables.push(Object(i.a)(this.element,"blur",(function(){var e=t.element.classList.contains("nn-focused");t.element.classList.remove("nn-focused"),e&&t.onBlur()})))},t.prototype.unbind=function(){this.element.classList.remove("nn-focusable"),Object(i.b)(this.disposables),this.disposables=[],this.clear()},t.getFocusableElsIn=function(t,e){void 0===e&&(e=[]);var n="[nn-focusable]";return e.forEach((function(t){n=n+":not("+t+")"})),t.querySelectorAll(n)},t.setFocusOnEl=function(t){var e=t;return e&&e.au&&e.au["nn-focusable"]&&e.au["nn-focusable"].viewModel?(e.au["nn-focusable"].viewModel.setFocus(),!0):(e&&e.focus&&e.focus(),!1)},t.clearFocusFromEl=function(t){var e=t;return e&&e.au&&e.au["nn-focusable"]&&e.au["nn-focusable"].viewModel?(e.au["nn-focusable"].viewModel.clearFocus(),!0):(e&&e.blur&&e.blur(),!1)},t.setFocusOnFirstChildOf=function(t,n){void 0===n&&(n={});var o=e.getFocusableElsIn(t,n.filter);return e.setFocusOnEl(o[0])},t.setFocusOnLastChildOf=function(t,n){void 0===n&&(n={});var o=e.getFocusableElsIn(t,n.filter);return 0!==o.length&&e.setFocusOnEl(o[o.length-1])},t.focusTrap=function(t,n,o){void 0===o&&(o={});var r=function(n){if(!e.setFocusOnEl(n))return!0;t.preventDefault()};if(Object(i.e)(t,"tab")){var a=e.getFocusableElsIn(n,o.filter);if(t.shiftKey){if(t.target===a[0]||n===t.target||!n.contains(t.target))return r(a[a.length-1])}else if(t.target===a[a.length-1]||n===t.target||!n.contains(t.target))return r(a[0])}return!0},t.clearFocusFromChildrenOf=function(t){for(var n=e.getFocusableElsIn(t),o=0;o<n.length;o++)e.clearFocusFromEl(n[o])},t.getActiveIndex=function(t){for(var e=-1,n=0;n<t.length;n++)if(t[n].classList.contains("nn-focused")){e=n;break}return e},t.keyNav=function(t,n,o){var a=r({},o),s=e.getFocusableElsIn(n,c(["[disabled]"],a.filter));if(0===s.length)return{children:s,index:-1};var l=e.getActiveIndex(s),u=l,p=Object(i.e)(t,"up"),d=Object(i.e)(t,"down"),h=Object(i.e)(t,"home"),m=Object(i.e)(t,"end");if(p||d||h||m){e.clearFocusFromChildrenOf(n);var f=void 0,g=!1;if(d)(b=s[u=l+1])||(a.wrap?(g=!0,b=s[u=0]):b=s[u=s.length-1]),e.setFocusOnEl(b),f="down";else if(p){var b;(b=s[u=l-1])||(a.wrap?(b=s[u=s.length-1],g=!0):b=s[u=0]),e.setFocusOnEl(b),f="up"}else h?(u=0,e.setFocusOnEl(s[u]),f="home"):m&&(u=s.length-1,e.setFocusOnEl(s[u]),f="end");return{children:s,index:u,nav:f,wrapped:g}}return{children:s,index:u}},t.prototype.setFocus=function(){this.styleOnly||this.element.focus(),this.element.classList.add("nn-focused")},t.prototype.clearFocus=function(){this.styleOnly||this.element.blur(),this.element.classList.remove("nn-focused")},t.prototype.disabledChanged=function(){this.disabled?this.element.setAttribute("aria-disabled","true"):this.element.setAttribute("aria-disabled","false")},t.prototype.indexChanged=function(){this.element.setAttribute("tabindex",(this.index||0).toString())},t.prototype.labelChanged=function(){this.label?this.element.setAttribute("aria-label",this.label):this.element.removeAttribute("aria-label")},t.prototype.clear=function(){this.element.classList.remove("nn-focused"),this.element.removeAttribute("tabindex")},a([Object(o.m)(),s("design:type",Boolean)],t.prototype,"disabled",void 0),a([Object(o.m)(),s("design:type",Number)],t.prototype,"index",void 0),a([Object(o.m)({primaryProperty:!0}),s("design:type",String)],t.prototype,"label",void 0),a([Object(o.m)(),s("design:type",Boolean)],t.prototype,"styleOnly",void 0),a([Object(o.m)(),s("design:type",Function)],t.prototype,"onFocus",void 0),a([Object(o.m)(),s("design:type",Function)],t.prototype,"onBlur",void 0),t=e=a([Object(o.r)("nn-focusable"),Object(o.t)(o.d.Element),s("design:paramtypes",[HTMLElement])],t)}()},"components/accessability/nn-interaction":function(t,e,n){"use strict";n.r(e),n.d(e,"Interaction",(function(){return s}));var o=n("aurelia-framework"),i=n(43),r=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(){function t(t){this.element=t,this.disposables=[]}return t.prototype.bind=function(){var t=this;this.element.classList.add("nn-interaction"),this.disposables.push(Object(i.a)(this.element,"click",(function(e){t.disabled||(!t.tagfilter||e.target&&t.tagfilter===e.target.tagName)&&"function"==typeof t.click&&(t.click({event:e})||e.preventDefault())}))),this.disposables.push(Object(i.a)(this.element,"keypress",(function(e){t.disabled||e.target!==t.element||(Object(i.e)(e,"enter")?"function"==typeof t.enter&&(t.enter({event:e})||e.preventDefault()):Object(i.e)(e,"space")?"function"==typeof t.space&&(t.space({event:e})||e.preventDefault()):Object(i.e)(e,"tab")?"function"==typeof t.tab&&(t.tab({event:e})||e.preventDefault()):Object(i.e)(e,"esc")&&"function"==typeof t.escape&&(t.escape({event:e})||e.preventDefault()))})))},t.prototype.unbind=function(){this.element.classList.remove("nn-interaction"),Object(i.b)(this.disposables),this.disposables=[]},r([Object(o.m)(),a("design:type",Boolean)],t.prototype,"disabled",void 0),r([Object(o.m)({primaryProperty:!0}),a("design:type",Object)],t.prototype,"click",void 0),r([Object(o.m)(),a("design:type",String)],t.prototype,"tagfilter",void 0),r([Object(o.m)(),a("design:type",Function)],t.prototype,"enter",void 0),r([Object(o.m)(),a("design:type",Function)],t.prototype,"space",void 0),r([Object(o.m)(),a("design:type",Function)],t.prototype,"tab",void 0),r([Object(o.m)(),a("design:type",Function)],t.prototype,"escape",void 0),t=r([Object(o.r)("nn-interaction"),Object(o.t)(o.d.Element),a("design:paramtypes",[HTMLElement])],t)}()},"css/annoto-app.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o),r=n(187),a=n.n(r),s=n(188),c=n(189),l=n(190),u=i()((function(t){return t[1]})),p=a()(s.a),d=a()(c.a),h=a()(l.a,{hash:"#annoto-icons-font"});u.push([t.i,'.annoto .annoto-flex-row-wrap{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row wrap;flex-flow:row wrap}.annoto .annoto-flex-row-nowrap{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap;min-width:0}.annoto .annoto-flex-column-wrap{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column wrap;flex-flow:column wrap}.annoto .annoto-flex-column-nowrap{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;min-height:0}.annoto .annoto-flex-justify-start{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.annoto .annoto-flex-justify-end{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.annoto .annoto-flex-justify-center{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.annoto .annoto-flex-align-center{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.annoto .annoto-flex-spacer{-webkit-box-flex:100;-ms-flex-positive:100;flex-grow:100}.annoto .annoto-shadow-3dp,.annoto-overlay .annoto-shadow-3dp{-webkit-box-shadow:0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.2),0 1px 8px 0 rgba(0,0,0,.12);box-shadow:0 3px 4px 0 rgba(0,0,0,.14),0 3px 3px -2px rgba(0,0,0,.2),0 1px 8px 0 rgba(0,0,0,.12)}.annoto .annoto-shadow-6dp,.annoto-overlay .annoto-shadow-6dp{-webkit-box-shadow:0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12),0 3px 5px -1px rgba(0,0,0,.2);box-shadow:0 6px 10px 0 rgba(0,0,0,.14),0 1px 18px 0 rgba(0,0,0,.12),0 3px 5px -1px rgba(0,0,0,.2)}.annoto .annoto-shadow,.annoto-overlay .annoto-shadow{-webkit-box-shadow:0 2px 2px 0 rgba(144,164,174,.14),0 3px 1px -2px rgba(144,164,174,.2),0 1px 5px 0 rgba(144,164,174,.12);box-shadow:0 2px 2px 0 rgba(144,164,174,.14),0 3px 1px -2px rgba(144,164,174,.2),0 1px 5px 0 rgba(144,164,174,.12)}@font-face{font-family:"annoto-icons-font";src:url('+p+') format("woff"),url('+d+') format("truetype"),url('+h+') format("svg");font-weight:normal;font-style:normal;font-display:block}.annoto-icon{font-family:"annoto-icons-font" !important;speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.annoto-icon-school:before{content:""}.annoto-icon-stars:before{content:""}.annoto-icon-star:before{content:""}.annoto-icon-anonymous:before{content:""}.annoto-icon-notifications_none:before{content:""}.annoto-icon-notifications_active:before{content:""}.annoto-icon-resize_drag:before{content:""}.annoto-icon-block:before{content:""}.annoto-icon-hourglass_empty:before{content:""}.annoto-icon-pin_drop:before{content:""}.annoto-icon-location_on:before{content:""}.annoto-icon-share:before{content:""}.annoto-icon-more_horiz:before{content:""}.annoto-icon-more_vert:before{content:""}.annoto-icon-menu:before{content:""}.annoto-icon-launch:before{content:""}.annoto-icon-arrow_drop_up:before{content:""}.annoto-icon-arrow_drop_down:before{content:""}.annoto-icon-expand_less:before{content:""}.annoto-icon-expand_more:before{content:""}.annoto-icon-arrow_upward:before{content:""}.annoto-icon-arrow_downward:before{content:""}.annoto-icon-remove:before{content:""}.annoto-icon-add:before{content:""}.annoto-icon-add_circle:before{content:""}.annoto-icon-fullscreen:before{content:""}.annoto-icon-fullscreen_exit:before{content:""}.annoto-icon-chat_bubble_o:before{content:""}.annoto-icon-mode_edit:before{content:""}.annoto-icon-delete:before{content:""}.annoto-icon-done:before{content:""}.annoto-icon-settings:before{content:""}.annoto-icon-close:before{content:""}.annoto-icon-send:before{content:""}.annoto-icon-asterisk:before{content:""}.annoto-icon-export:before{content:""}.annoto-icon-exit_arrow:before{content:""}.annoto-icon-file_xlsx:before{content:""}.annoto-icon-file_docx:before{content:""}.annoto-icon-emotion_idea:before{content:""}.annoto-icon-emotion_mark:before{content:""}.annoto-icon-emotion_help:before{content:""}.annoto-icon-emotion_help_buoy:before{content:""}.annoto-icon-emotion_not_ok:before{content:""}.annoto-icon-emotion_ok:before{content:""}.annoto-icon-emotion_smile_o:before{content:""}.annoto-icon-emotion_lol:before{content:""}.annoto-icon-emotion_angry:before{content:""}.annoto-icon-emotion_bored:before{content:""}.annoto-icon-emotion_sad:before{content:""}.annoto-icon-emotion_wow:before{content:""}.annoto-icon-emotion_like:before{content:""}.annoto-icon-emotion_like_o:before{content:""}.annoto-icon-social_facebook:before{content:""}.annoto-icon-social_google_plus:before{content:""}.annoto-icon-social_linkedin:before{content:""}.annoto-icon-social_twitter:before{content:""}.annoto .annoto-icon{font-weight:400;font-style:normal !important;font-size:24px;line-height:1 !important;letter-spacing:normal;text-transform:none;display:inline-block;word-wrap:normal;-webkit-font-feature-settings:"liga";font-feature-settings:"liga";white-space:nowrap;direction:ltr !important}.annoto .annoto-icon{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.annoto .annoto-icon.annoto-14{font-size:14px}.annoto .annoto-icon.annoto-18{font-size:18px}.annoto .annoto-icon.annoto-20{font-size:20px}.annoto .annoto-icon.annoto-24{font-size:24px}.annoto .annoto-icon.annoto-36{font-size:36px}.annoto .annoto-icon.annoto-48{font-size:48px}.annoto .annoto-icon.annoto-dark{color:rgba(0,0,0,.54)}.annoto .annoto-icon.annoto-dark.annoto-inactive{color:rgba(0,0,0,.26)}.annoto .annoto-icon.annoto-light{color:#fff}.annoto .annoto-icon.annoto-light.annoto-inactive{color:rgba(255,255,255,.3)}.annoto.annoto .annoto-icon.annoto-icon{font-family:"annoto-icons-font" !important}.annoto,.annoto-overlay{direction:ltr;text-align:initial;font-size:16px;font-weight:400;line-height:1.25em;color:#000}.annoto div:not(.annoto),.annoto p,.annoto a,.annoto span,.annoto label,.annoto h1,.annoto h2,.annoto h3,.annoto h4,.annoto h5,.annoto h6,.annoto input,.annoto textarea,.annoto button,.annoto-overlay div:not(.annoto),.annoto-overlay p,.annoto-overlay a,.annoto-overlay span,.annoto-overlay label,.annoto-overlay h1,.annoto-overlay h2,.annoto-overlay h3,.annoto-overlay h4,.annoto-overlay h5,.annoto-overlay h6,.annoto-overlay input,.annoto-overlay textarea,.annoto-overlay button{font-family:inherit !important}.annoto .annoto-avatar{-ms-flex-negative:0;flex-shrink:0;margin:0}.annoto .annoto-avatar .annoto-photo{top:0;left:0;width:100%;height:100%;background-repeat:no-repeat;background-size:cover;background-position:center;border-radius:50%;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .nn-nav-link{opacity:1}.annoto.nnc-rtl .nn-nav-link{font-size:16px}.annoto.annoto .nn-aaa-hidden-info.nn-aaa-hidden-info{width:1px !important;height:1px !important;min-width:0 !important;min-height:0 !important;border:0 !important;margin:-1px !important;padding:0 !important;position:absolute !important;clip:rect(0 0 0 0) !important;overflow:hidden !important}@-webkit-keyframes annoto-fade-in{0%{opacity:0}100%{opacity:1}}@keyframes annoto-fade-in{0%{opacity:0}100%{opacity:1}}.annoto-fade-in{-webkit-animation-name:"annoto-fade-in";animation-name:"annoto-fade-in";-webkit-animation-duration:.2s;animation-duration:.2s;-webkit-animation-iteration-count:1;animation-iteration-count:1;-webkit-animation-timing-function:ease-in;animation-timing-function:ease-in;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.annoto{--nnc-bg: transparent;--nnc-bg-color: transparent;font-family:var(--nnc-font-family, Roboto, Helvetica, Arial, sans-serif) !important}.annoto .nnc-color-primary{--nnc-color-base: var(--nnc-color-primary, #ea5451) !important;--nnc-color-contrast: var(--nnc-color-primary-contrast, #ffffff) !important;--nnc-color-shade: var(--nnc-color-primary-shade, #ce4a47) !important;--nnc-color-tint: var(--nnc-color-primary-tint, #ec6562) !important;--nnc-color-base-rgb: var(--nnc-color-primary-rgb, 234, 84, 81) !important;--nnc-color-contrast-rgb: var(--nnc-color-primary-contrast-rgb, 255, 255, 255) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-primary{color:#ea5451}.annoto .nnc-color-primary.nnc-color-primary.nnc-color-contrast{color:#fff;background-color:#ea5451}}.annoto .nnc-color-secondary{--nnc-color-base: var(--nnc-color-secondary, #00a9a4) !important;--nnc-color-contrast: var(--nnc-color-secondary-contrast, #ffffff) !important;--nnc-color-shade: var(--nnc-color-secondary-shade, #009590) !important;--nnc-color-tint: var(--nnc-color-secondary-tint, #1ab2ad) !important;--nnc-color-base-rgb: var(--nnc-color-secondary-rgb, 0, 169, 164) !important;--nnc-color-contrast-rgb: var(--nnc-color-secondary-contrast-rgb, 255, 255, 255) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-secondary{color:#00a9a4}.annoto .nnc-color-secondary.nnc-color-secondary.nnc-color-contrast{color:#fff;background-color:#00a9a4}}.annoto .nnc-color-tertiary{--nnc-color-base: var(--nnc-color-tertiary, #5450e8) !important;--nnc-color-contrast: var(--nnc-color-tertiary-contrast, #ffffff) !important;--nnc-color-shade: var(--nnc-color-tertiary-shade, #4a46cc) !important;--nnc-color-tint: var(--nnc-color-tertiary-tint, #6562ea) !important;--nnc-color-base-rgb: var(--nnc-color-tertiary-rgb, 84, 80, 232) !important;--nnc-color-contrast-rgb: var(--nnc-color-tertiary-contrast-rgb, 255, 255, 255) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-tertiary{color:#5450e8}.annoto .nnc-color-tertiary.nnc-color-tertiary.nnc-color-contrast{color:#fff;background-color:#5450e8}}.annoto .nnc-color-success{--nnc-color-base: var(--nnc-color-success, #38c172) !important;--nnc-color-contrast: var(--nnc-color-success-contrast, #000000) !important;--nnc-color-shade: var(--nnc-color-success-shade, #31aa64) !important;--nnc-color-tint: var(--nnc-color-success-tint, #4cc780) !important;--nnc-color-base-rgb: var(--nnc-color-success-rgb, 56, 193, 114) !important;--nnc-color-contrast-rgb: var(--nnc-color-success-contrast-rgb, 0, 0, 0) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-success{color:#38c172}.annoto .nnc-color-success.nnc-color-success.nnc-color-contrast{color:#000;background-color:#38c172}}.annoto .nnc-color-warning{--nnc-color-base: var(--nnc-color-warning, #f6993f) !important;--nnc-color-contrast: var(--nnc-color-warning-contrast, #000000) !important;--nnc-color-shade: var(--nnc-color-warning-shade, #d88737) !important;--nnc-color-tint: var(--nnc-color-warning-tint, #f7a352) !important;--nnc-color-base-rgb: var(--nnc-color-warning-rgb, 246, 153, 63) !important;--nnc-color-contrast-rgb: var(--nnc-color-warning-contrast-rgb, 0, 0, 0) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-warning{color:#f6993f}.annoto .nnc-color-warning.nnc-color-warning.nnc-color-contrast{color:#000;background-color:#f6993f}}.annoto .nnc-color-notice{--nnc-color-base: var(--nnc-color-notice, #ffd65b) !important;--nnc-color-contrast: var(--nnc-color-notice-contrast, #000000) !important;--nnc-color-shade: var(--nnc-color-notice-shade, #e0bc50) !important;--nnc-color-tint: var(--nnc-color-notice-tint, #ffda6b) !important;--nnc-color-base-rgb: var(--nnc-color-notice-rgb, 255, 214, 91) !important;--nnc-color-contrast-rgb: var(--nnc-color-notice-contrast-rgb, 0, 0, 0) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-notice{color:#ffd65b}.annoto .nnc-color-notice.nnc-color-notice.nnc-color-contrast{color:#000;background-color:#ffd65b}}.annoto .nnc-color-danger{--nnc-color-base: var(--nnc-color-danger, #d3411d) !important;--nnc-color-contrast: var(--nnc-color-danger-contrast, #ffffff) !important;--nnc-color-shade: var(--nnc-color-danger-shade, #ba391a) !important;--nnc-color-tint: var(--nnc-color-danger-tint, #d75434) !important;--nnc-color-base-rgb: var(--nnc-color-danger-rgb, 211, 65, 29) !important;--nnc-color-contrast-rgb: var(--nnc-color-danger-contrast-rgb, 255, 255, 255) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-danger{color:#d3411d}.annoto .nnc-color-danger.nnc-color-danger.nnc-color-contrast{color:#fff;background-color:#d3411d}}.annoto .nnc-color-light{--nnc-color-base: var(--nnc-color-light, #f4f5f8) !important;--nnc-color-contrast: var(--nnc-color-light-contrast, #000000) !important;--nnc-color-shade: var(--nnc-color-light-shade, #d7d8da) !important;--nnc-color-tint: var(--nnc-color-light-tint, #f5f6f9) !important;--nnc-color-base-rgb: var(--nnc-color-light-rgb, 244, 245, 248) !important;--nnc-color-contrast-rgb: var(--nnc-color-light-contrast-rgb, 0, 0, 0) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-light{color:#f4f5f8}.annoto .nnc-color-light.nnc-color-light.nnc-color-contrast{color:#000;background-color:#f4f5f8}}.annoto .nnc-color-medium{--nnc-color-base: var(--nnc-color-medium, #71737d) !important;--nnc-color-contrast: var(--nnc-color-medium-contrast, #ffffff) !important;--nnc-color-shade: var(--nnc-color-medium-shade, #63656e) !important;--nnc-color-tint: var(--nnc-color-medium-tint, #7f818a) !important;--nnc-color-base-rgb: var(--nnc-color-medium-rgb, 113, 115, 125) !important;--nnc-color-contrast-rgb: var(--nnc-color-medium-contrast-rgb, 255, 255, 255) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-medium{color:#71737d}.annoto .nnc-color-medium.nnc-color-medium.nnc-color-contrast{color:#fff;background-color:#71737d}}.annoto .nnc-color-dark{--nnc-color-base: var(--nnc-color-dark, #35353a) !important;--nnc-color-contrast: var(--nnc-color-dark-contrast, #ffffff) !important;--nnc-color-shade: var(--nnc-color-dark-shade, #2f2f33) !important;--nnc-color-tint: var(--nnc-color-dark-tint, #49494e) !important;--nnc-color-base-rgb: var(--nnc-color-dark-rgb, 53, 53, 58) !important;--nnc-color-contrast-rgb: var(--nnc-color-dark-contrast-rgb, 255, 255, 255) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-dark{color:#35353a}.annoto .nnc-color-dark.nnc-color-dark.nnc-color-contrast{color:#fff;background-color:#35353a}}.annoto .nnc-color-darkest{--nnc-color-base: var(--nnc-color-darkest, #16181a) !important;--nnc-color-contrast: var(--nnc-color-darkest-contrast, #ffffff) !important;--nnc-color-shade: var(--nnc-color-darkest-shade, #131517) !important;--nnc-color-tint: var(--nnc-color-darkest-tint, #2d2f31) !important;--nnc-color-base-rgb: var(--nnc-color-darkest-rgb, 22, 24, 26) !important;--nnc-color-contrast-rgb: var(--nnc-color-darkest-contrast-rgb, 255, 255, 255) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-color-darkest{color:#16181a}.annoto .nnc-color-darkest.nnc-color-darkest.nnc-color-contrast{color:#fff;background-color:#16181a}}.annoto .nnc-emotion-color-unknown{--nnc-color-base: var(--nnc-color-unknown, #989aa2) !important;--nnc-color-contrast: var(--nnc-color-unknown-contrast, inherit) !important;--nnc-color-shade: var(--nnc-color-unknown-shade, #86888f) !important;--nnc-color-tint: var(--nnc-color-unknown-tint, #a2a4ab) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-unknown{color:#989aa2;background-color:inherit}.annoto .nnc-emotion-color-unknown.nnc-emotion-color-unknown.nnc-color-contrast{color:inherit;background-color:#989aa2}}.annoto .nnc-emotion-color-neutral{--nnc-color-base: var(--nnc-color-neutral, #989aa2) !important;--nnc-color-contrast: var(--nnc-color-neutral-contrast, inherit) !important;--nnc-color-shade: var(--nnc-color-neutral-shade, #86888f) !important;--nnc-color-tint: var(--nnc-color-neutral-tint, #a2a4ab) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-neutral{color:#989aa2;background-color:inherit}.annoto .nnc-emotion-color-neutral.nnc-emotion-color-neutral.nnc-color-contrast{color:inherit;background-color:#989aa2}}.annoto .nnc-emotion-color-like{--nnc-color-base: var(--nnc-color-like, #ea5451) !important;--nnc-color-contrast: var(--nnc-color-like-contrast, inherit) !important;--nnc-color-shade: var(--nnc-color-like-shade, #ce4a47) !important;--nnc-color-tint: var(--nnc-color-like-tint, #ec6562) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-like{color:#ea5451;background-color:inherit}.annoto .nnc-emotion-color-like.nnc-emotion-color-like.nnc-color-contrast{color:inherit;background-color:#ea5451}}.annoto .nnc-emotion-color-angry{--nnc-color-base: var(--nnc-color-angry, #DB0045) !important;--nnc-color-contrast: var(--nnc-color-angry-contrast, var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))) !important;--nnc-color-shade: var(--nnc-color-angry-shade, #c1003d) !important;--nnc-color-tint: var(--nnc-color-angry-tint, #df1a58) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-angry{color:#db0045;background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nnc-emotion-color-angry.nnc-emotion-color-angry.nnc-color-contrast{color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464));background-color:#db0045}}.annoto .nnc-emotion-color-touched{--nnc-color-base: var(--nnc-color-touched, #39ACED) !important;--nnc-color-contrast: var(--nnc-color-touched-contrast, var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))) !important;--nnc-color-shade: var(--nnc-color-touched-shade, #3297d1) !important;--nnc-color-tint: var(--nnc-color-touched-tint, #4db4ef) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-touched{color:#39aced;background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nnc-emotion-color-touched.nnc-emotion-color-touched.nnc-color-contrast{color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464));background-color:#39aced}}.annoto .nnc-emotion-color-bored{--nnc-color-base: var(--nnc-color-bored, #A8733A) !important;--nnc-color-contrast: var(--nnc-color-bored-contrast, var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))) !important;--nnc-color-shade: var(--nnc-color-bored-shade, #946533) !important;--nnc-color-tint: var(--nnc-color-bored-tint, #b1814e) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-bored{color:#a8733a;background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nnc-emotion-color-bored.nnc-emotion-color-bored.nnc-color-contrast{color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464));background-color:#a8733a}}.annoto .nnc-emotion-color-lol{--nnc-color-base: var(--nnc-color-lol, #ffe469) !important;--nnc-color-contrast: var(--nnc-color-lol-contrast, var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))) !important;--nnc-color-shade: var(--nnc-color-lol-shade, #e0c95c) !important;--nnc-color-tint: var(--nnc-color-lol-tint, #ffe778) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-lol{color:#ffe469;background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nnc-emotion-color-lol.nnc-emotion-color-lol.nnc-color-contrast{color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464));background-color:#ffe469}}.annoto .nnc-emotion-color-wow{--nnc-color-base: var(--nnc-color-wow, #10E3C4) !important;--nnc-color-contrast: var(--nnc-color-wow-contrast, var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))) !important;--nnc-color-shade: var(--nnc-color-wow-shade, #0ec8ac) !important;--nnc-color-tint: var(--nnc-color-wow-tint, #28e6ca) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-wow{color:#10e3c4;background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nnc-emotion-color-wow.nnc-emotion-color-wow.nnc-color-contrast{color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464));background-color:#10e3c4}}.annoto .nnc-emotion-color-not-ok{--nnc-color-base: var(--nnc-color-not-ok, #DB0045) !important;--nnc-color-contrast: var(--nnc-color-not-ok-contrast, inherit) !important;--nnc-color-shade: var(--nnc-color-not-ok-shade, #c1003d) !important;--nnc-color-tint: var(--nnc-color-not-ok-tint, #df1a58) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-not-ok{color:#db0045;background-color:inherit}.annoto .nnc-emotion-color-not-ok.nnc-emotion-color-not-ok.nnc-color-contrast{color:inherit;background-color:#db0045}}.annoto .nnc-emotion-color-mark{--nnc-color-base: var(--nnc-color-mark, #39ACED) !important;--nnc-color-contrast: var(--nnc-color-mark-contrast, inherit) !important;--nnc-color-shade: var(--nnc-color-mark-shade, #3297d1) !important;--nnc-color-tint: var(--nnc-color-mark-tint, #4db4ef) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-mark{color:#39aced;background-color:inherit}.annoto .nnc-emotion-color-mark.nnc-emotion-color-mark.nnc-color-contrast{color:inherit;background-color:#39aced}}.annoto .nnc-emotion-color-help{--nnc-color-base: var(--nnc-color-help, #A8733A) !important;--nnc-color-contrast: var(--nnc-color-help-contrast, inherit) !important;--nnc-color-shade: var(--nnc-color-help-shade, #946533) !important;--nnc-color-tint: var(--nnc-color-help-tint, #b1814e) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-help{color:#a8733a;background-color:inherit}.annoto .nnc-emotion-color-help.nnc-emotion-color-help.nnc-color-contrast{color:inherit;background-color:#a8733a}}.annoto .nnc-emotion-color-idea{--nnc-color-base: var(--nnc-color-idea, #ffd65b) !important;--nnc-color-contrast: var(--nnc-color-idea-contrast, inherit) !important;--nnc-color-shade: var(--nnc-color-idea-shade, #e0bc50) !important;--nnc-color-tint: var(--nnc-color-idea-tint, #ffda6b) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-idea{color:#ffd65b;background-color:inherit}.annoto .nnc-emotion-color-idea.nnc-emotion-color-idea.nnc-color-contrast{color:inherit;background-color:#ffd65b}}.annoto .nnc-emotion-color-ok{--nnc-color-base: var(--nnc-color-ok, #10E3C4) !important;--nnc-color-contrast: var(--nnc-color-ok-contrast, inherit) !important;--nnc-color-shade: var(--nnc-color-ok-shade, #0ec8ac) !important;--nnc-color-tint: var(--nnc-color-ok-tint, #28e6ca) !important}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nnc-emotion-color-ok{color:#10e3c4;background-color:inherit}.annoto .nnc-emotion-color-ok.nnc-emotion-color-ok.nnc-color-contrast{color:inherit;background-color:#10e3c4}}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto{font-family:"Helvetica","Arial",sans-serif !important}}.nnc-mobile{--nn-widget-bg: #fafafa}.nn-notes-page{--nn-widget-bg: rgba(242, 246, 251, 0.9)}.nn-notes-page.nnc-mobile{--nn-widget-bg: #f2f6fb}.nnc-dark-theme{color:rgba(255,255,255,.84);--nnc-bg: #121212;--nnc-bg-color: #121212;--nnc-bg-hover: var(--nnc-color-step-800, #c8c8c8);--nnc-color: #ffffff;--nnc-item-bg: #121212;--nnc-border-color: #434343;--nnc-color-text: rgba(255, 255, 255, 0.87);--nnc-color-text-disabled: rgba(255, 255, 255, 0.26);--nnc-focused-box-shadow: 0 0 0 2px rgba(81, 160, 225, 0.9);--nnc-color-tertiary: #7673ed;--nnc-color-tertiary-contrast: #ffffff;--nnc-color-tertiary-shade: #6865d1;--nnc-color-tertiary-tint: #8481ef;--nnc-color-tertiary-rgb: 118, 115, 237;--nnc-color-tertiary-contrast-rgb: 255, 255, 255;--nnc-color-light: #222428;--nnc-color-light-contrast: #ffffff;--nnc-color-light-shade: #1e2023;--nnc-color-light-tint: #383a3e;--nnc-color-light-rgb: 34, 36, 40;--nnc-color-light-contrast-rgb: 255, 255, 255;--nnc-color-medium: #989aa2;--nnc-color-medium-contrast: #000000;--nnc-color-medium-shade: #86888f;--nnc-color-medium-tint: #a2a4ab;--nnc-color-medium-rgb: 152, 154, 162;--nnc-color-medium-contrast-rgb: 0, 0, 0;--nnc-color-dark: #c5cbda;--nnc-color-dark-contrast: #000000;--nnc-color-dark-shade: #adb3c0;--nnc-color-dark-tint: #cbd0de;--nnc-color-dark-rgb: 197, 203, 218;--nnc-color-dark-contrast-rgb: 0, 0, 0;--nnc-color-darkest: #f4f5f8;--nnc-color-darkest-contrast: #000000;--nnc-color-darkest-shade: #d7d8da;--nnc-color-darkest-tint: #f5f6f9;--nnc-color-darkest-rgb: 244, 245, 248;--nnc-color-darkest-contrast-rgb: 0, 0, 0;--nnc-color-step-50: #eeeeee;--nnc-color-step-100: #e1e1e1;--nnc-color-step-150: #d5d5d5;--nnc-color-step-200: #c8c8c8;--nnc-color-step-250: #bcbcbc;--nnc-color-step-300: #afafaf;--nnc-color-step-350: #a3a3a3;--nnc-color-step-400: #969696;--nnc-color-step-450: #8a8a8a;--nnc-color-step-500: #7d7d7d;--nnc-color-step-550: #717171;--nnc-color-step-600: #646464;--nnc-color-step-650: #585858;--nnc-color-step-700: #4b4b4b;--nnc-color-step-750: #3f3f3f;--nnc-color-step-800: #323232;--nnc-color-step-850: #262626;--nnc-color-step-900: #191919;--nnc-color-step-950: #0d0d0d;--nnc-color-step-50-rgb: 238, 238, 238;--nnc-color-step-100-rgb: 225, 225, 225;--nnc-color-step-150-rgb: 213, 213, 213;--nnc-color-step-200-rgb: 200, 200, 200;--nnc-color-step-250-rgb: 188, 188, 188;--nnc-color-step-300-rgb: 175, 175, 175;--nnc-color-step-350-rgb: 163, 163, 163;--nnc-color-step-400-rgb: 150, 150, 150;--nnc-color-step-450-rgb: 138, 138, 138;--nnc-color-step-500-rgb: 125, 125, 125;--nnc-color-step-550-rgb: 113, 113, 113;--nnc-color-step-600-rgb: 100, 100, 100;--nnc-color-step-650-rgb: 88, 88, 88;--nnc-color-step-700-rgb: 75, 75, 75;--nnc-color-step-750-rgb: 63, 63, 63;--nnc-color-step-800-rgb: 50, 50, 50;--nnc-color-step-850-rgb: 38, 38, 38;--nnc-color-step-900-rgb: 25, 25, 25;--nnc-color-step-950-rgb: 13, 13, 13;--nnc-color-docx: #6692d4;--nnc-color-xlsx: #41c97e;--nnc-color-pptx: #d87257;--nnc-emotion-bg-color: #121212;--nnc-comment-bubble-bg: rgba(90, 101, 114, 0.26);--nnc-bg: transparent;--nnc-bg-color: transparent;--nnc-comment-bg: transparent;--nnc-note-bg: transparent;--nn-widget-bg: rgba(18, 18, 18, 0.9);--nn-widget-solid-bg: #212121}.nnc-dark-theme.nn-player-fs{--nn-widget-bg: rgba(18, 18, 18, 0.8)}.nnc-dark-theme.nnc-mobile.nn-is-open{--nn-widget-bg: #121212}.nnc-rtl{--nnc-font-family: Helvetica, Arial, sans-serif}.annoto .nn-color-primary{color:var(--nnc-color-primary, #ea5451)}.annoto .nn-color-primary.amdl-button{color:var(--nnc-color-primary, #ea5451) !important}.annoto .nn-color-accent{color:var(--nnc-color-secondary, #00a9a4)}.annoto .nn-color-accent.amdl-button{color:var(--nnc-color-secondary, #00a9a4) !important}.annoto .nn-color-grey-heavy{color:var(--nnc-color-darkest, #16181a)}.annoto .nn-color-grey-heavy.amdl-button{color:var(--nnc-color-darkest, #16181a) !important}.annoto .nn-color-grey{color:var(--nnc-color-dark, #35353a)}.annoto .nn-color-grey.amdl-button{color:var(--nnc-color-dark, #35353a) !important}.annoto .nn-color-grey-light{color:var(--nnc-color-medium, #71737d)}.annoto .nn-color-grey-light.amdl-button{color:var(--nnc-color-medium, #71737d) !important}.annoto .nn-color-background-secondary{background-color:var(--nn-widget-solid-bg, white)}.annoto .nn-color-bg-hover:hover:not([disabled]):not(.disabled):not(.nn-active){background-color:var(--nnc-bg-hover, var(--nnc-color-step-950, #eeeeee))}.annoto .nn-border{border:1px solid var(--nnc-border-color, #e2e2e5)}.annoto .nn-border-bottom{border-bottom:1px solid var(--nnc-border-color, #e2e2e5)}.annoto .nn-border-top{border-top:1px solid var(--nnc-border-color, #e2e2e5)}.annoto .nn-border-right{border-right:1px solid var(--nnc-border-color, #e2e2e5)}.annoto .nn-border-left{border-left:1px solid var(--nnc-border-color, #e2e2e5)}.annoto .nn-text-color{color:var(--nnc-color-text, rgba(0, 0, 0, 0.87))}.annoto .nn-text-color a{color:var(--nnc-color-dark, #35353a);font-weight:400}.annoto .nn-text{text-align:inherit}.annoto .nn-text-center{text-align:center}.annoto .nn-text-title{font-family:var(--nnc-font-family, Roboto, Helvetica, Arial, sans-serif);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-decoration:inherit;text-transform:inherit;font-size:var(--nnc-typo-title-size, 1.125em);line-height:2em;font-weight:var(--nnc-typo-title-weight, 400);letter-spacing:.0111111111em}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nn-text-title{font-family:"Roboto","Helvetica","Arial",sans-serif}}.annoto .nn-text-subhead{font-family:var(--nnc-font-family, Roboto, Helvetica, Arial, sans-serif);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-decoration:inherit;text-transform:inherit;font-size:var(--nnc-typo-subhead-size, 1em);line-height:2em;font-weight:var(--nnc-typo-title-weight, 500);letter-spacing:.0125em}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nn-text-subhead{font-family:"Roboto","Helvetica","Arial",sans-serif}}.annoto .nn-text-body{font-family:var(--nnc-font-family, Roboto, Helvetica, Arial, sans-serif);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-decoration:inherit;text-transform:inherit;font-size:var(--nnc-typo-body-size, 1em);line-height:1.5em;font-weight:var(--nnc-typo-body-weight, 400);letter-spacing:.03125em}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nn-text-body{font-family:"Roboto","Helvetica","Arial",sans-serif}}.annoto .nn-text-caption{font-family:var(--nnc-font-family, Roboto, Helvetica, Arial, sans-serif);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-decoration:inherit;text-transform:inherit;font-size:var(--nnc-typo-caption-size, 0.75em);line-height:1.25em;font-weight:var(--nnc-typo-caption-weight, 400);letter-spacing:.0333333333em;line-height:inherit}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .nn-text-caption{font-family:"Roboto","Helvetica","Arial",sans-serif}}.annoto .nn-text-oblique{font-style:oblique}.annoto .amdl-icon-toggle.is-checked:not(.is-disabled) .amdl-icon-toggle__label{color:inherit}.annoto .amdl-icon-toggle.is-disabled .amdl-icon-toggle__label{color:var(--nnc-color-text-disabled, rgba(0, 0, 0, 0.26))}.annoto .amdl-switch .amdl-switch__track{background-color:var(--nnc-color-step-600, #969696)}.annoto .amdl-switch.is-checked:not(.is-disabled) .amdl-switch__track{background:rgba(var(--nnc-color-secondary-rgb, 0, 169, 164), 0.5)}.annoto .amdl-switch.is-checked:not(.is-disabled) .amdl-switch__thumb{background:var(--nnc-color-secondary, #00a9a4)}.annoto .amdl-button.amdl-button--primary{color:var(--nnc-color-primary, #ea5451) !important}.annoto .amdl-button.amdl-button--accent{color:var(--nnc-color-secondary, #00a9a4) !important}.annoto .amdl-button.amdl-button--icon.amdl-button--colored{color:var(--nnc-color-primary, #ea5451) !important}.annoto .amdl-button.amdl-button--raised.amdl-button--colored,.annoto .amdl-button.amdl-button--fab.amdl-button--colored{background-color:var(--nnc-color-primary, #ea5451) !important;color:var(--nnc-color-primary-contrast, #ffffff) !important}.annoto .amdl-button.amdl-button--raised.amdl-button--accent,.annoto .amdl-button.amdl-button--fab.amdl-button--accent{background-color:var(--nnc-color-secondary, #00a9a4) !important;color:var(--nnc-color-secondary-contrast, #ffffff) !important}.annoto .amdl-button:not(.amdl-button--fab):not(.amdl-button--icon):not(.amdl-button--mini-fab){border-radius:2px}.annoto .amdl-button{background-color:initial !important;-webkit-transition:none;transition:none}.annoto .amdl-button:hover{background-color:var(--nnc-bg-hover, var(--nnc-color-step-950, #eeeeee)) !important}.annoto .amdl-button[disabled][disabled],.annoto .amdl-button.amdl-button--disabled.amdl-button--disabled{color:rgba(var(--nnc-color-step-50-rgb, 13, 13, 13), 0.56) !important;cursor:default;background-color:transparent !important}.annoto .amdl-button--fab[disabled][disabled],.annoto .amdl-button--fab.amdl-button--disabled.amdl-button--disabled{background-color:rgba(var(--nnc-color-step-50-rgb, 13, 13, 13), 0.26) !important;color:rgba(var(--nnc-color-step-50-rgb, 13, 13, 13), 0.56) !important}.annoto .amdl-button--raised[disabled][disabled],.annoto .amdl-button--raised.amdl-button--disabled.amdl-button--disabled{background-color:rgba(var(--nnc-color-step-50-rgb, 13, 13, 13), 0.26) !important;color:rgba(var(--nnc-color-step-50-rgb, 13, 13, 13), 0.56) !important;-webkit-box-shadow:none;box-shadow:none}.annoto .amdl-button--colored[disabled][disabled],.annoto .amdl-button--colored.amdl-button--disabled.amdl-button--disabled{color:rgba(var(--nnc-color-step-50-rgb, 13, 13, 13), 0.56) !important}.annoto .annoto-menu-button .annoto-menu-text{font-size:14px;color:var(--nnc-color, #000);font-weight:400}.annoto .annoto-menu-button .annoto-menu-container{border-radius:2px}.annoto .annoto-menu-button .annoto-menu-container .annoto-menu-item.nn-active{color:var(--nnc-color-secondary-contrast, #ffffff);background-color:var(--nnc-color-secondary-shade, #009590)}.annoto .annoto-menu-button .annoto-menu-select-button{height:32px;line-height:32px}.annoto.nnc-dark-theme .annoto-menu-button .annoto-menu-text{font-weight:300}.annoto.nnc-rtl .annoto-menu-button .annoto-menu-select-button .annoto-menu-text{font-size:16px}.annoto .annoto-avatar{width:36px;height:36px;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-avatar .annoto-photo{border:none}.annoto .annoto-comment{background:var(--nnc-comment-bg, var(--nn-widget-bg, rgba(250, 250, 250, 0.9)))}.annoto .annoto-comment .annoto-avatar{width:36px;height:36px}.annoto .annoto-comment .annoto-avatar .annoto-comment-emotion{bottom:-4.5px;right:-4.5px}.annoto .annoto-comment .annoto-avatar .annoto-comment-emotion .annoto-emotion-container{min-width:16px;height:16px;width:16px;margin:1px}.annoto .annoto-comment .annoto-avatar .annoto-comment-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:18px;height:18px;line-height:18px;font-size:18px}.annoto .annoto-comment .annoto-comment-anonymous-caption{padding:0 36px}.annoto .annoto-comment .annoto-comment-mod-like-badge .annoto-mod-like-badge-icon{color:var(--nnc-color-notice, #ffd65b)}.annoto .annoto-comment .annoto-comment-mod-like-badge-tooltip{--nnc-bg: var(--nnc-color-notice, #ffd65b);--nnc-color: var(--nnc-color-notice-contrast, #000000)}.annoto .annoto-comment .annoto-comment-form-container,.annoto .annoto-comment .annoto-comment-replies{padding:0 0 0 40px}.annoto .annoto-comment .annoto-comment-votes-meta{line-height:12px}.annoto .annoto-comment .annoto-comment-votes-meta .annoto-comment-vote{width:12px;height:12px;background-color:inherit}.annoto .annoto-comment .annoto-comment-votes-meta .annoto-comment-vote .annoto-emotion .annoto-emotion-container{min-width:10px;height:10px;width:10px;margin:1px}.annoto .annoto-comment .annoto-comment-votes-meta .annoto-comment-vote .annoto-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:12px;height:12px;line-height:12px;font-size:12px}.annoto .annoto-comment .annoto-comment-votes-meta .annoto-comment-vote-count,.annoto .annoto-comment .annoto-comment-votes-meta .annoto-comment-votes-count{line-height:12px}.annoto .annoto-comment .annoto-comment-footer .annoto-emotion-vote .annoto-emotion-selector .annoto-emotion .annoto-emotion-container{min-width:12px;height:12px;width:12px;margin:1px}.annoto .annoto-comment .annoto-comment-footer .annoto-emotion-vote .annoto-emotion-selector .annoto-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:14px;height:14px;line-height:14px;font-size:14px}.annoto .annoto-comment .annoto-comment-footer .annoto-comment-user-vote .annoto-emotion .annoto-emotion-container{min-width:12px;height:12px;width:12px;margin:1px}.annoto .annoto-comment .annoto-comment-footer .annoto-comment-user-vote .annoto-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:14px;height:14px;line-height:14px;font-size:14px}.annoto .annoto-comment .annoto-comment-header .annoto-comment-author-name{font-size:13px;font-weight:400}.annoto.nnc-rtl .annoto-comment .annoto-avatar .annoto-comment-emotion{left:-4.5px;right:auto}.annoto.nnc-rtl .annoto-comment .annoto-comment-form-container,.annoto.nnc-rtl .annoto-comment .annoto-comment-replies{padding:0 40px 0 0}.annoto.nnc-rtl .annoto-comment .annoto-comment-header .annoto-comment-author-name{font-size:14px}.annoto .annoto-note{background-color:var(--nnc-note-bg, rgba(242, 246, 251, 0.9));padding:4px}.annoto .annoto-note .annoto-note-emotion{bottom:12px;right:12px;width:18px;height:18px}.annoto .annoto-note .annoto-note-emotion .annoto-emotion-container{min-width:16px;height:16px;width:16px;margin:1px}.annoto .annoto-note .annoto-note-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:18px;height:18px;line-height:18px;font-size:18px}.annoto .annoto-note .annoto-container{padding:0 4px 8px 4px}.annoto .annoto-note .annoto-container .annoto-note-content{padding:0 34px 0 4px}.annoto.nnc-rtl .annoto-note .annoto-note-emotion{left:12px;right:auto}.annoto.nnc-rtl .annoto-note .annoto-container .annoto-note-content{padding:0 4px 0 34px}.annoto .annoto-kuku .annoto-avatar{width:36px;height:36px}.annoto .annoto-kuku .annoto-avatar .annoto-kuku-emotion{bottom:-4.5px;right:-4.5px}.annoto .annoto-kuku .annoto-avatar .annoto-kuku-emotion .annoto-emotion-container{min-width:16px;height:16px;width:16px;margin:1px}.annoto .annoto-kuku .annoto-avatar .annoto-kuku-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:18px;height:18px;line-height:18px;font-size:18px}.annoto .annoto-kuku .annoto-kuku-author-name{font-size:13px;font-weight:400}.annoto.nnc-rtl .annoto-kuku .annoto-kuku-author-name{font-size:14px}.annoto .annoto-comment-form .annoto-comment-form-content{padding:4px;border-radius:0px;-webkit-box-shadow:none;box-shadow:none}.annoto .annoto-comment-form .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector{height:36px;width:36px}.annoto .annoto-comment-form .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-avatar{height:36px;width:36px}.annoto .annoto-comment-form .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-avatar .annoto-photo .annoto-icon{font-size:36px;font-weight:bold}.annoto .annoto-comment-form .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-avatar .annoto-photo .annoto-icon.nn-icon-user_avatar{color:var(--nnc-color-primary, #ea5451)}.annoto .annoto-comment-form .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-emotion{height:36px;width:36px}.annoto .annoto-comment-form .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-emotion .annoto-emotion-container{min-width:22px;height:22px;width:22px;margin:1px}.annoto .annoto-comment-form .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:24px;height:24px;line-height:24px;font-size:24px}.annoto .annoto-comment-form .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-emotion .annoto-emotion-container .annoto-icon.nn-icon-emotion_smile_o{color:var(--nnc-color-dark, #35353a)}.annoto .annoto-comment-form .annoto-form-container .annoto-comment-form-user{display:none;min-height:12px}.annoto .annoto-comment-form .annoto-form-container .annoto-comment-form-user>div{font-size:12px}.annoto .annoto-comment-form .annoto-form-container .annoto-comment-form-body textarea{background-color:inherit;max-height:100px}.annoto .annoto-comment-form .annoto-form-container .annoto-comment-form-body label:after{background-color:var(--nnc-color-secondary, #00a9a4)}.annoto .annoto-comment-form .annoto-comment-form-btns button{height:32px;line-height:32px;font-size:12px;font-weight:normal}.annoto.nnc-rtl .annoto-comment-form .annoto-comment-form-btns button{font-size:13px}.annoto .annoto-thread .annoto-thread-form-container{width:calc(100% - 0px);margin:0 0px 0px 0px;padding:0 4px 0px 4px;border-radius:0px}.annoto.has-tabs .annoto-thread .annoto-thread-form-container .annoto-comment-form{border-bottom-right-radius:0}.annoto-overlay.side-by-side-layout .annoto-thread .annoto-thread-form-container{width:calc(40% - 0px)}.annoto .annoto-header .annoto-header-row{height:44px;border-top-right-radius:3px;border-top-left-radius:3px;padding:0 8px 0 48px}.annoto .annoto-header .annoto-header-row .annoto-help-link{background-color:var(--nnc-emotion-color-help, #A8733A)}.annoto .annoto-header .annoto-drawer-button{margin:4px;line-height:36px;height:36px;width:40px;border-radius:2px}.annoto.no-drawer .annoto-header .annoto-header-row{padding:0 8px}.annoto.is-live .annoto-header .annoto-header-row .annoto-live{display:inline-block;font-size:12px;line-height:44px}.annoto.nnc-mobile .annoto-header .annoto-header-row{height:44px}.annoto.nnc-mobile .annoto-header .annoto-drawer-button{line-height:36px;height:36px}.annoto .annoto-drawer{top:44px;height:calc(100% - 88px);-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-drawer .annoto-drawer-footer .annoto-drawer-logo{height:18px}.annoto .annoto-drawer .annoto-link{font-weight:400;color:var(--nnc-color, #000)}.annoto .annoto-drawer .annoto-link.nn-active{color:var(--nnc-color-secondary-contrast, #ffffff);background-color:var(--nnc-color-secondary-shade, #009590)}.annoto .annoto-drawer .annoto-link.disabled{color:var(--nnc-color-text-disabled, rgba(0, 0, 0, 0.26))}.annoto.nnc-dark-theme .annoto-drawer .annoto-link{font-weight:300}.annoto .annoto-layout .annoto-header{min-height:44px}.annoto.nnc-mobile .annoto-layout .annoto-header{min-height:44px}.annoto .annoto-ct-series-a .annoto-ct-bar{stroke:var(--nnc-emotion-color-unknown, #989aa2)}.annoto .annoto-ct-series-b .annoto-ct-bar{stroke:var(--nnc-emotion-color-neutral, #989aa2)}.annoto .annoto-ct-series-c .annoto-ct-bar{stroke:var(--nnc-emotion-color-like, #ea5451)}.annoto .annoto-ct-series-d .annoto-ct-bar{stroke:var(--nnc-emotion-color-angry, #DB0045)}.annoto .annoto-ct-series-e .annoto-ct-bar{stroke:var(--nnc-emotion-color-touched, #39ACED)}.annoto .annoto-ct-series-f .annoto-ct-bar{stroke:var(--nnc-emotion-color-bored, #A8733A)}.annoto .annoto-ct-series-g .annoto-ct-bar{stroke:var(--nnc-emotion-color-lol, #ffe469)}.annoto .annoto-ct-series-h .annoto-ct-bar{stroke:var(--nnc-emotion-color-wow, #10E3C4)}.annoto .annoto-ct-series-i .annoto-ct-bar{stroke:var(--nnc-emotion-color-not-ok, #DB0045)}.annoto .annoto-ct-series-j .annoto-ct-bar{stroke:var(--nnc-emotion-color-mark, #39ACED)}.annoto .annoto-ct-series-k .annoto-ct-bar{stroke:var(--nnc-emotion-color-help, #A8733A)}.annoto .annoto-ct-series-l .annoto-ct-bar{stroke:var(--nnc-emotion-color-idea, #ffd65b)}.annoto .annoto-ct-series-m .annoto-ct-bar{stroke:var(--nnc-emotion-color-ok, #10E3C4)}.annoto .annoto-ct-series-n .annoto-ct-bar{stroke:var(--nnc-emotion-color-touched, #39ACED)}.annoto .annoto-ct-series-o .annoto-ct-bar{stroke:var(--nnc-emotion-color-touched, #39ACED)}.annoto .nn-emotion-color-unknown .nn-paint,.annoto .nn-emotion-color-unknown.nn-paint{color:var(--nnc-emotion-color-unknown, #989aa2)}.annoto .nn-emotion-color-unknown .nn-paint-background,.annoto .nn-emotion-color-unknown.nn-paint-background{background:inherit}.annoto .nn-emotion-color-neutral .nn-paint,.annoto .nn-emotion-color-neutral.nn-paint{color:var(--nnc-emotion-color-neutral, #989aa2)}.annoto .nn-emotion-color-neutral .nn-paint-background,.annoto .nn-emotion-color-neutral.nn-paint-background{background:inherit}.annoto .nn-emotion-color-like .nn-paint,.annoto .nn-emotion-color-like.nn-paint{color:var(--nnc-emotion-color-like, #ea5451)}.annoto .nn-emotion-color-like .nn-paint-background,.annoto .nn-emotion-color-like.nn-paint-background{background:inherit}.annoto .nn-emotion-color-angry .nn-paint,.annoto .nn-emotion-color-angry.nn-paint{color:var(--nnc-emotion-color-angry, #DB0045)}.annoto .nn-emotion-color-angry .nn-paint-background,.annoto .nn-emotion-color-angry.nn-paint-background{background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nn-emotion-color-touched .nn-paint,.annoto .nn-emotion-color-touched.nn-paint{color:var(--nnc-emotion-color-touched, #39ACED)}.annoto .nn-emotion-color-touched .nn-paint-background,.annoto .nn-emotion-color-touched.nn-paint-background{background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nn-emotion-color-bored .nn-paint,.annoto .nn-emotion-color-bored.nn-paint{color:var(--nnc-emotion-color-bored, #A8733A)}.annoto .nn-emotion-color-bored .nn-paint-background,.annoto .nn-emotion-color-bored.nn-paint-background{background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nn-emotion-color-lol .nn-paint,.annoto .nn-emotion-color-lol.nn-paint{color:var(--nnc-emotion-color-lol, #ffe469)}.annoto .nn-emotion-color-lol .nn-paint-background,.annoto .nn-emotion-color-lol.nn-paint-background{background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nn-emotion-color-wow .nn-paint,.annoto .nn-emotion-color-wow.nn-paint{color:var(--nnc-emotion-color-wow, #10E3C4)}.annoto .nn-emotion-color-wow .nn-paint-background,.annoto .nn-emotion-color-wow.nn-paint-background{background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto .nn-emotion-color-not-ok .nn-paint,.annoto .nn-emotion-color-not-ok.nn-paint{color:var(--nnc-emotion-color-not-ok, #DB0045)}.annoto .nn-emotion-color-not-ok .nn-paint-background,.annoto .nn-emotion-color-not-ok.nn-paint-background{background:inherit}.annoto .nn-emotion-color-mark .nn-paint,.annoto .nn-emotion-color-mark.nn-paint{color:var(--nnc-emotion-color-mark, #39ACED)}.annoto .nn-emotion-color-mark .nn-paint-background,.annoto .nn-emotion-color-mark.nn-paint-background{background:inherit}.annoto .nn-emotion-color-help .nn-paint,.annoto .nn-emotion-color-help.nn-paint{color:var(--nnc-emotion-color-help, #A8733A)}.annoto .nn-emotion-color-help .nn-paint-background,.annoto .nn-emotion-color-help.nn-paint-background{background:inherit}.annoto .nn-emotion-color-idea .nn-paint,.annoto .nn-emotion-color-idea.nn-paint{color:var(--nnc-emotion-color-idea, #ffd65b)}.annoto .nn-emotion-color-idea .nn-paint-background,.annoto .nn-emotion-color-idea.nn-paint-background{background:inherit}.annoto .nn-emotion-color-ok .nn-paint,.annoto .nn-emotion-color-ok.nn-paint{color:var(--nnc-emotion-color-ok, #10E3C4)}.annoto .nn-emotion-color-ok .nn-paint-background,.annoto .nn-emotion-color-ok.nn-paint-background{background:inherit}.annoto .nn-emotion-color-help-buoy .nn-paint,.annoto .nn-emotion-color-help-buoy.nn-paint{color:var(--nnc-emotion-color-touched, #39ACED)}.annoto .nn-emotion-color-help-buoy .nn-paint-background,.annoto .nn-emotion-color-help-buoy.nn-paint-background{background:inherit}.annoto .nn-emotion-color-sad .nn-paint,.annoto .nn-emotion-color-sad.nn-paint{color:var(--nnc-emotion-color-touched, #39ACED)}.annoto .nn-emotion-color-sad .nn-paint-background,.annoto .nn-emotion-color-sad.nn-paint-background{background-color:var(--nnc-emotion-bg-color, var(--nnc-color-step-400, #646464))}.annoto-timeline{border-radius:2px;background-color:var(--nnc-timeline-bg, rgba(250, 250, 250, 0.9))}.annoto-timeline .annoto-progress-bar{background-color:rgba(var(--nnc-color-step-800-rgb, 200, 200, 200), 0.2);-webkit-box-shadow:inset 0 0 3px rgba(var(--nnc-color-step-800-rgb, 200, 200, 200), 0.9);box-shadow:inset 0 0 3px rgba(var(--nnc-color-step-800-rgb, 200, 200, 200), 0.9);border-radius:2px}.annoto-timeline .annoto-progress-bar .annoto-progress-line{background-color:var(--nnc-timeline-progress-line-color, red);border-radius:2px}.annoto-timeline.nn-overlay{background-color:var(--nnc-timeline-overlay-bg, rgba(var(--nnc-color-dark-rgb, 53, 53, 58), 0.15))}.annoto-timeline.nn-overlay .annoto-progress-bar{-webkit-box-shadow:inset 0 0 3px rgba(var(--nnc-color-step-800-rgb, 200, 200, 200), 0.2);box-shadow:inset 0 0 3px rgba(var(--nnc-color-step-800-rgb, 200, 200, 200), 0.2)}.annoto-timeline.nn-overlay .annoto-progress-bar .annoto-progress-line{background-color:var(--nnc-timeline-progress-line-color, white)}.annoto .annoto-emotion-vote .annoto-emotions-box-container{border-radius:2px}.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotions-box .annoto-emotion-organ .annoto-emotion{margin:8px auto;height:38.4px;width:38.4px}.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotions-box .annoto-emotion-organ .annoto-emotion .annoto-emotion-container{min-width:30px;height:30px;width:30px;margin:1px}.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotions-box .annoto-emotion-organ .annoto-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:32px;height:32px;line-height:32px;font-size:32px}.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotions-box .annoto-emotion-organ .annoto-emotion:hover .annoto-emotion-container{min-width:36.4px;height:36.4px;width:36.4px;margin:1px}.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotions-box .annoto-emotion-organ .annoto-emotion:hover .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:38.4px;height:38.4px;line-height:38.4px;font-size:38.4px}.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotions-box .annoto-emotion-organ.selected .annoto-emotion{border-bottom:3px solid var(--nnc-color-primary, #ea5451)}.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotions-box .annoto-emotion-organ.selected .annoto-emotion .annoto-emotion-container{min-width:36.4px;height:36.4px;width:36.4px;margin:1px}.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotions-box .annoto-emotion-organ.selected .annoto-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:38.4px;height:38.4px;line-height:38.4px;font-size:38.4px}.annoto .nn-list-item.nn-disabled .nn-list-item-content,.annoto .nn-list-item.nn-disabled .nn-list-item-subtitle,.annoto .nn-list-item.nn-disabled .nn-list-item-text,.annoto .nn-list-item.nn-disabled .nn-list-item-end-info{color:var(--nnc-color-text-disabled, rgba(0, 0, 0, 0.26))}.nn-focusable{outline:none}.nn-focusable:focus{outline:none}.nn-focusable.nn-focused{-webkit-box-shadow:var(--nnc-focused-box-shadow, 0 0 0 2px rgba(37, 137, 218, 0.9));box-shadow:var(--nnc-focused-box-shadow, 0 0 0 2px rgba(37, 137, 218, 0.9));outline:none}.annoto-overlay .annoto-widget-container>div,.annoto-overlay .annoto-resizable{border-radius:3px}.annoto .nn-scrollbar::-webkit-scrollbar{width:var(--nnc-scrollbar-width, 6px)}.annoto .nn-scrollbar::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 var(--nnc-scrollbar-width, 6px) var(--nnc-scrollbar-bg, var(--nnc-color-step-850, #d5d5d5));box-shadow:inset 0 0 var(--nnc-scrollbar-width, 6px) var(--nnc-scrollbar-bg, var(--nnc-color-step-850, #d5d5d5));border-radius:3px}.annoto .nn-scrollbar::-webkit-scrollbar-thumb{background-color:var(--nnc-scrollbar-thumb-color, var(--nnc-color-step-750, #bcbcbc));border-radius:3px}.annoto .nn-scrollbar::-webkit-scrollbar-thumb:hover{background-color:var(--nnc-scrollbar-thumb-hover-color, var(--nnc-color-step-600, #969696))}#annoto-app,#annoto-app-default{display:block;height:0;width:0;position:absolute;top:0;left:0}#annoto-app-root{display:block;height:0;width:0;position:absolute;top:0;left:0}',""]),e.default=u},"dap/index":function(t,e,n){"use strict";n.r(e),n.d(e,"configure",(function(){return p}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(62),a=n(31),s=n("app-common/index"),c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e,n,i){this.eventAggregator=t,this.composer=e,this.widgets=n,this.appEl=i,this.map=new WeakMap,this.logger=o.h.getLogger("dap-compose-service")}return t.prototype.init=function(){var t=this;this.widgets.set.forEach((function(e){return t.widgetAttachedHandle(e)})),this.eventAggregator.subscribe(a.a.WIDGET_ATTACHED,(function(e){return t.widgetAttachedHandle(e)})),this.eventAggregator.subscribe(a.a.WIDGET_DETACHED,(function(e){return t.widgetDetachedHandle(e)}))},t.prototype.widgetAttachedHandle=function(t){var e=this;t&&!this.map.get(t)&&this.composer.compose({viewModel:"dap/nn-dap",tagName:"nn-dap",host:this.appEl.get(),container:t.auContainer}).then((function(n){e.map.set(t,n)})).catch((function(t){e.logger.error(t)}))},t.prototype.widgetDetachedHandle=function(t){var e=this.map.get(t);e&&(this.map.delete(t),this.composer.decompose(e))},t=c([Object(o.t)(i.EventAggregator,r.a,s.WidgetsSet,s.AppElement),l("design:paramtypes",[i.EventAggregator,r.a,s.WidgetsSet,s.AppElement])],t)}();function p(t){t.globalResources("./nn-dap"),t.postTask((function(){t.container.get(u).init()}))}},"dap/nn-dap":function(t,e,n){"use strict";n.r(e),n.d(e,"Dap",(function(){return m}));var o=n("aurelia-framework"),i=n(74),r=n(36),a=n(29),s=n(88),c=n(40),l=n(31),u=n(44),p=function(){return(p=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},d=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},h=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},m=function(){function t(t,n,o){this.el=t,this.store=n,this.service=o,this.disposables=[],this.defaults={scrollTo:{behavior:"smooth",block:"center"}},this.instanceId=e.instanceCounter,e.instanceCounter++,t.classList.add("annoto")}var e;return e=t,t.prototype.bind=function(){var t=this,e=this.store,n=e.threadController.on(c.a.INITIALIZED,(function(){n.dispose(),e.hasUGC&&e.commentsEnabled&&e.privateNotesEnabled&&t.startQuery().then((function(){t.disposables.push(e.eventAggregator.subscribe(l.a.USER_AUTHENTICATED,(function(){t.handleFinish(),t.dap=void 0,Object(a.c)(100).then((function(){if(e.user.in)return t.startQuery()}))}))),t.disposables.push(e.eventAggregator.subscribe(l.a.USER_LOGOUT,(function(){t.handleFinish(),t.dap=void 0})))}))}))},t.prototype.unbind=function(){Object(a.d)(this.disposables),this.disposables=[],this.handleFinish(),this.dap=void 0},Object.defineProperty(t.prototype,"zIndex",{get:function(){var t=this.store.widget;return(t.overlay?t.overlay.zIndex:this.store.settings.zIndex)+10},enumerable:!1,configurable:!0}),t.prototype.startQuery=function(){var t=this,e=this.store;return this.service.startQuery().then((function(n){if(!n)return t.dap=void 0,void(t.tour=void 0);if(t.defaults=p(p({},t.defaults),n.tour.stepsDefaults),e.user.in&&(t.subs={"{{user}}":e.user.name||""}),t.dap=n,e.interactiveController.cancelOneTimeInteractiveOn(),n.tour.data){var o=n.tour.data;e.demoController.setDapConfig(p(p({},o),{id:e.threadController.id,source:e.threadController.source}))}return Object(a.c)(10).then((function(){t.tour=n.tour}))}))},t.prototype.eventHandle=function(t){var e=this,n=t.detail,o=this.dap,r=this.store;if(o){if("show"===n.type)return(s=n.step)&&this.handleStepShow(s),this.service.recordEvent(o,{type:n.forward?i.DapEventType.next:i.DapEventType.back,step_name:n.stepName,step_index:n.index},n);if("start"===n.type)return r.widget.overlayLock(),r.widget.hide(),this.blockPlayerPlay(),this.service.recordEvent(o,{type:i.DapEventType.start,step_name:n.stepName,step_index:n.index},n).then((function(){r.pubSub.publish(l.a.DAP_START)}));if("complete"===n.type)return Object(a.c)().then((function(){return e.handleFinish()})),this.service.recordEvent(o,{type:i.DapEventType.complete,step_name:n.stepName,step_index:n.index},n);if("cancel"===n.type)return Object(a.c)().then((function(){return e.handleFinish()})),this.service.recordEvent(o,{type:i.DapEventType.cancel,step_name:n.stepName,step_index:n.index},n);if("before-show"===n.type){var s;if((s=n.step)&&s.actionOnCustomEvent)switch(s.actionOnCustomEvent.event){case"followThread":case"followGroup":n.skipShow=!r.hasFollowControls}this.stepActionDisposable&&(this.stepActionDisposable.dispose(),this.stepActionDisposable=void 0)}}},t.prototype.handleStepShow=function(t){var e=this,n=this.store;if(t.actionOnCustomEvent)switch(t.actionOnCustomEvent.event){case"showWidget":this.stepActionDisposable=n.pubSub.subscribeOnce(l.a.WIDGET_OPEN,(function(){Object(a.c)(50).then((function(){e.tourElement&&e.tourElement.doAction(t.actionOnCustomEvent.action)}))}));break;case"openDrawer":this.stepActionDisposable=n.pubSub.subscribeOnce(l.a.DRAWER_OPEN,(function(){Object(a.c)(100).then((function(){e.tourElement&&e.tourElement.doAction(t.actionOnCustomEvent.action)}))}));break;case"followThread":this.stepActionDisposable=n.pubSub.subscribeOnce(l.a.FOLLOW_THREAD,(function(){Object(a.c)(100).then((function(){e.tourElement&&e.tourElement.doAction(t.actionOnCustomEvent.action)}))}));break;case"followGroup":this.stepActionDisposable=n.pubSub.subscribeOnce(l.a.FOLLOW_GROUP,(function(){Object(a.c)(100).then((function(){e.tourElement&&e.tourElement.doAction(t.actionOnCustomEvent.action)}))}));break;case"openNotes":this.stepActionDisposable=n.eventAggregator.subscribeOnce(l.a.PRIVATE_MODE_CHANGED,(function(){Object(a.c)().then((function(){n.isPrivateMode&&e.tourElement&&e.tourElement.doAction(t.actionOnCustomEvent.action)}))}));break;case"commentFinish":this.finishDisposable=n.pubSub.subscribeOnce(l.a.COMMENT_FORM_FOCUS,(function(){e.finishDisposable&&(e.finishDisposable=void 0,e.tourElement&&e.tourElement.doAction(t.actionOnCustomEvent.action))}))}if(t.customState)switch(t.customState){case"widgetOpen":n.widget.isOpen||n.interactiveController.setOffAndDoShow();break;case"privateNotes":n.pubSub.publish(l.a.PAGES_SHOW,{page:"home",frame:"notes"}),n.pubSub.publish(l.a.TRIGGER_DRAWER_HIDE);break;case"comments":n.pubSub.publish(l.a.PAGES_SHOW,{page:"home",frame:"comments"}),n.pubSub.publish(l.a.TRIGGER_DRAWER_HIDE);break;case"menuOpen":n.pubSub.publish(l.a.TRIGGER_DRAWER_OPEN);break;case"menuClosed":n.pubSub.publish(l.a.TRIGGER_DRAWER_HIDE);break;case"tourEnd":n.pubSub.publish(l.a.PAGES_SHOW,{page:"home",frame:"comments"}),n.pubSub.publish(l.a.TRIGGER_DRAWER_HIDE),n.pubSub.publish(l.a.DAP_FINISH)}},t.prototype.handleFinish=function(){try{this.finishDisposable&&this.finishDisposable.dispose(),this.stepActionDisposable&&this.stepActionDisposable.dispose()}catch(t){}this.tour=null,this.finishDisposable=void 0,this.stepActionDisposable=void 0,this.store.pubSub.publish(l.a.DAP_END),this.releasePlayerPlay(),this.store.widget.overlayUnlock()},t.prototype.blockPlayerPlay=function(){var t=this;this.releasePlayerPlay();var e=this.store;this.playerBlockDisposable=e.player.on(u.b.TIME_UPDATE,(function(){if(t.tour)return e.player.pause()}))},t.prototype.releasePlayerPlay=function(){try{this.playerBlockDisposable&&(this.playerBlockDisposable.dispose(),this.playerBlockDisposable=void 0)}catch(t){}},t.instanceCounter=0,d([Object(o.p)("store.widget.overlay","store.widget.overlay.zIndex"),h("design:type",Number),h("design:paramtypes",[])],t.prototype,"zIndex",null),t=e=d([Object(o.s)("nn-dap"),Object(o.t)(o.d.Element,r.a,s.a),h("design:paramtypes",[Element,r.a,s.a])],t)}()},"dap/nn-dap.html":function(t,e){t.exports='<template>\n    <nnc-dap-tour if.bind="tour"\n                  steps.one-time="tour.steps"\n                  confirm-cancel.one-time="tour.confirmCancel"\n                  confirm-cancel-message.one-time="tour.confirmCancelMessage"\n                  auto-start.one-time="true"\n                  default-step-options.one-time="defaults"\n                  use-modal-overlay.one-time="true"\n                  substitutions.one-time="subs"\n                  nncdapevent.trigger="eventHandle($event)"\n                  rtl.one-time="store.rtl"\n                  z-index.one-time="zIndex"\n                  ref="tourElement"></nnc-dap-tour>\n</template>'},"dialog/css/nn-dialog.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto-dialog-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;background-color:transparent;position:absolute;top:0;left:0;height:100%;width:100%;opacity:0;-webkit-transition:opacity .2s cubic-bezier(0.25, 0.8, 0.25, 1);transition:opacity .2s cubic-bezier(0.25, 0.8, 0.25, 1);opacity:0;overflow-x:hidden;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:12px;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;outline:0}.annoto-dialog-container.active{opacity:1;overflow:auto;-ms-scroll-chaining:none;overscroll-behavior:none}.annoto-dialog-container nn-dialog{width:calc(100% - 16px)}.annoto-dialog-container.nn-dialog-fixed{position:fixed}.annoto-dialog-overlay{display:block;pointer-events:none;background-color:transparent;position:absolute;top:0;left:0;height:100%;width:100%;visibility:hidden;opacity:0;-webkit-transition:opacity .2s cubic-bezier(0.25, 0.8, 0.25, 1);transition:opacity .2s cubic-bezier(0.25, 0.8, 0.25, 1)}.annoto-dialog-overlay.active{opacity:1;pointer-events:auto;visibility:visible;background-color:rgba(0,0,0,.36)}.annoto-dialog-overlay.active.nn-dialog-dark-overlay{background-color:rgba(34,40,49,.9)}.annoto-dialog-overlay.nn-dialog-fixed{position:fixed}.annoto .annoto-dialog{display:inline-block;padding:12px;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:3px;position:relative}.annoto .annoto-dialog .annoto-dialog-message{margin:12px 0 0 0;min-height:46px;-webkit-box-sizing:border-box;box-sizing:border-box;white-space:pre-wrap}.annoto .annoto-dialog .annoto-dialog-footer{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end}.annoto .annoto-dialog .annoto-dialog-header{margin:8px 0;padding:0 12px;text-align:initial}.annoto .nn-dialog-close-btn{position:absolute;top:16px;right:16px;--nnc-color: #fff;color:#fff}@media only screen and (max-width: 640px){.annoto .nn-dialog-close-btn{top:4px;right:4px}}.annoto.nnc-rtl .annoto-dialog .annoto-dialog-message{direction:rtl}",""]),e.default=i},"dialog/index":function(t,e,n){"use strict";n.r(e),n.d(e,"configure",(function(){return w})),n.d(e,"DialogService",(function(){return g})),n.d(e,"DialogController",(function(){return m.a})),n.d(e,"YesNoDialog",(function(){return y.YesNoDialog})),n.d(e,"AlertDialog",(function(){return v.AlertDialog}));n("aurelia-framework");var o,i=n(0),r=n(5),a=n(29),s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a};var c=function(){function t(){}var e;return e=t,t.keyboardEventHandler=function(t){var n=function(t){return"Escape"===(t.code||t.key)||27===t.keyCode?"Escape":"Enter"===(t.code||t.key)||13===t.keyCode?"Enter":void 0}(t);if(n){var o=e.dialogControllers[e.dialogControllers.length-1];o&&o.settings.keyboard&&("Escape"===n?o.cancel():"Enter"===n&&o.ok())}},t.trackController=function(t){e.dialogControllers.length||i.DOM.addEventListener("keyup",e.keyboardEventHandler,!1),e.dialogControllers.push(t)},t.untrackController=function(t){var n=e.dialogControllers.indexOf(t);-1!==n&&e.dialogControllers.splice(n,1),e.dialogControllers.length||i.DOM.removeEventListener("keyup",e.keyboardEventHandler,!1)},t.prototype.getOwnElements=function(t,e){for(var n=t.querySelectorAll(e),o=[],i=0;i<n.length;i++)n[i].parentElement===t&&o.push(n[i]);return o},t.prototype.attach=function(t){this.dialogContainer.className="annoto-dialog-container"+(t.settings.fixed?" nn-dialog-fixed":""),this.dialogOverlay=i.DOM.createElement("nn-dialog-overlay"),this.dialogOverlay.className="annoto-dialog-overlay"+(t.settings.fixed?" nn-dialog-fixed":"")+(t.settings.darkOverlay?" nn-dialog-dark-overlay":"");var e="number"==typeof t.settings.startingZIndex?t.settings.startingZIndex+"":null;this.dialogOverlay.style.zIndex=e,this.dialogContainer.style.zIndex=e;var n=this.getOwnElements(this.host,"nn-dialog-container").pop();n&&n.parentElement?(this.host.insertBefore(this.dialogContainer,n.nextSibling),this.host.insertBefore(this.dialogOverlay,n.nextSibling)):(this.host.insertBefore(this.dialogContainer,this.host.firstChild),this.host.insertBefore(this.dialogOverlay,this.host.firstChild)),t.controller.attached(),this.host.classList.add("nn-dialog-open")},t.prototype.detach=function(t){this.host.removeChild(this.dialogOverlay),this.host.removeChild(this.dialogContainer),t.controller.detached(),e.dialogControllers.length||this.host.classList.remove("nn-dialog-open")},t.prototype.setAsActive=function(){this.dialogOverlay.classList.add("active"),this.dialogContainer.classList.add("active")},t.prototype.setAsInactive=function(){this.dialogOverlay.classList.remove("active"),this.dialogContainer.classList.remove("active")},t.prototype.setupClickHandling=function(t){this.stopPropagation=function(t){t._aureliaDialogHostClicked=!0},this.closeDialogClick=function(e){t.settings.overlayDismiss&&!e._aureliaDialogHostClicked&&t.cancel()},this.dialogContainer.addEventListener("click",this.closeDialogClick),this.dialogContainer.getElementsByClassName("annoto-dialog")[0].addEventListener("click",this.stopPropagation)},t.prototype.clearClickHandling=function(){this.dialogContainer.removeEventListener("click",this.closeDialogClick),this.dialogContainer.removeEventListener("click",this.stopPropagation)},t.prototype.awaitTransition=function(t){return Object(a.c)(50).then((function(){return t()}))},t.prototype.getDialogContainer=function(){return this.dialogContainer||(this.dialogContainer=i.DOM.createElement("nn-dialog-container"))},t.prototype.showDialog=function(t){var n=this;o||(o=i.DOM.querySelectorAll("body")[0]);var r=t.settings;return r.host?this.host=r.host:this.host=o,this.attach(t),"function"==typeof r.position&&r.position(this.dialogContainer,this.dialogOverlay),e.trackController(t),this.setupClickHandling(t),this.awaitTransition((function(){return n.setAsActive()}))},t.prototype.hideDialog=function(t){var n=this;return this.clearClickHandling(),e.untrackController(t),this.awaitTransition((function(){return n.setAsInactive()})).then((function(){n.detach(t)}))},t.dialogControllers=[],t=e=s([Object(r.transient)()],t)}(),l=n(98),u=n(1),p=n(3),d=function(){this.lock=!0,this.startingZIndex=1e3,this.ignoreTransitions=!1,this.focusOnClose=!0},h=n(99),m=n(64);function f(t,e){return this.then((function(t){return t.wasCancelled?t:t.closeResult})).then(t,e)}var g=function(){function t(t,e,n){this.controllers=[],this.hasOpenDialog=!1,this.hasActiveDialog=!1,this.container=t,this.compositionEngine=e,this.defaultSettings=n}return t.prototype.validateSettings=function(t){if(!t.viewModel&&!t.view)throw new Error('Invalid Dialog Settings. You must provide "viewModel", "view" or both.')},t.prototype.createCompositionContext=function(t,e,n){return{container:t.parent,childContainer:t,bindingContext:null,viewResources:null,model:n.model,view:n.view,viewModel:n.viewModel,viewSlot:new p.o(e,!0),host:e}},t.prototype.ensureViewModel=function(t){if("function"==typeof t.viewModel){var e=u.Origin.get(t.viewModel).moduleId;if(!e)return Promise.reject(new Error('Can not resolve "moduleId" of "'+t.viewModel.name+'".'));t.viewModel=e}return"string"==typeof t.viewModel?this.compositionEngine.ensureViewModel(t):Promise.resolve(t)},t.prototype.composeAndShowDialog=function(t,e){var n=this;return t.viewModel||(t.bindingContext={controller:e}),this.compositionEngine.compose(t).then((function(t){return e.controller=t,e.renderer.showDialog(e).then((function(){n.controllers.push(e),n.hasActiveDialog=n.hasOpenDialog=!!n.controllers.length}),(function(e){return t.viewModel&&Object(h.a)(t.viewModel,"deactivate"),Promise.reject(e)}))}))},t.prototype.createSettings=function(t){return"boolean"!=typeof(t=Object.assign({},this.defaultSettings,t)).overlayDismiss&&(t.overlayDismiss=!t.lock),t.container=t.container||this.container,this.validateSettings(t),t},t.prototype.open=function(t){var e=this;void 0===t&&(t={});var n,o,i=(t=this.createSettings(t)).container.createChild(),r=new Promise((function(t,e){n=t,o=e})),a=i.invoke(m.a,[t,n,o]);i.registerInstance(m.a,a),r.then((function(){b(e,a)}),(function(){b(e,a)}));var s,c=this.createCompositionContext(i,a.renderer.getDialogContainer(),a.settings),l=this.ensureViewModel(c).then((function(t){return!t.viewModel||Object(h.a)(t.viewModel,"canActivate",a.settings.model)})).then((function(t){return t?e.composeAndShowDialog(c,a).then((function(){return{controller:a,closeResult:r,wasCancelled:!1}})):{wasCancelled:!0}}));return(s=l).whenClosed=f,s},t.prototype.closeAll=function(){return Promise.all(this.controllers.slice(0).map((function(t){return t.cancel().then((function(e){return e.wasCancelled?t:null}))}))).then((function(t){return t.filter((function(t){return!!t}))}))},t.inject=[r.Container,p.e,d],t}();function b(t,e){var n=t.controllers.indexOf(e);-1!==n&&(t.controllers.splice(n,1),t.hasActiveDialog=t.hasOpenDialog=!!t.controllers.length)}var y=n("dialog/views/nn-yes-no"),v=n("dialog/views/nn-alert");function w(t){t.globalResources("./nn-dialog"),t.globalResources("./nn-dialog-header"),t.globalResources("./nn-dialog-body"),t.globalResources("./nn-dialog-footer"),t.transient(l.a,c)}},"dialog/nn-dialog":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoDialog",(function(){return l}));var o=n("aurelia-framework"),i=n(54),r=n(43),a=n(64),s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},l=function(){function t(t,e){this.el=t,this.controller=e,this.focusOnClose=!0,this.loading=!1,this.settings=e.settings}return t.prototype.attached=function(){this.activeEl=document.activeElement,this.dialogEl&&this.dialogEl.focus()},t.prototype.detached=function(){var t=this.controller.settings;t.focusOnClose&&i.a.setFocusOnEl(t.activeElement?t.activeElement():this.activeEl)},t.prototype.keydownHandle=function(t){return Object(r.e)(t,"esc")?(t.stopPropagation(),t.preventDefault(),this.controller.cancel(),!1):i.a.focusTrap(t,this.dialogEl)},t.prototype.closeClickHandle=function(t){return t.stopPropagation(),t.preventDefault(),this.controller.cancel(),!1},s([Object(o.m)(),c("design:type",Boolean)],t.prototype,"focusOnClose",void 0),s([Object(o.m)(),c("design:type",Boolean)],t.prototype,"loading",void 0),t=s([Object(o.s)("nn-dialog"),Object(o.t)(o.d.Element,a.a),c("design:paramtypes",[HTMLElement,a.a])],t)}()},"dialog/nn-dialog-body":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoDialogBody",(function(){return r}));var o=n(3),i=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},r=function(){function t(){}return t=i([Object(o.t)("nn-dialog-body"),o.u("\n  <template>\n    <slot></slot>\n  </template>\n")],t)}()},"dialog/nn-dialog-footer":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoDialogFooter",(function(){return r}));var o=n(3),i=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},r=function(){function t(){}return t=i([Object(o.t)("nn-dialog-footer"),o.u('\n    <template>\n        <div class="annoto-dialog-footer">\n            <slot></slot>\n        </div>\n    </template>\n')],t)}()},"dialog/nn-dialog-header":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoDialogHeader",(function(){return c}));var o=n(3),i=n("aurelia-framework"),r=n(36),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.store=t}return t=a([Object(o.t)("nn-dialog-header"),o.u('\n    <template>\n        <div class="annoto-dialog-header nn-text-color nn-text-title" dir="auto" amdl-rtl.one-time="store.rtl">\n            <slot></slot>\n        </div>\n    </template>\n'),Object(i.t)(r.a),s("design:paramtypes",[r.a])],t)}()},"dialog/nn-dialog.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-dialog.scss"></require>\n    <div class="annoto-dialog nn-color-background-secondary"\n         nn-focusable="index: -1" ref="dialogEl"\n         keydown.delegate="keydownHandle($event)"\n         role="alertdialog"\n         aria-modal="true">\n        <slot></slot>\n    </div>\n    <nnc-button if.bind="settings.closeBtn" class="nn-dialog-close-btn" fill="clear" click.trigger="closeClickHandle($event)">\n        <nnc-icon slot="icon" name="close" size="lg"></nnc-icon>\n    </nnc-button>\n    <nnc-backdrop-spinner color="tertiary" active.bind="loading"></nnc-backdrop-spinner>\n</template>'},"dialog/views/nn-alert":function(t,e,n){"use strict";n.r(e),n.d(e,"AlertDialog",(function(){return l}));var o=n("aurelia-framework"),i=n(57),r=n.n(i),a=n(64),s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},l=function(){function t(t){this.controller=t}return t.prototype.activate=function(t){this.data={message:""},r()(this.data,t)},t=s([Object(o.s)("nn-alert"),Object(o.t)(a.a),c("design:paramtypes",[a.a])],t)}()},"dialog/views/nn-alert.html":function(t,e){t.exports='<template>\n    <nn-dialog>\n        <nn-dialog-body>\n            <p class="annoto-dialog-message nn-text-body nn-color-grey-heavy">${data.message | t}</p>\n        </nn-dialog-body>\n\n        <nn-dialog-footer>\n            <nnc-button color="dark" fill="clear" ripple click.trigger="controller.ok()" >${\'generic.ok\' & t}</nnc-button>\n        </nn-dialog-footer>\n    </nn-dialog>\n</template>'},"dialog/views/nn-yes-no":function(t,e,n){"use strict";n.r(e),n.d(e,"YesNoDialog",(function(){return l}));var o=n("aurelia-framework"),i=n(57),r=n.n(i),a=n(64),s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},l=function(){function t(t){this.controller=t}return t.prototype.activate=function(t){this.data={message:"",yesBtnText:"generic.yes",noBtnText:"generic.cancel"},r()(this.data,t)},t=s([Object(o.s)("nn-yes-no"),Object(o.t)(a.a),c("design:paramtypes",[a.a])],t)}()},"dialog/views/nn-yes-no.html":function(t,e){t.exports='<template>\n    <nn-dialog>\n        <nn-dialog-body>\n            <p class="annoto-dialog-message nn-text-body nn-color-grey-heavy">${data.message | t}</p>\n        </nn-dialog-body>\n\n        <nn-dialog-footer>\n            <nnc-button color="dark" fill="clear" size="sm" ripple click.trigger="controller.cancel()">${data.noBtnText & t}</nnc-button>\n            <nnc-button color="dark" fill="outline" size="sm" ripple click.trigger="controller.ok()">${data.yesBtnText & t}</nnc-button>\n        </nn-dialog-footer>\n    </nn-dialog>\n</template>'},"locales/en/translation.json":function(t,e){t.exports={comment_form:{cancel:"cancel",message:{not_ready:"Loading...",login:"Log in to add a comment...",login_notes:"Log in to write a personal note...",ready:"Add a comment...",unauth_sso:"Log in to the site",ready_notes:"Write a personal note..."},toolbar:{anonymous:"post as anonymous\n(only moderators will see your details)",video_recorder:"Record video using your webcam or screen"}},comment:{reply:"reply",replies:"{{count}} Reply",replies_plural:"{{count}} Replies",replies_false:"Hide reply",replies_false_plural:"Hide replies",pending:"Pending approval",deleted:"Deleted by moderator",actions:{delete:"Delete",edit:"Edit",spam:"Report spam"},delete_confirmation:{message:"Are you sure you want to delete this comment?",ok:"DELETE",cancel:"CANCEL"},moderator_text:"Admin",moderator_text_ld:"Educator",badges:{moderator_like:"Educator's thumbs up!"},anonymous:"posted as anonymous"},note:{actions:{delete:"Delete",edit:"Edit"},delete_confirmation:{message:"Are you sure you want to delete this note?",ok:"DELETE",cancel:"CANCEL"}},thread:{sort:{recent:"Newest",rating:"Top Comments",tag:"Timestamp"},cta:{comments:"Get the conversation started!\nAsk a question, share an idea or leave a comment at any point.",notes:"Make personal notes that only you can see.",short_comments:"Get the conversation started!",short_notes:"Make a personal note."},following:"Following this discussion",not_following:"Click to follow this discussion"},drawer:{comments:"Comments",notes:"Personal Notes",login:"Log In / Sign Up",logout:"Log Out",preferences:"Preferences",my_space:"My Space",people:"People",docs:"Guide and Tips"},auth:{title:{welcome:"Welcome!",login:"Welcome Back!",signup:"Create a Free Account",anonymous_post:"Post as"},form:{email:"Your Email",name:"Full Name",pass:"Password",username:"Your Username"},button:{next:"Next",login:"Sign In",signup:"Sign Up"},or:"OR",social:{google:"Sign In with Google",facebook:"Sign In with Facebook",twitter:"Sign In with Twitter",linkedin:"Sign In with LinkedIn"},consent:"By creating account, you agree to our",terms:"Terms of use",privacy:"Privacy",err:{consent:"Please agree to our terms of use below to Sign Up"},welcome:{title:"Thank You for Signing up with Annoto!",msg:"Please visit your email to finish the registration process. After you verify your account, please sign in.",button:"All Done, Sign me In",footer:"If you don't receive an email within a few minutes, please try again or contact"},anonymous_consent:"By posting, you agree to our"},preferences:{title:"Preferences",section:{advanced:"Advanced",notifications:"Email Nofications"},group_notifications:{title:"Followed Groups",subtitle:"Enable/Disable email notifications for all the groups you follow (course/playlist/user groups)"},thread_notifications:{title:"Followed Discussions",subtitle:"Enable/Disable email notifications for all the discussions you follow"},comment_notifications:{title:"Followed Comments",subtitle:"Enable/Disable email notifications for all the comments you follow"},reply_notifications:{title:"Replies",subtitle:"Enable/Disable email notifications for replies to all of your comments"}},cta:{submit:"submit",skip:"skip",type:{"yes-no":"Yes/No question","multiple-choice":"Multiple choice question","open-ended":"Open ended question",completion:"Completion question",errata:"Errata",note:"Notice",enrich:"Enrichment",video:"Video Clip"},ok:"ok"},tut:{hide:"Close",minimise:"Minimize",show:"Open",open:"Open to add a reaction",resizing:"Drag to resize the window",drag:"You can move or resize the window",dragging:"Drag to move the window",sync_scroll:"Sync to video playback time",form_send:"Enter to send / Shift + Enter to add a new line",feed:"Activity Feed"},emotion:{unknown:"Unknown",neutral:"Neutral",like:"Like",lol:"LOL",angry:"Angry",sad:"Sad",touched:"Touched",bored:"Bored",wow:"WOW",not_ok:"Disagree",help_buoy:"Happy to help",mark:"Mark",help:"Question",idea:"Insight",ok:"Agree"},widget:{header:{live:"Live"},tabs:{notes:"Personal Notes",comments:"Comments",people:"People"}},generic:{yes:"yes",no:"no",cancel:"cancel",submit:"submit",send:"send",guest_username:"Guest",ok:"ok",vote:"vote",votes:"{{count}} vote",votes_plural:"{{count}} votes",sentiment:"sentiment",anonymous:"anonymous",export:"export",post:"post",save:"save",search:"search"},group:{following:"Following this group",not_following:"Click to follow this group"},aaa:{logo:"Annoto logo",widget:{section_home:"Discussion section.",section_home_private:"Discussion section. Personal notes",section_auth:"Discussion section. Sign-in",section_preferences:"Discussion section. Preferences",section_mini:"Discussion section in minimized mode.",section_mini_private:"Discussion section in minimized mode. Personal notes",minibar_button:"{{count}} comments",minibar_button_private:"{{count}} personal notes",drawer_button:"Main menu"},thread:{sort:"Sort menu"},comment:{timestamp:"comment timestamp, click to jump to {{time}}"},note:{timestamp:"note timestamp, click to jump to {{time}}"}},errors:{default:"Oops, something went wrong.\nPlease check your network. Refreshing the page might help as well.",ugc:{action:"Sorry, we were unable to complete the action.\nPlease check your network. Refreshing the page might help as well."}},user_space:{space_tab:"My Space",feed_tab:"Feed",back_btn:"back",activity_feed:"Activity Feed",feed_comment:{replies:"{{count}} more reply",replies_plural:"{{count}} more replies"},me:"me",tooltip:{my_history:"Only show content submitted by me",everyone:"Everyone"},empty_feed:"There is no activity :( Be the first to comment!",empty_following_feed:"Want to stay on top of things? Follow discussions and you will see all the activity here",empty_mine_feed:"Don't be shy, write a comment on any content, so you can see your activity here",group_activity:{title:"My Activity",comments:"Comments",notes:"Personal Notes"},profile:{title:"Profile",subtitle:"Fill your profile so people can know more about you.",headline_label:"Headline",headline_placeholder:"A short description about yourself",social_title:"Social",twiter_label:"Twitter",linkedin_label:"LinkedIn",website_label:"Website",website_placeholder:"https://www.example.com"}},user_hint:{request_feedback:"Was this helpful?",dismiss_hint:"(will dismiss the message)",helpful:"helpful",not_helpful:"not helpful"},people:{private_session_invite:{invite_btn:"Invite to Private Meeting",inviting_btn:"Sending Invite...",message:"Hi {{name}}, I'm inviting you to a private meeting at:"}},video_recorder:{settings:{title:"Recording Settings",mode:{camera:"Camera",screen:"Screen",mix:"Screen and Camera"},start_recording:"Start Recording",mode_input:"Recording Mode",audio_input:"Recording Audio Input",video_input:"Recording Video Input"}}}},"organs/auth/css/nn-anonymous-auth-dialog.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-anonymous-auth-dialog{max-width:400px}.annoto .annoto-anonymous-auth-dialog .annoto-dialog-header{text-transform:capitalize}.annoto .annoto-anonymous-auth-dialog .annoto-anonymous-auth-form{margin:0;padding:0;position:relative}.annoto .annoto-anonymous-auth-dialog nn-dialog-body>div{padding:0 16px}.annoto .annoto-anonymous-auth-dialog amdl-textfield{width:100%}.annoto .annoto-anonymous-auth-dialog .annoto-auth-consent{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;padding:8px 16px 16px}.annoto .annoto-anonymous-auth-dialog .annoto-auth-consent .amdl-checkbox__label{display:none}.annoto .annoto-anonymous-auth-dialog .annoto-auth-consent-text{margin-right:8px}.annoto .annoto-anonymous-auth-dialog .annoto-auth-consent-text>p{margin:auto;max-width:260px}.annoto .annoto-anonymous-auth-dialog .annoto-auth-consent-text a{color:var(--nnc-color-step-350, #585858)}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .annoto-anonymous-auth-dialog .annoto-auth-consent-text a{color:#585858}}.annoto .annoto-anonymous-auth-dialog .annoto-g-recaptcha{margin:0;padding:0}.annoto .annoto-anonymous-auth-dialog .annoto-spinner-container{position:absolute;top:0;bottom:0;right:0;left:0;pointer-events:none;z-index:2;background:rgba(0,0,0,.1);display:none}.annoto .annoto-anonymous-auth-dialog.nn-loading .annoto-spinner-container{display:-webkit-box;display:-ms-flexbox;display:flex}.annoto.nnc-rtl .annoto-anonymous-auth-dialog .annoto-auth-consent{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}",""]),e.default=i},"organs/auth/css/nn-auth-social-button.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-auth-social-button{margin:0;display:inline-table;text-align:center;background-color:transparent;border-radius:5px}.annoto .annoto-auth-social-button .annoto-auth-social-btn{display:inline-block}.annoto.nnc-rtl .annoto-auth-social-button .annoto-auth-social-btn{direction:rtl}",""]),e.default=i},"organs/auth/nn-anonymous-auth-dialog":function(t,e,n){"use strict";n.r(e),n.d(e,"AnonymousAuthDialog",(function(){return f}));var o=n("aurelia-framework"),i=n("aurelia-validation"),r=n(32),a=n("dialog/index"),s=n(36),c=n(43),l=n(29),u=n(159),p=n(34),d=n(11),h=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},m=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},f=function(){function t(t,e,n,r){var a=this;this.vController=t,this.controller=e,this.store=n,this.locale=r,this.consent=!0,this.showError=!1,this.isValid=!1,this.captchaOk=!1,this.loading=!0,this.logger=o.h.getLogger("Annoto-anonymous-auth"),t.validateTrigger=i.validateTrigger.changeOrBlur,t.subscribe((function(t){"reset"!==t.type&&(a.isValid=t.results.every((function(t){return t.valid})))}))}return t.prototype.activate=function(t){},t.prototype.attached=function(){var t=this;this.loadRecaptcha((function(e){e?t.logger.warn("recaptcha verify error: ",e):Object(l.c)(50).then((function(){t.loading=!1,t.nameVm.setFocus()}))}))},t.prototype.detached=function(){clearTimeout(this.challengePromptTimer),void 0!==typeof grecaptcha&&this.recaptchaId&&grecaptcha.reset(this.recaptchaId)},Object.defineProperty(t.prototype,"submitDisabled",{get:function(){return!this.isValid||!this.captchaOk||!this.consent},enumerable:!1,configurable:!0}),t.prototype.submitHandle=function(){var t=this,e=this.store;this.submitDisabled||e.user.anonymousSignup({name:this.name,consent:1,"g-recaptcha-response":grecaptcha.getResponse(this.recaptchaId)}).then((function(){return Object(l.c)(100)})).then((function(){t.controller.ok()})).catch((function(t){e.errorHandler.alert(p.b.USER.ANONYMOUS_REJECTED,t)}))},t.prototype.keyPress=function(t){return Object(c.e)(t,"enter")&&this.nameVm.clearFocus(),!0},t.prototype.loadRecaptcha=function(t){var e=this,n=this.store;this.loadRecaptchaScript().then((function(){grecaptcha.ready((function(){var o=grecaptcha.render(e.recaptchaEl,{sitekey:d.e.ENV.AUTH.RECAPTCHA_KEY,size:"invisible",isolated:!0,theme:n.widget.isDark?"dark":"light",badge:"bottomleft",callback:function(n){clearTimeout(e.challengePromptTimer),e.captchaOk=!0,t(null,n)},"error-callback":function(){clearTimeout(e.challengePromptTimer),e.captchaOk=!1,t(new Error)},"expired-callback":function(){e.captchaOk=!1,setTimeout((function(){e.loading=!0,grecaptcha.execute(e.recaptchaId)}),0)}});e.recaptchaId=o,clearTimeout(e.challengePromptTimer),Object(c.d)()&&(e.challengePromptTimer=setTimeout((function(){grecaptcha.reset(e.recaptchaId),Object(c.d)()&&Object(c.c)(),setTimeout((function(){grecaptcha.execute(e.recaptchaId)}),3e3)}),5e3)),grecaptcha.execute(e.recaptchaId)}))})).catch((function(e){t&&t(e)}))},t.prototype.loadRecaptchaScript=function(){var t=this,e=this.store;return new Promise((function(n,o){if("undefined"!=typeof grecaptcha)return n();e.initializer.assetLoader.loadScript("https://www.google.com/recaptcha/api.js?hl="+t.locale.getLocale()+"&render=explicit",(function(t){if(t)return o(t);n()}))}))},h([Object(o.p)("isValid","captchaOk","consent"),m("design:type",Boolean),m("design:paramtypes",[])],t.prototype,"submitDisabled",null),t=h([Object(o.s)("nn-anonymous-auth-dialog"),Object(o.t)(o.i.of(i.ValidationController),a.DialogController,s.a,u.a),m("design:paramtypes",[i.ValidationController,a.DialogController,s.a,u.a])],t)}(),g=r.a.validation.user;i.ValidationRules.ensure("name").displayName("Name").required().minLength(g.name.minLength).maxLength(g.name.maxLength).matches(g.name.expression).withMessage("Can contain only letters and space.").on(f)},"organs/auth/nn-anonymous-auth-dialog.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-anonymous-auth-dialog.scss"></require>\n    <nn-dialog class="annoto-anonymous-auth-dialog ${loading ? \'nn-loading\' : \'\'}">\n        <nn-dialog-header>\n            ${\'auth.title.anonymous_post\' & t & oneTime}\n        </nn-dialog-header>\n\n        <form class="annoto-anonymous-auth-form" submit.delegate="submitHandle()">\n            <nn-dialog-body>\n                <div class="annoto-flex-row-wrap annoto-flex-justify-center annoto-flex-align-center">\n                    <amdl-textfield placeholder="${\'auth.form.username\' & t & oneTime}" value.two-way="name & validate"\n                        validation-errors.bind="nameErrors" errors.bind="nameErrors" view-model.ref="nameVm" dir="auto"\n                        required.one-time="true" rtl.bind="store.rtl" keypress.trigger="keyPress($event)"\n                        disabled.bind="loading">\n                    </amdl-textfield>\n                </div>\n                <div class="annoto-auth-consent annoto-flex-row-nowrap annoto-flex-align-center">\n                    <amdl-checkbox checked.bind="consent" disabled.bind="loading"></amdl-checkbox>\n                    <div class="annoto-auth-consent-text">\n                        <p class="nn-text-caption">${\'auth.anonymous_consent\' & t}</p>\n                        <p class="nn-text-caption">\n                            <a target="_blank" href="http://annoto.net/terms">${\'auth.terms\' & t}</a> & <a target="_blank" href="http://annoto.net/privacy">${\'auth.privacy\' & t}</a>\n                        </p>\n                    </div>\n                </div>\n            </nn-dialog-body>\n\n            <nn-dialog-footer>\n                <nnc-button color="secondary" ripple disabled.bind="submitDisabled" click.trigger="submitHandle()">${\'generic.post\' & t & oneTime}</nnc-button>\n            </nn-dialog-footer>\n\n            <div class="annoto-g-recaptcha" ref="recaptchaEl"></div>\n            <div class="annoto-spinner-container annoto-flex-row-wrap annoto-flex-justify-center annoto-flex-align-center">\n                <amdl-spinner active.bind="loading"></amdl-spinner>\n            </div>\n        </form>\n    </nn-dialog>\n\n</template>'},"organs/auth/nn-auth-social-button":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoAuthSocialButton",(function(){return s}));var o=n("aurelia-framework"),i=n(166),r=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(){function t(t){this.config={},this.element=t,this.element.style.textAlign="center"}return t.prototype.clickHandle=function(){"function"==typeof this.click&&this.click()},t.prototype.providerChanged=function(t,e){t&&(this.config=i.b[t])},r([o.m,a("design:type",Object)],t.prototype,"click",void 0),r([o.m,a("design:type",Object)],t.prototype,"provider",void 0),t=r([Object(o.s)("nn-auth-social-button"),Object(o.t)(o.d.Element),a("design:paramtypes",[Object])],t)}()},"organs/auth/nn-auth-social-button.html":function(t,e,n){t.exports='<template>\n  <require from="./css/nn-auth-social-button.scss"></require>\n\n  <div class="annoto-auth-social-button annoto-shadow-6dp" with.bind="config">\n    <amdl-button class="annoto-auth-social-btn" click.call="clickHandle()" type="icon"\n               icon-class.bind="iconClass" button-style.bind="iconStyle"></amdl-button>\n    <amdl-button class="annoto-auth-social-btn" click.call="clickHandle()" text="${text & t}"\n               align="center" button-style.bind="buttonStyle"></amdl-button>\n  </div>\n</template>\n'},"organs/auth/nn-auth-title.html":function(t,e){t.exports='<template bindable="text">\n\n  <div class="annoto-auth-title">\n    <p amdl-text="headline" class="nn-text-center nn-color-accent">${text}</p>\n  </div>\n\n</template>\n'},"organs/comment-form/css/nn-comment-form.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-comment-form{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:visible;margin:0}.annoto .annoto-comment-form>div{position:relative;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-comment-form>div .annoto-comment-form-avatar-container{z-index:20;display:block}.annoto .annoto-comment-form>div .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector{display:block}.annoto .annoto-comment-form>div .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-avatar{cursor:pointer}.annoto .annoto-comment-form>div .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-avatar .annoto-photo{border:hidden}.annoto .annoto-comment-form>div .annoto-comment-form-avatar-container .annoto-comment-form-emotion-selector .annoto-emotion{border-radius:50%}.annoto .annoto-comment-form>div .annoto-form-container{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 8px 0 16px;-webkit-box-flex:2;-ms-flex-positive:2;flex-grow:2;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-ms-flex-item-align:center;align-self:center}.annoto .annoto-comment-form>div .annoto-form-container .annoto-comment-form-body{width:100%}.annoto .annoto-comment-form>div .annoto-form-container .annoto-comment-form-body>.amdl-textfield{width:100%;padding:0}.annoto .annoto-comment-form>div .annoto-form-container .annoto-comment-form-body>.amdl-textfield>.amdl-textfield__input{width:100%;min-height:32px;-webkit-box-sizing:border-box;box-sizing:border-box;line-height:1.3em;font-size:15px;text-align:initial}.annoto .annoto-comment-form>div .annoto-form-container .annoto-comment-form-body>.amdl-textfield>.amdl-textfield__label{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;top:0;bottom:0;line-height:32px;font-size:15px;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.annoto .annoto-comment-form>div .annoto-form-container .annoto-comment-form-body>.amdl-textfield>.amdl-textfield__label:after{bottom:0}.annoto .annoto-comment-form>div .annoto-form-container .annoto-comment-form-body>.amdl-textfield.is-invalid{margin-bottom:20px}.annoto .annoto-comment-form>div .annoto-form-container .annoto-comment-form-toolbar{width:100%;padding:0;border-top:1px solid #a4a4a4;z-index:19}.annoto .annoto-comment-form>div .annoto-form-container .annoto-comment-form-toolbar .amdl-icon-toggle{margin:2px}.annoto .annoto-comment-form>div .annoto-comment-form-overlay{position:absolute;top:0;bottom:0;left:0;right:0;cursor:pointer}.annoto .annoto-comment-form .annoto-comment-form-btns button{padding:0 4px;min-width:48px}.annoto.sso-noauth .annoto-comment-form{opacity:.6;pointer-events:none}.annoto.sso-noauth .annoto-comment-form>div .annoto-form-container .annoto-comment-form-body>.amdl-textfield .amdl-textfield__input{cursor:default}.annoto.nnc-rtl .annoto-comment-form .annoto-form-container{margin:0 16px 0 8px}.annoto.nn-notes-page .annoto-comment-form>div .annoto-form-container,.annoto.nnc-rtl.nn-notes-page .annoto-comment-form>div .annoto-form-container{margin:0 8px}",""]),e.default=i},"organs/comment-form/nn-comment-form":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoCommentForm",(function(){return x}));var o=n("aurelia-framework"),i=n("aurelia-validation"),r=n(191),a=n.n(r),s=n(264),c=n(49),l=n("organs/widget/nn-widget"),u=n(35),p=n(31),d=n(32),h=n(29),m=n(48),f=n(43),g=n(192),b=n(44),y=n(34),v=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},w=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},O=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},_=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},x=function(){function t(t,e,n){var r=this;this.id=Object(h.i)(),this.thisVm=this,this.body="",this.emotion=null,this.defaultEmotion=m.a.createUnknownEmotion(),this.emotionPosition="top-right",this.disabled=!0,this.features={},this.rows=1,this.isOpen=!1,this.message="",this.openLock=0,this.submitting=!1,this.isBodyFocused=!1,this.disposables=[],this.recorderDisposables=[],this.videoRecorderStartHandle=function(t){return O(r,void 0,void 0,(function(){var e,n,o;return _(this,(function(i){switch(i.label){case 0:e=this.store,i.label=1;case 1:return i.trys.push([1,3,,4]),this.recordingMedia=!0,n=this,[4,this.uploader.start({groupId:e.groupId,threadId:e.threadId},{type:"video",meta:{mime:t.detail.mime,title:"Video comment "+Object(s.a)(new Date,"PPp")+" ("+e.user.name+")",description:"Posted in "+e.threadController.title+" ["+this.ps+"] ("+e.threadController.groupTitle+")"}})];case 2:return n.asset=i.sent(),[3,4];case 3:return o=i.sent(),this.recordingMedia=!1,this.detachVideoRecorder(),e.errorHandler.alert(y.b.COMMENTS.ASSET_START,o,this.logger),[3,4];case 4:return[2]}}))}))},this.videoRecorderDataHandle=function(t){return O(r,void 0,void 0,(function(){return _(this,(function(e){return this.uploader.push(t.detail.data),[2]}))}))},this.videoRecorderStopHandle=function(t){return O(r,void 0,void 0,(function(){var e,n,o,i,r,a,s,c=this;return _(this,(function(l){switch(l.label){case 0:e=this.store,n=this.uploader,this.detachVideoRecorder(),o=function(t){return O(c,void 0,void 0,(function(){var n=this;return _(this,(function(o){switch(o.label){case 0:return this.logger.debug("discarding asset"),this.store.analyticsController.recordGaEvent({collection:"video_record",action:"discard"}),t&&setTimeout((function(){return e.errorHandler.alert(y.b.COMMENTS.ASSET_POST,t,n.logger)}),50),[4,this.assetDiscard()];case 1:return o.sent(),[2]}}))}))},i={srcObj:t.detail.data},l.label=1;case 1:return l.trys.push([1,3,,4]),[4,e.dialog.open({viewModel:"organs/comment-form/video-preview-dialog/nn-video-preview-dialog",lock:!0,fixed:!0,host:e.widget.containerElement,container:e.widget.auContainer,overlayDismiss:!1,darkOverlay:!0,closeBtn:!0,model:i}).whenClosed((function(t){return t}))];case 2:return l.sent().wasCancelled?[2,o()]:[3,4];case 3:return r=l.sent(),this.logger.debug("video preview dialog error:",r),[2,o(r)];case 4:this.endingMedia=!0,l.label=5;case 5:return l.trys.push([5,7,,8]),a=this,[4,n.end()];case 6:return a.asset=l.sent(),this.logger.debug("asset processing done"),[3,8];case 7:return s=l.sent(),this.store.analyticsController.recordGaEvent({collection:"video_record",action:"upload_error"}),[2,o(s)];case 8:return this.store.analyticsController.recordGaEvent({collection:"video_record",action:"submit"}),this.recordingMedia=!1,this.endingMedia=!1,this.submit(),[2]}}))}))},this.videRecorderCancelHandle=function(){r.detachVideoRecorder(),r.store.analyticsController.recordGaEvent({collection:"video_record",action:"cancel"})},this.playerFsChangeHandle=function(){r.setVideoRecorderZIndex()},this.vController=t,t.validateTrigger=i.validateTrigger.manual,this.user=e,this.widget=n,this.store=n.store,this.logger=o.h.getLogger("Annoto-comment-form")}var e;return e=t,t.prototype.bind=function(t,e){var n=this;if("function"!=typeof this.onSubmit)throw new TypeError("on-submit is a mandatory binding");this.resetEmotion(),this.disposables.push(this.widget.pubSub.subscribe(p.a.COMMENT_FORM_OPEN,(function(t){t!==n&&n.cancel()}))),this.disposables.push(this.store.player.on(b.b.FULL_SCREEN_CHANGE,this.playerFsChangeHandle))},t.prototype.unbind=function(){Object(f.b)(this.disposables),this.disposables=[],this.assetDiscard(),this.detachVideoRecorder(),this.body="",this.message="",this.emotion=null,this.submitting=!1,this.isOpen=!1,this.isBodyFocused=!1,this.openLock=0},t.prototype.attached=function(){var t=this,e=this.data;e&&(this.body=e.body,setTimeout((function(){if(t.bodyVm.update(),e.emotion&&t.emotionsBoxVm){var n=t.emotionsBoxVm.select(e.emotion);n&&(t.emotion=n)}}),0),this.canPostAnonymous&&e.anonymous&&(this.isAnonymous=!0)),a()(this.bodyVm.inputElement)},t.prototype.detached=function(){a.a.destroy(this.bodyVm.inputElement)},t.prototype.openForm=function(){this.bodyVm&&this.bodyVm.setFocus(!0)},t.prototype.emotionSelect=function(t){this.emotion=t,this.voteVm&&this.voteVm.close()},t.prototype.emotionSelectClickHandle=function(t){this.bodyVm.setFocus(),this.voteVm&&this.voteVm.emotionsBoxSelectHandle(t)},t.prototype.emotionSelectorClickHandle=function(){this.voteVm&&(this.voteVm.isOpen||this.voteVm.open(),this.resetEmotion(),this.openForm())},t.prototype.emotionSelectorOpen=function(){this.updateIsOpen(!0)},t.prototype.emotionSelectorClose=function(){this.updateIsOpen(!1)},t.prototype.submit=function(){var t=this,e=this.store;if(!this.submitting)return this.submitting=!0,this.vController.validate().then((function(n){if(!n.valid)throw new Error(n.results[0].message);if(t.user.anonymousEnabled&&!t.user.authenticated)return e.dialog.open({viewModel:"organs/auth/nn-anonymous-auth-dialog",lock:!1,host:e.widget.containerElement,container:e.widget.auContainer}).whenClosed((function(e){if(!t.user.authenticated)throw new Error}))})).then((function(){var e=t.asset;return t.onSubmit({data:{body:t.body||void 0,data:e?{media:{assetId:e.id,type:e.type}}:void 0,ps:t.ps,emotion:t.emotion?t.emotion.type:void 0,anonymous:t.canPostAnonymous?t.isAnonymous:void 0}})})).then((function(e){if(!1===e)throw new Error;t.reset()})).catch((function(){t.submitting=!1}))},t.prototype.cancel=function(){this.reset(),"function"==typeof this.onCancel&&this.onCancel()},t.prototype.reset=function(){var t=this;this.body="",this.isAnonymous=void 0,this.bodyVm&&this.bodyVm.clear(),this.voteVm&&this.voteVm.close(),this.resetEmotion(),this.assetDiscard(),this.detachVideoRecorder(),this.isOpen=!1,this.submitting=!1,setTimeout((function(){t.isOpen&&(t.openLock=0,t.updateIsOpenHandle(!1))}),e.closeDelay+25)},t.prototype.resetEmotion=function(){this.emotion=this.defaultEmotion,this.emotionsBoxVm&&this.emotionsBoxVm.reset()},Object.defineProperty(t.prototype,"ps",{get:function(){var t=this.store.player;return t?t.pp:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasOverlay",{get:function(){return!this.user.authenticated&&!this.user.anonymousEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"postDisabled",{get:function(){return this.updateMessage(),this.disabled||!this.user.authenticated&&!this.user.anonymousEnabled||this.submitting||this.recordingMedia},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"submitDisabled",{get:function(){return Boolean(this.postDisabled||!this.body||this.body.length<1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this.submitting||this.endingMedia},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasAvatar",{get:function(){return Boolean(this.store.settings.commentSentimentEnabled||!this.store.isPrivateMode)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sentimentDisabled",{get:function(){return!this.store.settings.commentSentimentEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"avatarFlip",{get:function(){return Boolean(!this.sentimentDisabled&&(this.isOpen||this.store.isPrivateMode))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hideControls",{get:function(){return Boolean(!this.isOpen&&!this.features.cancelBtn&&this.store.isPhone)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCancel",{get:function(){return Boolean(this.features.cancelBtn||this.store.isPhone)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"avatarUrl",{get:function(){return this.user.photoUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showPlus",{get:function(){var t=this.user;return!t.authenticated||t.photoUrl===t.defaultPhoto},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasName",{get:function(){return"generic.guest_username"!==this.user.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canPostAnonymous",{get:function(){return this.store.anonymousCommentsEnabled&&!this.user.isModerator&&!this.store.isPrivateMode&&!this.user.anonymousEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoEnabled",{get:function(){return this.store.settings.videoCommentsEnabled&&!this.data&&!this.store.isPrivateMode&&!this.store.demoIsActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasToolbar",{get:function(){return this.canPostAnonymous||this.videoEnabled},enumerable:!1,configurable:!0}),t.prototype.formClick=function(t){return!this.hasOverlay||t.target!==this.overlayEl||this.overlayClick()},t.prototype.formKbClick=function(t){if(this.hasOverlay)return this.overlayClick();this.openForm()},t.prototype.bodyKeyPress=function(t){if(t)return this.keyStop(t),!!(!Object(f.e)(t,"enter")||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey)||(this.submit(),!1)},t.prototype.bodyKeyDown=function(t){return t.stopPropagation(),!0},t.prototype.bodyKeyUp=function(t){return this.keyStop(t)},t.prototype.keyStop=function(t){if(t)return t.stopPropagation(),!(Object(f.e)(t,"enter")&&!t.shiftKey&&!t.altKey&&!t.metaKey&&!t.ctrlKey)},t.prototype.bodyFocusChange=function(t,e){!!t!=!!e&&(this.isBodyFocused=t,t&&"function"==typeof this.onOpen&&!this.onOpen()||(this.updateIsOpen(t),t&&(this._pauseVideo(),this.vController.reset({object:this,propertyName:"body"}),this.store.pubSub.publish(p.a.COMMENT_FORM_FOCUS,this))))},t.prototype.textChanged=function(t,e){t!==e&&this.store&&(t&&""!==t?e&&""!==e||this.updateIsOpen(!0):e&&""!==e&&this.updateIsOpen(!1))},t.prototype.isAnonymousChanged=function(t,e){!t!=!e&&this.bodyVm&&this.isOpen&&this.bodyVm.setFocus(!0)},t.prototype.anonymousClickHandle=function(){var t=this;setTimeout((function(){t.store.analyticsController.recordUgcInteraction("anonymous_tap",void 0,{label:t.isAnonymous?"on":"off"})}))},t.prototype.anonymousFocusHandle=function(){this.updateIsOpen(!0)},t.prototype.anonymousBlurHandle=function(){this.updateIsOpen(!1)},t.prototype.isOpenChanged=function(t,e){var n=this;!t!=!e&&this.store&&(t?this.widget.pubSub.publish(p.a.COMMENT_FORM_OPEN,this):(this.isAnonymous=(!this.data||!this.data.anonymous)&&void 0,this.resetEmotion(),this.widget.pubSub.publish(p.a.COMMENT_FORM_CLOSE,this),this.vController.validate()),setTimeout((function(){n.bodyVm&&n.bodyVm.inputElement&&a.a.update(n.bodyVm.inputElement)}),10))},t.prototype.overlayClick=function(){if(!this.user.authenticated){this.widget.pubSub.publish(p.a.PAGES_SHOW,{page:"auth",frame:"welcome"});var t=this.store.isPrivateMode?"note":"comment";this.store.analyticsController.recordConversionInteraction("auth_trigger",{cause:t,element:this.store.interactiveMode?"mini":"thread"},{label:t})}},t.prototype.videoRecordStart=function(){var t=this.store,e=this.attachVideoRecorder();this.recorderDisposables.push(Object(f.a)(e,"nncStart",this.videoRecorderStartHandle)),this.recorderDisposables.push(Object(f.a)(e,"nncStop",this.videoRecorderStopHandle)),this.recorderDisposables.push(Object(f.a)(e,"nncData",this.videoRecorderDataHandle)),this.recorderDisposables.push(Object(f.a)(e,"nncCancel",this.videRecorderCancelHandle)),t.analyticsController.recordGaEvent({collection:"video_record",action:"start"}),this.assetDiscard(),this.uploader=new g.AssetUploader(t.apiService,{concurency:3,partRetries:5})},t.prototype.assetDiscard=function(){return O(this,void 0,void 0,(function(){var t;return _(this,(function(e){switch(e.label){case 0:this.asset=null,t=this.uploader,this.uploader=void 0,e.label=1;case 1:return e.trys.push([1,4,,5]),t&&t.started&&!t.finished?[4,t.abort()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:return e.sent(),[3,5];case 5:return this.recordingMedia=!1,this.endingMedia=!1,[2]}}))}))},t.prototype.setVideoRecorderZIndex=function(){var t=this.store,e=t.player.fullScreen()?t.settings.fsZIndex:t.settings.zIndex;this.videoRecorderEl&&this.videoRecorderEl.style.setProperty("--nnc-z-index",""+(e+1))},t.prototype.attachVideoRecorder=function(){var t,e,n=this.store;this.detachVideoRecorder();var o=document.createElement("nnc-video-recorder");return o.maxDuration=(null===(e=null===(t=n.settings)||void 0===t?void 0:t.limits)||void 0===e?void 0:e.videoCommentDuraion)||180,n.appCommon.appElement.getParent().appendChild(o),this.videoRecorderEl=o,this.setVideoRecorderZIndex(),o},t.prototype.detachVideoRecorder=function(){var t;Object(f.b)(this.recorderDisposables),this.recorderDisposables=[],this.videoRecorderEl&&(null===(t=this.store)||void 0===t||t.appCommon.appElement.getParent().removeChild(this.videoRecorderEl),this.videoRecorderEl=void 0)},t.prototype._pauseVideo=function(){this.store.playerUxFilter.pause(this.store,"formOpen")},t.prototype.updateMessage=function(){var t=this.store;switch(!0){case this.disabled:this.message="comment_form.message.not_ready";break;case this.user.authenticated||this.user.anonymousEnabled:this.message=t.isPrivateMode?"comment_form.message.ready_notes":"comment_form.message.ready";break;case this.user.ssoNotAuthenticated&&this.user.authActionsDisabled:this.message="comment_form.message.unauth_sso";break;default:this.message=t.isPrivateMode?"comment_form.message.login_notes":"comment_form.message.login"}},t.prototype.updateIsOpen=function(t){var n=this;t?(this.store.interactiveController.recordUserAction(),this.updateIsOpenHandle(t)):setTimeout((function(){n.updateIsOpenHandle(t)}),e.closeDelay)},t.prototype.updateIsOpenHandle=function(t){if(t)return this.isOpen=!0,void++this.openLock;--this.openLock,this.openLock<=0&&(this.openLock=0,this.isOpen=!1)},t.closeDelay=200,v([Object(o.v)({changeHandler:"textChanged"}),w("design:type",Object)],t.prototype,"body",void 0),v([o.m,w("design:type",Function)],t.prototype,"onSubmit",void 0),v([o.m,w("design:type",Object)],t.prototype,"onCancel",void 0),v([o.m,w("design:type",Object)],t.prototype,"onOpen",void 0),v([o.m,w("design:type",Object)],t.prototype,"emotionPosition",void 0),v([o.m,w("design:type",Object)],t.prototype,"disabled",void 0),v([o.m,w("design:type",Object)],t.prototype,"features",void 0),v([o.m,w("design:type",Object)],t.prototype,"data",void 0),v([Object(o.m)({changeHandler:"isOpenChanged"}),w("design:type",Object)],t.prototype,"isOpen",void 0),v([Object(o.v)({changeHandler:"isAnonymousChanged"}),w("design:type",Boolean)],t.prototype,"isAnonymous",void 0),v([Object(o.p)("store.player","store.player.pp"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"ps",null),v([Object(o.p)("user.authenticated","user.anonymousEnabled"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"hasOverlay",null),v([Object(o.p)("disabled","user.authenticated","submitting","user.anonymousEnabled","recordingMedia"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"postDisabled",null),v([Object(o.p)("postDisabled","body"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"submitDisabled",null),v([Object(o.p)("submitting","endingMedia"),w("design:type",Boolean),w("design:paramtypes",[])],t.prototype,"processing",null),v([Object(o.p)("store.isPrivateMode","store.settings","store.settings.commentSentimentEnabled"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"hasAvatar",null),v([Object(o.p)("store.settings","store.settings.commentSentimentEnabled"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"sentimentDisabled",null),v([Object(o.p)("isOpen","store.isPrivateMode","sentimentDisabled"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"avatarFlip",null),v([Object(o.p)("isOpen","features","features.cancelBtn","store.isPhone"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"hideControls",null),v([Object(o.p)("features","features.cancelBtn","store.isPhone"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"hasCancel",null),v([Object(o.p)("user.photoUrl"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"avatarUrl",null),v([Object(o.p)("user.authenticated","user.photoUrl"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"showPlus",null),v([Object(o.p)("user.name"),w("design:type",Object),w("design:paramtypes",[])],t.prototype,"hasName",null),v([Object(o.p)("store.anonymousCommentsEnabled","user.isModerator","store.isPrivateMode","user.anonymousEnabled"),w("design:type",Boolean),w("design:paramtypes",[])],t.prototype,"canPostAnonymous",null),v([Object(o.p)("store.settings.videoCommentsEnabled","data","store.isPrivateMode","store.demoIsActive"),w("design:type",Boolean),w("design:paramtypes",[])],t.prototype,"videoEnabled",null),v([Object(o.p)("canPostAnonymous","videoEnabled"),w("design:type",Boolean),w("design:paramtypes",[])],t.prototype,"hasToolbar",null),t=e=v([Object(o.s)("nn-comment-form"),Object(o.t)(o.i.of(i.ValidationController),c.a,u.a.of(l.AnnotoWidget,!0)),w("design:paramtypes",[i.ValidationController,c.a,l.AnnotoWidget])],t)}(),E=d.a.validation.comment;i.ValidationRules.ensure("body").displayName("Comment").required().when((function(t){return t.isOpen&&t.voteVm&&!t.voteVm.isOpen})).withMessage("${$displayName} cannot be empty.").minLength(E.body.minLength).maxLength(E.body.maxLength).ensure("ps").displayName("Time Stamp").required().when((function(t){return!(!t.store.player||!t.store.player.pd)})).satisfies((function(t,e){return!!(!Object(h.k)(t)&&t>=0&&t<=e.store.player.pd)})).on(x)},"organs/comment-form/nn-comment-form.html":function(t,e,n){t.exports='<template>\n\n    <require from="./css/nn-comment-form.scss"></require>\n    <require from="../emotion/nn-emotion-vote"></require>\n    <require from="../emotion/nn-emotions-box"></require>\n    <require from="../flipper/nn-flipper"></require>\n    <require from="../emotion/nn-dynamic-emotion"></require>\n\n    <form class="annoto-comment-form" role="form" submit.delegate="submit()" nn-focusable.bind="message & t" nn-interaction="click.call: formClick(event); enter.call: formKbClick(event);">\n\n        <div class="annoto-comment-form-content annoto-flex-row-nowrap">\n\n            <nn-emotion-vote\n                    if.bind="hasAvatar"\n                    view-model.ref="voteVm"\n                    class="annoto-comment-form-avatar-container"\n                    position.bind="emotionPosition"\n                    on-vote.call="emotionSelect(emotion)"\n                    disabled.bind="postDisabled || sentimentDisabled"\n                    on-open.call="emotionSelectorOpen()"\n                    on-close.call="emotionSelectorClose()"\n                    on-selector-click.call="emotionSelectorClickHandle()"\n                    aaa-label.one-time="\'generic.sentiment\' & t">\n                <nn-flipper slot="emotion-selector"\n                        class="annoto-comment-form-emotion-selector" flip.bind="avatarFlip" disabled.bind="postDisabled" flip-on-hover.one-time="false">\n                    <div slot="front"\n                         if.bind="!store.isPrivateMode"  class="annoto-avatar">\n                        <div class="annoto-photo" css="background-image: url(${showPlus ? \'#\' : avatarUrl});">\n                            <i if.bind="showPlus" class="annoto-icon annoto-icon-add_circle nn-icon-user_avatar"></i>\n                        </div>\n                    </div>\n                    <nn-dynamic-emotion slot="back"\n                        if.bind="!sentimentDisabled"\n                        data.bind="emotion"></nn-dynamic-emotion>\n                </nn-flipper>\n                <nn-emotions-box slot="emotions-box"\n                            if.bind="!sentimentDisabled"\n                            view-model.ref="emotionsBoxVm"\n                            emotions.bind="voteVm.emotions"\n                            columns.bind="voteVm.columnsNum"\n                            rows.bind="voteVm.rowsNum"\n                            on-select.call="emotionSelectClickHandle(index)"></nn-emotions-box>\n            </nn-emotion-vote>\n\n            <div class="annoto-form-container">\n                <div if.bind="features.userName" class="annoto-comment-form-user" amdl-rtl.bind="store.rtl">\n                    <div class="nn-color-grey">${hasName ? user.name : \'\' & t}</div>\n                </div>\n\n                <div if.bind="hasToolbar" show.bind="isOpen" class="annoto-comment-form-toolbar annoto-flex-row-nowrap annoto-flex-align-center annoto-fade-in">\n                    <amdl-icon-toggle\n                        if.bind="canPostAnonymous"\n                        id="annoto-form-anonymous-${id & oneTime}"\n                        icon-class="annoto-icon annoto-20 annoto-icon-anonymous nn-icon-anonymous"\n                        checked.bind="isAnonymous"\n                        color-class="accent"\n                        on-focus.call="anonymousFocusHandle()"\n                        on-blur.call="anonymousBlurHandle()"\n                        click.call="anonymousClickHandle()"\n                        index.one-time="0"\n                        label.one-time="\'comment_form.toolbar.anonymous\' & t">\n                        <nnc-tooltip slot="end" for="annoto-form-anonymous-${id & oneTime}" position="top" size="sm">${\'comment_form.toolbar.anonymous\' & t\n                            & oneTime}</nnc-tooltip>\n                    </amdl-icon-toggle>\n                    \n                    <div if.bind="videoEnabled">\n                        <nnc-button\n                            id="nn-form-video-rec-btn-${id & oneTime}"\n                            color=\'tertiary\' size=\'sm\' ripple fill=\'clear\'\n                            disabled.bind="postDisabled"\n                            click.trigger=\'videoRecordStart()\'>\n                            <nnc-icon slot=\'icon\' name=\'media-camera\'></nnc-icon>\n                        </nnc-button>\n                        <nnc-tooltip for="nn-form-video-rec-btn-${id & oneTime}" position="top" size="sm">${\'comment_form.toolbar.video_recorder\' & t\n                            & oneTime}</nnc-tooltip>\n                    </div>\n                </div>\n\n                <amdl-textarea class="annoto-comment-form-body"\n                            view-model.ref="bodyVm"\n                            value.bind="body & validate"\n                            validation-errors.bind="bodyErrors"\n                            errors.bind="bodyErrors"\n                            dir="auto"\n                            rows.bind="rows"\n                            focus-change.call="bodyFocusChange(value, old)"\n                            disabled.bind="postDisabled"\n                            placeholder="${message & t}"\n                            keydown.trigger="bodyKeyDown($event)"\n                            keyup.trigger="bodyKeyUp($event)"\n                            keypress.trigger="bodyKeyPress($event)"\n                            rtl.bind="store.rtl"\n                            required.one-time="true"\n                            id="annoto-form-body-${id & oneTime}"\n                            aaa-label.bind="\'tut.form_send\' & t">\n                </amdl-textarea>\n                <nnc-tooltip for="annoto-form-body-${id & oneTime}" position="top" size="sm">${\'tut.form_send\' & t & oneTime}</nnc-tooltip>\n\n            </div>\n\n            <nnc-button size="sm" color="secondary" ripple disabled.bind="submitDisabled" type="submit">\n                <nnc-spinner if.bind="processing" slot="icon" type="android" size="sm"></nnc-spinner>\n                <nnc-icon else slot="icon" name="send"></nnc-icon>\n            </nnc-button>\n\n            <div if.bind="hasOverlay" class="annoto-comment-form-overlay" ref="overlayEl"></div>\n        </div>\n\n        <div class="annoto-comment-form-btns annoto-flex-row-nowrap" show.bind="!hideControls">\n            <amdl-button if.bind="hasCancel"\n                            class="annoto-comment-form-cancel"\n                            text="${\'comment_form.cancel\' & t}"\n                            color-class="grey"\n                            ripple.one-time="true"\n                            click.call="cancel()"\n                            label.one-time="\'generic.cancel\' & t"></amdl-button>\n        </div>\n    </form>\n\n</template>\n'},"organs/comment-form/video-preview-dialog/nn-video-preview-dialog":function(t,e,n){"use strict";n.r(e),n.d(e,"VideoPreviewDialog",(function(){return u}));var o=n("aurelia-framework"),i=n("dialog/index"),r=n(29),a=n(36),s=function(){return(s=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e){this.controller=t,this.store=e,this.processing=!1}return t.prototype.activate=function(t){this.data=s({},t)},t.prototype.attached=function(){},t.prototype.detached=function(){this.processing=!1},t.prototype.postClickHandle=function(t){var e=this;return t.preventDefault(),t.stopPropagation(),this.processing=!0,Object(r.c)(300).then((function(){e.controller.ok()})),!1},t=c([Object(o.s)("nn-video-preview-dialog"),Object(o.t)(i.DialogController,a.a),l("design:paramtypes",[i.DialogController,a.a])],t)}()},"organs/comment-form/video-preview-dialog/nn-video-preview-dialog.html":function(t,e,n){t.exports="<template>\n    <require from=\"./nn-video-preview-dialog.scss\"></require>\n\n    <nn-dialog class=\"annoto-video-preview-dialog annoto\" loading.bind=\"processing\">\n        <nnc-video-player if.bind=\"!!(data && data.srcObj)\" src-obj.one-time=\"data.srcObj\" autoplay nopip></nnc-video-player>\n        <nn-dialog-footer>\n            <nnc-button color='secondary' fill='raised' ripple click.trigger='postClickHandle($event)'>\n                ${'generic.post' & t & oneTime}\n                <nnc-icon slot='end' name='send'></nnc-icon>\n            </nnc-button>\n        </nn-dialog-footer>\n    </nn-dialog>\n</template>"},"organs/comment-form/video-preview-dialog/nn-video-preview-dialog.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto-dialog-container{padding:0}.annoto-dialog-container .annoto-video-preview-dialog{max-width:1024px;width:calc(100% - 36px);max-height:100%}.annoto-dialog-container .annoto-video-preview-dialog>.annoto-dialog{height:100%;padding:0;overflow:hidden;border-radius:6px}@media only screen and (max-width: 1280px)and (min-aspect-ratio: 4/3)and (orientation: landscape){.annoto-dialog-container .annoto-video-preview-dialog{width:calc(100% - 20vw)}}@media only screen and (max-width: 1280px)and (min-aspect-ratio: 18/9)and (orientation: landscape){.annoto-dialog-container .annoto-video-preview-dialog{width:calc(100% - 40vw)}}",""]),e.default=i},"organs/comment/comment-media-dialog/nn-comment-media-dialog":function(t,e,n){"use strict";n.r(e),n.d(e,"CommentMediaDialog",(function(){return p}));var o=n("aurelia-framework"),i=n("dialog/index"),r=n(36),a=function(){return(a=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},l=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))},u=function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},p=function(){function t(t,e){this.controller=t,this.store=e}return t.prototype.activate=function(t){this.data=a({},t),this.loadAsset()},t.prototype.loadAsset=function(){return l(this,void 0,void 0,(function(){var t,e,n,o,i,r;return u(this,(function(a){switch(a.label){case 0:e=(t=this).store,n=t.data,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.apiService.getCommentMedia({id:n.model.id,threadId:n.model.threadId})];case 2:if(!(o=a.sent()))throw new Error("media not found");return i=o[n.model.data.media.assetId],this.provider=i.provider,this.src=i.url,[3,4];case 3:return r=a.sent(),this.controller.error(r),[3,4];case 4:return[2]}}))}))},t=s([Object(o.s)("nn-comment-media-dialog"),Object(o.t)(i.DialogController,r.a),c("design:paramtypes",[i.DialogController,r.a])],t)}()},"organs/comment/comment-media-dialog/nn-comment-media-dialog.html":function(t,e,n){t.exports='<template>\n    <require from="./nn-comment-media-dialog.scss"></require>\n\n    <nn-dialog class="annoto-comment-media-dialog annoto">\n        <template if.bind="!!src">\n            <nnc-kaltura-player if.bind="provider === \'kaltura\'" src.bind="src" autoplay></nnc-kaltura-player>\n            <nnc-vjs-player else src.bind="src" autoplay nodownload></nnc-vjs-player>\n        </template>\n    </nn-dialog>\n</template>'},"organs/comment/comment-media-dialog/nn-comment-media-dialog.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto-dialog-container{padding:0}.annoto-dialog-container .annoto-comment-media-dialog{max-width:1024px;width:calc(100% - 36px);max-height:100%}.annoto-dialog-container .annoto-comment-media-dialog>.annoto-dialog{height:100%;padding:0;background:transparent}@media only screen and (max-width: 1280px)and (min-aspect-ratio: 4/3)and (orientation: landscape){.annoto-dialog-container .annoto-comment-media-dialog{width:calc(100% - 20vw)}}@media only screen and (max-width: 1280px)and (min-aspect-ratio: 18/9)and (orientation: landscape){.annoto-dialog-container .annoto-comment-media-dialog{width:calc(100% - 30vw)}}",""]),e.default=i},"organs/comment/css/nn-comment.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-comment{position:relative;width:100%;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;padding:4px;font-size:16px}.annoto .annoto-comment .annoto-comment-anonymous-caption{margin:0 0 0 14px}.annoto .annoto-comment .annoto-comment-anonymous-caption>.annoto-icon{margin:0 2px}.annoto .annoto-comment .annoto-comment-container{position:relative}.annoto .annoto-comment .annoto-comment-container>.annoto-avatar{position:relative;margin:4px;z-index:11;overflow:visible}.annoto .annoto-comment .annoto-comment-container>.annoto-avatar .annoto-comment-emotion{position:absolute}.annoto .annoto-comment .annoto-comment-container>.annoto-avatar .annoto-comment-author-role{position:absolute;left:0;right:0;bottom:-32px;display:-webkit-box;display:-ms-flexbox;display:flex;line-height:1;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.annoto .annoto-comment .annoto-comment-container>.annoto-container{margin:0 4px;width:100%;min-width:0;min-height:32px}.annoto .annoto-comment .annoto-comment-container>.annoto-moderator-organ{display:none}.annoto .annoto-comment .annoto-comment-container .nn-comment-bubble{width:100%;background-color:var(--nnc-comment-bubble-bg, rgba(90, 101, 114, 0.06));padding:8px;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:9px;position:relative}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta{margin:0;-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end;height:16px;max-width:64px;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote{padding:0 2px;position:relative;-webkit-box-sizing:content-box;box-sizing:content-box;margin:0 0 0 -4px;background-clip:border-box;display:inline-block;border-radius:50%}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote.vote-0{z-index:3;margin-left:-2px}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote.vote-1{z-index:2}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote.vote-2{display:none}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote.vote-3{display:none}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote.vote-4{display:none}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote.vote-5{display:none}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote .annoto-comment-vote-emotion{left:2px;top:0;position:absolute;display:block}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta .annoto-comment-vote-count{display:none}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta:hover .annoto-comment-votes-count{display:none}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta:hover .annoto-comment-vote{display:inline-block;margin:0}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta:hover .annoto-comment-vote.vote-0{margin-left:-2px}.annoto .annoto-comment .annoto-comment-container .annoto-comment-votes-meta:hover .annoto-comment-vote-count{display:inline-block}.annoto .annoto-comment .annoto-comment-container .annoto-comment-mod-like-badge{position:absolute;bottom:2px;left:-12px;z-index:10;padding:0}.annoto .annoto-comment .annoto-comment-container .annoto-comment-mod-like-badge .annoto-mod-like-badge-icon{display:block}.annoto .annoto-comment .annoto-comment-form-container{display:block;max-height:100%;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-comment .annoto-comment-form-container .annoto-comment-form{background:inherit}.annoto .annoto-comment .annoto-comment-replies{width:100%;margin:0;list-style-type:none;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-comment.moderator.pending{border:1px solid orange}.annoto .annoto-comment.moderator.pending:hover .annoto-comment-container>.annoto-avatar{opacity:.2}.annoto .annoto-comment.moderator.pending:hover .annoto-comment-container>.annoto-moderator-organ{display:block}.annoto .annoto-comment.editing>.annoto-comment-anonymous-caption,.annoto .annoto-comment.editing>.annoto-comment-container,.annoto .annoto-comment.editing>.annoto-comment-replies{display:none}.annoto .annoto-comment.editing>.annoto-comment-form-container{padding:0}.annoto .annoto-comment.nn-anonymous>.annoto-comment-container>.annoto-avatar>.annoto-photo,.annoto .annoto-comment.nn-anonymous>.annoto-comment-container>.annoto-avatar>nnc-avatar{background-size:70% auto;background-color:var(--nnc-color-step-500, #7d7d7d)}.annoto .annoto-comment.nn-mod-like .annoto-comment-votes-meta{margin:0 4px}.annoto.nnc-rtl .annoto-comment .annoto-comment-anonymous-caption{margin:0 14px 0 0}.annoto.nnc-rtl .annoto-comment .annoto-comment-votes-meta{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;margin-left:auto}.annoto.nnc-rtl .annoto-comment .annoto-comment-votes-meta .annoto-comment-vote{margin:0 -4px 0 0}.annoto.nnc-rtl .annoto-comment .annoto-comment-votes-meta .annoto-comment-vote.vote-0{margin-left:0;margin-right:-2px}.annoto.nnc-rtl .annoto-comment .annoto-comment-votes-meta:hover .annoto-comment-vote{margin:0}.annoto.nnc-rtl .annoto-comment .annoto-comment-votes-meta:hover .annoto-comment-vote.vote-0{margin-left:0;margin-right:-2px}.annoto.nnc-rtl .annoto-comment .annoto-comment-mod-like-badge{right:-12px;left:auto}.annoto.nnc-rtl .annoto-comment.editing .annoto-comment-form-container{padding:0}",""]),e.default=i},"organs/comment/css/nn-content.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-comment .annoto-comment-content{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-comment .annoto-comment-content .annoto-comment-topic,.annoto .annoto-comment .annoto-comment-content .annoto-comment-body{text-align:initial}.annoto .annoto-comment .annoto-comment-content .annoto-comment-topic p,.annoto .annoto-comment .annoto-comment-content .annoto-comment-body p{word-wrap:break-word;overflow-wrap:break-word;word-break:break-word;margin:0;width:100%}.annoto .annoto-comment .annoto-comment-content .annoto-comment-topic p{margin-bottom:0}.annoto .annoto-comment .annoto-comment-content .annoto-comment-body p{white-space:pre-wrap;font-size:var(--nnc-comment-typo-body-size, 15px)}.annoto .annoto-comment .annoto-comment-content .nn-comment-media{width:100%;padding:8px 0}.annoto .annoto-comment .annoto-comment-content .nn-comment-media nnc-button{--nnc-border-width: 1px;--nnc-border-style: dashed}.annoto.nnc-mobile.is-landscape.phone-form-open .annoto-comment .annoto-comment-content .annoto-comment-body p{max-height:32px;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}",""]),e.default=i},"organs/comment/css/nn-footer.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-comment .annoto-comment-footer{min-height:16px;width:100%;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.annoto .annoto-comment .annoto-comment-footer .annoto-replies-toggle>label{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:0 8px;height:24px;cursor:pointer}.annoto .annoto-comment .annoto-comment-footer .annoto-replies-toggle>label>span{vertical-align:text-top;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding:0}.annoto .annoto-comment .annoto-comment-footer .annoto-replies-toggle>label>span::after,.annoto .annoto-comment .annoto-comment-footer .annoto-replies-toggle>label>span::before{display:none}.annoto .annoto-comment .annoto-comment-footer .annoto-replies-toggle>label>i{min-width:18px;width:18px}.annoto .annoto-comment .annoto-comment-footer .annoto-comment-reply-actions{z-index:4;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.annoto .annoto-comment .annoto-comment-footer .annoto-comment-reply-actions .annoto-emotion-vote .annoto-emotion-selector{border-radius:50%}.annoto .annoto-comment .annoto-comment-footer .annoto-comment-reply-actions .annoto-emotion-vote .annoto-emotion-selector .annoto-comment-vote-selector{display:inherit}.annoto .annoto-comment .annoto-comment-footer .annoto-comment-reply-actions .annoto-emotion-vote .annoto-emotion-selector .annoto-comment-vote-selector .annoto-emotion{height:24px;width:24px}.annoto .annoto-comment .annoto-comment-footer .annoto-comment-reply-actions .annoto-comment-user-vote .annoto-emotion{height:24px;width:24px}.annoto .annoto-comment .annoto-comment-footer .annoto-comment-reply-actions .annoto-comment-reply-button{font-weight:400;text-transform:capitalize;--nnc-padding-start: .5em;--nnc-padding-end: .5em}.annoto.sso-noauth .annoto-comment .annoto-comment-footer .annoto-comment-reply-actions .annoto-comment-reply-button{opacity:.6;pointer-events:none}",""]),e.default=i},"organs/comment/css/nn-header.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-comment .annoto-comment-header{width:100%;height:16px;line-height:16px;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.annoto .annoto-comment .annoto-comment-header .annoto-flex-row-nowrap,.annoto .annoto-comment .annoto-comment-header .annoto-flex-row-wrap{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.annoto .annoto-comment .annoto-comment-header .annoto-comment-date{-ms-flex-negative:1000;flex-shrink:1000;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.annoto .annoto-comment .annoto-comment-header .annoto-comment-author-name{-ms-flex-negative:1;flex-shrink:1;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.annoto .annoto-comment .annoto-comment-header .annoto-flex-spacer{height:100%}.annoto .annoto-comment .annoto-comment-header .annoto-comment-ps,.annoto .annoto-comment .annoto-comment-header .annoto-comment-date{margin:0 4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.annoto .annoto-comment .annoto-comment-header .annoto-comment-ps{padding:0 4px;-ms-flex-negative:0;flex-shrink:0;cursor:pointer}.annoto:not(.is-touch) .annoto-comment .annoto-comment-header .annoto-comment-menu{position:absolute;top:0;bottom:0;right:0;-webkit-transition:visibility 0s linear 0.1s,opacity .1s linear 0s;transition:visibility 0s linear 0.1s,opacity .1s linear 0s;opacity:0;visibility:hidden}.annoto:not(.is-touch) .annoto-comment .annoto-comment-header .annoto-comment-date{opacity:1;-webkit-transition:visibility 0s linear 0s,opacity .2s linear .1s;transition:visibility 0s linear 0s,opacity .2s linear .1s;visibility:visible}.annoto:not(.is-touch) .annoto-comment.has-menu .annoto-comment-header:focus-within .annoto-comment-menu,.annoto:not(.is-touch) .annoto-comment.has-menu .annoto-comment-header:hover .annoto-comment-menu{opacity:1;visibility:visible;-webkit-transition:visibility 0s linear 0s,opacity .1s linear .2s;transition:visibility 0s linear 0s,opacity .1s linear .2s}.annoto:not(.is-touch) .annoto-comment.has-menu .annoto-comment-header:focus-within .annoto-comment-date,.annoto:not(.is-touch) .annoto-comment.has-menu .annoto-comment-header:hover .annoto-comment-date{opacity:0;visibility:hidden;-webkit-transition:visibility 0s linear 0.2s,opacity .2s linear 0s;transition:visibility 0s linear 0.2s,opacity .2s linear 0s}.annoto:not(.is-touch) .annoto-comment.has-menu.owner:focus-within .annoto-comment-header .annoto-comment-menu,.annoto:not(.is-touch) .annoto-comment.has-menu.owner:hover .annoto-comment-header .annoto-comment-menu{opacity:1;visibility:visible;-webkit-transition:visibility 0s linear 0s,opacity .1s linear .2s;transition:visibility 0s linear 0s,opacity .1s linear .2s}.annoto:not(.is-touch) .annoto-comment.has-menu.owner:focus-within .annoto-comment-header .annoto-comment-date,.annoto:not(.is-touch) .annoto-comment.has-menu.owner:hover .annoto-comment-header .annoto-comment-date{opacity:0;visibility:hidden;-webkit-transition:visibility 0s linear 0.2s,opacity .2s linear 0s;transition:visibility 0s linear 0.2s,opacity .2s linear 0s}.annoto:not(.is-touch) .annoto-comment.has-menu.menu-open .annoto-comment-header .annoto-comment-menu{opacity:1;visibility:visible;-webkit-transition:visibility 0s linear 0s,opacity .1s linear .2s;transition:visibility 0s linear 0s,opacity .1s linear .2s}.annoto:not(.is-touch) .annoto-comment.has-menu.menu-open .annoto-comment-header .annoto-comment-date{opacity:0;visibility:hidden;-webkit-transition:visibility 0s linear 0.2s,opacity .2s linear 0s;transition:visibility 0s linear 0.2s,opacity .2s linear 0s}.annoto.nnc-rtl:not(.is-touch) .annoto-comment .annoto-comment-header .annoto-comment-menu{right:auto;left:0}.annoto.is-live .annoto-comment .annoto-comment-header .annoto-comment-ps{cursor:default}",""]),e.default=i},"organs/comment/nn-comment":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoCommentOrgan",(function(){return _}));var o=n("aurelia-framework"),i=n(251),r=n(84),a=n.n(r),s=n(29),c=n(38),l=n("organs/widget/nn-widget"),u=n(32),p=n(31),d=n(11),h=n(60),m=n(48),f=n("aurelia-templating-resources"),g=n(73),b=n("dialog/index"),y=n(54),v=n(34),w=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},O=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},_=function(){function t(t,e,n,i){this.element=t,this.dialog=i,this.thisVm=this,this.emotionsSortConfig={property:"count",order:"desc",comparison:"number",enabled:!0,value:"count"},this.repliesHidden=!0,this.showForm=!1,this.childFormOpen=!1,this.votePosition="left",this.formEmotionPosition="top-right",this.submitting=!1,this.editing=!1,this.voteSelector=m.a.createLikeOEmotion(),this.formFeatures={cancelBtn:!0,userName:!1},this.widget=n,this.store=n.store,this.signaler=e,this.user=this.store.user,t.style.display="inherit",this.logger=o.h.getLogger("Annoto-comment")}var e;return e=t,t.prototype.bind=function(t,n){if(this.ancestor&&!(this.ancestor instanceof e))throw new TypeError("comment ancestor must be of type AnnotoCommentOrgan");this.rtl?this.votePosition="right":this.votePosition="left",(this.showRepliesByDefault||!this.repliesHidden||this.last&&this.store.isLive&&this.data.repliesCount>0)&&(this.repliesHidden=!1,this.loadReplies())},t.prototype.unbind=function(){this.submitting=!1,this.editing=!1},t.prototype.replyFormShow=function(){var t=this;return this.store.interactiveController.recordUserAction(),this.user.authenticated||this.store.pubSub.publish(p.a.PAGES_SHOW,{page:"auth",frame:"welcome"}),this.canShowReply?this.replyOpenDisable?Promise.resolve():this.data.depth<u.a.thread.maxDepth?(this.repliesHidden=!1,this.loadReplies().then((function(){return Object(s.c)()})).then((function(){return t.formShow()}))):this.ancestor?this.ancestor.replyFormShow():void 0:Promise.resolve()},t.prototype.setFocus=function(){this.focusableEl&&this.focusableEl.focus()},t.prototype.replyClick=function(){if("function"==typeof this.onReply&&this.onReply({vm:this}),!this.replyOpenDisable)return this.ancestor?this.ancestor.replyClick():void this.replyFormShow()},t.prototype.onFormSubmit=function(t){var e=this;if(!this.submitting)return this.submitting=!0,(this.editing?this.editSubmit(t):this.replySubmit(t)).then((function(){e.submitting=!1})).catch((function(){return e.submitting=!1,!1}))},t.prototype.voteSelectorClickHandle=function(){if(this.store.voteEmotionsDisabled||!this.widget.platform.touchScreen||this.voteVm.isOpen){var t=m.a.createLikeEmotion(),e=m.a.createVoteFromEmotion(t,this.store.user.author);return this.submitVote(e)}this.voteVm.open()},t.prototype.submitVote=function(t){var e=this,n=this.store,o=n.user;if(!this.submitting)return this.submitting=!0,n.interactiveController.recordUserAction(),o.authenticated?this.doVoteSubmit(t):(n.analyticsController.recordConversionInteraction("auth_trigger",{cause:"vote",element:this.store.interactiveMode?"mini":"thread",comment:this.data.info,vote:t.info},{label:"vote",value:this.data.length}),o.anonymousEnabled?n.dialog.open({viewModel:"organs/auth/nn-anonymous-auth-dialog",lock:!1,host:n.widget.containerElement,container:n.widget.auContainer}).whenClosed((function(){if(o.authenticated)return e.doVoteSubmit(t)})).finally((function(){e.submitting=!1})):(this.submitting=!1,n.widget.pubSub.publish(p.a.PAGES_SHOW,{page:"auth",frame:"welcome"})))},t.prototype.doVoteSubmit=function(t){var e=this;return this.store.commentsController.postCommentVote(this.data,t).then((function(){return e.submitting=!1,Object(s.c)()})).then((function(){y.a.setFocusOnEl(e.userVoteEl)}))},t.prototype.psClick=function(t){var e=this.store,n=this.data;if(e.interactiveController.recordUserAction(),t.stopPropagation(),this.hasPS){e.playerUxFilter.setCurrentTime(e,n.ps);var o=n.info,i=e.interactiveMode?"mini":"thread";e.analyticsController.recordUgcInteraction("timetag_tap",{element:i,comment:o},{label:i,value:n.length})}},t.prototype.repliesToggleClick=function(){var t=this;return this.store.interactiveController.recordUserAction(),Object(s.c)().then((function(){var e=t.store;if(!t.repliesHidden){t.loadReplies();var n=t.data.info,o=e.interactiveMode?"mini":"thread";e.analyticsController.recordUgcInteraction("show_replies",{element:o,comment:n},{label:o,value:t.data.discussionCount})}})),!0},t.prototype.actionHandle=function(t){return this.store.interactiveController.recordUserAction(),this.canEditAndOwner?this.ownerActionHandle(t):this.moderatorActionHandle(t)},t.prototype.clickHandle=function(){return this.store.interactiveController.recordUserAction(),"function"!=typeof this.onClick||this.onClick({vm:this})},Object.defineProperty(t.prototype,"rtl",{get:function(){return this.store.rtl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPhone",{get:function(){return this.store.isPhone},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showRepliesByDefault",{get:function(){return Boolean(this.store.api&&this.store.api.thread.showReplies||this.store.dapDemoIsActive)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasEmotion",{get:function(){return!!this.data.emotion},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPS",{get:function(){return this.data.hasPS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showPs",{get:function(){var t=this.store,e=this.data;return!(!this.hasPS||0!==e.depth||t.hidePs||!t.timelineEnabled&&!e.ps&&t.isLive)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showEmotion",{get:function(){var t=this.data.emotion;return!(!t||t.type===c.c.UNKNOWN)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showTopic",{get:function(){return!(0!==this.data.depth||!this.data.topic||""===this.data.topic)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showBody",{get:function(){return!(!this.data.body||""===this.data.body)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasMedia",{get:function(){var t,e;return null===(e=null===(t=this.data.data)||void 0===t?void 0:t.media)||void 0===e?void 0:e.assetId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showReplies",{get:function(){return Boolean(this.hasReplies&&!this.repliesHidden&&this.data.isVisible)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doShowForm",{get:function(){return Boolean(this.showForm&&this.data.isVisible)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showReplyActions",{get:function(){return Boolean(!this.showForm||this.store.dapDemoIsActive)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasReplies",{get:function(){return!!(this.data.repliesCount&&this.data.repliesCount>0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canShowReply",{get:function(){return this.store.commentsSubmitEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOwner",{get:function(){return Object(s.z)(this.user.id,this.data.author.id)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isModerator",{get:function(){return Boolean(this.data.author&&this.data.author.scopes&&-1!==this.data.author.scopes.indexOf("moderator"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showRole",{get:function(){return this.isModerator&&!this.isDeleted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roleText",{get:function(){return"comment.moderator_text"+(this.store.isELearning?"_ld":"")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roleIcon",{get:function(){return this.store.isELearning?"annoto-icon-school":"annoto-icon-stars"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canEditAndOwner",{get:function(){var t=this.data;return Boolean(this.isOwner&&(t.isVisible||t.isPending)&&0===t.repliesCount&&0===t.emotionsCount&&(this.user.isModerator||Object(i.a)(new Date,t.createdAt)<u.a.thread.editInterval))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasEmotions",{get:function(){return!!(this.data.emotionsCount&&this.data.emotionsCount>0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emotionsVotes",{get:function(){var t=this,e=[],n=[c.c.UNKNOWN,c.c.NEUTRAL,c.c.LIKE_O];return this.data.emotionsVotes&&Object(s.f)(this.data.emotionsVotes,(function(o,i){if(-1===n.indexOf(o)&&i>0){var r=new g.a(null,o,t.store.settings.emotionsParams[o]);e.push({emotion:r,count:i})}})),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phoneHideOnFormOpen",{get:function(){return!(!this.isPhone||this.childFormOpen||this.showForm||!this.widget||!this.widget.someFormOpen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"someFormOpen",{get:function(){return!(!this.widget||!this.widget.someFormOpen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canModerate",{get:function(){return this.user.canModerate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasMenu",{get:function(){return Boolean(!this.store.interactiveMode&&(this.canEditAndOwner||this.canModerate&&this.data.isVisible))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"menuActions",{get:function(){return this.canEditAndOwner?[{text:"comment.actions.edit",icon:"annoto-icon-mode_edit nn-color-accent nn-icon-edit"},{text:"comment.actions.delete",icon:"annoto-icon-delete nn-color-grey-heavy nn-icon-delete"}]:this.canModerate?[{text:"comment.actions.delete",icon:"annoto-icon-delete nn-color-grey-heavy nn-icon-delete"}]:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return this.data.isPending},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDeleted",{get:function(){return this.data.isDeleted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidePending",{get:function(){return this.isPending&&!this.user.canModerate&&this.user.id!==this.data.author.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidden",{get:function(){return this.hidePending||this.isDeleted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canShowFooterActions",{get:function(){return!this.isPending&&!this.isDeleted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"editData",{get:function(){return this.editing?this.data:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formatedTimestamp",{get:function(){return this.data?a()(this.data.ps).format("00:00:00"):""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anonymizeAuthor",{get:function(){return Boolean(this.data.anonymous&&!this.user.isModerator&&this.user.id!==this.data.author.id)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authorName",{get:function(){var t=this.data.author.name;return this.anonymizeAuthor?this.store.i18n.tr("generic.anonymous"):t&&t.startsWith("generic.")?this.store.i18n.tr(t):t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authorPhoto",{get:function(){return this.anonymizeAuthor?""+d.b.IMAGES_URL+d.b.ANONYMOUS_AVATAR:this.data.author.photoUrl},enumerable:!1,configurable:!0}),t.prototype._showFormChanged=function(t,e){!t!=!e&&this.ancestor&&(this.ancestor.childFormOpen=t)},t.prototype.formShow=function(){this.showForm=!0,this.store.dapDemoIsActive||this.formOpenCall()},t.prototype.formOpenCall=function(t){var e=this;return void 0===t&&(t=this),Object(s.c)().then((function(){"function"==typeof e.onFormOpen&&e.onFormOpen({vm:t})}))},t.prototype.formHide=function(){this.showForm=!1,this.editing=!1,this.formHideCall()},t.prototype.formHideCall=function(t){var e=this;return void 0===t&&(t=this),Object(s.c)().then((function(){"function"==typeof e.onFormHide&&e.onFormHide({vm:t}),e.setFocus()}))},t.prototype.ownerActionHandle=function(t){var e=this;return 0===t?(this.showForm=!1,Object(s.c)().then((function(){return e.editing=!0,e.showForm=!0,Object(s.c)()})).then((function(){e.formVm.openForm()}))):1===t?this.deleteComment():void this.logger.warn("Unknown Owner action: ",t)},t.prototype.moderatorActionHandle=function(t){if(0===t)return this.moderatorDelete();this.logger.warn("Unknown Moderator action: ",t)},t.prototype.loadReplies=function(){var t=this;return this.data.replies.length===this.data.repliesCount||this.data.repliesCount<=0?Promise.resolve():this.store.commentsController.getReplies(this.data,"asc").then((function(){t.updateRepliesSignal()}))},t.prototype.replySubmit=function(t){var e,n=this;return this.store.commentsController.postReply(this.data,t).then((function(t){if(!t)throw new Error;return e=t,n.updateRepliesSignal(),n.repliesHidden=!1,n.formHide(),n.loadReplies()})).then((function(){return Object(s.c)()})).then((function(){e&&e.vm&&e.vm.setFocus()}))},t.prototype.editSubmit=function(t){var e=this,n=this.data.emotion;return this.data.emotion=null,this.store.commentsController.editComment(this.data,t).then((function(t){if(!t)throw e.data.emotion=n,new Error;e.formHide()}))},t.prototype.deleteComment=function(){var t=this;if(this.store.demoIsActive)return this.store.commentsController.deleteComment(this.data).then((function(){return t.data.depth>0&&t.updateRepliesSignal(),null}));return this.dialog.open({model:{message:"comment.delete_confirmation.message",yesBtnText:"comment.delete_confirmation.ok",noBtnText:"comment.delete_confirmation.cancel"},viewModel:"dialog/views/nn-yes-no",lock:!1,host:this.widget.containerElement,container:this.widget.auContainer,focusOnClose:!1}).whenClosed((function(e){if(!e.wasCancelled)return t.store.commentsController.deleteComment(t.data).then((function(){return t.data.depth>0&&t.updateRepliesSignal(),null}));t.setFocus()}))},t.prototype.moderatorDelete=function(){var t=this;if(!this.submitting){this.submitting=!0;return this.dialog.open({model:{message:"comment.delete_confirmation.message",yesBtnText:"comment.delete_confirmation.ok",noBtnText:"comment.delete_confirmation.cancel"},viewModel:"dialog/views/nn-yes-no",lock:!1,host:this.widget.containerElement,container:this.widget.auContainer,activeElement:function(){return t.focusableEl}}).whenClosed((function(e){if(!e.wasCancelled)return t.store.commentsController.patchCommentState(t.data,h.a.state.deleted)})).then((function(){t.submitting=!1})).catch((function(){t.submitting=!1}))}},t.prototype.updateRepliesSignal=function(){this.signaler.signal("annoto-replies-update")},t.prototype.playMedia=function(){var t=this,e={model:this.data};this.store.player.pause(),this.dialog.open({model:e,viewModel:"organs/comment/comment-media-dialog/nn-comment-media-dialog",lock:!1,host:this.widget.containerElement,container:this.widget.auContainer,activeElement:function(){return t.focusableEl},fixed:!0,overlayDismiss:!0,darkOverlay:!0,closeBtn:!0}).whenClosed((function(){})).catch((function(e){t.store.errorHandler.alert(v.b.COMMENTS.ASSET_NOT_FOUND,e.output,t.logger)})),this.store.analyticsController.recordGaEvent({collection:"ugc_interaction",action:"video_comment_play"})},w([o.m,O("design:type",h.a)],t.prototype,"data",void 0),w([o.m,O("design:type",Object)],t.prototype,"onFormHide",void 0),w([o.m,O("design:type",Object)],t.prototype,"onFormOpen",void 0),w([o.m,O("design:type",Boolean)],t.prototype,"last",void 0),w([o.m,O("design:type",Object)],t.prototype,"onReply",void 0),w([o.m,O("design:type",Boolean)],t.prototype,"replyOpenDisable",void 0),w([o.m,O("design:type",Object)],t.prototype,"onClick",void 0),w([Object(o.v)({changeHandler:"_showFormChanged"}),O("design:type",Object)],t.prototype,"showForm",void 0),w([o.m,O("design:type",t)],t.prototype,"ancestor",void 0),w([Object(o.p)("store.rtl"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"rtl",null),w([Object(o.p)("store.isPhone"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"isPhone",null),w([Object(o.p)("store.api","store.api.thread","store.api.thread.showReplies","store.dapDemoIsActive"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"showRepliesByDefault",null),w([Object(o.p)("data.emotion"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"hasEmotion",null),w([Object(o.p)("data.hasPS"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"hasPS",null),w([Object(o.p)("hasPS","data.depth","store.hidePs","store.isLive"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"showPs",null),w([Object(o.p)("data.emotion"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"showEmotion",null),w([Object(o.p)("data.topic","data.depth"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"showTopic",null),w([Object(o.p)("data.body"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"showBody",null),w([Object(o.p)("data.data.media"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"hasMedia",null),w([Object(o.p)("hasReplies","repliesHidden","data","data.isVisible"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"showReplies",null),w([Object(o.p)("showForm","data","data.isVisible"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"doShowForm",null),w([Object(o.p)("showForm","store.dapDemoIsActive"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"showReplyActions",null),w([Object(o.p)("data.repliesCount"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"hasReplies",null),w([Object(o.p)("store.commentsSubmitEnabled"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"canShowReply",null),w([Object(o.p)("user.id","data.author"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"isOwner",null),w([Object(o.p)("data.author"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"isModerator",null),w([Object(o.p)("isModerator","isDeleted"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"showRole",null),w([Object(o.p)("store.isELearning"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"roleText",null),w([Object(o.p)("store.isELearning"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"roleIcon",null),w([Object(o.p)("isOwner","data","data.state","data.createdAt","data.repliesCount","data.emotionsCount","user.isModerator"),O("design:type",Boolean),O("design:paramtypes",[])],t.prototype,"canEditAndOwner",null),w([Object(o.p)("data.emotionsCount"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"hasEmotions",null),w([Object(o.p)("data.emotionsCount","data.emotionsVotes"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"emotionsVotes",null),w([Object(o.p)("isPhone","showForm","widget.someFormOpen","childFormOpen"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"phoneHideOnFormOpen",null),w([Object(o.p)("widget.someFormOpen"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"someFormOpen",null),w([Object(o.p)("user.canModerate"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"canModerate",null),w([Object(o.p)("store.interactiveMode","canEditAndOwner","canModerate","data.isVisible"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"hasMenu",null),w([Object(o.p)("canEditAndOwner","canModerate"),O("design:type",Array),O("design:paramtypes",[])],t.prototype,"menuActions",null),w([Object(o.p)("data.isPending"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"isPending",null),w([Object(o.p)("data.isDeleted"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"isDeleted",null),w([Object(o.p)("isPending","user.canModerate","user.id","data.author"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"hidePending",null),w([Object(o.p)("hidePending","isDeleted"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"hidden",null),w([Object(o.p)("isPending","isDeleted"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"canShowFooterActions",null),w([Object(o.p)("editing"),O("design:type",Object),O("design:paramtypes",[])],t.prototype,"editData",null),w([Object(o.p)("data","data.ps"),O("design:type",String),O("design:paramtypes",[])],t.prototype,"formatedTimestamp",null),w([Object(o.p)("data.anonymous","user.isModerator","user.id","data.author"),O("design:type",Boolean),O("design:paramtypes",[])],t.prototype,"anonymizeAuthor",null),w([Object(o.p)("anonymizeAuthor","data.author"),O("design:type",String),O("design:paramtypes",[])],t.prototype,"authorName",null),w([Object(o.p)("anonymizeAuthor","data.author"),O("design:type",String),O("design:paramtypes",[])],t.prototype,"authorPhoto",null),t=e=w([Object(o.s)("nn-comment"),Object(o.t)(o.d.Element,f.BindingSignaler,o.k.of(l.AnnotoWidget),b.DialogService),O("design:paramtypes",[HTMLElement,f.BindingSignaler,l.AnnotoWidget,b.DialogService])],t)}()},"organs/comment/nn-comment.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-comment.scss"></require>\n    <require from="./nn-header.html"></require>\n    <require from="./nn-content.html"></require>\n    <require from="./nn-footer.html"></require>\n    <require from="../comment-form/nn-comment-form"></require>\n    <require from="../emotion/nn-emotion"></require>\n    <require from="./nn-comment"></require>\n    <require from="../moderator/nn-moderator"></require>\n\n\n    <div show.bind="!phoneHideOnFormOpen"\n         class="annoto-comment\n                ${hasMenu ? \'has-menu\' : \'\'}\n                ${menuOpen ? \'menu-open\' : \'\'}\n                ${isOwner ? \'owner\' : \'\'}\n                ${canModerate ? \'moderator\' : \'\'}\n                ${isPending ? \'pending\' : \'\'}\n                ${editing ? \'editing\' : \'\'}\n                ${data.hasModLikeBadge ? \'nn-mod-like\' : \'\'}\n                ${anonymizeAuthor ? \'nn-anonymous\' : \'\' & oneTime & signal:\'annoto-auth-update\'}">\n\n        <div if.bind="data.anonymous && !anonymizeAuthor"\n             class="annoto-comment-anonymous-caption annoto-flex-row-nowrap annoto-flex-align-center"\n             amdl-flex-row-rtl.one-time="rtl">\n            <i class="annoto-icon annoto-20 annoto-icon-anonymous nn-icon-anonymous nn-color-accent" aria-hidden="true"></i>\n            <span class="nn-text-caption nn-color-grey">${\'comment.anonymous\' & t & oneTime}</span>\n        </div>\n\n        <div class="annoto-comment-container annoto-flex-row-nowrap" amdl-flex-row-rtl.one-time="rtl" nn-focusable ref="focusableEl">\n\n            <div class="annoto-moderator-organ" if.bind="canModerate && isPending">\n                <nn-moderator comment-data.one-time="data"></nn-moderator>\n            </div>\n\n            <div class="annoto-avatar">\n                <nnc-avatar photo-src.bind="authorPhoto & oneTime & signal:\'annoto-auth-update\'" full-name.bind="authorName & oneTime & signal:\'annoto-auth-update\'" responsive></nnc-avatar>\n                <nn-emotion if.bind="showEmotion"\n                            class="annoto-comment-emotion"\n                            data.bind="data.emotion"></nn-emotion>\n                <div if.one-time="showRole" class="annoto-comment-author-role" id="annoto-comment-role-${data.id & oneTime}">\n                    <i class="annoto-icon annoto-20 ${roleIcon & oneTime} nn-icon-moderator nn-color-grey" aria-hidden="true"></i>\n                    <span class="nn-aaa-hidden-info">${roleText & t & oneTime}</span>\n                    <nnc-tooltip for="annoto-comment-role-${data.id & oneTime}">${roleText & t & oneTime}</nnc-tooltip>\n                </div>\n            </div>\n\n            <div class="annoto-container">\n\n                <div class="nn-comment-bubble">\n                    <nn-header comment.one-time="thisVm"></nn-header>\n                    <nn-content comment.one-time="thisVm"></nn-content>\n                    <div if.bind="hasEmotions" class="annoto-comment-votes-meta annoto-flex-row-nowrap">\n                        <template repeat.for="vote of emotionsVotes | arraySort:emotionsSortConfig">\n                            <div class="annoto-comment-vote vote-${$index} annoto-flex-row-nowrap annoto-flex-align-center">\n                                <nn-emotion class="annoto-comment-vote-emotion" data.bind="vote.emotion"\n                                            aaa-info="${vote.emotion.name & t & oneTime} ${\'generic.votes\' & t: { \'count\': vote.count }}"></nn-emotion>\n                            </div>\n                            <span class="annoto-comment-vote-count nn-text-caption nn-color-grey" aria-hidden="true">${vote.count | number:\'0,0\'}</span>\n                        </template>\n                        <span class="annoto-comment-votes-count nn-text-caption nn-color-grey" aria-hidden="true">${data.emotionsCount | number:\'0,0\'}</span>\n                    </div>\n\n                    <div if.bind="data.hasModLikeBadge" class="annoto-comment-mod-like-badge" id="annoto-comment-mod-like-badge-${data.id & oneTime}">\n                        <nnc-icon class="annoto-mod-like-badge-icon" name="star-badge" aria-label="${\'comment.badges.moderator_like\' & t & oneTime}"></nnc-icon>\n                        <nnc-tooltip for="annoto-comment-mod-like-badge-${data.id & oneTime}"\n                                     class="annoto-comment-mod-like-badge-tooltip"\n                                     position="bottom">${\'comment.badges.moderator_like\' & t & oneTime}</nnc-tooltip>\n                    </div>\n                </div>\n\n                <nn-footer comment.one-time="thisVm"></nn-footer>\n\n            </div>\n        </div>\n\n        <ol show.bind="showReplies" class="annoto-comment-replies">\n\n            <li repeat.for="reply of data.replies | arrayClone & oneTime & signal:\'annoto-replies-update\'">\n                <nn-comment data.one-time="reply"\n                            ancestor.one-time="thisVm"\n                            view-model.ref="reply.vm"\n                            last.bind="$last"\n                            on-reply-form-hide.call="formHideCall()"></nn-comment>\n            </li>\n        </ol>\n\n        <div if.bind="doShowForm" class="annoto-comment-form-container">\n            <nn-comment-form ref="formElement"\n                             view-model.ref="formVm"\n                             features.one-time="formFeatures"\n                             data.one-time="editData"\n                             on-cancel.call="formHide()"\n                             on-submit.call="onFormSubmit(data)"\n                             emotion-position.one-time="formEmotionPosition"\n                             disabled.one-time="false">\n            </nn-comment-form>\n        </div>\n    </div>\n\n</template>\n'},"organs/comment/nn-content.html":function(t,e,n){t.exports='<template bindable="comment">\n    <require from="./css/nn-content.scss"></require>\n\n    <template with.bind="comment">\n        <div show.bind="!hidden" class="annoto-comment-content" click.delegate="clickHandle()">\n            <div if.bind="showTopic" class="annoto-comment-topic" dir="auto">\n                <p class="nn-text nn-text-subhead nn-text-color">${data.topic}</p>\n            </div>\n            <div show.bind="!mobileViewHideBody" if.bind="showBody" class="annoto-comment-body" dir="auto">\n                <p class="nn-text nn-text-body nn-text-color" innerhtml="${data.body | escape | hyperlink:{yt:true} | sanitizeHTML }"></p>\n            </div>\n            <div if.bind="hasMedia" class="nn-comment-media">\n                <nnc-button fill="outline" expand="full" color="tertiary" ripple rounded click.trigger="playMedia()" disabled.bind="!user.in">\n                    <nnc-icon name="media-play" size="lg"></nnc-icon>\n                </nnc-button>\n            </div>\n            \n        </div>\n        <div if.bind="isPending || isDeleted" class="annoto-comment-content">\n            <span if.bind="isPending" class="nn-color-grey nn-text-caption nn-text-oblique"><i class="annoto-icon annoto-14 annoto-icon-hourglass_empty nn-icon-moderator_pending nn-color-grey"></i> ${\'comment.pending\' & t}</span>\n            <span if.bind="isDeleted" class="nn-color-grey nn-text-caption nn-text-oblique"><i class="annoto-icon annoto-14 annoto-icon-block nn-icon-moderator_blocked nn-color-grey"></i> ${\'comment.deleted\' & t}</span>\n        </div>\n    </template>\n</template>'},"organs/comment/nn-footer.html":function(t,e,n){t.exports='<template bindable="comment" >\n\n    <require from="./css/nn-footer.scss"></require>\n    <require from="../emotion/nn-emotion-vote"></require>\n    <require from="../emotion/nn-emotion"></require>\n    <require from="../emotion/nn-emotions-box"></require>\n\n    <template with.bind="comment">\n        <div if.bind="canShowFooterActions" class="annoto-comment-footer annoto-flex-row-nowrap"\n            amdl-flex-row-rtl.bind="rtl & oneTime">\n\n            <amdl-icon-toggle class="annoto-replies-toggle"\n                            if.bind="hasReplies"\n                            icon-class="annoto-icon annoto-18 ${repliesHidden ? \'annoto-icon-expand_more nn-icon-replies_show\' : \'annoto-icon-expand_less nn-icon-replies_hide\'}"\n                            checked.two-way="repliesHidden"\n                            aaa-reverse.one-time="true"\n                            aaa-expandable.one-time="true"\n                            color-class="grey-heavy"\n                            click.call="repliesToggleClick()"\n                            label.bind="\'comment.replies\' & t: { \'count\': data.discussionCount}"\n                            amdl-rtl.bind="rtl & oneTime">\n                <span if.bind="repliesHidden" slot="start" class="nn-color-grey-heavy nn-text-caption">${\'comment.replies\' & t: {\'count\': data.discussionCount}}</span>\n            </amdl-icon-toggle>\n\n            <div class="annoto-flex-spacer" click.delegate="clickHandle()" aria-hidden="true"></div>\n\n            <div if.bind="showReplyActions"\n                class="annoto-comment-reply-actions annoto-flex-row-nowrap"\n                amdl-flex-row-rtl.bind="rtl & oneTime">\n\n                <nn-emotion if.bind="data.userVoted" data.bind="data.userEmotion"\n                            class="annoto-comment-user-vote" nn-focusable="disabled.one-time: true;" ref="userVoteEl"\n                            role="button" aaa-info="${data.userEmotion.name & t & oneTime} ${\'generic.vote\' & t & oneTime}"></nn-emotion>\n                <nn-emotion-vote if.bind="!data.userVoted"\n                                view-model.ref="voteVm"\n                                on-vote.call="submitVote(vote)"\n                                on-selector-click.call="voteSelectorClickHandle()"\n                                disable-hover.bind="store.voteEmotionsDisabled & oneTime & signal:\'annoto-thread-settings-update\'"\n                                position.one-time="votePosition"\n                                aaa-label.one-time="\'generic.vote\' & t">\n                    <nn-emotion slot="emotion-selector"\n                                class="annoto-comment-vote-selector"\n                                data.bind="voteSelector"></nn-emotion>\n                    <nn-emotions-box if.bind="!store.voteEmotionsDisabled & oneTime & signal:\'annoto-thread-settings-update\'"\n                                    slot="emotions-box"\n                                    emotions.bind="voteVm.emotions"\n                                    columns.bind="voteVm.columnsNum"\n                                    rows.bind="voteVm.rowsNum"\n                                    on-select.call="voteVm.emotionsBoxSelectHandle(index)"></nn-emotions-box>\n                </nn-emotion-vote>\n\n                <nnc-button if.bind="canShowReply" class="annoto-comment-reply-button" size="sm" fill="clear" color="dark" rounded ripple click.trigger="replyClick()">${\'comment.reply\' & t & oneTime}</nnc-button>\n                \n            </div>\n        </div>\n        <div else class="annoto-comment-footer"></div>\n    </template>\n</template>\n'},"organs/comment/nn-header.html":function(t,e,n){t.exports='<template bindable="comment">\n  <require from="./css/nn-header.scss"></require>\n\n  <div class="annoto-comment-header annoto-flex-row-nowrap"\n       with.bind="comment" amdl-flex-row-rtl.bind="rtl & oneTime">\n\n       <span class="annoto-comment-author-name nn-text-caption nn-color-grey">${authorName & oneTime & signal:\'annoto-auth-update\'}</span>\n\n       <span if.one-time="showPs"\n             class="annoto-comment-ps annoto-flex-row-nowrap"\n             role="button"\n             nn-interaction="click.call: psClick(event); space.call: psClick(event); enter.call: psClick(event);"\n             nn-focusable.one-time="\'aaa.comment.timestamp\' | t: {\'time\': formatedTimestamp}">\n         <span class="nn-text-caption nn-color-grey">${formatedTimestamp}</span>\n       </span>\n \n       <div class="annoto-flex-spacer" click.delegate="clickHandle()" aria-hidden="true"></div>\n\n       <span class="annoto-comment-date nn-text-caption nn-color-grey-light"\n             id="annoto-comment-date-${data.id & oneTime}" aria-hidden="true">${data.createdAt | fromNow & oneTime & signal:\'annoto-dates\'}</span>\n       <span class="nn-aaa-hidden-info" aria-labelledby="annoto-comment-date-${data.id & oneTime}"></span>\n       <nnc-tooltip for="annoto-comment-date-${data.id & oneTime}" size="sm">${data.createdAt | date:"PP \'at\' HH:mm" & oneTime}</nnc-tooltip>\n\n       <amdl-menu-button if.bind="hasMenu" \n                        class="annoto-comment-menu"\n                        icon-class="annoto-icon-more_horiz nn-icon-menu_more nn-color-grey-heavy"\n                        icon-only.one-time="true"\n                        options.bind="menuActions"\n                        on-invoke.call="actionHandle(index)"\n                        position.one-time="store.rtl ? \'left\' : \'right\'"\n                        open.from-view="menuOpen"></amdl-menu-button>\n  </div>\n</template>\n'},"organs/emotion/css/nn-emotion-vote.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-emotion-vote{position:relative}.annoto .annoto-emotion-vote .annoto-emotion-selector{cursor:pointer}.annoto .annoto-emotion-vote .annoto-emotion-selector .annoto-emotion .annoto-emotion-container,.annoto .annoto-emotion-vote .annoto-emotions-box-container .annoto-emotion .annoto-emotion-container{cursor:pointer}.annoto .annoto-emotion-vote .annoto-emotions-box-container{position:absolute;z-index:999;overflow:visible;height:auto;width:auto;padding:0 8px;-webkit-box-sizing:content-box;box-sizing:content-box;display:table;visibility:hidden;opacity:0}.annoto .annoto-emotion-vote .annoto-emotions-box-container.open{visibility:visible;-webkit-transition:opacity .2s ease-in 0s;transition:opacity .2s ease-in 0s;opacity:1}.annoto .annoto-emotion-vote .annoto-emotion-cta-container{width:100%}.annoto.sso-noauth .annoto-emotion-vote{opacity:.6;pointer-events:none}",""]),e.default=i},"organs/emotion/css/nn-emotion.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-emotion{overflow:hidden;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.annoto .annoto-emotion .annoto-emotion-container{display:block;position:relative;border-radius:50%;background-clip:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0;border:transparent;text-align:center;cursor:default;direction:ltr;font-style:normal;letter-spacing:normal;text-decoration:none;text-indent:0;text-shadow:none;word-spacing:0;overflow:visible;min-width:22px;height:22px;width:22px;margin:1px}.annoto .annoto-emotion .annoto-emotion-container .annoto-emotion-icon{margin:-1px;width:24px;height:24px;line-height:24px;font-size:24px}.annoto .annoto-emotion .annoto-emotion-container .annoto-emotion-icon{line-height:1;border-radius:initial;display:inline-block;vertical-align:middle;position:absolute;top:0;left:0}",""]),e.default=i},"organs/emotion/css/nn-emotions-box.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-emotions-box{-webkit-box-sizing:content-box;box-sizing:content-box;-ms-flex-pack:distribute;justify-content:space-around;cursor:default}.annoto .annoto-emotions-box .annoto-emotion-organ{margin:0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.annoto .annoto-emotions-box .annoto-emotion-organ .annoto-emotion .annoto-emotion-container{margin:0;display:block}",""]),e.default=i},"organs/emotion/nn-dynamic-emotion":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoDynamicEmotionOrgan",(function(){return c}));var o,i=n("aurelia-framework"),r=n("organs/emotion/nn-emotion"),a=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e=s([Object(i.s)("nn-dynamic-emotion")],e)}(r.AnnotoEmotionOrgan)},"organs/emotion/nn-dynamic-emotion.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-emotion.scss"></require>\n\n    <div class="annoto-emotion ${data.colorClass}">\n\n        <div class="annoto-emotion-container nn-paint-background" id="annoto-emotion-${id}">\n            <i if.bind="useFontIcon" class="annoto-emotion-icon ${data.iconClasses}" aria-hidden="true"></i>\n            <img if.bind="!useFontIcon" class="annoto-emotion-icon" src.bind="data.iconSrc" aria-hidden="true">\n            <span class="nn-aaa-hidden-info">${data.name & t} ${\'generic.sentiment\' & t & oneTime}</span>\n        </div>\n\n        <nnc-tooltip if.bind="showTooltip" for="annoto-emotion-${id}" position="bottom">${data.name & t}</nnc-tooltip>\n    </div>\n\n\n</template>'},"organs/emotion/nn-emotion":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoEmotionOrgan",(function(){return c}));var o=n("aurelia-framework"),i=n(73),r=n(29),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(){this.tooltipPosition="bottom",this.showTooltip=!1}return Object.defineProperty(t.prototype,"useFontIcon",{get:function(){return!Boolean(this.data&&this.data.iconSrc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.data&&this.data.id?this.data.id:Object(r.i)()},enumerable:!1,configurable:!0}),a([o.m,s("design:type",i.a)],t.prototype,"data",void 0),a([o.m,s("design:type",Object)],t.prototype,"tooltipPosition",void 0),a([o.m,s("design:type",Object)],t.prototype,"showTooltip",void 0),a([o.m,s("design:type",String)],t.prototype,"aaaInfo",void 0),a([Object(o.p)("data","data.iconSrc"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"useFontIcon",null),a([Object(o.p)("data","data.id"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"id",null),t=a([Object(o.s)("nn-emotion")],t)}()},"organs/emotion/nn-emotion-vote":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoEmotionVote",(function(){return f}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=n(48),s=n(40),c=n(38),l=n("aurelia-templating-resources"),u=n(29),p=n(54),d=n(43),h=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},m=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},f=function(){function t(t,e){this.id=Object(u.i)(),this.emotions=[],this.position="left",this.isOpen=!1,this.disableHover=!1,this.disabled=!1,this.aaaLabel="vote",this.disposables=[],this.styleTrigger=!1,this.widget=t,this.store=t.store,this.signaler=e}return t.prototype.bind=function(){var t=this;this.disposables.push(this.store.threadController.on(s.a.INITIALIZED,(function(){t._initEmotions()})))},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=0),this._close(),this.emotions=[]},t.prototype.close=function(){this._close()},t.prototype.open=function(){this._open()},t.prototype.setFocusOnMenu=function(){this.emotionsBoxElement&&p.a.setFocusOnLastChildOf(this.emotionsBoxElement)},t.prototype.enterSelectorHandle=function(){this.store.interactiveController.recordUserAction(),this.disableHover||this.widget.platform.touchScreen||this._open()},t.prototype.leaveSelectorHandle=function(){var t=this;this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=0),this.leaveTimer=setTimeout((function(){t._close()}),500)},t.prototype.enterEmotionsBoxHandle=function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=0)},t.prototype.leaveEmotionsBoxHandle=function(){this._close()},t.prototype.emotionsBoxSelectHandle=function(t){var e=this;setTimeout((function(){e._vote(t)}),300)},t.prototype.selectorClickHandle=function(t){var e=this;this.disabled||(t.stopPropagation(),this.store.interactiveController.recordUserAction(),setTimeout((function(){"function"==typeof e.onSelectorClick&&e.onSelectorClick({isKb:!1,event:t})}),300))},t.prototype.selectorKbClickHandle=function(t){var e=this;if(!this.disabled){if(t.stopPropagation(),this.store.interactiveController.recordUserAction(),!this.isOpen&&!this.disableHover)return this.open(),void setTimeout((function(){return e.setFocusOnMenu()}),0);setTimeout((function(){"function"==typeof e.onSelectorClick&&e.onSelectorClick({isKb:!0,event:t})}),300)}},t.prototype.emotionsBoxKeyDownHandle=function(t){if(Object(d.e)(t,"esc"))return t.stopPropagation(),this.close(),void p.a.setFocusOnEl(this.selectorElement);if(Object(d.e)(t,"tab"))return this.close(),!0;if(Object(d.e)(t,"home"))return t.stopPropagation(),void p.a.setFocusOnFirstChildOf(this.emotionsBoxElement);Object(d.e)(t,"end")&&(t.stopPropagation(),p.a.setFocusOnLastChildOf(this.emotionsBoxElement));var e=Object(d.e)(t,"down"),n=Object(d.e)(t,"up");if(e||n){t.stopPropagation();var o=p.a.getFocusableElsIn(this.emotionsBoxElement);if(0===o.length)return;for(var i=0,r=0;r<o.length;r++)if(o[r].classList.contains("nn-focused")){i=r;break}if(e){var a=o[i+1]||o[o.length-1];return void p.a.setFocusOnEl(a)}if(n){a=o[Math.max(0,i-1)]||o[0];return void p.a.setFocusOnEl(a)}}return!0},Object.defineProperty(t.prototype,"columnsNum",{get:function(){return Math.ceil(2===this.rowsNum?this.emotions.length/2:this.emotions.length)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowsNum",{get:function(){return this.emotions.length>4?2:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emotionsBoxContainerStyle",{get:function(){var t=this.position,e=this.rowsNum,n=this.columnsNum,o=c.d.iconSize,i=this.selectorElement,r=this.emotionsBoxElement,a=i?i.offsetHeight:c.d.defaultSelectorSize,s=r?r.offsetWidth:o*n,l=r?r.offsetHeight:o*e,u="",p="",d="",h="";return 0===t.indexOf("bottom")?d=a+"px":0===t.indexOf("top")&&(h=a+"px"),t.indexOf("left")>0?p="0":u=t.indexOf("right")>0?"0":"calc(50% - "+Math.ceil(s/2)+"px)","left"===t?(p="100%",d="calc(50% - "+l/2+"px)",u="",h=""):"right"===t&&(u="100%",d="calc(50% - "+l/2+"px)",p="",h=""),{left:u,right:p,top:d,bottom:h}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emotionsBoxContainerClasses",{get:function(){return"annoto-emotions-box-container nn-color-background-secondary nn-border "+(this.isOpen?"annoto-shadow-3dp open":"")},enumerable:!1,configurable:!0}),t.prototype._open=function(){var t=this;this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=0),this.disabled||this.isOpen||(this.isOpen=!0,setTimeout((function(){t.styleTrigger=!t.styleTrigger,"function"==typeof t.onOpen&&t.onOpen()}),0))},t.prototype._close=function(){var t=this;this.isOpen&&(this.isOpen=!1,setTimeout((function(){t.styleTrigger=!t.styleTrigger,"function"==typeof t.onClose&&t.onClose()}),0))},t.prototype._vote=function(t){if(!this.disabled){var e=this.emotions[t];if("function"==typeof this.onVote){var n=a.a.createVoteFromEmotion(e,this.store.user.author);this.onVote({emotion:e,vote:n})}}},t.prototype._initEmotions=function(){this.emotions=a.a.createEmotionsList(this.store.settings),this.signaler.signal("annoto-update-vote-emotions")},h([o.m,m("design:type",Object)],t.prototype,"position",void 0),h([Object(o.m)({defaultBindingMode:o.n.twoWay}),m("design:type",Object)],t.prototype,"isOpen",void 0),h([o.m,m("design:type",Object)],t.prototype,"onVote",void 0),h([o.m,m("design:type",Object)],t.prototype,"onSelectorClick",void 0),h([o.m,m("design:type",Object)],t.prototype,"onOpen",void 0),h([o.m,m("design:type",Object)],t.prototype,"onClose",void 0),h([o.m,m("design:type",Object)],t.prototype,"disableHover",void 0),h([o.m,m("design:type",Object)],t.prototype,"disabled",void 0),h([o.m,m("design:type",String)],t.prototype,"aaaLabel",void 0),h([Object(o.p)("emotions","emotions.length","rowsNum"),m("design:type",Object),m("design:paramtypes",[])],t.prototype,"columnsNum",null),h([Object(o.p)("emotions","emotions.length"),m("design:type",Object),m("design:paramtypes",[])],t.prototype,"rowsNum",null),h([Object(o.p)("position","rowsNum","columnsNum","styleTrigger"),m("design:type",Object),m("design:paramtypes",[])],t.prototype,"emotionsBoxContainerStyle",null),h([Object(o.p)("isOpen"),m("design:type",Object),m("design:paramtypes",[])],t.prototype,"emotionsBoxContainerClasses",null),t=h([Object(o.t)(r.a.of(i.AnnotoWidget,!0),l.BindingSignaler),Object(o.s)("nn-emotion-vote"),m("design:paramtypes",[i.AnnotoWidget,l.BindingSignaler])],t)}()},"organs/emotion/nn-emotion-vote.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-emotion-vote.scss"></require>\n\n    <div class="annoto-emotion-vote">\n        <div class="annoto-emotion-selector ${disabled ? \'\' : \'nnc-activatable nn-color-bg-hover\'}"\n             mouseenter.trigger="enterSelectorHandle()"\n             mouseleave.trigger="leaveSelectorHandle()"\n             ref="selectorElement"\n             id="annoto-emotion-vote-button-${id & oneTime}"\n             role="button"\n             nn-focusable="disabled.bind: disabled; label.bind: aaaLabel"\n             nn-interaction="disabled.bind: disabled; click.call: selectorClickHandle(event); enter.call: selectorKbClickHandle(event); space.call: selectorKbClickHandle(event);"\n             aria-haspopup.bind="!disableHover"\n             aria-expanded.bind="isOpen ? true : null"\n             aria-controls="annoto-emotion-vote-menu-${id & oneTime}">\n\n            <slot name="emotion-selector"></slot>\n            <nnc-ripple></nnc-ripple>\n        </div>\n\n        <div mouseenter.trigger="enterEmotionsBoxHandle()"\n             mouseleave.trigger="leaveEmotionsBoxHandle()"\n             style.bind="emotionsBoxContainerStyle"\n             class-name.bind="emotionsBoxContainerClasses"\n             ref="emotionsBoxElement"\n             id="annoto-emotion-vote-menu-${id & oneTime}"\n             nn-focusable="index: -1;"\n             keydown.capture="emotionsBoxKeyDownHandle($event)"\n             role="menu"\n             aria-labelledby="annoto-emotion-vote-button-${id & oneTime}">\n\n            <slot name="emotions-box"></slot>\n\n            <div class="annoto-emotion-cta-container">\n                <slot name="emotion-cta"></slot>\n            </div>\n        </div>\n    </div>\n\n\n</template>\n'},"organs/emotion/nn-emotion.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-emotion.scss"></require>\n\n    <div class="annoto-emotion ${data.colorClass & oneTime}" id="annoto-emotion-${id & oneTime}">\n\n        <div class="annoto-emotion-container nn-paint-background">\n            <i if.one-time="useFontIcon" class="annoto-emotion-icon ${data.iconClasses & oneTime}" aria-hidden="true"></i>\n            <img if.one-time="!useFontIcon" class="annoto-emotion-icon" src.one-time="data.iconSrc" aria-hidden="true">\n            <span if.one-time="aaaInfo" class="nn-aaa-hidden-info">${aaaInfo & oneTime}</span>\n            <span else class="nn-aaa-hidden-info">${data.name & t & oneTime} ${\'generic.sentiment\' & t & oneTime}</span>\n        </div>\n    </div>\n\n    <nnc-tooltip if.one-time="showTooltip" for="annoto-emotion-${id & oneTime}" position="bottom">${data.name & t & oneTime}</nnc-tooltip>\n</template>\n'},"organs/emotion/nn-emotions-box":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoEmotionsBox",(function(){return c}));var o=n("aurelia-framework"),i=n(38),r=n(36),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.store=t,this.emotions=[],this.columns=1,this.rows=1,this.clickedIndex=-1}return t.prototype.reset=function(){this.clickedIndex=-1},t.prototype.select=function(t){for(var e=0;e<this.emotions.length;e++)if(this.emotions[e].type===t.type)return this.clickedIndex=e,this.emotions[e]},Object.defineProperty(t.prototype,"boxStyleObject",{get:function(){return{width:i.d.iconSize*this.columns+"px"}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"emotionStyleObject",{get:function(){return{width:Math.floor(100/this.columns)+"%"}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showTooltips",{get:function(){return!this.store.isPhone},enumerable:!1,configurable:!0}),t.prototype.selectHandle=function(t,e){t.stopPropagation(),this.clickedIndex=e,"function"==typeof this.onSelect&&this.onSelect({index:e,event:t})},a([o.m,s("design:type",Array)],t.prototype,"emotions",void 0),a([o.m,s("design:type",Object)],t.prototype,"onSelect",void 0),a([o.m,s("design:type",Object)],t.prototype,"columns",void 0),a([o.m,s("design:type",Object)],t.prototype,"rows",void 0),a([Object(o.p)("columns","rows"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"boxStyleObject",null),a([Object(o.p)("columns","rows"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"emotionStyleObject",null),a([Object(o.p)("store.isPhone"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"showTooltips",null),t=a([Object(o.t)(r.a),Object(o.s)("nn-emotions-box"),s("design:paramtypes",[r.a])],t)}()},"organs/emotion/nn-emotions-box.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-emotions-box.scss"></require>\n    <require from="./nn-emotion"></require>\n\n    <div class="annoto-emotions-box"\n         amdl-grid="no-spacing:true"\n         style.bind="boxStyleObject">\n\n        <div repeat.for="emotion of emotions"\n             class="annoto-emotion-organ ${($index === clickedIndex) ? \'selected\' : \'\'}"\n             amdl-cell\n             style.bind="emotionStyleObject"\n             role="menuitem"\n             nn-interaction="click.call: selectHandle(event, $index); enter.call: selectHandle(event, $index); space.call: selectHandle(event, $index);"\n             nn-focusable="index: -1">\n\n            <nn-emotion data.bind="emotion"\n                        show-tooltip.one-time="showTooltips"></nn-emotion>\n        </div>\n\n    </div>\n</template>\n'},"organs/export-btn/css/nn-export-dialog.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-export-dialog{max-width:500px}.annoto .annoto-export-dialog .annoto-dialog-header{text-transform:capitalize}.annoto .annoto-export-dialog .annoto-export-file-btn{padding:8px}.annoto .annoto-export-dialog .annoto-export-file-btn .amdl-button{height:80px;width:80px;min-width:80px}.annoto .annoto-export-dialog .annoto-export-file-btn .amdl-button .annoto-icon{-webkit-transform:translate(-32px, -32px);transform:translate(-32px, -32px);width:64px;height:64px;font-size:64px}.annoto .annoto-export-dialog .annoto-export-file-btn .annoto-icon.annoto-icon-file_docx{color:var(--nnc-color-docx, #2B579A)}.annoto .annoto-export-dialog .annoto-export-file-btn .annoto-icon.annoto-icon-file_xlsx{color:var(--nnc-color-xlsx, #217346)}.annoto .annoto-export-dialog .annoto-export-file-btn .annoto-icon.annoto-icon-file_pptx{color:var(--nnc-color-pptx, #B7472A)}",""]),e.default=i},"organs/export-btn/nn-export-btn":function(t,e,n){"use strict";n.r(e),n.d(e,"ExportBtn",(function(){return l}));var o=n("aurelia-framework"),i=n(36),r=n("dialog/index"),a=n(34),s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},l=function(){function t(t,e){this.store=t,this.dialog=e,this.onSelect=function(){throw new a.a("onSelect not implemented")},this.subject="drawer.notes",this.index=0,this.disabled=!1}return Object.defineProperty(t.prototype,"title",{get:function(){var t=this.store.i18n;return t.tr("generic.export")+" "+t.tr(this.subject)},enumerable:!1,configurable:!0}),t.prototype.openDialogHandle=function(){var t=this,e=this.store,n={title:this.title,formats:["xlsx","docx"]};return e.analyticsController.recordMenuInteraction("select",{select:"export_notes"},{label:"export_notes"}),this.dialog.open({model:n,viewModel:"organs/export-btn/nn-export-dialog",lock:!1,host:e.widget.containerElement,container:e.widget.auContainer}).whenClosed((function(e){if(!e.wasCancelled){var n=e.output;return t.onSelect({format:n.format})}}))},t.prototype.setFocus=function(){this.buttonVm.setFocus()},s([Object(o.m)(),c("design:type",Function)],t.prototype,"onSelect",void 0),s([Object(o.m)(),c("design:type",String)],t.prototype,"subject",void 0),s([Object(o.m)(),c("design:type",Number)],t.prototype,"index",void 0),s([Object(o.m)(),c("design:type",Boolean)],t.prototype,"disabled",void 0),s([Object(o.p)("subject"),c("design:type",String),c("design:paramtypes",[])],t.prototype,"title",null),t=s([Object(o.s)("nn-export-btn"),Object(o.t)(i.a,r.DialogService),c("design:paramtypes",[i.a,r.DialogService])],t)}()},"organs/export-btn/nn-export-btn.html":function(t,e){t.exports='<template>\n        <amdl-button type="icon"\n            view-model.ref="buttonVm"\n            icon-class="annoto-icon annoto-icon-export nn-icon-export"\n            click.call="openDialogHandle()"\n            disabled.bind="disabled"\n            color-class="grey"\n            ripple.one-time="true"\n            index.bind="index"\n            label.bind="title"></amdl-button>\n</template>'},"organs/export-btn/nn-export-dialog":function(t,e,n){"use strict";n.r(e),n.d(e,"ExportDialog",(function(){return u}));var o=n("aurelia-framework"),i=n("aurelia-i18n"),r=n("dialog/index"),a=n(29),s=function(){return(s=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e){this.controller=t,this.i18n=e}return t.prototype.activate=function(t){this.data=s({title:"export",formats:[]},t)},Object.defineProperty(t.prototype,"buttons",{get:function(){var t=this;return this.data.formats.map((function(e){return{format:e,label:t.i18n.tr("generic.export")+" "+e}}))},enumerable:!1,configurable:!0}),t.prototype.selectHandle=function(t){var e=this,n={index:t,format:this.data.formats[t]};return Object(a.c)(100).then((function(){return e.controller.ok(n)}))},c([Object(o.p)("data"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"buttons",null),t=c([Object(o.s)("nn-export-dialog"),Object(o.t)(r.DialogController,i.I18N),l("design:paramtypes",[r.DialogController,i.I18N])],t)}()},"organs/export-btn/nn-export-dialog.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-export-dialog.scss"></require>\n\n    <nn-dialog class="annoto-export-dialog">\n        <nn-dialog-header>\n            ${data.title}\n        </nn-dialog-header>\n        <nn-dialog-body>\n            <div class="annoto-flex-row-wrap annoto-flex-justify-center annoto-flex-align-center">\n                <amdl-button repeat.for="item of buttons"\n                    class="annoto-export-file-btn"\n                    type="icon"\n                    icon-class="annoto-icon annoto-icon-file_${item.format & oneTime} nn-icon-file_${item.format & oneTime}"\n                    click.call="selectHandle($index)"\n                    label.one-time="item.label"\n                    ripple.one-time="true"\n                    ></amdl-button>\n            </div>\n        </nn-dialog-body>\n\n        <nn-dialog-footer>\n            <nnc-button color="dark" fill="clear" size="sm" ripple click.trigger="controller.cancel()">${\'generic.cancel\' & t}</nnc-button>\n        </nn-dialog-footer>\n    </nn-dialog>\n</template>'},"organs/flipper/css/nn-flipper.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-flipper{padding:0;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;display:block;-webkit-perspective:1000px;perspective:1000px;position:relative}.annoto .annoto-flipper .annoto-flipper-front,.annoto .annoto-flipper .annoto-flipper-back{-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-transition:.35s;transition:.35s;-webkit-backface-visibility:hidden;backface-visibility:hidden;position:absolute}.annoto .annoto-flipper .annoto-flipper-front{z-index:2;-webkit-transform:rotateY(0deg);transform:rotateY(0deg);visibility:visible}.annoto .annoto-flipper .annoto-flipper-back{-webkit-transform:rotateY(180deg);transform:rotateY(180deg);visibility:hidden}.annoto .annoto-flipper:hover:not(.disabled):not(.hover-disable) .annoto-flipper-front,.annoto .annoto-flipper.flip:not(.disabled) .annoto-flipper-front{-webkit-transform:rotateY(180deg);transform:rotateY(180deg);visibility:hidden}.annoto .annoto-flipper:hover:not(.disabled):not(.hover-disable) .annoto-flipper-back,.annoto .annoto-flipper.flip:not(.disabled) .annoto-flipper-back{-webkit-transform:rotateY(0deg);transform:rotateY(0deg);visibility:visible}",""]),e.default=i},"organs/flipper/nn-flipper":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoFlipper",(function(){return a}));var o=n("aurelia-framework"),i=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},r=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=function(){function t(){this.disabled=!1,this.flip=!1,this.flipOnHover=!0}return i([o.m,r("design:type",Object)],t.prototype,"disabled",void 0),i([o.m,r("design:type",Object)],t.prototype,"flip",void 0),i([o.m,r("design:type",Object)],t.prototype,"flipOnHover",void 0),t=i([Object(o.s)("nn-flipper")],t)}()},"organs/flipper/nn-flipper.html":function(t,e,n){t.exports="<template>\n    <require from=\"./css/nn-flipper.scss\"></require>\n\n\n    <div class=\"annoto-flipper ${flip ? 'flip' : ''} ${disabled ? 'disabled' : ''} ${flipOnHover ? '' : 'hover-disable'}\">\n        <div class=\"annoto-flipper-front\">\n            <slot name=\"front\"></slot>\n        </div>\n\n        <div class=\"annoto-flipper-back\">\n            <slot name=\"back\"></slot>\n        </div>\n    </div>\n</template>\n"},"organs/header/css/nn-header-buttons.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,"",""]),e.default=i},"organs/header/css/nn-header.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-header{position:relative}.annoto .annoto-header .annoto-drawer-button{top:0;bottom:0;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-header .annoto-header-row .annoto-flex-spacer{height:100%}.annoto .annoto-header .annoto-header-row .annoto-live{text-transform:uppercase;padding:0 8px;display:none}.annoto .annoto-header .annoto-header-row .annoto-header-title{-webkit-box-flex:100;-ms-flex-positive:100;flex-grow:100}.annoto .annoto-header .annoto-header-row nnc-button.annoto-uspace-btn{font-size:16px}.annoto .annoto-header .annoto-header-row .annoto-help-link{margin:0 4px;border-radius:50%}.annoto .annoto-header .annoto-header-row .annoto-help-link>div{height:24px;width:24px;position:relative;cursor:pointer;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-header .annoto-header-row .annoto-help-link>div>i{position:absolute;top:0;bottom:0;right:0;left:0;height:18px;width:18px;font-size:18px;margin:auto;color:#fff}.annoto.nnc-rtl .annoto-header .annoto-header-title{text-align:center}",""]),e.default=i},"organs/header/css/nn-sort.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-sort-menu button{text-transform:initial}",""]),e.default=i},"organs/header/nn-header":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoHeaderOrgan",(function(){return d}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=n(32),s=n(29),c=n(77),l=n(163),u=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},p=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},d=function(){function t(t){this.imagesUrl=a.a.imagesUrl,this.disposables=[],this.widget=t,this.store=t.store}return t.prototype.bind=function(){},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose()},Object.defineProperty(t.prototype,"logoUrl",{get:function(){return this.widget.isDark?this.imagesUrl+"/logo_white_v2.svg":this.imagesUrl+"/logo_v2.png"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showDragHint",{get:function(){return!this.widget.isDragged&&!this.widget.wasDragged&&!this.widget.draggableNotPermitted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showHelp",{get:function(){return Boolean("string"==typeof this.store.settings.helpUrl&&""!==this.store.settings.helpUrl)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showSort",{get:function(){var t=this.store;return"home"===t.activePage&&"people"!==t.homeFrame},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showTitle",{get:function(){return Boolean("preferences"===this.store.activePage)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"headerTitle",{get:function(){return this.store.activePage+".title"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spaceDisabled",{get:function(){var t=this.store;return!t.user.authenticated||!t.userSpaceEnabled||t.userSpaceOpen},enumerable:!1,configurable:!0}),t.prototype.helpClickHandle=function(){var t=this.store;return Object(s.o)((function(){t.analyticsController.recordWidgetInteraction("help_tap",{element:"header"},{label:t.player.playStateInfo,value:Object(c.e)()})}))(),!0},t.prototype.userActivityClickHandle=function(){var t=this.store;Object(l.a)(t,{defaultView:"feed",defaultQuery:{filter_followed:!t.user.anonymousEnabled}})},u([Object(o.p)("imagesUrl","widget.isDark"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"logoUrl",null),u([Object(o.p)("widget.isDragged","widget.wasDragged","widget.draggableNotPermitted"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"showDragHint",null),u([Object(o.p)("store.settings.helpUrl"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"showHelp",null),u([Object(o.p)("store.activePage","store.homeFrame"),p("design:type",Boolean),p("design:paramtypes",[])],t.prototype,"showSort",null),u([Object(o.p)("store.activePage"),p("design:type",Boolean),p("design:paramtypes",[])],t.prototype,"showTitle",null),u([Object(o.p)("store.activePage"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"headerTitle",null),u([Object(o.p)("store.user","store.user.authenticated","store.userSpaceEnabled","store.userSpaceOpen"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"spaceDisabled",null),t=u([Object(o.s)("nn-header"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),p("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/header/nn-header-buttons":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoHeaderButtonsOrgan",(function(){return c}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.disposables=[],this.widget=t,this.store=t.store}return t.prototype.bind=function(){},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose()},t.prototype.hide=function(){var t=this;return this.store.interactiveController.recordUserAction(),this.widget.hide().then((function(){var e=t.store;e.analyticsController.recordWidgetInteraction("close",{element:"header"},{label:"header",value:e.player.playCounter>0?1:0})}))},t.prototype.kbHide=function(){var t=this;this.hide().then((function(){t.widget.setFocus()}))},t.prototype.interactiveOn=function(){var t=this.store;return this.store.interactiveController.recordUserAction(),t.interactiveController.setOnAndShow().then((function(){t.analyticsController.recordWidgetInteraction("minimize",{element:"header"},{label:"header",value:t.player.playCounter>0?1:0})}))},t.prototype.kbInteractiveOn=function(){var t=this;this.interactiveOn().then((function(){t.widget.setFocus()}))},t=a([Object(o.s)("nn-header-buttons"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),s("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/header/nn-header-buttons.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-header-buttons.scss"></require>\n\n    <div class="annoto-header-buttons annoto-flex-row-nowrap annoto-flex-align-center">\n        <div>\n            <amdl-button type="icon" icon-class="annoto-icon annoto-icon-remove nn-icon-widget_minimize"\n                         pointer-click.call="interactiveOn()"\n                         kb-click.call="kbInteractiveOn()"\n                         id="annoto-header-interactive-button"\n                         color-class="grey"\n                         label="${\'tut.minimise\' & t}"></amdl-button>\n            <nnc-tooltip for="annoto-header-interactive-button" position="bottom">${\'tut.minimise\' & t & oneTime}</nnc-tooltip>\n        </div>\n        <div>\n            <amdl-button type="icon" icon-class="annoto-icon annoto-icon-close nn-icon-widget_close"\n                         pointer-click.call="hide()"\n                         kb-click.call="kbHide()"\n                         id="annoto-header-hide-button"\n                         color-class="grey"\n                         label="${\'tut.hide\' & t}"></amdl-button>\n            <nnc-tooltip for="annoto-header-hide-button" position="bottom">${\'tut.hide\' & t & oneTime}</nnc-tooltip>\n        </div>\n    </div>\n\n</template>'},"organs/header/nn-header.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-header.scss"></require>\n    <require from="./nn-sort"></require>\n    <require from="./nn-header-buttons"></require>\n\n    <div amdl-header-row class="annoto-header-row nn-color-background-secondary nn-draggable-handle">\n\n        <nn-sort if.bind="showSort"></nn-sort>\n        <div if.bind="store.userSpaceEnabled">\n            <nnc-button id="annoto-header-feed-btn-${store.id & oneTime}" class="annoto-uspace-btn"\n                size="sm"\n                ripple\n                color="secondary"\n                click.trigger="userActivityClickHandle()"\n                disabled.bind="spaceDisabled"\n                label.one-time="\'tut.feed\' & t">\n                <nnc-icon slot="icon" name="activity"></nnc-icon>\n            </nnc-button>\n            <nnc-tooltip position="bottom" for="annoto-header-feed-btn-${store.id & oneTime}">${\'tut.feed\' & t & oneTime}</nnc-tooltip>\n        </div>\n        <div if.bind="showTitle" class="annoto-header-title annoto-drag-hint nn-color-grey nn-text-subhead">${headerTitle & t & oneTime}</div>\n\n        <div if.bind="!showTitle" class="annoto-live annoto-drag-hint nn-color-primary nn-text-caption">${\'widget.header.live\' & t}</div>\n\n        <div if.bind="!showTitle" class="annoto-drag-hint annoto-flex-spacer" id="annoto-header-spacer-${store.id & oneTime}" aria-hidden="true"></div>\n        <nnc-tooltip show.bind="showDragHint" position="bottom" for="annoto-header-spacer-${store.id & oneTime}">${\'tut.drag\' & t & oneTime}</nnc-tooltip>\n\n        <a if.one-time="showHelp" class="annoto-help-link" href.one-time="store.settings.helpUrl" target="_blank" click.delegate="helpClickHandle()">\n            <div>\n                <i class="annoto-icon annoto-icon-emotion_help nn-icon-emotion_help"></i>\n            </div>\n        </a>\n        <nn-header-buttons if.bind="widget.isOverlay"></nn-header-buttons>\n    </div>\n</template>\n'},"organs/header/nn-sort":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoSortOrgan",(function(){return s}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(){function t(t){this.store=t.store}return t.prototype.bind=function(){},t.prototype.unbind=function(){},Object.defineProperty(t.prototype,"sortOption",{get:function(){var t=this.store;return t.isPrivateMode?t.notesController.sortOption:t.commentsController.sortOption},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortingOptions",{get:function(){var t=this.store;return t.isPrivateMode?t.notesController.sortingOptions:t.commentsController.sortingOptions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShown",{get:function(){return this.sortingOptions&&this.sortingOptions.length>1},enumerable:!1,configurable:!0}),t.prototype.sortHandle=function(t){var e=this.store;e.isPrivateMode?e.notesController.sortSetByUser(t):e.commentsController.sortSetByUser(t),e.analyticsController.recordUgcInteraction("sort",{sort:t.name},{label:t.name})},r([Object(o.p)("store.isPrivateMode","store.notesController","store.notesController.sortOption","store.commentsController","store.commentsController.sortOption"),a("design:type",Object),a("design:paramtypes",[])],t.prototype,"sortOption",null),r([Object(o.p)("store.isPrivateMode","store.notesController","store.notesController.sortingOptions","store.commentsController","store.commentsController.sortingOptions"),a("design:type",Array),a("design:paramtypes",[])],t.prototype,"sortingOptions",null),r([Object(o.p)("sortingOptions"),a("design:type",Boolean),a("design:paramtypes",[])],t.prototype,"isShown",null),t=r([Object(o.s)("nn-sort"),Object(o.t)(o.k.of(i.AnnotoWidget)),a("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/header/nn-sort.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-sort.scss"></require>\n\n    <amdl-menu-button class="annoto-sort-menu"\n        show.bind="isShown"\n        value.bind="sortOption"\n        on-invoke.call="sortHandle(option)"\n        options.bind="sortingOptions"\n        position.bind="store.rtl ? \'right\' : \'left\'"\n        aaa-label.bind="\'aaa.thread.sort\' & t">\n    </amdl-menu-button>\n\n</template>'},"organs/mini/css/nn-comments.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-mini .annoto-mini-content-container .annoto-comments{overflow-y:auto;overflow-x:hidden;height:100%;width:100%;margin:0;padding:0;list-style-type:none;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li{margin:0;padding:0;cursor:default}.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment{padding-top:4px !important}.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment .annoto-comment-content,.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment .annoto-comment-footer .annoto-flex-spacer,.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment .annoto-comment-header .annoto-flex-spacer{cursor:pointer}.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment .annoto-comment-header .annoto-comment-date,.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment .annoto-comment-header .annoto-comment-menu{display:none}.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment .annoto-comment-content{padding-bottom:0 !important}.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment .annoto-comment-content .annoto-comment-body>p,.annoto .annoto-mini .annoto-mini-content-container .annoto-comments>li .annoto-comment .annoto-comment-content .annoto-comment-topic>p{outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}",""]),e.default=i},"organs/mini/css/nn-content.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-mini .annoto-mini-content-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;height:calc(100% - 32px);width:100%}.annoto .annoto-mini .annoto-mini-content-container .annoto-mini-content{-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;padding:0 2px 4px 0;overflow-y:hidden;height:100%;width:100%;cursor:pointer}.annoto .annoto-mini .annoto-mini-content-container .annoto-mini-content .annoto-mini-cta-message{position:absolute;left:0;right:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);margin:auto;padding:0 8px;overflow:hidden;-webkit-box-sizing:border-box;box-sizing:border-box;text-align:center;white-space:pre-wrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.annoto .annoto-mini .annoto-mini-content-container .annoto-mini-content .nn-media-embed{width:100%;height:100px}.annoto .annoto-mini.kuku .annoto-mini-content-container{height:100%}.annoto .annoto-mini.kuku .annoto-mini-content-container .annoto-mini-content.cta{width:calc(100% - 64px)}.annoto.nnc-rtl .annoto-mini .annoto-mini-content-container .annoto-mini-content .annoto-mini-cta-message{direction:rtl}",""]),e.default=i},"organs/mini/css/nn-header.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-mini-header{height:32px;width:100%}.annoto .annoto-mini-header .annoto-flex-spacer{height:32px}",""]),e.default=i},"organs/mini/css/nn-kuku.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-kuku{position:relative;width:100%;height:100%;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:4px 8px}.annoto .annoto-kuku .annoto-avatar{position:relative;margin:0}.annoto .annoto-kuku .annoto-avatar .annoto-kuku-emotion{position:absolute}.annoto .annoto-kuku .annoto-kuku-content{margin:0 0 0 16px;width:100%;min-width:0;min-height:32px;cursor:pointer}.annoto .annoto-kuku .annoto-kuku-content .annoto-kuku-header{width:calc(100% - 70px)}.annoto .annoto-kuku .annoto-kuku-content .annoto-kuku-header .annoto-kuku-author-name{-ms-flex-negative:1;flex-shrink:1;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;height:20px;line-height:20px}.annoto .annoto-kuku .annoto-kuku-content .annoto-kuku-header .annoto-kuku-ps{margin:0;padding:0 8px;height:20px;line-height:20px;-ms-flex-negative:0;flex-shrink:0;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.annoto .annoto-kuku .annoto-kuku-content .annoto-kuku-body{text-align:initial}.annoto .annoto-kuku .annoto-kuku-content .annoto-kuku-body p{outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin:0;height:24px;line-height:24px;width:100%}.annoto .annoto-kuku .annoto-kuku-content .nn-kuku-media nnc-button{--nnc-border-width: 1px;--nnc-border-style: dashed}.annoto.nn-notes-page .annoto-kuku .annoto-kuku-content .annoto-kuku-header .annoto-kuku-ps{padding:0}",""]),e.default=i},"organs/mini/css/nn-mini.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-mini{width:100%;height:100%;padding:0;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;position:relative}.annoto .annoto-mini.kuku .annoto-mini-buttons{position:absolute;top:4px;right:4px}",""]),e.default=i},"organs/mini/css/nn-notes.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-mini .annoto-mini-content-container .annoto-notes{overflow-y:auto;overflow-x:hidden;height:100%;width:100%;margin:0;padding:0;list-style-type:none;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-mini .annoto-mini-content-container .annoto-notes>li{margin:0;padding:0;cursor:default}.annoto .annoto-mini .annoto-mini-content-container .annoto-notes>li .annoto-note .annoto-note-content,.annoto .annoto-mini .annoto-mini-content-container .annoto-notes>li .annoto-note .annoto-note-header .annoto-flex-spacer{cursor:pointer}.annoto .annoto-mini .annoto-mini-content-container .annoto-notes>li .annoto-note .annoto-note-header .annoto-note-date,.annoto .annoto-mini .annoto-mini-content-container .annoto-notes>li .annoto-note .annoto-note-header .annoto-note-menu{display:none}.annoto .annoto-mini .annoto-mini-content-container .annoto-notes>li .annoto-note .annoto-note-content .annoto-note-body>p,.annoto .annoto-mini .annoto-mini-content-container .annoto-notes>li .annoto-note .annoto-note-content .annoto-note-topic>p{outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}",""]),e.default=i},"organs/mini/nn-buttons":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoMiniButtons",(function(){return c}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.widget=t,this.store=t.store}return t.prototype.hide=function(){var t=this.store;return t.interactiveController.recordUserAction(),t.widget.hide().then((function(){t.analyticsController.recordWidgetInteraction("close",{element:"mini"},{label:"mini",value:t.player.playCounter>0?1:0})}))},t.prototype.kbHide=function(){var t=this;this.hide().then((function(){t.store.widget.setFocus()}))},t.prototype.openWidget=function(){var t=this.store;return t.interactiveController.recordUserAction(),t.interactiveController.setOffAndDoShow().then((function(){t.analyticsController.recordWidgetInteraction("open",{element:"mini"},{label:"mini",value:t.player.playCounter>0?1:0})}))},t.prototype.kbOpenWidget=function(){var t=this;this.openWidget().then((function(){t.store.widget.setFocus()}))},t=a([Object(o.s)("nn-buttons"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),s("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/mini/nn-buttons.html":function(t,e){t.exports='<template>\n    <div class="annoto-mini-buttons annoto-flex-row-nowrap annoto-flex-align-center">\n        <div>\n            <amdl-button type="icon" icon-class="annoto-icon annoto-icon-fullscreen nn-icon-widget_open" pointer-click.call="openWidget()" kb-click.call="kbOpenWidget()" color-class="grey"\n                id="annoto-mini-show-button"\n                label="${\'tut.show\' & t}"></amdl-button>\n            <nnc-tooltip for="annoto-mini-show-button" position="bottom">${\'tut.show\' & t & oneTime}</nnc-tooltip>\n        </div>\n        <div>\n            <amdl-button type="icon" icon-class="annoto-icon annoto-icon-close nn-icon-widget_close" pointer-click.call="hide()" kb-click.call="kbHide()" color-class="grey"\n                id="annoto-mini-hide-button"\n                label="${\'tut.hide\' & t}"></amdl-button>\n            <nnc-tooltip for="annoto-mini-hide-button" position="bottom">${\'tut.hide\' & t & oneTime}</nnc-tooltip>\n        </div>\n    </div>\n</template>'},"organs/mini/nn-comments":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoMiniComments",(function(){return p}));var o=n("aurelia-framework"),i=n("aurelia-templating-resources"),r=n("organs/widget/nn-widget"),a=n(35),s=n(69),c=n(29),l=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},p=function(){function t(t,e){this.sortConfig={property:"updatedAt",order:"desc",comparison:"date",enabled:!0},this.comments=[],this.disposables=[],this.signaler=t,this.store=e.store,this.logger=o.h.getLogger("Annoto-mini-comments")}return t.prototype.bind=function(t,e){this.addDisposables()},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this.comments=[]},t.prototype.addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.commentsController.on(s.b.VISIBLE_COMMENTS_CHANGE,(function(){return t.updateComments()}))),n.push(e.commentsController.on(s.b.CLEAR,(function(){t.comments=[],t.updateSignal()}))),n.push(e.commentsController.on(s.b.INITIALIZED,(function(){return t.updateComments()})))},Object.defineProperty(t.prototype,"showMiniCTA",{get:function(){return Boolean(this.store.commentsController&&this.store.commentsController.rtComments&&0===this.store.commentsController.rtComments.length)},enumerable:!1,configurable:!0}),t.prototype.replyClick=function(t){var e=this,n=this.store;n.user.authenticated?n.analyticsController.recordUgcInteraction("reply_tap",{element:"mini",comment:t.data.info},{label:t.data.type,value:t.data.length}):n.analyticsController.recordConversionInteraction("auth_trigger",{cause:"reply",element:"mini",comment:t.data.info},{label:"reply",value:t.data.length}),n.interactiveController.setOffAndDoShow().then((function(){return Object(c.c)()})).then((function(){return e.store.interactiveController.focusOnReplyForm(t.data)}))},t.prototype.commentClick=function(t){var e=this,n=this.store;return n.analyticsController.recordUgcInteraction("comment_tap",{element:"mini",comment:t.info},{label:t.type,value:t.length}),n.interactiveController.setOffAndDoShow().then((function(){return e.store.interactiveController.focusOnComment(t)})),!1},t.prototype.contentClick=function(){var t=this.comments;if(t&&t[0])return this.commentClick(t[0]);this.contentVm.triggerHandle()},t.prototype.updateComments=function(){this.comments=this.store.commentsController.rtComments||[],this.updateSignal()},t.prototype.updateSignal=function(){this.signaler.signal("annoto-mini-comments-update")},l([Object(o.p)("store.commentsController","store.commentsController.rtComments","store.commentsController.rtComments.length"),u("design:type",Object),u("design:paramtypes",[])],t.prototype,"showMiniCTA",null),t=l([Object(o.s)("nn-comments"),Object(o.t)(i.BindingSignaler,a.a.of(r.AnnotoWidget,!0)),u("design:paramtypes",[i.BindingSignaler,r.AnnotoWidget])],t)}()},"organs/mini/nn-comments.html":function(t,e,n){t.exports='<template>\n\n    <require from="./css/nn-comments.scss"></require>\n    <require from="./nn-content"></require>\n    <require from="../comment-form/nn-comment-form"></require>\n    <require from="../comment/nn-comment"></require>\n\n    <nn-content class="annoto-mini-content-container"\n                show-form.bind="store.commentsSubmitEnabled"\n                show-content.one-time="true"\n                show-cta.bind="showMiniCTA"\n                view-model.ref="contentVm"\n                on-click.call="contentClick()">\n\n        <ol slot="content" class="annoto-comments nn-scrollbar nn-mini-trigger" ref="commentsElement">\n            <li repeat.for="comment of comments | arraySort:sortConfig & oneTime & signal:\'annoto-mini-comments-update\'">\n                <nn-comment data.one-time="comment"\n                            last.one-time="$last"\n                            on-reply.call=replyClick(vm)\n                            reply-open-disable.one-time="true"\n                            on-click.call=commentClick(vm.data)></nn-comment>\n            </li>\n        </ol>\n\n    </nn-content>\n</template>\n'},"organs/mini/nn-content":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoMiniContent",(function(){return c}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.showContent=!0,this.showCta=!1,this.onClick=function(){},this.widget=t,this.store=t.store}return t.prototype.bind=function(){},Object.defineProperty(t.prototype,"formEmotionPosition",{get:function(){return this.store.isPhone?"bottom-right":"top-right"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miniCTAMessage",{get:function(){return this.store.isPrivateMode?"thread.cta.short_notes":"thread.cta.short_comments"},enumerable:!1,configurable:!0}),t.prototype.triggerHandle=function(){var t=this,e=this.store;e.interactiveController.recordUserAction(),e.analyticsController.recordConversionInteraction("cta_tap",{element:"mini"},{label:"mini",value:e.player.pp}),e.interactiveController.setOffAndDoShow().then((function(){return t.store.interactiveController.focusOnRootForm()}))},t.prototype.contentClick=function(t){return!event.target.classList.contains("nn-mini-trigger")||(t.stopPropagation(),this.onClick(),!1)},a([o.m,s("design:type",Object)],t.prototype,"showContent",void 0),a([o.m,s("design:type",Object)],t.prototype,"showCta",void 0),a([o.m,s("design:type",Object)],t.prototype,"onClick",void 0),a([Object(o.p)("store.isPhone"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"formEmotionPosition",null),a([Object(o.p)("store.isPrivateMode"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"miniCTAMessage",null),t=a([Object(o.s)("nn-content"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),s("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/mini/nn-content.html":function(t,e,n){t.exports='<template>\n\n    <require from="./css/nn-content.scss"></require>\n\n    <div show.bind="showContent" class="annoto-mini-content nn-mini-trigger ${showCta ? \'cta\' : \'\'}" click.trigger="contentClick($event)">\n        <slot name="content"></slot>\n        <p if.bind="showCta" class="annoto-mini-cta-message nn-mini-trigger nn-text-body nn-color-grey-heavy">${miniCTAMessage | t}</p>\n    </div>\n</template>'},"organs/mini/nn-header":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoMiniHeaderOrgan",(function(){return r}));var o=n("aurelia-framework"),i=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},r=function(){function t(){}return t=i([Object(o.s)("nn-header")],t)}()},"organs/mini/nn-header.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-header.scss"></require>\n    <require from="./nn-buttons"></require>\n    <div class="annoto-mini-header annoto-flex-row-nowrap annoto-flex-align-center">\n\n        <div class="annoto-drag-hint nn-draggable-handle annoto-flex-spacer" aria-hidden="true"></div>\n\n        <nn-buttons></nn-buttons>\n    </div>\n</template>'},"organs/mini/nn-kuku":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoKuku",(function(){return d}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=n(69),s=n(38),c=n(61),l=n(11),u=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},p=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},d=function(){function t(t){this.disposables=[],this.submitting=!1,this.store=t.store,this.logger=o.h.getLogger("Annoto-mini-kuku")}return t.prototype.bind=function(t,e){this.addDisposables()},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this.data=null},t.prototype.addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.commentsController.on(a.b.VISIBLE_COMMENTS_CHANGE,(function(){return t.updateComments()}))),n.push(e.commentsController.on(a.b.CLEAR,(function(){return t.clearComments()}))),n.push(e.commentsController.on(a.b.INITIALIZED,(function(){return t.updateComments()}))),n.push(e.notesController.on(c.b.VISIBLE_NOTES_CHANGE,(function(){return t.uptadeNotes()}))),n.push(e.notesController.on(c.b.CLEAR,(function(){return t.clearNotes()}))),n.push(e.notesController.on(c.b.INITIALIZED,(function(){return t.uptadeNotes()})))},Object.defineProperty(t.prototype,"hasData",{get:function(){return Boolean(!!this.data)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showEmotion",{get:function(){if(!this.data)return!1;var t=this.data.emotion;return!(!t||t.type===s.c.UNKNOWN)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showPs",{get:function(){var t=this.store,e=this.data;return!(!e||!e.hasPS||!t.timelineEnabled&&!e.ps&&t.isLive)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anonymizeAuthor",{get:function(){var t=this.data,e=t&&t.author,n=this.store;return Boolean(t&&e&&t.anonymous&&!n.user.isModerator&&n.user.id!==e.id)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authorName",{get:function(){var t=this.data,e=t&&t.author,n=e&&e.name;return this.anonymizeAuthor?this.store.i18n.tr("generic.anonymous"):n&&n.startsWith("generic.")?this.store.i18n.tr(n):n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authorPhoto",{get:function(){var t=this.data,e=t&&t.author,n=e&&e.photoUrl;return this.anonymizeAuthor?""+l.b.IMAGES_URL+l.b.ANONYMOUS_AVATAR:n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasMedia",{get:function(){var t,e,n=this.data;return null===(e=null===(t=null==n?void 0:n.data)||void 0===t?void 0:t.media)||void 0===e?void 0:e.assetId},enumerable:!1,configurable:!0}),t.prototype.contentClick=function(){this.contentVm.triggerHandle()},t.prototype.clickHandle=function(t){var e=this;if(this.hasData){var n=this.store,o=this.data,i=o.info;return n.analyticsController.recordUgcInteraction("kuku_tap",{element:"mini",kuku_item:i},{label:o.type,value:o.length}),n.interactiveController.setOffAndDoShow().then((function(){return n.isPrivateMode?n.interactiveController.focusOnNote(o):e.store.interactiveController.focusOnComment(o)})),!1}},t.prototype.clearComments=function(){this.store.isPrivateMode||(this.data=null)},t.prototype.updateComments=function(){this.store.isPrivateMode||(this.data=this.store.commentsController.rtComments.reduce((function(t,e){return!t||e.rating>t.rating?e:t.rating>e.rating?t:e.updatedAt>t.updatedAt?e:t}),null))},t.prototype.uptadeNotes=function(){this.store.isPrivateMode&&(this.data=this.store.notesController.rtNotes.reduce((function(t,e){return!t||e.updatedAt>t.updatedAt?e:t}),null))},t.prototype.clearNotes=function(){this.store.isPrivateMode&&(this.data=null)},t.prototype.updateData=function(t){},u([Object(o.p)("data"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"hasData",null),u([Object(o.p)("data","data.emotion"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"showEmotion",null),u([Object(o.p)("data","data.hasPS","store.isLive"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"showPs",null),u([Object(o.p)("data","store.user.isModerator","store.user.id"),p("design:type",Boolean),p("design:paramtypes",[])],t.prototype,"anonymizeAuthor",null),u([Object(o.p)("anonymizeAuthor","data"),p("design:type",String),p("design:paramtypes",[])],t.prototype,"authorName",null),u([Object(o.p)("anonymizeAuthor","data"),p("design:type",String),p("design:paramtypes",[])],t.prototype,"authorPhoto",null),u([Object(o.p)("data"),p("design:type",Object),p("design:paramtypes",[])],t.prototype,"hasMedia",null),t=u([Object(o.s)("nn-kuku"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),p("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/mini/nn-kuku.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-kuku.scss"></require>\n    <require from="../emotion/nn-emotion"></require>\n    <require from="./nn-content"></require>\n\n    <nn-content class="annoto-mini-content-container"\n                show-form.one-time="false"\n                show-content.one-time="true"\n                show-cta.bind="!hasData"\n                view-model.ref="contentVm"\n                on-click.call="contentClick()">\n\n        <div slot="content" class="annoto-kuku annoto-flex-row-nowrap" show.bind="hasData">\n\n            <div if.bind="!store.isPrivateMode" class="annoto-avatar annoto-drag-hint nn-draggable-handle" aria-hidden="true">\n                <nnc-avatar photo-src.bind="authorPhoto" full-name.bind="authorName" responsive></nnc-avatar>\n                <nn-emotion if.bind="showEmotion" class="annoto-kuku-emotion" data.bind="data.emotion"></nn-emotion>\n            </div>\n\n            <div if.bind="hasData" class="annoto-kuku-content"\n                 nn-focusable\n                 nn-interaction="click.call: clickHandle(event); space.call: clickHandle(event); enter.call: clickHandle(event);">\n                <div class="annoto-kuku-header annoto-flex-row-nowrap annoto-flex-align-center" aria-hidden="true">\n\n                    <span class="annoto-kuku-author-name nn-color-grey nn-text-caption">${data.author.name & t}</span>\n\n                    <span if.bind="showPs" class="annoto-kuku-ps annoto-flex-row-nowrap">\n                        <span class="nn-color-grey-heavy nn-text-caption">${data.ps | number:\'00:00:00\'}</span>\n                    </span>\n                </div>\n\n                <div if.bind="!!data.body" class="annoto-kuku-body" dir="auto" aria-hidden="true">\n                    <p class="nn-text nn-text-body nn-text-color" innerhtml="${data.body | escape | hyperlink | sanitizeHTML}"></p>\n                </div>\n                <div if.bind="hasMedia && !data.body" class="nn-kuku-media">\n                    <nnc-button fill="outline" color="tertiary" ripple rounded>\n                        <nnc-icon name="media-play" size="lg"></nnc-icon>\n                    </nnc-button>\n                </div>\n\n                <div class="nn-aaa-hidden-info" aria-live="polite">${data.author.name & t}. ${data.ps | number:\'00:00:00\'}. ${data.body | escape}</div>\n            </div>\n        </div>\n    </nn-content>\n\n</template>'},"organs/mini/nn-mini":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoMini",(function(){return c}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.disposables=[],this.widget=t,this.store=t.store}return t.prototype.bind=function(t,e){},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[]},t=a([Object(o.s)("nn-mini"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),s("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/mini/nn-mini.html":function(t,e,n){t.exports='<template>\n        <require from="./css/nn-mini.scss"></require>\n        <require from="./nn-header"></require>\n        <require from="./nn-buttons"></require>\n        <require from="./nn-comments"></require>\n        <require from="./nn-notes"></require>\n        <require from="./nn-kuku"></require>\n    \n        <div class="annoto-mini ${widget.miniKukuMode ? \'kuku\' : \'\'}">\n\n            <nn-header if.bind="!widget.miniKukuMode"></nn-header>\n\n            <nn-comments if.bind="!widget.miniKukuMode && !store.isPrivateMode && store.commentsEnabled"></nn-comments>\n\n            <nn-notes if.bind="!widget.miniKukuMode && store.isPrivateMode && store.privateNotesEnabled"></nn-notes>\n    \n            <nn-kuku if.bind="widget.miniKukuMode"></nn-kuku>\n            <nn-buttons if.bind="widget.miniKukuMode"></nn-buttons>\n        </div>\n    </template>\n    '},"organs/mini/nn-notes":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoMiniNotes",(function(){return u}));var o=n("aurelia-framework"),i=n("aurelia-templating-resources"),r=n("organs/widget/nn-widget"),a=n(35),s=n(61),c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e){this.sortConfig={property:"updatedAt",order:"desc",comparison:"date",enabled:!0,value:"updated_at"},this.notes=[],this.disposables=[],this.signaler=t,this.store=e.store,this.logger=o.h.getLogger("Annoto-mini-notes")}return t.prototype.bind=function(t,e){this.addDisposables()},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this.notes=[]},t.prototype.addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.notesController.on(s.b.VISIBLE_NOTES_CHANGE,(function(){return t.uptadeNotes()}))),n.push(e.notesController.on(s.b.CLEAR,(function(){t.notes=[],t.updateSignal()}))),n.push(e.notesController.on(s.b.INITIALIZED,(function(){return t.uptadeNotes()})))},Object.defineProperty(t.prototype,"showMiniCTA",{get:function(){return Boolean(this.store.notesController&&this.store.notesController.rtNotes&&0===this.store.notesController.rtNotes.length)},enumerable:!1,configurable:!0}),t.prototype.noteClick=function(t){var e=this,n=this.store;return n.analyticsController.recordUgcInteraction("note_tap",{element:"mini",note:t.info},{label:"mini",value:t.length}),n.interactiveController.setOffAndDoShow().then((function(){return e.store.interactiveController.focusOnNote(t)})),!1},t.prototype.contentClick=function(){var t=this.notes;if(t&&t[0])return this.noteClick(t[0]);this.contentVm.triggerHandle()},t.prototype.uptadeNotes=function(){this.notes=this.store.notesController.rtNotes||[],this.updateSignal()},t.prototype.updateSignal=function(){this.signaler.signal("annoto-mini-notes-update")},c([Object(o.p)("store.notesController","store.notesController.rtNotes","store.notesController.rtNotes.length"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"showMiniCTA",null),t=c([Object(o.s)("nn-notes"),Object(o.t)(i.BindingSignaler,a.a.of(r.AnnotoWidget,!0)),l("design:paramtypes",[i.BindingSignaler,r.AnnotoWidget])],t)}()},"organs/mini/nn-notes.html":function(t,e,n){t.exports='<template>\n\n        <require from="./css/nn-notes.scss"></require>\n        <require from="./nn-content"></require>\n        <require from="../comment-form/nn-comment-form"></require>\n        <require from="../note/nn-note"></require>\n    \n        <nn-content class="annoto-mini-content-container"\n                    show-form.bind="store.commentsSubmitEnabled"\n                    show-content.bind="true"\n                    show-cta.bind="showMiniCTA"\n                    view-model.ref="contentVm"\n                    on-click.call="contentClick()">\n    \n            <ol slot="content" class="annoto-notes nn-scrollbar nn-mini-trigger" ref="notesElement">\n                <li repeat.for="note of notes | arraySort:sortConfig & oneTime & signal:\'annoto-mini-notes-update\'">\n                    <nn-note data.bind="note & oneTime"\n                             on-click.call=noteClick(vm.data)></nn-note>\n                </li>\n            </ol>\n    \n        </nn-content>\n    </template>\n    '},"organs/moderator/css/nn-moderator.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-comment .annoto-moderator{position:relative;width:36px;height:36px;margin:0}.annoto .annoto-comment .annoto-moderator .annoto-moderator-controls .annoto-moderator-spacer{width:100%;height:20px}.annoto .annoto-comment .annoto-moderator .annoto-moderator-spinner{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%)}",""]),e.default=i},"organs/moderator/nn-moderator":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoModerator",(function(){return c}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(60),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.working=!1,this.widget=t,this.store=t.store}return t.prototype.bind=function(t,e){},t.prototype.unbind=function(){this.working=!1},t.prototype.approve=function(){var t=this;this.working=!0,this.store.commentsController.patchCommentState(this.commentData,r.a.state.visible).then((function(){t.working=!1}))},t.prototype.remove=function(){var t=this;this.working=!0,this.store.commentsController.patchCommentState(this.commentData,r.a.state.deleted).then((function(){t.working=!1}))},a([o.m,s("design:type",Object)],t.prototype,"commentData",void 0),t=a([Object(o.s)("nn-moderator"),Object(o.t)(o.k.of(i.AnnotoWidget)),s("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/moderator/nn-moderator.html":function(t,e,n){t.exports='<template>\n  <require from="./css/nn-moderator.scss"></require>\n\n  <div class="annoto-moderator">\n    <div class="annoto-moderator-controls" show.bind="!working" amdl-grid="align-content:center; no-spacing:true">\n      <amdl-button amdl-cell="col:12" color-class="accent" type="icon" icon-class="annoto-icon annoto-icon-done nn-icon-moderator_approve" click.call="approve()" align="left"></amdl-button>\n      <div class="annoto-moderator-spacer"></div>\n      <amdl-button amdl-cell="col:12" color-class="primary" type="icon" icon-class="annoto-icon annoto-icon-close nn-icon-moderator_decline" click.call="remove()" align="right"></amdl-button>\n\n    </div>\n\n    <div class="annoto-moderator-spinner" show.bind="working"><amdl-spinner></amdl-spinner></div>\n  </div>\n</template>\n'},"organs/note/css/nn-content.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-note .annoto-note-content{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-note .annoto-note-content .annoto-note-topic,.annoto .annoto-note .annoto-note-content .annoto-note-body{text-align:initial}.annoto .annoto-note .annoto-note-content .annoto-note-topic p,.annoto .annoto-note .annoto-note-content .annoto-note-body p{word-wrap:break-word;overflow-wrap:break-word;word-break:break-word;margin:0;width:100%}.annoto .annoto-note .annoto-note-content .annoto-note-topic p{margin-bottom:0}.annoto .annoto-note .annoto-note-content .annoto-note-body p{white-space:pre-wrap;font-size:var(--nnc-note-typo-body-size, 15px)}",""]),e.default=i},"organs/note/css/nn-header.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-note .annoto-note-header{width:100%;position:relative}.annoto .annoto-note .annoto-note-header .annoto-flex-row-nowrap,.annoto .annoto-note .annoto-note-header .annoto-flex-row-wrap{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.annoto .annoto-note .annoto-note-header .annoto-note-date{-ms-flex-negative:1000;flex-shrink:1000;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.annoto .annoto-note .annoto-note-header .annoto-flex-spacer{height:32px}.annoto .annoto-note .annoto-note-header .annoto-note-ps,.annoto .annoto-note .annoto-note-header .annoto-note-date{margin:0 4px;height:32px;line-height:32px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.annoto .annoto-note .annoto-note-header .annoto-note-ps{padding:0;-ms-flex-negative:0;flex-shrink:0;cursor:pointer}.annoto.is-live .annoto-note .annoto-note-header .annoto-note-ps{cursor:default}",""]),e.default=i},"organs/note/css/nn-note.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-note{position:relative;width:100%;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;font-size:16px}.annoto .annoto-note .annoto-note-container .annoto-note-emotion{position:absolute}.annoto .annoto-note .annoto-note-container .annoto-container{margin:0;width:100%;min-height:32px;min-width:0}.annoto .annoto-note .annoto-note-form-container{display:block;max-height:100%;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}.annoto .annoto-note .annoto-note-form-container .annoto-comment-form{background:inherit}.annoto .annoto-note.editing>.annoto-note-container{display:none}",""]),e.default=i},"organs/note/nn-content.html":function(t,e,n){t.exports='<template bindable="note">\n    <require from="./css/nn-content.scss"></require>\n\n    <div with.bind="note" class="annoto-note-content" click.delegate="clickHandle()">\n        <div if.bind="showTopic" class="annoto-note-topic" dir="auto">\n            <p class="nn-text nn-text-subhead nn-text-color">${data.topic}</p>\n        </div>\n        <div class="annoto-note-body" dir="auto">\n            <p class="nn-text nn-text-body nn-text-color" innerhtml="${data.body | escape | hyperlink:{yt:true} | sanitizeHTML}"></p>\n        </div>\n    </div>\n</template>'},"organs/note/nn-header.html":function(t,e,n){t.exports='<template bindable="note">\n    <require from="./css/nn-header.scss"></require>\n\n    <div with.bind="note" class="annoto-note-header annoto-flex-row-nowrap annoto-flex-align-center" amdl-flex-row-rtl.one-time="store.rtl">\n\n        <span if.one-time="showPs" class="annoto-note-ps annoto-flex-row-nowrap"\n                role="button"\n                nn-interaction="click.call: psClick(event); space.call: psClick(event); enter.call: psClick(event);"\n                nn-focusable.one-time="\'aaa.note.timestamp\' | t: {\'time\': formatedTimestamp}">\n            <span class="nn-text-caption nn-color-grey-heavy">${formatedTimestamp}</span>\n        </span>\n\n        <div class="annoto-flex-spacer" click.delegate="clickHandle()" aria-hidden="true"></div>\n\n        <span id="annoto-note-date-${data.id & oneTime}" class="annoto-note-date nn-color-grey-light nn-text-caption">\n            ${data.updatedAt | fromNow & oneTime & signal:\'annoto-dates\'}\n        </span>\n        <nnc-tooltip for="annoto-note-date-${data.id & oneTime}" size="sm">${data.updatedAt | date:"PP \'at\' HH:mm" & oneTime}</nnc-tooltip>\n\n        <amdl-menu-button class="annoto-note-menu"\n                        icon-class="annoto-icon-more_horiz nn-icon-menu_more nn-color-grey-heavy"\n                        icon-only.one-time="true"\n                        options.one-time="menuActions"\n                        on-invoke.call="actionHandle(index)"\n                        open.from-view="menuOpen"\n                        position.one-time="store.rtl ? \'left\' : \'right\'"></amdl-menu-button>\n    </div>\n</template>'},"organs/note/nn-note":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoNoteOrgan",(function(){return h}));var o=n("aurelia-framework"),i=n(84),r=n.n(i),a=n(38),s=n("organs/widget/nn-widget"),c=n(85),l=n(29),u=n("dialog/index"),p=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(){function t(t,e){this.widget=t,this.dialog=e,this.thisVm=this,this.showForm=!1,this.editing=!1,this.submitting=!1,this.formEmotionPosition="bottom-right",this.formFeatures={cancelBtn:!0,userName:!1},this.menuActions=[{text:"note.actions.edit",icon:"annoto-icon-mode_edit nn-color-accent nn-icon-edit"},{text:"note.actions.delete",icon:"annoto-icon-delete nn-color-grey-heavy nn-icon-delete"}],this.store=t.store,this.logger=o.h.getLogger("Annoto-note")}return t.prototype.bind=function(){},t.prototype.unbind=function(){this.submitting=!1,this.editing=!1},t.prototype.psClick=function(t){var e=this.store,n=this.data;if(this.store.interactiveController.recordUserAction(),t.stopPropagation(),this.data.hasPS){e.playerUxFilter.setCurrentTime(e,n.ps);var o=n.info,i=e.interactiveMode?"mini":"thread";return e.analyticsController.recordUgcInteraction("timetag_tap",{element:i,note:o},{label:i,value:n.length})}},t.prototype.setFocus=function(){this.focusableEl&&this.focusableEl.focus()},t.prototype.clickHandle=function(){return this.store.interactiveController.recordUserAction(),"function"!=typeof this.onClick||this.onClick({vm:this})},t.prototype.actionHandle=function(t){var e=this;return this.store.interactiveController.recordUserAction(),0===t?(this.showForm=!1,Object(l.c)(0).then((function(){return e.editing=!0,e.showForm=!0,Object(l.c)(0)})).then((function(){e.formVm.openForm()}))):1===t?this.deleteNote():void this.logger.warn("Unknown action: ",t)},t.prototype.formSubmit=function(t){var e=this;if(!this.submitting)return this.submitting=!0,this.editSubmit(t).then((function(){e.submitting=!1})).catch((function(){return e.submitting=!1,!1}))},Object.defineProperty(t.prototype,"showPs",{get:function(){var t=this.store,e=this.data;return!(!e.hasPS||t.hidePs||!t.timelineEnabled&&!e.ps&&t.isLive)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showEmotion",{get:function(){var t=this.data.emotion;return!(!t||t.type===a.c.UNKNOWN)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showTopic",{get:function(){return!(!this.data.topic||""===this.data.topic)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formatedTimestamp",{get:function(){return this.data?r()(this.data.ps).format("00:00:00"):""},enumerable:!1,configurable:!0}),t.prototype.formHide=function(){var t=this;this.showForm=!1,this.editing=!1,setTimeout((function(){return t.setFocus()}),0)},t.prototype.deleteNote=function(){var t=this;if(this.store.demoIsActive)return this.store.notesController.deleteNote(this.data);return this.dialog.open({model:{message:"note.delete_confirmation.message",yesBtnText:"note.delete_confirmation.ok",noBtnText:"note.delete_confirmation.cancel"},viewModel:"dialog/views/nn-yes-no",lock:!1,host:this.widget.containerElement,container:this.widget.auContainer,focusOnClose:!1}).whenClosed((function(e){if(!e.wasCancelled)return t.store.notesController.deleteNote(t.data);t.setFocus()}))},t.prototype.editSubmit=function(t){var e=this,n=this.data.emotion;return this.data.emotion=null,this.store.notesController.editNote(this.data,t).then((function(t){if(!t)throw e.data.emotion=n,new Error;e.formHide()}))},p([o.m,d("design:type",c.a)],t.prototype,"data",void 0),p([o.m,d("design:type",Object)],t.prototype,"onClick",void 0),p([Object(o.p)("data.hasPS","store.hidePs","store.isLive"),d("design:type",Object),d("design:paramtypes",[])],t.prototype,"showPs",null),p([Object(o.p)("data.emotion"),d("design:type",Object),d("design:paramtypes",[])],t.prototype,"showEmotion",null),p([Object(o.p)("data.topic"),d("design:type",Object),d("design:paramtypes",[])],t.prototype,"showTopic",null),p([Object(o.p)("data","data.ps"),d("design:type",String),d("design:paramtypes",[])],t.prototype,"formatedTimestamp",null),t=p([Object(o.s)("nn-note"),Object(o.t)(o.k.of(s.AnnotoWidget),u.DialogService),d("design:paramtypes",[s.AnnotoWidget,u.DialogService])],t)}()},"organs/note/nn-note.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-note.scss"></require>\n    <require from="./nn-header.html"></require>\n    <require from="./nn-content.html"></require>\n    <require from="../emotion/nn-emotion"></require>\n    <require from="../comment-form/nn-comment-form"></require>\n\n\n    <div class="annoto-note ${editing ? \'editing\' : \'\'} ${menuOpen ? \'menu-open\' : \'\'}">\n\n        <div class="annoto-note-container annoto-flex-row-nowrap" amdl-flex-row-rtl.one-time="store.rtl" nn-focusable ref="focusableEl">\n            <div if.bind="showEmotion" class="annoto-note-emotion">\n                <nn-emotion data.bind="data.emotion"></nn-emotion>\n            </div>\n\n            <div class="annoto-container nn-border-bottom">\n\n                <nn-header note.bind="thisVm"></nn-header>\n                <nn-content note.bind="thisVm"></nn-content>\n\n            </div>\n        </div>\n\n        <div if.bind="showForm" class="annoto-note-form-container">\n            <nn-comment-form\n                             view-model.ref="formVm"\n                             features.one-time="formFeatures"\n                             data.one-time="data"\n                             on-cancel.call="formHide()"\n                             on-submit.call="formSubmit(data)"\n                             emotion-position.one-time="formEmotionPosition"\n                             disabled.one-time="false">\n            </nn-comment-form>\n        </div>\n    </div>\n\n</template>\n'},"organs/people/css/nn-live-session-invite.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-live-session-invite{width:100%}.annoto .annoto-live-session-invite .nn-live-session-invite-text{color:var(--nnc-color-step-100, #191919)}",""]),e.default=i},"organs/people/css/nn-people.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-people{display:block;width:100%;height:100%}.annoto .annoto-people .nn-people-list{font-size:16px;display:block;list-style-type:none;-webkit-box-sizing:border-box;box-sizing:border-box;contain:content;margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;padding-left:1em;padding-right:1em;padding-top:.5em;padding-bottom:.5em;background:var(--nnc-item-bg, #fafafa)}@supports((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.annoto .annoto-people .nn-people-list{padding-left:unset;padding-right:unset;-webkit-padding-start:1em;padding-inline-start:1em;-webkit-padding-end:1em;padding-inline-end:1em}}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .annoto-people .nn-people-list{background:#fafafa}}.annoto .annoto-people .nn-people-list>li{margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;padding-left:0;padding-right:0;padding-top:0;padding-bottom:0}.annoto .annoto-people .nn-people-search{padding:0 16px;-webkit-box-sizing:border-box;box-sizing:border-box}",""]),e.default=i},"organs/people/css/nn-person.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-person{--nnc-padding-y: .75em}",""]),e.default=i},"organs/people/css/nn-selected-person.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-selected-person,.annoto .annoto-selected-person .nn-selected-person-info{height:100%;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-line-pack:stretch;align-content:stretch;padding:0;margin:0}.annoto .annoto-selected-person .nn-selected-person-info{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:0;padding-right:0;padding-top:16px;padding-bottom:16px;margin-left:16px;margin-right:16px;margin-top:0;margin-bottom:0;width:calc(100% - 32px);height:auto;position:relative;border-bottom:1px solid var(--nnc-border-color, #e2e2e5)}@supports((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.annoto .annoto-selected-person .nn-selected-person-info{margin-left:unset;margin-right:unset;-webkit-margin-start:16px;margin-inline-start:16px;-webkit-margin-end:16px;margin-inline-end:16px}}.annoto .annoto-selected-person .nn-selected-person-info nnc-avatar{margin-bottom:10px}.annoto .annoto-selected-person .nn-back-to-people-btn{position:absolute;left:14px;top:14px}.annoto .annoto-selected-person .nnc-person-social-icons{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:0;padding-right:0;padding-top:8px;padding-bottom:8px}.annoto .annoto-selected-person .nnc-person-social-icons>a{margin-left:8px;margin-right:8px;margin-top:0;margin-bottom:0;font-family:inherit;font-size:inherit;font-style:inherit;font-weight:inherit;letter-spacing:inherit;text-decoration:inherit;text-overflow:inherit;text-transform:inherit;text-align:inherit;white-space:inherit;color:inherit;text-decoration:none;background-color:transparent;outline:none;-webkit-box-sizing:border-box;box-sizing:border-box;display:block;cursor:pointer}@supports((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.annoto .annoto-selected-person .nnc-person-social-icons>a{margin-left:unset;margin-right:unset;-webkit-margin-start:8px;margin-inline-start:8px;-webkit-margin-end:8px;margin-inline-end:8px}}.annoto .annoto-selected-person .nn-selected-person-invite-btn{text-transform:none}.annoto .annoto-selected-person .nnc-selected-person-main{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;padding-left:16px;padding-right:16px;padding-top:16px;padding-bottom:16px}@supports((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.annoto .annoto-selected-person .nnc-selected-person-main{padding-left:unset;padding-right:unset;-webkit-padding-start:16px;padding-inline-start:16px;-webkit-padding-end:16px;padding-inline-end:16px}}",""]),e.default=i},"organs/people/nn-live-session-invite":function(t,e,n){"use strict";n.r(e),n.d(e,"LiveSessionInvite",(function(){return s}));var o=n("aurelia-framework"),i=n(36),r=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(){function t(t){this.store=t}return Object.defineProperty(t.prototype,"message",{get:function(){var t=this.invite,e=this.invitedUser;return t&&e?t.message?t.message.replace("{{name}}",e.name):this.store.i18n.tr("people.private_session_invite.message",{name:e.name}):""},enumerable:!1,configurable:!0}),r([o.m,a("design:type",Object)],t.prototype,"invite",void 0),r([o.m,a("design:type",Object)],t.prototype,"invitedUser",void 0),r([o.m,a("design:type",String)],t.prototype,"linkText",void 0),r([Object(o.p)("invite"),a("design:type",String),a("design:paramtypes",[])],t.prototype,"message",null),t=r([Object(o.s)("nn-live-session-invite"),Object(o.t)(i.a),a("design:paramtypes",[i.a])],t)}()},"organs/people/nn-live-session-invite-dialog":function(t,e,n){"use strict";n.r(e),n.d(e,"LiveSessionInviteDialog",(function(){return d}));var o=n("aurelia-framework"),i=n("aurelia-i18n"),r=n("dialog/index"),a=n(29),s=n(49),c=n(36),l=function(){return(l=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},u=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},p=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},d=function(){function t(t,e,n,o){var i=this;this.controller=t,this.i18n=e,this.user=n,this.store=o,"function"==typeof o.ux.getOneOnOneSessionInvite&&Promise.resolve().then((function(){return o.ux.getOneOnOneSessionInvite({authorId:"",invitedUserId:""})})).then((function(t){t&&(i.inviteUrlText=t.inviteUrlText)})).catch((function(t){}))}return t.prototype.activate=function(t){this.data=l({},t)},Object.defineProperty(t.prototype,"title",{get:function(){var t=this.data;return t&&t.title?t.title:""},enumerable:!1,configurable:!0}),t.prototype.closeHandle=function(){var t=this,e={};return Object(a.c)(200).then((function(){return t.controller.ok(e)}))},u([Object(o.p)("data"),p("design:type",String),p("design:paramtypes",[])],t.prototype,"title",null),t=u([Object(o.s)("nn-live-session-invite-dialog"),Object(o.t)(r.DialogController,i.I18N,s.a,c.a),p("design:paramtypes",[r.DialogController,i.I18N,s.a,c.a])],t)}()},"organs/people/nn-live-session-invite-dialog.html":function(t,e,n){t.exports='<template>\n    <require from="./nn-live-session-invite"></require>\n    <nn-dialog class="annoto-live-session-invite-dialog">\n        <nn-dialog-header>\n            ${title}\n        </nn-dialog-header>\n        <nn-dialog-body>\n            <nn-live-session-invite invite.bind="data" invited-user.bind="user.author" link-text.bind="inviteUrlText"/>\n        </nn-dialog-body>\n\n        <nn-dialog-footer>\n            <nnc-button click.trigger="closeHandle()" fill="clear" color="medium" ripple>${\'generic.close\' & t & oneTime}</nnc-button>\n        </nn-dialog-footer>\n    </nn-dialog>\n</template>'},"organs/people/nn-live-session-invite.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-live-session-invite.scss"></require>\n\n    <nnc-item class="annoto-live-session-invite" lines="full">\n        <nnc-avatar slot="start" photo-src.one-time="invite.author.photo_url" full-name.one-time="invite.author.name"></nnc-avatar>\n        <nnc-label><h4>${invite.author.name}</h4></nnc-label>\n        <nnc-label truncate.one-time="false" class="nn-live-session-invite-text">\n            ${message} <nnc-hyperlink color="secondary" href="${invite.inviteUrl}" text.bind="linkText"/>\n        </nnc-label>\n    </nnc-item>\n</template>'},"organs/people/nn-people":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoPeople",(function(){return y}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=n(91),s=n(75),c=n(32),l=n(29),u=n(43),p=n(31),d=n(34),h=n("aurelia-templating-resources"),m=function(){return(m=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},f=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},g=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},b={page:0,size:20,include_my_events:1},y=function(){function t(t,e){var n=this;this.signaler=t,this.widget=e,this.disposables=[],this.loading=!1,this.people=[],this.query=m({},b),this.searchTerm=null,this.sortConfig={enabled:!1,property:"updated_at",order:"desc",comparison:"date"},this.pollPeople=function(){return n.updatePeople().catch((function(t){n.logger.warn("pollPeople: ",t)}))},this.store=e.store,this.logger=o.h.getLogger("Annoto-people"),this.updatePoll=new a.a((function(){var t=c.a.rt.peoplePoll;return Object(s.a)(t.min,t.max)}),this.pollPeople)}return t.prototype.bind=function(){var t=this;this.addDisposables(),this.query=m({},b),this.loading=!1,this.getItems({query:m({},this.query),noMerge:!0}).then((function(){t.updatePollStart()}))},t.prototype.unbind=function(){this.updatePollStop(),Object(l.d)(this.disposables),this.disposables=[],this.people=[],this.items=null},Object.defineProperty(t.prototype,"intersectorDisabled",{get:function(){var t=this.items;return!!(t&&t.results.length>=t.total)},enumerable:!1,configurable:!0}),t.prototype.personSelectHandle=function(t){this.selectedPerson=t,this.store.analyticsController.recordGaEvent({collection:"people",action:"select_person"})},t.prototype.backToPeopleHandle=function(){var t=this;Object(l.c)(200).then((function(){t.selectedPerson=null}))},t.prototype.addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.eventAggregator.subscribe(p.a.USER_AUTH_CHANGE,(function(){e.user.authenticated?t.updatePollStart():t.updatePollStop()}))),n.push(Object(u.a)(this.intersectorEl,"nncScrollIntersect",(function(){var e=t.items,n=t.searchTerm;if(e&&e.results.length>=e.total)return Promise.resolve();var o=m({},b);return e?o.page=t.query.page+1:t.query=m({},b),n&&(o.term=n),t.getItems({query:o}).then((function(e){return e&&(t.query.page=o.page),Object(l.c)(20)})).then((function(){if(t.intersectorEl)return t.intersectorEl.complete()}))}))),n.push(Object(u.a)(this.searchInput,"nncChange",(function(e){var n=e.detail.value||null;t.searchTerm!=n&&(t.searchTerm=n,(n&&n.length>=2||!n)&&t.getItems({query:m(m({},b),{term:n}),noMerge:!0}))})))},t.prototype.getItems=function(t){var e=this,n=this.store;return n.peopleDisabled?(this.logger.debug("people disabled, skipping fetch"),Promise.resolve(!1)):this.loading?(this.logger.debug("loading, skip getItems"),Promise.resolve(!1)):(this.loading=!0,n.apiService.getThreadPeople({groupId:n.groupId,threadId:n.threadId},m({},t.query)).then((function(o){return t.noMerge||!e.items?e.items=o:e.merge(o),e.people=e.items.results,e.updateSignal(),n.presenceController.handleEvents(o.events||[]),!0})).catch((function(o){return t.noAlertOnErr?e.logger.debug("trouble updating people"):n.errorHandler.alert(d.b.PEOPLE.THREAD_GET,o,e.logger),!1})).finally((function(){e.loading=!1})))},t.prototype.updatePeople=function(){var t=this.store,e=this.searchTerm;if(t.peopleDisabled)return this.logger.debug("people disabled, skipping fetch"),Promise.resolve();var n=m({},b);return e&&(n.term=e),this.getItems({query:n,noAlertOnErr:!0}).then((function(){}))},t.prototype.merge=function(t){var e=this.items.results,n=new Map;e.forEach((function(t,e){n.set(t.id,e)})),t.results.forEach((function(t){var o=n.get(t.id);n.has(t.id)?Object.assign(e[o],t):e.push(t)}))},t.prototype.updatePollStart=function(){this.store.peopleDisabled||this.updatePoll.start()},t.prototype.updatePollStop=function(){this.updatePoll.stop()},t.prototype.updateSignal=function(){this.signaler.signal("annoto-people-update")},f([Object(o.p)("items","items.results","items.results.length","items.total"),g("design:type",Boolean),g("design:paramtypes",[])],t.prototype,"intersectorDisabled",null),t=f([Object(o.s)("nn-people"),Object(o.t)(h.BindingSignaler,r.a.of(i.AnnotoWidget,!0)),g("design:paramtypes",[h.BindingSignaler,i.AnnotoWidget])],t)}()},"organs/people/nn-people.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-people.scss"></require>\n    <require from="./nn-person"></require>\n    <require from="./nn-selected-person"></require>\n\n    <div class="annoto-people">\n\n        <nnc-content show.bind="!selectedPerson" overscroll="contain">\n            <nnc-item class="nn-people-search">\n                <nnc-input placeholder="${\'generic.search\' | t | capitalize & oneTime}" debounce="350" ref="searchInput">\n                    <nnc-icon slot="end" name="search" size="sm" color="medium"></nnc-icon>\n                </nnc-input>\n            </nnc-item>\n            <ol class="nn-people-list">\n                <li repeat.for="item of people | arraySort:sortConfig & oneTime & signal:\'annoto-people-update\'">\n                    <nn-person model.bind="item" click.trigger="personSelectHandle(item)"></nn-person>\n                </li>\n            </ol>\n            <nnc-content-scroll-intersector\n                threshold.one-time="30"\n                disabled.bind="intersectorDisabled"\n                ref="intersectorEl">\n            </nnc-content-scroll-intersector>\n        </nnc-content>\n\n        <nn-selected-person if.bind="!!selectedPerson" model.bind="selectedPerson" on-back-click.call="backToPeopleHandle()">\n        </nn-selected-person>\n\n    </div>\n</template>\n'},"organs/people/nn-person":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoPerson",(function(){return p}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=n(32),s=n(29),c=n(174),l=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},p=function(){function t(t){this.widget=t,this.disposables=[],this.loading=!0,this.store=t.store}return t.prototype.bind=function(){},t.prototype.unbind=function(){Object(s.d)(this.disposables),this.disposables=[],this.loading=!0},Object.defineProperty(t.prototype,"isActive",{get:function(){var t=this.model;return!!t&&Object(c.a)(new Date,new Date(t.updated_at))<a.a.presence.activeThresholdSec},enumerable:!1,configurable:!0}),l([o.m,u("design:type",Object)],t.prototype,"model",void 0),l([Object(o.p)("model","model.updated_at"),u("design:type",Boolean),u("design:paramtypes",[])],t.prototype,"isActive",null),t=l([Object(o.s)("nn-person"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),u("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/people/nn-person.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-person.scss"></require>\n\n    <nnc-item class="annoto-person" lines="full" clickable>\n        <nnc-avatar slot="start" photo-src.one-time="model.author.photo_url" full-name.one-time="model.name">\n            <nnc-dot position="bottom-right" color.bind="isActive ? \'success\' : \'medium\' & signal:\'annoto-people-update\'"></nnc-dot>\n        </nnc-avatar>\n        <nnc-label>${model.name}</nnc-label>\n        <nnc-label><p>${model.headline}</p></nnc-label>\n        <nnc-icon slot="end" size="xs" name="navigate-next" color="medium"></nnc-icon>\n    </nnc-item>\n</template>\n'},"organs/people/nn-selected-person":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoPerson",(function(){return p}));var o=n("aurelia-framework"),i=n(36),r=n(32),a=n(29),s=n(174),c=n(34),l=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},p=function(){function t(t){this.store=t,this.onBackClick=function(){},this.disposables=[],this.sendingInvite=!1,this.logger=o.h.getLogger("Annoto-person")}return t.prototype.bind=function(){var t=this;this.store.apiService.getUserById(this.model.user_id).then((function(e){return t.data=e,t.details=e.details,t.setupLiveSession()})).catch((function(e){t.details=null,t.logger.warn("get user details: ",e)}))},t.prototype.setupLiveSession=function(){var t=this,e=this.store;return e.user.sso&&"function"==typeof e.ux.getOneOnOneSessionInvite?Promise.resolve().then((function(){return e.ux.getOneOnOneSessionInvite({authorId:e.user.ssoId,invitedUserId:t.data.sso_id})})).then((function(e){e&&e.inviteUrl&&(t.liveSessionInvite=e)})).catch((function(e){t.logger.warn("setupLiveSession: ",e)})):Promise.resolve()},t.prototype.unbind=function(){Object(a.d)(this.disposables),this.disposables=[],this.data=null,this.details=null,this.liveSessionInviteResult=null,this.liveSessionInvite=null,this.sendingInvite=!1},Object.defineProperty(t.prototype,"isActive",{get:function(){var t=this.model;return!!t&&Object(s.a)(new Date,new Date(t.updated_at))<r.a.presence.activeThresholdSec},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"liveSessionInviteText",{get:function(){var t=this.sendingInvite,e=this.liveSessionInviteResult,n=this.store;return t?n.i18n.tr("people.private_session_invite.inviting_btn"):e&&e.inviteButton?e.inviteButton:n.i18n.tr("people.private_session_invite.invite_btn")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showLiveSessionInvite",{get:function(){return this.liveSessionInvite&&this.store.user.id!==this.model.user_id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inviteUrlText",{get:function(){return this.liveSessionInvite?this.liveSessionInvite.inviteUrlText:""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDark",{get:function(){return this.store.widget.isDark},enumerable:!1,configurable:!0}),t.prototype.backToPeopleHandle=function(){this.onBackClick()},t.prototype.liveSessionInviteHandle=function(){var t=this,e=this.store,n=this.liveSessionInvite;this.sendingInvite=!0,Object(a.n)(e.apiService.postLiveSessionInvite({threadId:e.threadId,invitedUserId:this.model.user_id},{inviteUrl:n.inviteUrl,title:n.title,message:n.message,inviteButton:n.inviteButton}).then((function(e){t.liveSessionInviteResult=e})).catch((function(n){e.errorHandler.alert(c.b.PEOPLE.ONE_ON_ONE_INVITE,n,t.logger)})),500).finally((function(){t.sendingInvite=!1,t.store.analyticsController.recordGaEvent({collection:"people",action:"private_invite"})}))},l([o.m,u("design:type",Object)],t.prototype,"model",void 0),l([o.m,u("design:type",Object)],t.prototype,"onBackClick",void 0),l([Object(o.p)("model","model.updated_at"),u("design:type",Boolean),u("design:paramtypes",[])],t.prototype,"isActive",null),l([Object(o.p)("liveSessionInvite","sendingInvite"),u("design:type",String),u("design:paramtypes",[])],t.prototype,"liveSessionInviteText",null),l([Object(o.p)("liveSessionInvite","store.user.id","model.user_id"),u("design:type",Boolean),u("design:paramtypes",[])],t.prototype,"showLiveSessionInvite",null),l([Object(o.p)("liveSessionInvite"),u("design:type",String),u("design:paramtypes",[])],t.prototype,"inviteUrlText",null),l([Object(o.p)("store.widget.isDark"),u("design:type",Boolean),u("design:paramtypes",[])],t.prototype,"isDark",null),t=l([Object(o.s)("nn-selected-person"),Object(o.t)(i.a),u("design:paramtypes",[i.a])],t)}()},"organs/people/nn-selected-person.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-selected-person.scss"></require>\n    <require from="./nn-live-session-invite"></require>\n\n    <div class="annoto-selected-person">\n        <nnc-content overscroll="contain">\n            <div class="nn-selected-person-info">\n                <nnc-button fill="raised" color="tertiary" size="sm" ripple class="nn-back-to-people-btn" click.trigger="backToPeopleHandle()">\n                    <nnc-icon slot="icon" name="navigate-before"></nnc-icon>\n                </nnc-button>\n                <nnc-avatar slot="start" photo-src.one-time="model.author.photo_url" full-name.one-time="model.name" size="56">\n                    <nnc-dot position="bottom-right" color.bind="isActive ? \'success\' : \'medium\' & signal:\'annoto-people-update\'" size="lg"></nnc-dot>\n                </nnc-avatar>\n                <nnc-label truncate.one-time="false"><h3>${model.name}</h3></nnc-label>\n                <nnc-label truncate.one-time="false"><p>${model.headline}</p></nnc-label>\n                <div class="nnc-person-social-icons" if.bind="!!details">\n                    <a if.bind="!!details.twitter" href="${details.twitter}" target="_blank" rel=\'noreferrer\'><nnc-icon name="social-twitter" color="medium"></nnc-icon></a>\n                    <a if.bind="!!details.linkedin" href="${details.linkedin}" target="_blank" rel=\'noreferrer\'><nnc-icon name="social-linkedin" color="medium"></nnc-icon></a>\n                    <a if.bind="!!details.website" href="${details.website}" target="_blank" rel=\'noreferrer\'><nnc-icon name="globe" color="medium"></nnc-icon></a>\n                </div>\n                <nnc-button class="nn-selected-person-invite-btn" if.bind="showLiveSessionInvite"\n                    fill.bind="isDark ? \'raised\' : \'outline\'"\n                    color="tertiary"\n                    rounded ripple\n                    disabled.bind="sendingInvite"\n                    click.trigger="liveSessionInviteHandle()">${liveSessionInviteText}</nnc-button>\n            </div>\n            <div class="nnc-selected-person-main">\n                <nn-live-session-invite if.bind="!sendingInvite && liveSessionInviteResult"\n                        invite.bind="liveSessionInviteResult"\n                        invited-user.bind="model.author"\n                        link-text.bind="inviteUrlText"></nn-live-session-invite>\n            </div>\n        </nnc-content>\n    </div>\n</template>\n'},"organs/side-tabs/css/nn-side-tab.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,'.annoto nn-side-tab .annoto-side-tab{width:100%;height:calc(100% - 4px);cursor:pointer;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;z-index:1;opacity:.8;font-size:16px;-webkit-box-sizing:border-box;box-sizing:border-box;position:absolute;top:0;right:0;-webkit-transition:width .2s ease-in;transition:width .2s ease-in;border-radius:0 3px 3px 0}.annoto nn-side-tab .annoto-side-tab::after{content:"";width:calc(100% - 1.5px - 1px);height:4px;background:inherit;position:absolute;top:100%;left:0;-webkit-clip-path:polygon(0 0, 0% 100%, 100% 0);clip-path:polygon(0 0, 0% 100%, 100% 0)}.annoto nn-side-tab .annoto-side-tab nnc-icon{margin:2px;-ms-flex-negative:0;flex-shrink:0}.annoto nn-side-tab .annoto-side-tab .annoto-side-tab-text{color:inherit;text-align:center;width:0;overflow:hidden;visibility:hidden;opacity:0}.annoto nn-side-tab .annoto-side-tab.nn-disabled{cursor:default;z-index:0;opacity:.4;background:var(--nnc-color-step-400, #646464)}.annoto nn-side-tab .annoto-side-tab.nn-active{z-index:100;opacity:1;-webkit-filter:drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.7));filter:drop-shadow(1px 2px 2px rgba(0, 0, 0, 0.7))}.annoto nn-side-tab .annoto-side-tab:hover:not(.nn-disabled),.annoto nn-side-tab.nn-focused .annoto-side-tab:not(.nn-disabled){opacity:1;width:140px;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;border-radius:3px 3px 0 3px}.annoto nn-side-tab .annoto-side-tab:hover:not(.nn-disabled) .annoto-side-tab-text,.annoto nn-side-tab.nn-focused .annoto-side-tab:not(.nn-disabled) .annoto-side-tab-text{width:auto;padding:0 8px;visibility:visible;-webkit-transition:opacity .1s ease-in .2s;transition:opacity .1s ease-in .2s;opacity:1}.annoto nn-side-tab .annoto-side-tab:hover:not(.nn-disabled)::after,.annoto nn-side-tab.nn-focused .annoto-side-tab:not(.nn-disabled)::after{border-bottom-right-radius:3px;left:auto;right:0;-webkit-clip-path:polygon(100% 0, 0 0, 100% 100%);clip-path:polygon(100% 0, 0 0, 100% 100%)}.annoto nn-side-tab .annoto-side-tab:hover:not(.nn-disabled) nnc-icon,.annoto nn-side-tab.nn-focused .annoto-side-tab:not(.nn-disabled) nnc-icon{font-size:20px}',""]),e.default=i},"organs/side-tabs/css/nn-side-tabs.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-side-tabs{width:100%;height:100%;position:relative;-webkit-box-sizing:border-box;box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;padding:3px 3px 0 0}.annoto .annoto-side-tabs nn-side-tab{width:100%;display:block;position:relative;-webkit-box-sizing:border-box;box-sizing:border-box;height:56px}",""]),e.default=i},"organs/side-tabs/nn-side-tab":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoSideTabOrgan",(function(){return s}));var o=n("aurelia-framework"),i=n(29),r=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},s=function(){function t(){this.id=Object(i.i)(),this.color="white",this.disabled=!1,this.active=!1,this.zIndex=1}return Object.defineProperty(t.prototype,"style",{get:function(){var t=this,e=t.disabled,n=t.active,o=t.zIndex,i=t.fill,r=t.color;return{background:e?void 0:i,"z-index":n?100:o,color:r,"--nnc-color":r}},enumerable:!1,configurable:!0}),r([o.m,a("design:type",String)],t.prototype,"text",void 0),r([o.m,a("design:type",String)],t.prototype,"icon",void 0),r([o.m,a("design:type",String)],t.prototype,"color",void 0),r([o.m,a("design:type",String)],t.prototype,"fill",void 0),r([o.m,a("design:type",Object)],t.prototype,"disabled",void 0),r([o.m,a("design:type",Boolean)],t.prototype,"active",void 0),r([o.m,a("design:type",Number)],t.prototype,"zIndex",void 0),r([Object(o.p)("fill","disabled","active","zIndex","color"),a("design:type",Object),a("design:paramtypes",[])],t.prototype,"style",null),t=r([Object(o.s)("nn-side-tab")],t)}()},"organs/side-tabs/nn-side-tab.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-side-tab.scss"></require>\n\n    <div class="annoto-side-tab nnc-activatable ${disabled ? \'nn-disabled\' : \'\'} ${active ? \'nn-active\' : \'\'}" style.bind="style">\n        <div class="annoto-side-tab-text" dir="auto">${text & oneTime}</div>\n        <nnc-icon name.one-time="icon" size="sm" aria-label-hidden.one-time="true"></nnc-icon>\n        <nnc-ripple></nnc-ripple>\n    </div>\n\n</template>\n'},"organs/side-tabs/nn-side-tabs":function(t,e,n){"use strict";n.r(e),n.d(e,"SideTabsOrgan",(function(){return p}));var o=n("aurelia-framework"),i=n(29),r=n(35),a=n("organs/widget/nn-widget"),s=n(54),c=n(43),l=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},p=function(){function t(t){this.tabs=[],this.activeTab=0,this.onActiveTabChange=function(){},this.aaaLabel="Vertical side tabs",this.tabsIndex=0,this.store=t.store}return t.prototype.bind=function(){this.tabsIndex=0,this.updateTabs()},Object.defineProperty(t.prototype,"tabsStyle",{get:function(){var t=this.tabs[this.activeTab];return t?{"border-left":"3px solid "+t.fill}:{}},enumerable:!1,configurable:!0}),t.prototype.focusHandle=function(){if(this.tabsEl){var t=s.a.getFocusableElsIn(this.tabsEl);s.a.setFocusOnEl(t[this.activeTab])&&(this.tabsIndex=-1)}},t.prototype.blurHandle=function(){this.tabsIndex=0},t.prototype.keydownHandle=function(t){var e=this;if(this.tabsEl){var n=Object(c.e)(t,"down"),o=Object(c.e)(t,"up");if(n||o){var i=s.a.getFocusableElsIn(this.tabsEl);if(0===i.length)return;var r=void 0;return n?i[r=this.activeTab+1]||(r=0):o&&(i[r=this.activeTab-1]||(r=i.length-1)),s.a.setFocusOnEl(i[r])&&(this.tabsIndex=-1),void this.tabClick(r)}return Object(c.e)(t,"tab")&&setTimeout((function(){e.tabsIndex=0}),0),!0}},t.prototype.tabsChanged=function(){this.updateTabs()},t.prototype.activeTabChanged=function(t,e){var n=this;t!==e&&Object(i.c)().then((function(){return n.tabChangeHandle()}))},t.prototype.tabClick=function(t){this.store.interactiveController.recordUserAction(),t!==this.activeTab&&(this.activeTab=t)},t.prototype.tabChangeHandle=function(){var t=this.activeTab,e=this.tabs[t];e&&!e.disabled&&(this.deactivateTabs(),e.active=!0,this.onActiveTabChange({index:t,tab:e}))},t.prototype.updateTabs=function(){if(0!==this.tabs.length)for(var t=0;t<this.tabs.length;t++){var e=this.tabs[t],n=this.tabs.length-t;e.active=t===this.activeTab,e.zIndex=n}},t.prototype.deactivateTabs=function(){for(var t=0;t<this.tabs.length;t++)this.tabs[t].active=!1},l([o.m,u("design:type",Array)],t.prototype,"tabs",void 0),l([o.m,u("design:type",Number)],t.prototype,"activeTab",void 0),l([o.m,u("design:type",Function)],t.prototype,"onActiveTabChange",void 0),l([o.m,u("design:type",String)],t.prototype,"aaaLabel",void 0),l([Object(o.p)("activeTab"),u("design:type",Object),u("design:paramtypes",[])],t.prototype,"tabsStyle",null),t=l([Object(o.t)(r.a.of(a.AnnotoWidget,!0)),Object(o.s)("nn-side-tabs"),u("design:paramtypes",[a.AnnotoWidget])],t)}()},"organs/side-tabs/nn-side-tabs.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-side-tabs.scss"></require>\n    <require from="./nn-side-tab"></require>\n\n    <div class="annoto-side-tabs" style.bind="tabsStyle"\n        role="tablist"\n        aria-orientation="vertical"\n        aria-label.bind="aaaLabel"\n        tabindex.bind="tabsIndex"\n        focus.trigger="focusHandle()"\n        keydown.delegate="keydownHandle($event)"\n        ref="tabsEl">\n        <template repeat.for="tab of tabs">\n            <nn-side-tab role="tab"\n                         aria-selected.bind="tab.active"\n                         aria-controls.bind="tab.aaaControls"\n                         text.bind="tab.text"\n                         fill.bind="tab.fill"\n                         icon.bind="tab.icon"\n                         color.bind="tab.color"\n                         disabled.bind="tab.disabled"\n                         active.bind="tab.active"\n                         focused.bind="tab.focused"\n                         nn-interaction="click.call: tabClick($index); space.call: tabClick($index); enter.call: tabClick($index); disabled.bind: tab.disabled;"\n                         nn-focusable="label.bind: tab.text & t; index: -1; disabled.bind: tab.disabled;"\n                         blur.trigger="blurHandle()"\n                         ></nn-side-tab>\n        </template>\n    </div>\n\n</template>\n'},"organs/thread/css/nn-comments.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-thread-content .annoto-content-container .annoto-comments-container{overflow:visible;width:100%;margin:0;padding:0}.annoto .annoto-thread-content .annoto-content-container .annoto-comments-container>ol{overflow:visible;height:auto;width:100%;margin:0;padding:0;list-style-type:none}.annoto .annoto-thread-content .annoto-content-container .annoto-comments-container>ol>li{margin:0;padding:0;cursor:default}.annoto .annoto-thread-content .annoto-content-container .annoto-spacer{height:20px;-webkit-box-sizing:border-box;box-sizing:border-box;pointer-events:none}.annoto.nnc-mobile .annoto-thread-content .annoto-content-container .annoto-spacer{display:none}",""]),e.default=i},"organs/thread/css/nn-content.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-thread-content-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;height:100%;position:relative}.annoto .annoto-thread-content{height:100%;-webkit-box-sizing:border-box;box-sizing:border-box;-ms-flex-line-pack:stretch;align-content:stretch;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.annoto .annoto-thread-content .annoto-user-hint{cursor:default}.annoto .annoto-thread-content .annoto-content-container{-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;padding:0 2px 0 0;overflow-y:hidden;height:100%;width:100%}.annoto .annoto-thread-content .annoto-content-container .annoto-content-scrollable{height:100%;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0;overflow-y:auto;overflow-x:hidden}.annoto .annoto-thread-content .annoto-content-container .annoto-loading-spinner{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%)}.annoto .annoto-thread-content .annoto-content-container .annoto-scroll-button{position:absolute;bottom:4px;width:32px;height:32px;margin:0 auto;--nnc-padding-top: 0;--nnc-padding-bottom: 0;--nnc-padding-start: 0;--nnc-padding-end: 0;left:0;right:0;z-index:10}.annoto .annoto-thread-content .annoto-content-container .annoto-scroll-button.nn-up{top:4px;bottom:initial}.annoto .annoto-thread-content .annoto-content-container .nn-media-embed{width:100%;height:160px}.annoto .annoto-thread-content .annoto-thread-form-container{-webkit-box-sizing:border-box;box-sizing:border-box;z-index:12}.annoto-overlay.side-by-side-layout .annoto-thread-content{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap}.annoto-overlay.side-by-side-layout .annoto-thread-content .annoto-content-container{width:60%}",""]),e.default=i},"organs/thread/css/nn-notes.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-thread-content .annoto-content-container .annoto-notes-container{overflow:visible;width:100%;margin:0;padding:0}.annoto .annoto-thread-content .annoto-content-container .annoto-notes-container>ol{overflow:visible;height:auto;width:100%;margin:0;padding:0;list-style-type:none}.annoto .annoto-thread-content .annoto-content-container .annoto-notes-container>ol>li{margin:0;padding:0;cursor:default}.annoto .annoto-thread-content .annoto-content-container .annoto-spacer{height:20px;-webkit-box-sizing:border-box;box-sizing:border-box;pointer-events:none}.annoto.nnc-mobile .annoto-thread-content .annoto-content-container .annoto-spacer{display:none}",""]),e.default=i},"organs/thread/css/nn-thread.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-thread{width:100%;height:100%;padding:0;-webkit-box-sizing:border-box;box-sizing:border-box;-ms-flex-line-pack:stretch;align-content:stretch;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.annoto .annoto-thread .annoto-thread-content-organ{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%;overflow-y:hidden;height:100%}",""]),e.default=i},"organs/thread/css/nn-user-hints.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-thread .annoto-thread-cta-message{margin:16px auto;width:100%;padding:0;max-width:220px;overflow:hidden;-webkit-box-sizing:border-box;box-sizing:border-box;text-align:center;white-space:pre-wrap}",""]),e.default=i},"organs/thread/nn-comments":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoThreadComments",(function(){return _}));var o=n("aurelia-framework"),i=n("aurelia-templating-resources"),r=n("organs/widget/nn-widget"),a=n(35),s=n(69),c=n(31),l=n(29),u=n(165),p=n(60),d=n(91),h=n(75),m=n(32),f=n(68),g=n(44),b=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},v=200,w=1e3,O=5e3,_=function(){function t(t,e){var n=this;this.thisVm=this,this.comments=[],this.loading=!0,this.someFormOpen=!1,this.formOpen=!1,this.formFeatures={cancelBtn:!1,userName:!0},this.disposables=[],this.submitting=!1,this._autoscroll=!0,this.syncToTimeline=!1,this.syncToTimelineInProgress=!1,this.syncToTop=!1,this.scrollTop=0,this.signaler=t,this.widget=e,this.store=e.store,this.logger=o.h.getLogger("Annoto-comments"),this.updatePoll=new d.a((function(){var t=n.store.isLive?m.a.rt.livePoll:m.a.rt.poll;return Object(h.a)(t.min,t.max)}),(function(){return n.pollComments()}))}return Object.defineProperty(t.prototype,"autoscroll",{set:function(t){this._autoscroll=t},enumerable:!1,configurable:!0}),t.prototype.bind=function(t,e){this.autoscroll=!0,this._addDisposables()},t.prototype.unbind=function(){this.updatePollStop();for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this.comments=[],this.loading=!0,this.formOpen=!1,this.syncToTimeline=!1,this.syncToTimelineInProgress=!1,this.syncToComment=null,this.syncToTop=!1,this.scrollTop=0},t.prototype._addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.pubSub.subscribe(c.a.COMMENT_FORM_OPEN,(function(e){e===t.formVm&&(t.formOpen=!0),t.someFormOpen||(t.someFormOpen=!0,t.store.pubSub.publish(c.a.SOME_FORM_OPEN_CHANGE,!0))}))),n.push(e.pubSub.subscribe(c.a.COMMENT_FORM_CLOSE,(function(e){e===t.formVm&&(t.formOpen=!1),t.someFormOpen&&(t.someFormOpen=!1,t.store.pubSub.publish(c.a.SOME_FORM_OPEN_CHANGE,!1))}))),n.push(e.pubSub.subscribe(c.a.WIDGET_OPEN,(function(){return Object(l.c)(0).then((function(){t.store.isPrivateMode||!t._autoscroll||t.store.interactiveMode||t.store.interactiveController.autoscrollOff||t.scrollToStart(!1).then((function(){t.store.threadController.clearMetadataDiffCounters()}))}))}))),n.push(e.player.on(g.b.FULL_SCREEN_CHANGE,(function(){return Object(l.c)(100).then((function(){if(!(t.store.isPrivateMode||t.store.interactiveMode||t.store.interactiveController.autoscrollOff))return t.scrollToStart(!1)}))}))),n.push(e.commentsController.on(s.b.SORT_CONFIG_START,(function(){t.loading=!0,t.updatePollStop()}))),n.push(e.commentsController.on(s.b.SORT_CONFIG_CHANGE,(function(){return t.setComments(),t.updateSignal(),t.updatePollStart(),t.loading=!1,Object(l.c)().then((function(){if(!t.store.interactiveController.autoscrollOff)return t.scrollToStart(!1)}))}))),n.push(e.commentsController.on(s.b.COMMENT_POSTED,(function(e){e&&e.depth>0||(t.updateSignal(),t.rootCountCache=t.store.metaData.comments.rootCount)}))),n.push(e.commentsController.on(s.b.COMMENT_DELETED,(function(e){e&&e.depth>0||(t.updateSignal(),t.rootCountCache=t.store.metaData.comments.rootCount)}))),n.push(e.commentsController.on(s.b.CLEAR,(function(){t.setComments(),t.updateSignal()}))),n.push(e.commentsController.on(s.b.INITIALIZED,(function(){t.updateComments({clear:!0}).then((function(){return t.updatePollStart()}))}))),n.push(e.pubSub.subscribe(c.a.FOCUS_ON_COMPONENT_REQUEST,(function(e){if(!t.store.isPrivateMode)if("root_form"===e.target){if(t.formVm)return t.formVm.openForm()}else if("comment"===e.target){if("ux"===e.source)return t.syncToComment=e.item,t.focusOnCommentHandle(t.syncToComment).catch().then((function(){return Object(l.c)(100)})).then((function(){t.syncToTimeline=!0}));if("timeline_sync"===e.source){if(t.syncToComment=e.item,!t.syncToTimeline)return;return t.syncToTimelineInProgress=!0,t.focusOnCommentHandle(t.syncToComment).catch().then((function(){return Object(l.c)(100)})).then((function(){t.syncToTimelineInProgress=!1}))}}else if("reply_form"===e.target)return t.focusOnCommentHandle(e.item,!0)})))},t.prototype.setComments=function(){this.comments=this.store.commentsController.comments||[]},t.prototype.clearComments=function(){this.comments=[]},Object.defineProperty(t.prototype,"postDisabled",{get:function(){return!this.store.threadInitialized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phoneHideOnFormOpen",{get:function(){return!(!this.store.isPhone||!this.someFormOpen||this.formOpen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phoneFormOpen",{get:function(){return!!(this.store.isPhone&&this.someFormOpen&&this.formOpen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"somePhoneFormOpen",{get:function(){return!(!this.store.isPhone||!this.someFormOpen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formDisabled",{get:function(){return Boolean(!this.store.commentsController||!this.store.commentsController.initialized)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortConfig",{get:function(){return this.store.commentsController.sortConfig},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReversed",{get:function(){return Boolean(this.sortConfig.flipOrder&&!this.store.demoMode)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollAtStart",{get:function(){return!this.scrollableElement||Boolean(!this.scrollableElement||this.store.commentsTopToBottom?0===this.scrollableElement.scrollTop:this.scrollableElement.offsetHeight+this.scrollableElement.scrollTop+10>=this.scrollableElement.scrollHeight)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSortByTimetag",{get:function(){return Boolean(this.store.commentsController.sortOption&&this.store.commentsController.sortOption.type===f.d.BY_TIMELINE)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollSyncToTimelie",{get:function(){return this.isSortByTimetag&&!this.store.isLive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showScrollButton",{get:function(){return!this.store.dapDemoIsActive&&Boolean(this.scrollSyncToTimelie?!this.syncToTimeline&&this.store.commentsController.rtComments.length>0:!this._autoscroll&&!this.scrollAtStart)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollButtonUp",{get:function(){return Boolean(this.scrollSyncToTimelie?this.syncToTop:this.store.commentsTopToBottom)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showThreadCTA",{get:function(){return Boolean(this.store.commentsController&&this.store.commentsController.comments&&0===this.store.commentsController.comments.length)},enumerable:!1,configurable:!0}),t.prototype.submitHandle=function(t){var e,n=this;if(!this.submitting)return this.submitting=!0,this.updatePollStop(),this.store.commentsController.postComment(t).then((function(t){return e=t,Object(l.c)(0)})).then((function(){if(e instanceof p.a)return Object(l.c)(0).then((function(){return e.element?Object(u.c)(n.scrollableElement,n.calcTargetYForComment(e.element),O).then((function(){n.scrollSyncToTimelie&&(n.syncToComment=e,n.syncToTimeline=!0)})):n.scrollToStart(!0,O)})).catch((function(){}))})).then((function(){if(n.submitting=!1,n.updatePollStart(),!e)return!1;e.vm&&e.vm.setFocus()}))},t.prototype.replyFormHideHandle=function(t){this.store.isPhone&&t&&t.data&&t.data.element&&(this.scrollableElement.scrollTop=t.data.element.offsetTop,this.scrollHandle())},t.prototype.replyOpenHandle=function(t){var e=Promise.resolve();!this.store.isPhone&&t&&t.data&&t.data.element&&t.formElement&&(e=Object(u.c)(this.scrollableElement,t.data.element.offsetTop+t.formElement.offsetTop-160,w)),e.then((function(){t.formVm.openForm()}))},t.prototype.replyClick=function(t){var e=this.store;e.user.authenticated?e.analyticsController.recordUgcInteraction("reply_tap",{element:"thread",comment:t.data.info},{label:t.data.type,value:t.data.length}):e.analyticsController.recordConversionInteraction("auth_trigger",{cause:"reply",element:"thread",comment:t.data.info},{label:"reply",value:t.data.length})},t.prototype.scrollClickHandle=function(){this.scrollToStart(!0,O)},t.prototype.scrollDirectionChange=function(t){var e=this.store.commentsTopToBottom?t.scrollAtTop:t.scrollAtBottom,n=this.store.commentsTopToBottom?"down":"up";e||t.scrollDirection!==n?e&&(this.autoscroll=!0,this.updatePollStart(),this.widget.isOpen&&!this.store.interactiveMode&&this.store.threadController.clearMetadataDiffCounters()):this.autoscroll=!1},t.prototype.scrollHandle=function(){!this.syncToTimelineInProgress&&this.syncToTimeline&&(this.syncToTimeline=!1,this.syncToTop=this.syncToComment&&this.syncToComment.element&&this.scrollableElement.scrollTop>this.calcTargetYForComment(this.syncToComment.element)),this.scrollTop=this.scrollableElement.scrollTop},t.prototype.pollComments=function(){var t=this,e=this.store;if(!e.threadController||!e.threadController.initialized)return this.logger.debug("Thread not initialized, skipping load metadata"),Promise.resolve();var n=e.metaData.thread.rating;return e.threadController.loadMetaData().then((function(){if(e.metaData.thread.rating!==n||e.metaData.comments.rootCount!==t.rootCountCache)return Promise.all([t.updateComments({noAlertOnError:!0}),e.pbMetricsController.loadMetrics()])})).catch((function(e){t.logger.warn("pollComments: ",e)}))},t.prototype.updateComments=function(t){var e=this;void 0===t&&(t={}),t.clear&&(this.clearComments(),this.loading=!0);var n=this.store;return n.commentsController.getComments({noAlertOnError:t.noAlertOnError}).then((function(){return e.logger.debug("updated comments"),t.clear&&e.setComments(),e.updateSignal(),e.loading=!1,e.rootCountCache=n.metaData.comments.rootCount,Object(l.c)(0)})).then((function(){if(t.clear||e._autoscroll&&!e.submitting&&!n.interactiveController.autoscrollOff)return e.scrollToStart(!t.clear,v)}))},t.prototype.updatePollStart=function(){var t=this.store;(t.isLive||t.commentsController.sortOption&&t.commentsController.sortOption.type===f.d.MOST_RECENT)&&this.updatePoll.start()},t.prototype.updatePollStop=function(){this.updatePoll.stop()},t.prototype.updateSignal=function(){this.signaler.signal("annoto-comments-update")},t.prototype.scrollToStart=function(t,e){var n=this;if(this.scrollableElement)return this.scrollSyncToTimelie?this.store.interactiveController.focusOnPP().then((function(t){t||(n.syncToTimeline=!0)})):t?this.store.commentsTopToBottom?Object(u.b)(this.scrollableElement,e):Object(u.a)(this.scrollableElement,e):(this.store.commentsTopToBottom?this.scrollableElement.scrollTop=0:this.scrollableElement.scrollTop=this.scrollableElement.scrollHeight,this.scrollHandle(),Promise.resolve())},t.prototype.focusOnCommentHandle=function(t,e){if(void 0===e&&(e=!1),!t)return Promise.resolve();for(var n,o,i=this.comments.length;i--;){var r=this.comments[i];if(r.id===t.id){n=r.element,o=r.vm;break}}return n?e&&o?(this.scrollableElement.scrollTop=n.offsetTop,o.replyFormShow()):Object(u.c)(this.scrollableElement,this.calcTargetYForComment(n),O):Promise.resolve()},t.prototype.calcTargetYForComment=function(t){var e=t.offsetTop;return this.store.commentsTopToBottom||(e+=t.offsetHeight-this.scrollableElement.offsetHeight),Math.max(0,e)},b([Object(o.p)("store.threadInitialized"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"postDisabled",null),b([Object(o.p)("store.isPhone","formOpen","someFormOpen"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"phoneHideOnFormOpen",null),b([Object(o.p)("store.isPhone","formOpen","someFormOpen"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"phoneFormOpen",null),b([Object(o.p)("store.isPhone","someFormOpen"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"somePhoneFormOpen",null),b([Object(o.p)("store.commentsController","store.commentsController.initialized"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"formDisabled",null),b([Object(o.p)("store.commentsController","store.commentsController.sortConfig"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"sortConfig",null),b([Object(o.p)("sortConfig","store.demoMode"),y("design:type",Boolean),y("design:paramtypes",[])],t.prototype,"isReversed",null),b([Object(o.p)("scrollableElement","store.commentsTopToBottom","scrollTop"),y("design:type",Boolean),y("design:paramtypes",[])],t.prototype,"scrollAtStart",null),b([Object(o.p)("store.commentsController","store.commentsController.sortOption"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"isSortByTimetag",null),b([Object(o.p)("isSortByTimetag","store.isLive"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"scrollSyncToTimelie",null),b([Object(o.p)("scrollSyncToTimelie","_autoscroll","scrollAtStart","syncToTimeline","store.commentsController","store.commentsController.rtComments","store.commentsController.rtComments.length","store.dapDemoIsActive"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"showScrollButton",null),b([Object(o.p)("scrollSyncToTimelie","store.commentsTopToBottom","syncToTop"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"scrollButtonUp",null),b([Object(o.p)("store.commentsController","store.commentsController.comments","store.commentsController.comments.length"),y("design:type",Object),y("design:paramtypes",[])],t.prototype,"showThreadCTA",null),t=b([Object(o.s)("nn-comments"),Object(o.t)(i.BindingSignaler,a.a.of(r.AnnotoWidget,!0)),y("design:paramtypes",[i.BindingSignaler,r.AnnotoWidget])],t)}()},"organs/thread/nn-comments.html":function(t,e,n){t.exports='<template>\n\n    <require from="./css/nn-comments.scss"></require>\n    <require from="./nn-content"></require>\n    <require from="../comment-form/nn-comment-form"></require>\n    <require from="../comment/nn-comment"></require>\n    <require from="./nn-user-hints"></require>\n\n    <nn-content class="annoto-thread-content-container"\n                show-form.bind="!phoneHideOnFormOpen && store.commentsSubmitEnabled"\n                show-content.bind="!phoneFormOpen"\n                view-model.ref="contentVm"\n                loading.bind="loading"\n                show-scroll-button.bind="showScrollButton & throttle:350"\n                scroll-button-sync.bind="scrollSyncToTimelie"\n                scroll-button-up.bind="scrollButtonUp & throttle:300"\n                on-scroll-click.call="scrollClickHandle()"\n                on-scroll-dir-change.call="scrollDirectionChange(event)"\n                on-scroll.call="scrollHandle()"\n                scrollable-element.bind="scrollableElement">\n\n        <div slot="content" class="annoto-comments-container" show.bind="!loading">\n            <nn-user-hints if.bind="store.commentsTopToBottom" show.bind="!somePhoneFormOpen" show-cta.bind="showThreadCTA"></nn-user-hints>\n\n            <ol>\n                <li repeat.for="comment of comments | arraySort:sortConfig | arrayReverse:isReversed & oneTime & signal:\'annoto-comments-update\'">\n                    <nn-comment data.one-time="comment"\n                                ref="comment.element"\n                                view-model.ref="comment.vm"\n                                last.one-time="$last"\n                                on-reply.call=replyClick(vm)\n                                on-form-hide.call="replyFormHideHandle(vm)"\n                                on-form-open.call="replyOpenHandle(vm)"></nn-comment>\n                </li>\n                <div class="annoto-spacer" aria-hidden="true" tabindex="-1"></div>\n            </ol>\n\n            <nn-user-hints if.bind="!store.commentsTopToBottom" show.bind="!somePhoneFormOpen" show-cta.bind="showThreadCTA"></nn-user-hints>\n        </div>\n\n        <nn-comment-form slot="form"\n                         emotion-position.bind="contentVm.formEmotionPosition"\n                         view-model.ref="formVm"\n                         disabled.bind="formDisabled"\n                         features.one-time="formFeatures"\n                         on-submit.call="submitHandle(data)">\n        </nn-comment-form>\n\n    </nn-content>\n</template>\n'},"organs/thread/nn-content":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoThreadContent",(function(){return c}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.showForm=!0,this.showContent=!0,this.showScrollButton=!1,this.scrollButtonUp=!1,this.scrollButtonSync=!1,this.onScroll=function(){},this.onScrollDirChange=function(){},this.widget=t,this.store=t.store}return Object.defineProperty(t.prototype,"sideBySideLayout",{get:function(){return this.widget.sideBySideLayout},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formEmotionPosition",{get:function(){return this.sideBySideLayout||this.store.isPhone?"bottom-right":"top-right"},enumerable:!1,configurable:!0}),t.prototype.scrollClick=function(){"function"==typeof this.onScrollClick&&this.onScrollClick();var t=this.store,e=this.scrollButtonSync?"sync_tap":"scroll_tap";t.analyticsController.recordUgcInteraction(e,{element:"thread"},{label:"thread"})},t.prototype.scrollDirectionChange=function(t){this.onScrollDirChange({event:t})},t.prototype.scrollHandle=function(t){this.onScroll({event:t})},a([o.m,s("design:type",Object)],t.prototype,"showForm",void 0),a([o.m,s("design:type",Object)],t.prototype,"showContent",void 0),a([o.m,s("design:type",Boolean)],t.prototype,"loading",void 0),a([o.m,s("design:type",Boolean)],t.prototype,"showScrollButton",void 0),a([o.m,s("design:type",Boolean)],t.prototype,"scrollButtonUp",void 0),a([o.m,s("design:type",Boolean)],t.prototype,"scrollButtonSync",void 0),a([o.m,s("design:type",Function)],t.prototype,"onScrollClick",void 0),a([Object(o.m)({defaultBindingMode:o.n.fromView}),s("design:type",HTMLElement)],t.prototype,"scrollableElement",void 0),a([o.m,s("design:type",Function)],t.prototype,"onScroll",void 0),a([o.m,s("design:type",Function)],t.prototype,"onScrollDirChange",void 0),a([Object(o.p)("widget.sideBySideLayout"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"sideBySideLayout",null),a([Object(o.p)("sideBySideLayout","store.isPhone"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"formEmotionPosition",null),t=a([Object(o.s)("nn-content"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),s("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/thread/nn-content.html":function(t,e,n){t.exports='<template>\n\n    <require from="./css/nn-content.scss"></require>\n\n    <div class="annoto-thread-content">\n\n        <div show.bind="showContent" class="annoto-content-container">\n            <div class="annoto-content-scrollable nn-scrollbar"\n                ref="scrollableElement"\n                scroll.trigger="scrollDirectionChange($event) & scrollDirection:scrollHandle & throttle:120">\n                \n                <slot name="content"></slot>\n                \n            </div>\n\n            <div class="annoto-loading-spinner" if.bind="loading">\n                <amdl-spinner></amdl-spinner>\n            </div>\n\n            <nnc-button show.bind="showScrollButton"\n                id="annoto-thread-content-scroll-button-${store.id & oneTime}"\n                class="annoto-scroll-button ${scrollButtonUp ? \'nn-up\' : \'\'}"\n                fill="raised"\n                color="medium"\n                click.trigger="scrollClick()"\n                aria-hidden="true">\n                <nnc-icon name.bind="scrollButtonSync ? \'pin-drop\' : scrollButtonUp ? \'expand-less\' : \'expand-more\'" slot="icon" />\n            </nnc-button>\n            <nnc-tooltip if.bind="scrollButtonSync" for="annoto-thread-content-scroll-button-${store.id & oneTime}">${\'tut.sync_scroll\' & t & oneTime}</nnc-tooltip>\n        </div>\n\n        <div show.bind="showForm" class="annoto-thread-form-container nn-color-background-secondary">\n            <slot name="form"></slot>\n        </div>\n\n    </div>\n</template>'},"organs/thread/nn-notes":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoThreadNotes",(function(){return b}));var o=n("aurelia-framework"),i=n("aurelia-templating-resources"),r=n("organs/widget/nn-widget"),a=n(35),s=n(61),c=n(31),l=n(29),u=n(165),p=n(85),d=n(68),h=n(44),m=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},f=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=5e3,b=function(){function t(t,e){this.thisVm=this,this.notes=[],this.loading=!0,this.submitting=!1,this.someFormOpen=!1,this.formOpen=!1,this.formFeatures={cancelBtn:!1,userName:!0},this.disposables=[],this.syncToTimeline=!1,this.syncToTimelineInProgress=!1,this.syncToTop=!1,this.scrollTop=0,this.signaler=t,this.store=e.store,this.logger=o.h.getLogger("Annoto-notes")}return t.prototype.bind=function(t,e){this._addDisposables()},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this.notes=[],this.loading=!0,this.formOpen=!1,this.syncToTimeline=!1,this.syncToTimelineInProgress=!1,this.syncToNote=null,this.syncToTop=!1,this.scrollTop=0},t.prototype._addDisposables=function(){var t=this,e=this.store,n=this.disposables;n.push(e.pubSub.subscribe(c.a.COMMENT_FORM_OPEN,(function(e){e===t.formVm&&(t.formOpen=!0),t.someFormOpen||(t.someFormOpen=!0,t.store.pubSub.publish(c.a.SOME_FORM_OPEN_CHANGE,!0))}))),n.push(e.pubSub.subscribe(c.a.COMMENT_FORM_CLOSE,(function(e){e===t.formVm&&(t.formOpen=!1),t.someFormOpen&&(t.someFormOpen=!1,t.store.pubSub.publish(c.a.SOME_FORM_OPEN_CHANGE,!1))}))),n.push(e.pubSub.subscribe(c.a.WIDGET_OPEN,(function(){return Object(l.c)(0).then((function(){!t.store.isPrivateMode||t.store.interactiveMode||t.store.interactiveController.autoscrollOff||t.scrollToStart(!1)}))}))),n.push(e.player.on(h.b.FULL_SCREEN_CHANGE,(function(){return Object(l.c)(100).then((function(){!t.store.isPrivateMode||t.store.interactiveMode||t.store.interactiveController.autoscrollOff||t.scrollToStart(!1)}))}))),n.push(e.notesController.on(s.b.NOTE_POSTED,(function(){t.updateSignal()}))),n.push(e.notesController.on(s.b.NOTE_DELETED,(function(){t.updateSignal()}))),n.push(e.notesController.on(s.b.SORT_CONFIG_START,(function(){t.loading=!0}))),n.push(e.notesController.on(s.b.SORT_CONFIG_CHANGE,(function(){t.resetNotes(),t.loading=!1}))),n.push(e.notesController.on(s.b.INITIALIZED,(function(){return t.updateNotes()}))),n.push(e.notesController.on(s.b.CLEAR,(function(){t.notes=[],t.updateSignal()}))),n.push(e.notesController.on(s.b.AUTH_HANDLED,(function(){t.resetNotes()}))),n.push(e.pubSub.subscribe(c.a.FOCUS_ON_COMPONENT_REQUEST,(function(e){if(t.store.isPrivateMode)if("root_form"===e.target){if(t.formVm)return t.formVm.openForm()}else if("note"===e.target){if("ux"===e.source)return t.syncToNote=e.item,t.focusOnNoteHandle(t.syncToNote).catch().then((function(){return Object(l.c)(100)})).then((function(){t.syncToTimeline=!0}));if("timeline_sync"===e.source){if(t.syncToNote=e.item,!t.syncToTimeline)return;return t.syncToTimelineInProgress=!0,t.focusOnNoteHandle(t.syncToNote).catch().then((function(){return Object(l.c)(100)})).then((function(){t.syncToTimelineInProgress=!1}))}}})))},Object.defineProperty(t.prototype,"postDisabled",{get:function(){return!this.store.threadInitialized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phoneFormOpen",{get:function(){return!(!this.store.isPhone||!this.formOpen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formDisabled",{get:function(){return Boolean(!this.store.notesController||!this.store.notesController.initialized)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortConfig",{get:function(){return this.store.notesController.sortConfig},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollAtStart",{get:function(){return Boolean(this.scrollTop<10)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSortByTimetag",{get:function(){return Boolean(this.store.notesController.sortOption&&this.store.notesController.sortOption.type===d.d.BY_TIMELINE)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollSyncToTimelie",{get:function(){return this.isSortByTimetag&&!this.store.isLive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showScrollButton",{get:function(){return Boolean(this.scrollSyncToTimelie?!this.syncToTimeline&&this.store.notesController.rtNotes.length>0:!this.scrollAtStart)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollButtonUp",{get:function(){return Boolean(!this.scrollSyncToTimelie||this.syncToTop)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showThreadCTA",{get:function(){return Boolean(this.store.notesController&&this.store.notesController.notes&&0===this.store.notesController.notes.length)},enumerable:!1,configurable:!0}),t.prototype.submitHandle=function(t){var e,n=this;if(!this.submitting)return this.submitting=!0,this.store.notesController.postNote(t).then((function(t){return e=t,Object(l.c)(0)})).then((function(){if(e instanceof p.a)return Object(l.c)(0).then((function(){return e.element?Object(u.c)(n.scrollableElement,e.element.offsetTop).then((function(){n.scrollSyncToTimelie&&(n.syncToNote=e,n.syncToTimeline=!0)})):n.scrollToStart(!0,g)})).catch((function(){}))})).then((function(){if(n.submitting=!1,!e)return!1;e.vm&&e.vm.setFocus()}))},t.prototype.resetNotes=function(){var t=this;return this.notes=this.store.notesController.notes||[],this.updateSignal(),Object(l.c)(0).then((function(){if(!t.store.interactiveController.autoscrollOff)return t.scrollToStart(!1)}))},t.prototype.updateNotes=function(){var t=this;return this.loading=!0,this.store.notesController.getNotes().then((function(){return t.logger.debug("updated notes"),t.notes=t.store.notesController.notes||[],t.updateSignal(),t.loading=!1,Object(l.c)(0)})).then((function(){t.store.interactiveController.autoscrollOff||t.scrollToStart(!1)}))},t.prototype.updateSignal=function(){this.signaler.signal("annoto-notes-update")},t.prototype.scrollClickHandle=function(){this.scrollToStart(!0,g)},t.prototype.scrollHandle=function(){!this.syncToTimelineInProgress&&this.syncToTimeline&&(this.syncToTimeline=!1,this.syncToTop=this.syncToNote&&this.syncToNote.element&&this.scrollableElement.scrollTop>this.syncToNote.element.offsetTop),this.scrollTop=this.scrollableElement.scrollTop},t.prototype.focusOnNoteHandle=function(t){if(!t)return Promise.resolve();for(var e,n=this.notes.length;n--;){var o=this.notes[n];if(o.id===t.id){e=o.element;break}}return e?Object(u.c)(this.scrollableElement,e.offsetTop,g):Promise.resolve()},t.prototype.scrollToStart=function(t,e){var n=this;if(this.scrollableElement)return this.scrollSyncToTimelie?this.store.interactiveController.focusOnPP().then((function(t){t||(n.syncToTimeline=!0)})):t?Object(u.b)(this.scrollableElement,e):(this.scrollableElement.scrollTop=0,this.scrollHandle(),Promise.resolve())},m([Object(o.p)("store.threadInitialized"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"postDisabled",null),m([Object(o.p)("store.isPhone","formOpen"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"phoneFormOpen",null),m([Object(o.p)("store.notesController","store.notesController.initialized"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"formDisabled",null),m([Object(o.p)("store.notesController","store.notesController.sortConfig"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"sortConfig",null),m([Object(o.p)("scrollTop"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"scrollAtStart",null),m([Object(o.p)("store.notesController","store.notesController.sortOption"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"isSortByTimetag",null),m([Object(o.p)("isSortByTimetag","store.isLive"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"scrollSyncToTimelie",null),m([Object(o.p)("scrollSyncToTimelie","scrollAtStart","syncToTimeline","store.notesController","store.notesController.rtNotes","store.notesController.rtNotes.length"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showScrollButton",null),m([Object(o.p)("scrollSyncToTimelie","syncToTop"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"scrollButtonUp",null),m([Object(o.p)("store.notesController","store.notesController.notes","store.notesController.notes.length"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showThreadCTA",null),t=m([Object(o.s)("nn-notes"),Object(o.t)(i.BindingSignaler,a.a.of(r.AnnotoWidget,!0)),f("design:paramtypes",[i.BindingSignaler,r.AnnotoWidget])],t)}()},"organs/thread/nn-notes.html":function(t,e,n){t.exports='<template>\n\n    <require from="./css/nn-notes.scss"></require>\n    <require from="./nn-content"></require>\n    <require from="../comment-form/nn-comment-form"></require>\n    <require from="../note/nn-note"></require>\n    <require from="./nn-user-hints"></require>\n\n    <nn-content class="annoto-thread-content-container"\n                show-form.bind="store.privateNotesSubmitEnabled"\n                show-content.bind="!phoneFormOpen"\n                view-model.ref="contentVm"\n                loading.bind="loading"\n                show-scroll-button.bind="showScrollButton & throttle:350"\n                scroll-button-sync.bind="scrollSyncToTimelie"\n                scroll-button-up.bind="scrollButtonUp & throttle:300"\n                on-scroll-click.call="scrollClickHandle()"\n                on-scroll.call="scrollHandle()"\n                scrollable-element.bind="scrollableElement">\n\n        <div slot="content" class="annoto-notes-container" show.bind="!loading">\n            <nn-user-hints show-cta.bind="showThreadCTA"></nn-user-hints>\n\n            <ol>\n                <li repeat.for="note of notes | arraySort:sortConfig & oneTime & signal:\'annoto-notes-update\'">\n                    <nn-note data.bind="note & oneTime"\n                            ref="note.element"\n                            view-model.ref="note.vm"></nn-note>\n                </li>\n                <div class="annoto-spacer" aria-hidden="true" tabindex="-1"></div>\n            </ol>\n        </div>        \n\n        <nn-comment-form slot="form"\n                         emotion-position.bind="contentVm.formEmotionPosition"\n                         view-model.ref="formVm"\n                         disabled.bind="formDisabled"\n                         features.one-time="formFeatures"\n                         on-submit.call="submitHandle(data)">\n        </nn-comment-form>\n\n    </nn-content>\n</template>\n'},"organs/thread/nn-thread":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoThread",(function(){return c}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.store=t.store}return t=a([Object(o.s)("nn-thread"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),s("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/thread/nn-thread.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-thread.scss"></require>\n    <require from="./nn-comments"></require>\n    <require from="./nn-notes"></require>\n\n    <div class="annoto-thread annoto-flex-column-nowrap">\n\n        <nn-comments if.bind="!store.isPrivateMode && store.commentsEnabled"\n                     class="annoto-thread-content-organ"\n                     id="nn-thread-comments-id-${store.id}"></nn-comments>\n\n        <nn-notes if.bind="store.isPrivateMode && store.privateNotesEnabled"\n                  class="annoto-thread-content-organ"\n                  id="nn-thread-notes-id-${store.id}"></nn-notes>\n\n    </div>\n</template>\n'},"organs/thread/nn-user-hints":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoThreadContent",(function(){return u}));var o=n("aurelia-framework"),i=n(36),r=n(170),a=n(29),s=n(31),c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e){this.store=t,this.userHintsService=e,this.showCta=!1,this.isActive=!1,this.disposables=[]}return t.prototype.bind=function(){var t=this;this.updateState(),this.disposables.push(this.store.eventAggregator.subscribe(s.a.USER_HINTS_UPDATE,(function(){t.updateState()}))),this.store.demoMode&&setTimeout((function(){return t.userHintsService.getHints()}))},t.prototype.unbind=function(){Object(a.d)(this.disposables),this.disposables=[]},Object.defineProperty(t.prototype,"userHints",{get:function(){return this.userHintsService.hints||[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"threadCTAMessage",{get:function(){return this.store.isPrivateMode?"thread.cta.notes":"thread.cta.comments"},enumerable:!1,configurable:!0}),t.prototype.userHintClear=function(){var t=this;Object(a.c)(250).then((function(){return t.userHintsService.clearHeadHint().then((function(e){return t.updateState(),e}))}))},t.prototype.updateState=function(){this.isActive=Boolean(this.userHints.length>0&&!this.store.dapIsActive)},c([o.m,l("design:type",Object)],t.prototype,"showCta",void 0),c([Object(o.m)({defaultBindingMode:o.n.fromView}),l("design:type",Boolean)],t.prototype,"isActive",void 0),c([Object(o.p)("userHintsService.hints"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"userHints",null),c([Object(o.p)("store.isPrivateMode"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"threadCTAMessage",null),t=c([Object(o.s)("nn-user-hints"),Object(o.t)(i.a,r.a),l("design:paramtypes",[i.a,r.a])],t)}()},"organs/thread/nn-user-hints.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-user-hints.scss"></require>\n    <require from="../user-hint/nn-user-hint"></require>\n    <template if.bind="isActive">\n        <nn-user-hint data.bind="userHints | arrayHead" on-done.call="userHintClear()"></nn-user-hint>\n    </template>\n    <p if.bind="!isActive && showCta" class="annoto-thread-cta-message nn-text-body nn-color-grey" dir="auto">${threadCTAMessage | t}</p>\n</template>'},"organs/user-hint/css/nn-content.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-user-hint .annoto-user-hint-content{width:100%}.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-topic,.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-body{text-align:initial}.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-topic h6,.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-topic p,.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-body h6,.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-body p{word-wrap:break-word;overflow-wrap:break-word;word-break:break-word;margin:0;padding:0;width:100%}.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-body p{font-size:var(--nnc-hint-typo-body-size, 15px);white-space:pre-wrap}.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-body p a{color:var(--nnc-color-secondary, #00a9a4);display:inline-block;padding:0;margin:0;line-height:normal;white-space:nowrap}.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-body .annoto-user-hint-video{position:relative;height:0;width:100%;margin:0;padding:0 0 56.25% 0}.annoto .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-body .annoto-user-hint-video>iframe{position:absolute;top:0;left:0;width:100%;height:100%;margin:0;padding:0}",""]),e.default=i},"organs/user-hint/css/nn-footer.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-user-hint .annoto-user-hint-footer{width:100%;padding:12px 0;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-user-hint .annoto-user-hint-footer .annoto-hint-footer-title,.annoto .annoto-user-hint .annoto-user-hint-footer .annoto-hint-footer-caption{margin:0;padding:0;text-align:initial}",""]),e.default=i},"organs/user-hint/css/nn-header.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-user-hint .annoto-user-hint-header{width:calc(100% - 32px);margin:0}.annoto .annoto-user-hint .annoto-user-hint-header .annoto-user-hint-date{-ms-flex-negative:100;flex-shrink:100;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin:0 4px;height:32px;line-height:32px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.annoto .annoto-user-hint .annoto-user-hint-header .annoto-user-hint-author-name{-ms-flex-negative:1;flex-shrink:1;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;height:32px;line-height:32px;text-align:initial}.annoto .annoto-user-hint .annoto-user-hint-dismiss{position:absolute;top:0;right:0}.annoto.nnc-rtl .annoto-user-hint .annoto-user-hint-header{margin-left:32px}.annoto.nnc-rtl .annoto-user-hint .annoto-user-hint-dismiss{right:auto;left:0}",""]),e.default=i},"organs/user-hint/css/nn-user-hint.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-user-hint{position:relative;width:calc(100% - 16px);padding:8px;margin:8px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:3px;font-size:16px}.annoto .annoto-user-hint .annoto-avatar{position:relative}.annoto .annoto-user-hint .annoto-avatar .annoto-user-hint-emotion{position:absolute;bottom:-8px;right:-8px;border-radius:50%;width:32px;height:32px}.annoto .annoto-user-hint .annoto-container{margin:0 0 0 6px;width:calc(100% - 36px - 6px);min-height:32px}.annoto.nnc-rtl .annoto-user-hint .annoto-avatar .annoto-user-hint-emotion{left:-8px;right:0}.annoto.nnc-rtl .annoto-user-hint .annoto-container{margin-left:0;margin-right:6px}.annoto.nnc-mobile.is-landscape.phone-form-open .annoto-user-hint .annoto-user-hint-content .annoto-user-hint-body p{max-height:32px;outline:none;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}",""]),e.default=i},"organs/user-hint/nn-content.html":function(t,e,n){t.exports='<template bindable="data">\n    <require from="./css/nn-content.scss"></require>\n\n    <div with.bind="data" class="annoto-user-hint-content">\n        <div if.one-time="showTopic" class="annoto-user-hint-topic" dir="auto">\n            <h6 class="nn-text nn-text-title nn-text-color" dir="auto">${data.topic & t & oneTime}</h6>\n        </div>\n        <div if.one-time="showBody" class="annoto-user-hint-body" dir="auto">\n            <p class="nn-text nn-text-body nn-text-color" dir="auto" innerhtml="${data.body | t | hyperlink | sanitizeHTML & oneTime}"></p>\n        </div>\n    </div>\n</template>'},"organs/user-hint/nn-footer.html":function(t,e,n){t.exports='<template bindable="data">\n    <require from="./css/nn-footer.scss"></require>\n\n    <div class="annoto-user-hint-footer annoto-flex-row-nowrap annoto-flex-align-center" with.bind="data" amdl-flex-row-rtl.one-time="store.rtl">\n\n        <div>\n            <p class="annoto-hint-footer-title nn-text nn-text-body nn-text-color" dir="auto">${\'user_hint.request_feedback\' & t & oneTime}</p>\n            <p class="annoto-hint-footer-caption nn-text nn-text-caption nn-text-color" dir="auto">${\'user_hint.dismiss_hint\' & t & oneTime}</p>\n        </div>\n\n        <div class="annoto-flex-spacer" aria-hidden="true"></div>\n\n        <nnc-button color="warning" ripple size="sm" label.one-time="\'user_hint.not_helpful\' & t" click.trigger="notHelpfulClick()">\n            <nnc-icon slot="icon" name="emoticon_sad_o" size="lg"></nnc-icon>\n        </nnc-button>\n        <nnc-button color="success" ripple size="sm" label.one-time="\'user_hint.helpful\' & t" click.trigger="helpfulClick()">\n            <nnc-icon slot="icon" name="emoticon_happy_o" size="lg"></nnc-icon>\n        </nnc-button>\n\n    </div>\n</template>'},"organs/user-hint/nn-header.html":function(t,e,n){t.exports='<template bindable="data">\n    <require from="./css/nn-header.scss"></require>\n\n    <div class="annoto-user-hint-header annoto-flex-row-nowrap annoto-flex-align-center" with.bind="data" amdl-flex-row-rtl.one-time="store.rtl">\n\n        <span class="annoto-user-hint-author-name nn-color-grey" amdl-text="menu" dir="auto">${data.author.name & t & oneTime}</span>\n\n        <span class="annoto-user-hint-date nn-text-caption nn-color-grey-light">\n            ${data.updatedAt | date & oneTime}\n        </span>\n\n        <div class="annoto-flex-spacer" aria-hidden="true"></div>\n\n        <nnc-button color="medium" ripple size="sm" class="annoto-user-hint-dismiss" click.trigger="closeClick()">\n            <nnc-icon slot="icon" name="close"></nnc-icon>\n        </nnc-button>\n\n    </div>\n</template>'},"organs/user-hint/nn-user-hint":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoUserHintOrgan",(function(){return l}));var o=n("aurelia-framework"),i=n(38),r=n("organs/widget/nn-widget"),a=n(87),s=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},l=function(){function t(t){this.thisVm=this,this.widget=t,this.store=t.store}return t.prototype.bind=function(t,e){this.data&&(this.photoElement.style.backgroundImage='url("'+this.data.author.photoUrl+'")')},t.prototype.unbind=function(){},t.prototype.attached=function(){this.data&&this.store.analyticsController.recordGaEvent({collection:"user_hints",action:"show",label:this.gaLabel})},Object.defineProperty(t.prototype,"gaLabel",{get:function(){var t=this.data;return t&&(t.data&&t.data.en?t.data.en.topic:t.topic)||""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasEmotion",{get:function(){return Boolean(this.data&&this.data.emotion)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showEmotion",{get:function(){var t=this.data;return Boolean(t&&t.emotion&&t.emotion.type!==i.c.UNKNOWN)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showTopic",{get:function(){var t=this.data;return Boolean(t&&t.topic&&""!==t.topic)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showBody",{get:function(){var t=this.data;return Boolean(t&&t.body&&""!==t.body)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableFeedback",{get:function(){return!!((this.data||{}).options||{}).surveyDisabled},enumerable:!1,configurable:!0}),t.prototype.doneHandle=function(t){"function"==typeof this.onDone&&this.onDone(),this.data&&this.store.analyticsController.recordGaEvent({collection:"user_hints",action:t,label:this.gaLabel})},t.prototype.closeClick=function(){this.doneHandle("close_tap")},t.prototype.helpfulClick=function(){this.doneHandle("helpful_tap")},t.prototype.notHelpfulClick=function(){this.doneHandle("not_helpful_tap")},s([o.m,c("design:type",a.a)],t.prototype,"data",void 0),s([o.m,c("design:type",Function)],t.prototype,"onDone",void 0),s([Object(o.p)("data.emotion"),c("design:type",Boolean),c("design:paramtypes",[])],t.prototype,"hasEmotion",null),s([Object(o.p)("data.emotion"),c("design:type",Boolean),c("design:paramtypes",[])],t.prototype,"showEmotion",null),s([Object(o.p)("data.topic"),c("design:type",Boolean),c("design:paramtypes",[])],t.prototype,"showTopic",null),s([Object(o.p)("data.body"),c("design:type",Boolean),c("design:paramtypes",[])],t.prototype,"showBody",null),s([Object(o.p)("data.options"),c("design:type",Boolean),c("design:paramtypes",[])],t.prototype,"disableFeedback",null),t=s([Object(o.s)("nn-user-hint"),Object(o.t)(o.k.of(r.AnnotoWidget)),c("design:paramtypes",[r.AnnotoWidget])],t)}()},"organs/user-hint/nn-user-hint.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-user-hint.scss"></require>\n    <require from="./nn-header.html"></require>\n    <require from="./nn-content.html"></require>\n    <require from="./nn-footer.html"></require>\n    <require from="../emotion/nn-emotion"></require>\n\n\n    <div class="annoto-user-hint annoto-shadow-3dp nn-color-background-secondary nn-border annoto-flex-row-wrap"\n         amdl-flex-row-rtl.one-time="store.rtl"\n         nn-focusable>\n\n        <div class="annoto-avatar">\n            <div class="annoto-photo" ref="photoElement"></div>\n            <nn-emotion if.one-time="showEmotion" class="annoto-user-hint-emotion" data.bind="data.emotion"></nn-emotion>\n        </div>\n\n        <div class="annoto-flex-spacer" aria-hidden="true"></div>\n\n        <div class="annoto-container">\n\n            <nn-header data.bind="thisVm"></nn-header>\n            <nn-content data.bind="thisVm"></nn-content>\n            <nn-footer if.bind="!disableFeedback" data.bind="thisVm"></nn-footer>\n\n        </div>\n\n    </div>\n\n</template>'},"organs/user-space/dialog/nn-user-space-dialog":function(t,e,n){"use strict";n.r(e),n.d(e,"UserSpaceDialog",(function(){return u}));var o=n("aurelia-framework"),i=n("dialog/index"),r=n(29),a=n(36),s=function(){return(s=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e){this.controller=t,this.store=e}return t.prototype.activate=function(t){this.data=s({defaultView:"feed"},t)},t.prototype.attached=function(){this.store.userSpaceOpen=!0},t.prototype.detached=function(){this.store.userSpaceOpen=!1},t.prototype.closeHandle=function(t){var e=this;return Object(r.c)(100).then((function(){return e.controller.ok()}))},t=c([Object(o.s)("nn-user-space-dialog"),Object(o.t)(i.DialogController,a.a),l("design:paramtypes",[i.DialogController,a.a])],t)}()},"organs/user-space/dialog/nn-user-space-dialog.html":function(t,e,n){t.exports='<template>\n    <require from="./nn-user-space-dialog.scss"></require>\n    <require from="../space/nn-user-space"></require>\n\n    <nn-dialog class="annoto-user-space-dialog annoto">\n        <nn-user-space on-close.call="closeHandle()"\n            default-view.bind="data.defaultView"\n            default-query.bind="data.defaultQuery"></nn-user-space>\n    </nn-dialog>\n</template>'},"organs/user-space/dialog/nn-user-space-dialog.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto-user-space-dialog{height:calc(100% - 16px);max-width:920px;max-height:920px}.annoto-user-space-dialog>.annoto-dialog{height:100%;padding:0}",""]),e.default=i},"organs/user-space/space/nn-user-space":function(t,e,n){"use strict";n.r(e),n.d(e,"UserSpace",(function(){return u}));var o=n("aurelia-framework"),i=n(36),r=n(34),a=n(43),s=function(){return(s=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e){this.el=t,this.store=e,this.onClose=function(){},this.feed={query:{start:(new Date).toISOString(),size:10,filter_followed:!0,filter_myhistory:!0}},this.profile={},this.disposables=[],this.el.classList.add("annoto-user-space"),this.logger=o.h.getLogger("Annoto-user-space")}return t.prototype.bind=function(){var t=this,e=this.feed;e.query=s(s({},e.query),this.defaultQuery),e.data||this.loadFeed(e.query),this.loadProfile(),this.disposables.push(Object(a.a)(this.spaceComp,"nncUserDetailsSave",(function(e){t.store.apiService.patchUserDetails(e.detail).then((function(e){var n=t.profile.data;if(t.profile={data:s(s({},n),{credentials:s(s({},n.credentials),{details:e})}),detailsSaveErr:null},t.store.presenceController)return t.store.presenceController.updatePresence().catch((function(t){}))})).catch((function(e){t.logger.warn("patch user details: ",e),t.profile={data:t.profile.data,detailsSaveErr:"We are having trouble saving the profile ("+(e.message||e.statusText)+"), please retry"}}))})))},t.prototype.unbind=function(){Object(a.b)(this.disposables),this.disposables=[]},Object.defineProperty(t.prototype,"isDark",{get:function(){return this.store.widget.isDark},enumerable:!1,configurable:!0}),t.prototype.closeSpace=function(){this.onClose()},t.prototype.loadProfile=function(){var t=this,e=this.store;e.apiService.getUserProfile({group_id:e.groupId}).then((function(e){t.profile={data:e}})).catch((function(n){e.errorHandler.alert(r.b.USER_SPACE.PROFILE_GET,n,t.logger,t.el)}))},t.prototype.loadFeedEvent=function(t){this.loadFeed(s({},t.detail.query),t.detail.resetData)},t.prototype.loadFeed=function(t,e){var n=this;void 0===e&&(e=!1);var o=this.store,i=e?null:this.feed.data;o.apiService.getUserFeed(t).then((function(e){var o=e.items;n.feed=i?{query:t,data:{items:{total:o.total,end:o.end,results:i.items.results.concat(o.results)},meta:{threads:s(s({},i.meta.threads),e.meta.threads),groups:s(s({},i.meta.groups),e.meta.groups)}}}:{query:t,data:e}})).catch((function(t){o.errorHandler.alert(r.b.USER_SPACE.FEED_GET,t,n.logger,n.el)}))},t.prototype.exportGroupNotes=function(){var t=this,e=this.store,n={title:e.i18n.tr("generic.export"),formats:["xlsx","docx"]};return e.dialog.open({model:n,viewModel:"organs/export-btn/nn-export-dialog",lock:!1,host:this.el,container:e.widget.auContainer}).whenClosed((function(n){if(!n.wasCancelled){var o=n.output.format;return e.analyticsController.recordUgcInteraction("export_group_notes",void 0,{label:o}),e.apiService.exportGroupNotes(e.groupId,o).catch((function(n){e.errorHandler.alert(r.b.NOTES.EXPORT_GROUP,n,t.logger,t.el)}))}}))},c([Object(o.m)({defaultBindingMode:o.n.oneTime}),l("design:type",String)],t.prototype,"defaultView",void 0),c([Object(o.m)({defaultBindingMode:o.n.oneTime}),l("design:type",Object)],t.prototype,"defaultQuery",void 0),c([o.m,l("design:type",Object)],t.prototype,"onClose",void 0),c([Object(o.p)("store.widget.isDark"),l("design:type",Boolean),l("design:paramtypes",[])],t.prototype,"isDark",null),t=c([Object(o.s)("nn-user-space"),Object(o.t)(o.d.Element,i.a),l("design:paramtypes",[HTMLElement,i.a])],t)}()},"organs/user-space/space/nn-user-space.html":function(t,e,n){t.exports='<template>\n    <require from="./nn-user-space.scss"></require>\n\n    <nnc-user-space\n        ref="spaceComp"\n        default-view.one-time="defaultView"\n        feed.bind="feed"\n        nncuserfeedquery.trigger="loadFeedEvent($event)"\n        profile.bind="profile"\n        nncexportgroupnotes.trigger="exportGroupNotes()"\n        nncbacktap.trigger="closeSpace()"></nnc-user-space>\n\n</template>'},"organs/user-space/space/nn-user-space.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-user-space{display:block;width:100%;height:100%;-webkit-box-sizing:border-box;box-sizing:border-box;padding:4px;position:relative;background:#fafafa}.annoto .annoto-user-space nnc-user-space{--nnc-bg: #fafafa}",""]),e.default=i},"organs/widget/css/nn-drawer.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,'.annoto .annoto-drawer{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;border-left:none;-webkit-box-shadow:none;box-shadow:none;width:200px}.annoto .annoto-drawer .annoto-drawer-footer{text-align:center;line-height:40px;padding:0}.annoto .annoto-drawer .annoto-drawer-footer .annoto-drawer-logo{margin:auto;display:inline-block}.annoto .annoto-drawer .annoto-drawer-content{text-align:left;padding:8px 0;height:auto;background:inherit;-webkit-box-shadow:none;box-shadow:none}.annoto .annoto-drawer .annoto-drawer-content .annoto-drawer-link-btn{padding:0 4px;margin:0;display:block}.annoto .annoto-drawer .annoto-drawer-content .annoto-link{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;padding:8px 16px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.annoto .annoto-drawer .annoto-drawer-content .annoto-link.disabled{background-color:initial;cursor:default;pointer-events:none}.annoto .annoto-drawer .nn-list{padding:0}.annoto .annoto-drawer .nn-list .nn-list-item-content{padding-right:8px}.annoto .annoto-drawer .nn-drawer-docs{padding:8px 16px;background:inherit;-webkit-box-shadow:none;box-shadow:none;font-family:var(--nnc-font-family, Roboto, Helvetica, Arial, sans-serif);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;text-decoration:inherit;text-transform:inherit;font-size:.875em;line-height:1.25em;font-weight:400;letter-spacing:.0178571429em}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .annoto-drawer .nn-drawer-docs{font-family:"Roboto","Helvetica","Arial",sans-serif}}.annoto.nnc-rtl .annoto-drawer .annoto-drawer-content{text-align:center}',""]),e.default=i},"organs/widget/css/nn-layout.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-layout{overflow:hidden}.annoto .annoto-layout .annoto-layout-content{height:100%;min-height:0;width:100%;overflow:visible;display:-webkit-box;display:-ms-flexbox;display:flex}.annoto .annoto-layout .annoto-layout-content>div{display:-webkit-box;display:-ms-flexbox;display:flex;height:100%;width:100%}.annoto .annoto-layout .annoto-layout-content>div .annoto-page{width:100%;height:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-layout .annoto-layout-content>div .annoto-page .annoto-page-grid{width:100%;height:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto .annoto-layout .amdl-layout__obfuscator{opacity:0}",""]),e.default=i},"organs/widget/css/nn-minibar.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-minibar{position:absolute;top:0;left:0;height:100%;width:100%}.annoto .annoto-minibar .annoto-minibar-layout{width:100%;height:100%}.annoto .annoto-minibar .annoto-minibar-layout .annoto-open{cursor:pointer;margin:0;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none}.annoto .annoto-minibar .annoto-minibar-layout .annoto-open>i{font-size:32px}.annoto:not(.nnc-mobile) .annoto-minibar .annoto-open>i{font-size:32px}",""]),e.default=i},"organs/widget/css/nn-widget-overlay.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto-overlay{width:0;height:0;position:absolute;left:0;top:0;-webkit-box-sizing:border-box;box-sizing:border-box;/*!\n * jQuery UI Draggable 1.12.1\n * http://jqueryui.com\n *\n * Copyright jQuery Foundation and other contributors\n * Released under the MIT license.\n * http://jquery.org/license\n *//*!\n * jQuery UI CSS Framework 1.12.1\n * http://jqueryui.com\n *\n * Copyright jQuery Foundation and other contributors\n * Released under the MIT license.\n * http://jquery.org/license\n *\n * http://api.jqueryui.com/category/theming/\n *//*!\n * jQuery UI Resizable 1.12.1\n * http://jqueryui.com\n *\n * Copyright jQuery Foundation and other contributors\n * Released under the MIT license.\n * http://jquery.org/license\n */}.annoto-overlay .annoto-body{width:0 !important;height:0 !important;top:0 !important;left:0 !important;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:2}.annoto-overlay .annoto-draggable{visibility:hidden;-webkit-transition:top .2s ease-in,left .1s ease-in;transition:top .2s ease-in,left .1s ease-in;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto-overlay .annoto-draggable .annoto-drag-hint{cursor:move}.annoto-overlay .annoto-resizable{z-index:10;overflow:visible;clear:both;top:0;left:0;visibility:visible;-webkit-box-sizing:border-box;box-sizing:border-box}.annoto-overlay.dragging .annoto-draggable,.annoto-overlay.resizing .annoto-draggable{-webkit-transition:none;transition:none}.annoto-overlay.not-draggable .annoto-draggable .annoto-drag-hint{cursor:default}.annoto-overlay:not(.nnc-mobile) .annoto-html{visibility:visible;-webkit-transition:opacity .3s ease-in .2s;transition:opacity .3s ease-in .2s;opacity:1}.annoto-overlay:not(.nnc-mobile) .annoto-html.nn-hidden{opacity:0;-webkit-transition:none;transition:none}.annoto-overlay .annoto-resizable.ui-resizable-resizing{opacity:.8}.annoto-overlay .ui-draggable-handle{-ms-touch-action:none;touch-action:none}.annoto-overlay .ui-state-disabled{cursor:default !important;pointer-events:none}.annoto-overlay .ui-resizable-handle{position:absolute;font-size:.1px;display:block;-ms-touch-action:none;touch-action:none}.annoto-overlay .ui-resizable-disabled .ui-resizable-handle,.annoto-overlay .ui-resizable-autohide .ui-resizable-handle{display:none}.annoto-overlay .ui-resizable-n{cursor:n-resize;height:7px;width:100%;top:-5px;left:0}.annoto-overlay .ui-resizable-s{cursor:s-resize;height:7px;width:100%;bottom:-5px;left:0}.annoto-overlay .ui-resizable-e{cursor:e-resize;width:7px;right:-5px;top:0;height:100%}.annoto-overlay .ui-resizable-w{cursor:w-resize;width:7px;left:-5px;top:0;height:100%}.annoto-overlay .ui-resizable-se{cursor:se-resize;width:12px;height:12px;right:1px;bottom:1px}.annoto-overlay .ui-resizable-sw{cursor:sw-resize;width:9px;height:9px;left:-5px;bottom:-5px}.annoto-overlay .ui-resizable-nw{cursor:nw-resize;width:9px;height:9px;left:-5px;top:-5px}.annoto-overlay .ui-resizable-ne{cursor:ne-resize;width:9px;height:9px;right:-5px;top:-5px}.annoto-overlay .ui-resizable-e,.annoto-overlay .ui-resizable-w{width:8px}.annoto-overlay .ui-resizable-s,.annoto-overlay .ui-resizable-n{height:8px}.annoto-overlay .ui-resizable-sw,.annoto-overlay .ui-resizable-se{height:16px;width:20px}.annoto-overlay .ui-resizable-handle{z-index:11}.annoto-widget-resizable-helper{border:none;-webkit-box-shadow:inset 0px 0px 0px 1px var(--nnc-color-step-500, #7d7d7d);box-shadow:inset 0px 0px 0px 1px var(--nnc-color-step-500, #7d7d7d);-webkit-box-sizing:border-box;box-sizing:border-box;z-index:2147483647 !important}",""]),e.default=i},"organs/widget/css/nn-widget.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto{-webkit-box-sizing:border-box;box-sizing:border-box}.annoto.annoto-widget-container{width:100%;height:100%;position:relative}.annoto.annoto-widget-container>div{width:100%;height:100%;background:var(--nn-widget-bg, rgba(250, 250, 250, 0.9))}.annoto img{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}",""]),e.default=i},"organs/widget/nn-drawer":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoDrawer",(function(){return m}));var o=n("aurelia-framework"),i=n(49),r=n(11),a=n(31),s=n(36),c=n(40),l=n("organs/widget/nn-layout"),u=n(34),p=n(163),d=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},h=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},m=function(){function t(t,e,n){var i=this;this.store=e,this.layout=n,this.disposables=[],this.followingThread=!0,this.followingGroup=!0,this.user=t,this.logger=o.h.getLogger("Annoto-menu"),this.links=[{text:"drawer.comments",get active(){return"home"===e.activePage&&"comments"===e.homeFrame},disabled:!1,get show(){return e.commentsEnabled},handler:function(){return i.loadHomeComments()},classes:"annoto-drawer-comments-link"},{text:"drawer.people",get active(){return"home"===e.activePage&&"people"===e.homeFrame},get disabled(){return e.peopleDisabled},get show(){return e.settings.peopleEnabled},handler:function(){return i.loadHomePeople()},classes:"annoto-drawer-people-link"},{text:"drawer.notes",get active(){return"home"===e.activePage&&e.isPrivateMode&&"notes"===e.homeFrame},disabled:!1,get show(){return e.privateNotesEnabled},handler:function(){return i.loadHomeNotes()},classes:"annoto-drawer-notes-link",button:{handler:function(t){return i.exportNotes(t)},get disabled(){return!t.authenticated||e.demoIsActive},get show(){return!e.demoMode&&e.ugcExportEnabled}}},{text:"drawer.my_space",get active(){return e.userSpaceOpen},get disabled(){return!t.authenticated||!e.userSpaceEnabled||e.userSpaceOpen},get show(){return e.userSpaceEnabled},handler:function(){i.hide(),Object(p.a)(e,{defaultView:"profile",defaultQuery:{filter_followed:!t.anonymousEnabled}})},classes:"annoto-drawer-user-space-link"},{text:"drawer.preferences",get active(){return"preferences"===e.activePage},get disabled(){return e.userPreferencesDisabled},get show(){return e.hasUserPreferences},handler:function(){return i.loadPreferences()},classes:"annoto-drawer-preferences-link"},{get text(){return t.authenticated?"drawer.logout":"drawer.login"},get active(){return!t.authenticated&&("auth"===e.activePage||"signup_welcome"===e.activePage)},disabled:!1,get show(){return t.authenticated?!t.logoutActionDisabled:!t.authActionsDisabled},handler:function(){return i.auth()},classes:"annoto-drawer-auth-link"}]}return t.prototype.bind=function(){var t=this;this.disposables.push(this.store.threadController.on(c.a.PREFERENCES_CHANGE,(function(e){t.threadPreferencesUpdateHandle(e)}))),this.threadPreferencesUpdateHandle(this.store.threadController.preferences)},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[]},Object.defineProperty(t.prototype,"followThreadNotAllowed",{get:function(){return!(this.user.authenticated&&this.followingPref&&this.store.userSettings.preferences.notifications&&this.store.userSettings.preferences.notifications.comment_post_th)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"followThreadDisabled",{get:function(){return this.followThreadNotAllowed||this.followGroupChecked},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"followGroupDisabled",{get:function(){return!(this.user.authenticated&&this.followingPref&&this.store.userSettings.preferences.notifications&&this.store.userSettings.preferences.notifications.comment_post_group)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"followThreadChecked",{get:function(){return Boolean(this.followingThread&&!this.followThreadNotAllowed||this.followGroupChecked)},set:function(t){this.setFollowingThread(!!t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"followGroupChecked",{get:function(){return this.followingGroup&&!this.followGroupDisabled},set:function(t){this.setFollowingGroup(!!t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasFollowGroup",{get:function(){return Boolean(this.user.isModerator&&this.store.groupId)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOpen",{get:function(){return Boolean(this.layout&&this.layout.drawerOpen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docsLink",{get:function(){return this.store.user.isModerator?r.b.MODERATOR_DOCS:r.b.USER_DOCS},enumerable:!1,configurable:!0}),t.prototype.threadFollowClick=function(){this.setFollowingThread(!this.followingThread)},t.prototype.groupFollowClick=function(){this.setFollowingGroup(!this.followingGroup)},t.prototype.threadPreferencesUpdateHandle=function(t){if(!t||!t.following)return this.followingPref=void 0,void this.setFollowingThread(!1);this.followingPref=t.following,this.setFollowingThread(t.following.followingThread),this.setFollowingGroup(t.following.followingGroup)},t.prototype.setFollowingThread=function(t){t!==this.followingThread&&(this.followingThread=t)},t.prototype.setFollowingGroup=function(t){t!==this.followingGroup&&(this.followingGroup=t)},t.prototype.followingThreadChanged=function(t,e){var n=this;if(this.followingPref&&t!==e&&t!==this.followingPref.followingThread){var o=Boolean(t);this.store.authService.postFollowingThread(this.store.threadController.id,o).then((function(){return n.store.threadController.loadPreferences()})).catch((function(t){n.logger.warn("followingThreadChanged: ",t)})),this.store.analyticsController.recordUgcInteraction("thread_follow",{thread_follow:o},{label:"thread_follow",value:o?1:0}),o&&this.store.pubSub.publish(a.a.FOLLOW_THREAD)}},t.prototype.followingGroupChanged=function(t,e){var n=this;if(this.followingPref&&this.hasFollowGroup&&t!==e&&t!==this.followingPref.followingGroup){var o=Boolean(t);this.store.authService.postFollowingGroup(this.store.groupId,o).then((function(){return n.store.threadController.loadPreferences()})).catch((function(t){n.logger.warn("followingGroupChanged: ",t)})),this.store.analyticsController.recordUgcInteraction("group_follow",{group_follow:o},{label:"group_follow",value:o?1:0}),o&&this.store.pubSub.publish(a.a.FOLLOW_GROUP)}},t.prototype.auth=function(){var t=this,e=this.user.authenticated?"logout":"signin";this.store.analyticsController.recordMenuInteraction("select",{select:e},{label:e}),this.user.authenticated?this.user.logout().then((function(){t.showPageHandle({page:"home"})})):this.showPageHandle({page:"auth",frame:"welcome"}),this.hide()},t.prototype.loadHomeComments=function(){this.store.analyticsController.recordMenuInteraction("select",{select:"comments"},{label:"comments"}),this.showPageHandle({page:"home",frame:"comments"}),this.hide()},t.prototype.loadHomePeople=function(){this.store.analyticsController.recordMenuInteraction("select",{select:"people"},{label:"people"}),this.showPageHandle({page:"home",frame:"people"}),this.hide()},t.prototype.loadHomeNotes=function(){this.store.analyticsController.recordMenuInteraction("select",{select:"notes"},{label:"notes"}),this.showPageHandle({page:"home",frame:"notes"}),this.hide()},t.prototype.loadPreferences=function(){this.store.analyticsController.recordMenuInteraction("select",{select:"preferences"},{label:"preferences"}),this.showPageHandle({page:"preferences"}),this.hide()},t.prototype.hide=function(){this.store.pubSub.publish(a.a.TRIGGER_DRAWER_HIDE)},t.prototype.showPageHandle=function(t){this.store.pubSub.publish(a.a.PAGES_SHOW,t)},t.prototype.exportNotes=function(t){var e=this,n=this.store;return n.analyticsController.recordUgcInteraction("export_notes",void 0,{label:t}),n.apiService.exportThreadNotes(n.threadId,t,n.groupId).catch((function(t){n.errorHandler.alert(u.b.NOTES.EXPORT,t,e.logger)}))},d([Object(o.v)(),h("design:type",Object)],t.prototype,"followingThread",void 0),d([Object(o.v)(),h("design:type",Object)],t.prototype,"followingGroup",void 0),d([Object(o.p)("user.authenticated","followingPref","store.userSettings.preferences","store.userSettings.preferences.notifications"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"followThreadNotAllowed",null),d([Object(o.p)("followThreadNotAllowed","followGroupChecked"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"followThreadDisabled",null),d([Object(o.p)("user.authenticated","followingPref","store.userSettings.preferences","store.userSettings.preferences.notifications"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"followGroupDisabled",null),d([Object(o.p)("followingThread","followGroupChecked","followThreadNotAllowed"),h("design:type",Boolean),h("design:paramtypes",[Boolean])],t.prototype,"followThreadChecked",null),d([Object(o.p)("followingGroup","followGroupDisabled"),h("design:type",Boolean),h("design:paramtypes",[Boolean])],t.prototype,"followGroupChecked",null),d([Object(o.p)("user.isModerator","store.groupId"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"hasFollowGroup",null),d([Object(o.p)("layout","layout.drawerOpen"),h("design:type",Boolean),h("design:paramtypes",[])],t.prototype,"isOpen",null),d([Object(o.p)("store.user.isModerator"),h("design:type",String),h("design:paramtypes",[])],t.prototype,"docsLink",null),t=d([Object(o.s)("nn-drawer"),Object(o.t)(i.a,s.a,l.AnnotoWidgetLayout),h("design:paramtypes",[i.a,s.a,l.AnnotoWidgetLayout])],t)}()},"organs/widget/nn-drawer.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-drawer.scss"></require>\n    <require from="../export-btn/nn-export-btn"></require>\n\n    <nav amdl-nav class="annoto-drawer-content">\n        <template repeat.for="link of links">\n            <div class="annoto-flex-row-nowrap annoto-flex-align-center">\n                <a amdl-nav-link if.bind="link.show"\n                    href="#"\n                    contextmenu.trigger="false"\n                    class="annoto-link nn-color-bg-hover ${link.active ? \'nn-active\' : \'\'} ${link.disabled ? \'disabled\' : \'\'} ${link.classes}"\n                    nn-focusable="disabled.bind: link.disabled; index.bind: isOpen ? 0 : -1"\n                    nn-interaction="disabled.bind: link.disabled; click.call: link.handler(); space.call: link.handler(); enter.call: link.handler();">${link.text & t}\n                </a>\n\n                <nn-export-btn if.bind="link.show && link.button && link.button.show"\n                    class="annoto-drawer-link-btn"\n                    index.bind="isOpen ? 0 : -1"\n                    disabled.bind="link.button.disabled"\n                    subject.one-time="link.text"\n                    on-select.call="link.button.handler(format)">\n                </nn-export-btn>\n            </div>\n        </template>\n    </nav>\n\n    <div if.bind="store.hasFollowControls" class="nn-border-top">\n        <amdl-list>\n            <amdl-list-item classes="annoto-follow-thread" on-content-click.call="threadFollowClick()" disabled.bind="followThreadDisabled">\n                <span slot="subtitle" aria-hidden="true">${followThreadChecked ? \'thread.following\' : \'thread.not_following\' & t}</span>\n                <amdl-icon-toggle slot="end"\n                    disabled.bind="followThreadDisabled"\n                    icon-class="annoto-icon ${followThreadChecked ? \'annoto-icon-notifications_active nn-icon-notifications_active\' :\n                                                                \'annoto-icon-notifications_none nn-icon-notifications_none\'}"\n                    checked.bind="followThreadChecked"\n                    color-class="accent"\n                    ripple.one-time="true"\n                    index.bind="isOpen ? 0 : -1"\n                    label.bind="followThreadChecked ? \'thread.following\' : \'thread.not_following\' & t"></amdl-icon-toggle>\n            </amdl-list-item>\n            <amdl-list-item classes="annoto-follow-group" if.bind="hasFollowGroup" on-content-click.call="groupFollowClick()" disabled.bind="followGroupDisabled">\n                <span slot="subtitle" aria-hidden="true">${followGroupChecked ? \'group.following\' : \'group.not_following\' & t}</span>\n                <amdl-icon-toggle slot="end"\n                    disabled.bind="followGroupDisabled"\n                    icon-class="annoto-icon ${followGroupChecked ? \'annoto-icon-notifications_active nn-icon-notifications_active\' :\n                                                                \'annoto-icon-notifications_none nn-icon-notifications_none\'}"\n                    checked.bind="followGroupChecked"\n                    color-class="accent"\n                    ripple.one-time="true"\n                    index.bind="isOpen ? 0 : -1"\n                    label.bind="followGroupChecked ? \'group.following\' : \'group.not_following\' & t"></amdl-icon-toggle>\n            </amdl-list-item>\n        </amdl-list>\n    </div>\n\n    <div class="nn-border-top nn-drawer-docs">\n        <nnc-hyperlink text.one-time="\'drawer.docs\' & t" justify.one-time="store.rtl ? \'center\' : \'start\'" href.bind="docsLink">\n            <nnc-icon slot="start" name="open_book" color="secondary"></nnc-icon>\n        </nnc-hyperlink>\n    </div>\n\n</template>\n'},"organs/widget/nn-layout":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoWidgetLayout",(function(){return h}));var o=n("aurelia-framework"),i=n(32),r=n("organs/widget/nn-widget"),a=n(35),s=n(31),c=n(77),l=n(43),u=n(29),p=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(){function t(t){this.isReady=!1,this.drawerOpen=!1,this.pages={home:!0,auth:!1,signWelcome:!1,preferences:!1},this.disposables=[],this.imagesUrl=i.a.imagesUrl,this.widget=t,this.store=t.store,this.store.activePage="home",this.store.homeFrame="comments",this.store.authFrame="welcome"}return t.prototype.bind=function(t,e){var n=this,o=this.store;this.disposables.push(o.pubSub.subscribe(s.a.PAGES_SHOW,(function(t){return n.showPage(t)}))),this.disposables.push(o.pubSub.subscribe(s.a.TRIGGER_DRAWER_HIDE,(function(){n.drawerOpen&&(n.drawerOpen=!1)}))),this.disposables.push(o.pubSub.subscribe(s.a.TRIGGER_DRAWER_OPEN,(function(){n.drawerOpen||(n.drawerOpen=!0)}))),this.disposables.push(o.eventAggregator.subscribe(s.a.USER_LOGOUT,(function(){o.homeFrame=o.isPrivateMode?"notes":"comments"})))},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;++t)this.disposables[t].dispose();this.disposables=[],this.isReady=!1},Object.defineProperty(t.prototype,"logoUrl",{get:function(){return this.imagesUrl+"/logo_v2.png"},enumerable:!1,configurable:!0}),t.prototype.showPage=function(t){var e=this.store,n=e.user;switch(t.page){case"home":this.loadHome(t.frame);break;case"auth":if(n.authActionsDisabled)break;if(n.sso&&!n.authenticated)return n.ssoAuthRequestHandle();this.loadAuth(t.frame),e.interactiveMode?e.interactiveController.setOffAndDoShow():this.widget.show();break;case"signup_welcome":if(n.authActionsDisabled)break;this.loadSignupWelcome();break;case"preferences":this.loadPreferences()}Object(u.c)().then((function(){e.pubSub.publish(s.a.PAGES_NAV_COMPLETE)}))},t.prototype.loadHome=function(t){var e=this.store,n=this.pages;n.auth=!1,n.signWelcome=!1,n.preferences=!1,n.home=!0,e.activePage="home","notes"===t&&e.privateNotesEnabled?(e.homeFrame=t,e.user.setPrivateMode(!0)):"comments"===t&&e.commentsEnabled?(e.homeFrame=t,e.user.setPrivateMode(!1)):"people"!==t||e.peopleDisabled||(e.homeFrame=t),e.analyticsController.recordGaEvent({collection:"navigation",action:"nav_home",label:e.homeFrame})},t.prototype.loadAuth=function(t){var e=this.store,n=this.pages;n.auth||e.playerUxFilter.pause(e,"authTrigger"),n.home=!1,n.signWelcome=!1,n.preferences=!1,n.auth=!0,e.activePage="auth",t&&(e.authFrame=t)},t.prototype.loadSignupWelcome=function(){var t=this.pages;t.home=!1,t.auth=!1,t.preferences=!1,t.signWelcome=!0,this.store.activePage="signup_welcome"},t.prototype.loadPreferences=function(){var t=this.pages;t.home=!1,t.auth=!1,t.signWelcome=!1,t.preferences=!0,this.store.activePage="preferences"},t.prototype.drawerKeyHandle=function(t){var e=this;return setTimeout((function(){e.drawerOpen||(Object(l.e)(t,"enter")||Object(l.e)(t,"space"))&&e.widget.setFocus()}),100),!0},t.prototype._onReady=function(){this.isReady=!0,"function"==typeof this.onReady&&this.onReady()},t.prototype._drawerOpenChanged=function(t,e){if(t!==e&&this.store&&this.isReady){var n=this.store;return n.interactiveController.recordUserAction(),n.pubSub.publish(t?s.a.DRAWER_OPEN:s.a.DRAWER_CLOSE),t?n.analyticsController.recordMenuInteraction("open",null,{label:"widget",value:Object(c.e)()}):void 0}},p([o.m,d("design:type",Object)],t.prototype,"onReady",void 0),p([Object(o.m)({defaultBindingMode:o.n.twoWay}),d("design:type",Object)],t.prototype,"isReady",void 0),p([Object(o.v)({changeHandler:"_drawerOpenChanged"}),d("design:type",Object)],t.prototype,"drawerOpen",void 0),p([Object(o.p)("imagesUrl"),d("design:type",Object),d("design:paramtypes",[])],t.prototype,"logoUrl",null),t=p([Object(o.s)("nn-layout"),Object(o.t)(a.a.of(r.AnnotoWidget,!0)),d("design:paramtypes",[r.AnnotoWidget])],t)}()},"organs/widget/nn-layout.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-layout.scss"></require>\n    <require from="../header/nn-header"></require>\n    <require from="./nn-drawer"></require>\n    <require from="../../pages/nn-home"></require>\n    <require from="../../pages/nn-auth"></require>\n    <require from="../../pages/nn-signup-welcome"></require>\n    <require from="../../pages/nn-preferences"></require>\n\n    <amdl-layout\n            fixed-header.one-time="true"\n            fixed-drawer.one-time="false"\n            transparent-header.one-time="true"\n            on-ready.call="_onReady()"\n            is-drawer-open.bind="drawerOpen"\n            no-drawer-button.bind="!store.drawerEnabled"\n            rtl.bind="store.rtl"\n            drawer-button-label.one-time="\'aaa.widget.drawer_button\' & t"\n            on-drawer-key-down.call="drawerKeyHandle(event)">\n\n        <nn-header slot="header-content"></nn-header>\n\n        <nn-drawer if.bind="store.drawerEnabled"\n                    slot="drawer-content"></nn-drawer>\n\n        <a if.bind="store.drawerEnabled" href="http://annoto.net" target="_blank" slot="drawer-footer" nn-focusable="index.bind: drawerOpen ? 0 : -1;">\n            <img class="annoto-drawer-logo" src.one-time="logoUrl" alt="${\'aaa.logo\' & t}">\n        </a>\n\n        <i if.bind="store.drawerEnabled"\n            slot="drawer-icon"\n            class="annoto-icon annoto-icon-menu nn-icon-menu nn-color-grey-heavy"></i>\n\n        <div slot="content">\n            <nn-home if.bind="store.hasUGC" show.bind="pages.home" class="annoto-page"></nn-home>\n            <nn-auth show.bind="pages.auth" class="annoto-page"></nn-auth>\n            <nn-signup-welcome if.bind="pages.signWelcome" class="annoto-page"></nn-signup-welcome>\n            <nn-preferences if.bind="pages.preferences" class="annoto-page"></nn-preferences>\n        </div>\n\n    </amdl-layout>\n</template>\n'},"organs/widget/nn-minibar":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoMinibar",(function(){return c}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},s=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},c=function(){function t(t){this.widget=t,this.store=t.store}return t.prototype.setFocus=function(){this.focusable&&this.focusable.setFocus()},t.prototype.open=function(){var t=this;return this.store.interactiveController.recordUserAction(),this.store.interactiveController.setOffAndShow().then((function(){var e=t.store;e.analyticsController.recordWidgetInteraction("open",{element:"minibar"},{label:"minibar",value:e.player.playCounter>0?1:0})}))},t.prototype.keyOpen=function(){var t=this;this.open().then((function(){t.widget.setFocus()}))},Object.defineProperty(t.prototype,"tooltipPosition",{get:function(){return"left"===this.store.api.position?"right":"left"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentsNum",{get:function(){var t=this.store;return t.metaData&&t.metaData.total.count&&!t.dapDemoIsActive?t.metaData.total.count:null},enumerable:!1,configurable:!0}),a([Object(o.p)("store.api","store.api.position"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"tooltipPosition",null),a([Object(o.p)("store.metaData","store.metaData.total","store.metaData.total.count","store.dapDemoIsActive"),s("design:type",Object),s("design:paramtypes",[])],t.prototype,"commentsNum",null),t=a([Object(o.s)("nn-minibar"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),s("design:paramtypes",[i.AnnotoWidget])],t)}()},"organs/widget/nn-minibar.html":function(t,e,n){t.exports='<template>\n  <require from="./css/nn-minibar.scss"></require>\n\n  <div class="annoto-minibar annoto-drag-hint nn-draggable-handle">\n    <div class="annoto-minibar-layout annoto-flex-row-nowrap annoto-flex-justify-center annoto-flex-align-center"\n         nn-focusable.bind="\'aaa.widget.minibar_button\' & t: { \'count\': commentsNum, \'context\': store.isPrivateMode ? \'private\' : \'\'}"\n         role="button"\n         aria-expanded="false"\n         nn-interaction="enter.call: keyOpen(); space.call: keyOpen()"\n         nn-focusable.ref="focusable">\n\n      <div  class="annoto-open" id="annoto-minibar-open" click.trigger="open()" amdl-badge="data.bind:commentsNum; overlap:true;">\n        <i class="annoto-icon annoto-icon-chat_bubble_o nn-icon-chat_bubble_o nn-color-grey"></i>\n      </div>\n      <nnc-tooltip if.bind="!store.isPhone" for="annoto-minibar-open" position.bind="tooltipPosition">${\'tut.open\' & t & oneTime}</nnc-tooltip>\n\n    </div>\n  </div>\n</template>\n'},"organs/widget/nn-widget":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoWidget",(function(){return S}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n("aurelia-templating-resources"),a=n(32),s=n(29),c=n(76),l=n(31),u=n(40),p=n(61),d=n(69),h=n(90),m=n(67),f=n(79),g=n(66),b=n(44),y=n(36),v=function(){function t(){this.reset()}return t.prototype.reset=function(){this._widgetWasOpened=!1},t.prototype.widgetWasOpened=function(t){return"boolean"==typeof t&&t!==this._widgetWasOpened&&(this._widgetWasOpened=t),this._widgetWasOpened},t}(),w=n(50),O=n("dialog/index"),_=n(171),x=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},E=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},S=function(){function t(t,n,r,a,s,c,l,u){this.auContainer=a,this.dialog=u,this.disposables=[],this.instanceId=e.instanceCounter,e.instanceCounter++,this.logger=o.h.getLogger("Annoto-widget"),this.eventAggregator=t,this.pubSub=new i.EventAggregator,this.signaler=n,this.bindingEngine=r,this.serviceInitializer=s,this.platform=c,this.sessionService=l,this.store=new y.a(this),a.registerInstance(y.a,this.store),this.reset(),this.closed=!1}var e;return e=t,Object.defineProperty(t.prototype,"index",{get:function(){return this.api?this.api.index:void 0},enumerable:!1,configurable:!0}),t.prototype.activate=function(t){this.api=t},t.prototype.reset=function(){this.canShow=!1,this.isOpen=!1,this.ctaActive=!1,this.someFormOpen=!1,this.playerFullScreen=!1,this.firstShow=!0,this.upgraded={layout:!1}},t.prototype.bind=function(){var t=this,e=this.api;e instanceof c.b?(e._init(this),e._closed&&(this.closed=!0),this.closed?this.logger.debug("widget is closed, cancel binding"):(this.player=new b.a(this.bindingEngine,this.store),this.auContainer.registerInstance(b.a,this.player),e.demoMode||(this.threadController=new u.b(this.store),this.initControllers()),this.dateRefreshTimer=setInterval((function(){return t.signaler.signal("annoto-dates")}),a.a.widget.dateRefreshInterval),this.disposables.push(this.pubSub.subscribe(l.a.SOME_FORM_OPEN_CHANGE,(function(e){t.someFormOpen=e}))),this.disposables.push(this.pubSub.subscribe(l.a.CTA_TOGGLE,(function(e){t.ctaActive=e}))),this.disposables.push(this.eventAggregator.subscribe(l.a.USER_AUTH_CHANGE,(function(e){var n=e?"login":"logout";t.store.analyticsController.recordConversionInteraction(n)}))),"text"===this.store.mediaType&&(this.startupState=this.store.userSettings.preferences.widgetState))):this.logger.error("AnnotoWidgetAPI must be bound to api")},t.prototype.attached=function(){var t=this;if(this.closed)this.logger.debug("widget is closed, cancel attaching");else{if(this.player.init().then((function(){t.player.onOneTime(b.b.READY,(function(){t.playerFullScreen=t.player.fullScreen(),t.playerHeight=t.player.height(),t.eventAggregator.publish(l.a.PLAYER_FULL_SCREEN_CHANGE,{publisher:t,data:t.playerFullScreen}),t.disposables.push(t.player.on(b.b.FULL_SCREEN_CHANGE,(function(){t.playerFullScreen=t.player.fullScreen(),t.playerHeight=t.player.height(),t.eventAggregator.publish(l.a.PLAYER_FULL_SCREEN_CHANGE,{publisher:t,data:t.playerFullScreen})}))),t.disposables.push(t.player.on(b.b.SIZE_CHANGE,(function(){t.playerHeight=t.player.height()}))),t.disposables.push(t.player.on(b.b.READY,(function(){t.canShow&&(t.playerHeight=t.player.height(),t.updateSignal(),t.isOpen&&t.player.playHack(!0))})))}))})).catch((function(e){t.logger.error("Player initialization failed: ",e)})),this.api.demoMode)return this.threadController=new u.b(this.store),this.store.demoController.importDemo().then((function(){return t.initControllers(),t.updateSignal(),Object(s.p)()})).then((function(){t.showIfReady(),t.eventAggregator.publish(l.a.WIDGET_ATTACHED,t),"function"==typeof t.onAttached&&t.onAttached()}));this.showIfReady(),this.eventAggregator.publish(l.a.WIDGET_ATTACHED,this),"function"==typeof this.onAttached&&this.onAttached()}},t.prototype.initControllers=function(){var t=this.settings;this.threadController.setup(),t.privateNotesEnabled&&(this.notesController=new p.a(this.store)),t.commentsEnabled&&(this.commentsController=new d.a(this.store)),t.hasUGC&&(this.pbMetricsController=new h.a(this.store),this.metaDataController=new m.a(this.store)),t.peopleEnabled&&(this.presenceController=new _.a(this.store))},t.prototype.layoutReady=function(){this.logger.debug("Layout ready"),this.upgraded.layout=!0,this.showIfReady()},t.prototype.showIfReady=function(){var t=this;if(!this.canShow&&this.upgraded.layout&&this.threadController){var e=this.store;if(this.logger.info("Ready"),this.canShow=!0,!this.isOverlay||this.api.open&&!this.platform.isPhone()&&"closed"!==e.widgetStartupState)return e.interactiveController.recordAutoOpenEvent("configuration"),"mini"===e.widgetStartupState&&(e.interactiveController.interactive=!0),this.doShow();this.doHide(),e.ux.kukuCloseOnLoad?e.interactiveController.recordUserAction():this.player.onOneTime(b.b.FIRST_PLAY,(function(){t.logger.debug("first play handle"),t.isOpen||t.sessionService.widgetWasOpened()||"closed"===e.widgetStartupState||e.interactiveController.autoShowOnStartup("first_play")}))}},t.prototype.unbind=function(){this.closed||(this.logger.warn("widget not closed while unbinding"),this.prepareUnbind()),this.player=void 0,this.threadController=void 0,this.commentsController=void 0,this.pbMetricsController=void 0,this.metaDataController=void 0,this.notesController=void 0,this.reset()},t.prototype.detached=function(){this.isOpen=!1,this.canShow=!1,this.dispose(),this.upgraded.layout=!1,this.eventAggregator.publish(l.a.WIDGET_DETACHED,this),"function"==typeof this.onDetached&&this.onDetached();var t={name:"widget:hide",data:this};this.eventAggregator.publish(l.a.UX_EVENT,t)},t.prototype.dispose=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[]},t.prototype.prepareUnbind=function(){clearInterval(this.dateRefreshTimer),this.dateRefreshTimer=0,this.dispose(),this.player&&this.player.remove(),this.threadController&&this.threadController.dispose(),this.commentsController&&this.commentsController.dispose(),this.pbMetricsController&&this.pbMetricsController.dispose(),this.metaDataController&&this.metaDataController.dispose(),this.notesController&&this.notesController.dispose()},t.prototype.close=function(){var t=this;return this.detached(),this.prepareUnbind(),this.closed=!0,this.updateSignal(),Object(s.p)().then((function(){t.unbind()}))},t.prototype.reload=function(t){var e=this;return t instanceof c.b?this.close().then((function(){return Object(s.p)()})).then((function(){return e.api=t,e.closed=!1,e.bind(),e.updateSignal(),Object(s.p)()})).then((function(){e.attached()})):Promise.reject(new TypeError("unable to reload widget. api must be instance of AnnotoWidgetAPI"))},t.prototype.hide=function(){var t=this;return Promise.resolve().then((function(){if(t.isOpen){t.doHide();var e={name:"widget:hide",data:t};return t.eventAggregator.publish(l.a.UX_EVENT,e),Object(s.c)().then((function(){return null}))}}))},t.prototype.doHide=function(){this.isOpen=!1,"function"==typeof this.onHide&&this.onHide(),this.updateSignal();try{var t=this.store;"text"===t.mediaType&&(t.userSettings.preferences.widgetState="closed",t.userSettings.cacheLocalPreferences().catch((function(t){})))}catch(t){}},t.prototype.showByApi=function(){var t=this,e=this.store;return e.interactiveController.recordUserAction(),e.analyticsController.recordWidgetInteraction("open",{element:"ext"},{label:"ext",value:e.player.playCounter>0?1:0}),e.interactiveController.setOffAndShow().then((function(){return t.show()}))},t.prototype.hideByApi=function(){var t=this.store;return t.interactiveController.recordUserAction(),t.analyticsController.recordWidgetInteraction("close",{element:"ext"},{label:"ext",value:t.player.playCounter>0?1:0}),this.hide()},t.prototype.show=function(){var t=this;return Promise.resolve().then((function(){if(t.canShow){if(t.isOpen)return t.pausePlayerOnShow?t.store.playerUxFilter.pause(t.store,"widgetOpenOnPhone"):void 0;var e=t.sessionService.widgetWasOpened();return(t.pausePlayerOnShow?t.store.playerUxFilter.pause(t.store,"widgetOpenOnPhone").then((function(){return t.doShow()})):t.doShow()).then((function(){t.player.ready&&t.firstShow&&t.player.playHack(),t.firstShow=!1,e||t.sessionService.widgetWasOpened(!0);var n={name:"widget:show",data:t};t.eventAggregator.publish(l.a.UX_EVENT,n)}))}t.logger.warn("Cannoto show, Not setup")}))},t.prototype.doShow=function(){var t=this,e=this.store;return Promise.resolve().then((function(){if(t.isOpen=!0,"function"==typeof t.onShow)return t.onShow()})).then((function(){t.updateSignal(),t.pubSub.publish(l.a.WIDGET_OPEN);try{"text"===e.mediaType&&(e.userSettings.preferences.widgetState=e.interactiveMode?"mini":"open",e.userSettings.cacheLocalPreferences())}catch(t){}}))},t.prototype.setFocus=function(){this.canShow&&(this.isOpen&&this.focusable?this.focusable.setFocus():!this.isOpen&&this.minibar&&this.minibar.setFocus())},t.prototype.overlayLock=function(){this.overlay&&this.overlay.lock()},t.prototype.overlayUnlock=function(){this.overlay&&this.overlay.unlock()},Object.defineProperty(t.prototype,"isOverlay",{get:function(){return!!this.overlay},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"settings",{get:function(){return this.serviceInitializer.settings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this.serviceInitializer.user},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apiService",{get:function(){return this.serviceInitializer.apiService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loader",{get:function(){return this.serviceInitializer.loader},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phoneFormOpenView",{get:function(){return!(!this.someFormOpen||!this.platform.phone)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasLayout",{get:function(){return Boolean(!this.closed&&!!this.threadController&&this.settings.hasUGC)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDark",{get:function(){return Boolean(this.overlay&&this.overlay.isDark||"dark"===this.store.ux.theme)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pausePlayerOnShow",{get:function(){return this.platform.phone},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minibarShow",{get:function(){return Boolean(!this.closed&&this.canShow&&!this.miniShow&&!this.isOpen&&this.settings.hasUGC&&this.settings.minibarEnabled)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miniShow",{get:function(){return Boolean(!this.closed&&this.canShow&&this.isOpen&&this.settings.hasUGC&&this.settings.interactiveEnabled&&this.store.interactiveMode)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"miniKukuMode",{get:function(){return Boolean(this.platform.phone||a.a.ux.forceMiniKuku||this.isInner&&this.playerHeight<a.a.mini.kukuPlayerHeightThreshold)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutShow",{get:function(){return Boolean(!this.closed&&this.isOpen&&!this.store.interactiveMode)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isResized",{get:function(){return this.isOverlay&&this.overlay.isResized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDragged",{get:function(){return this.isOverlay&&this.overlay.isDragged},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSmallPlayer",{get:function(){return Boolean(this.isInner&&this.playerHeight<a.a.widget.smallPlayerHeightThreshold)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isInner",{get:function(){return Boolean(this.isOverlay&&this.overlay.isInner)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wasDragged",{get:function(){return this.isOverlay&&this.overlay.wasDragged},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"draggableNotPermitted",{get:function(){return!this.isOverlay||this.overlay.draggableNotPermitted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sideBySideLayout",{get:function(){return this.isOverlay&&this.overlay.sideBySideLayout},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aaaTrOptions",{get:function(){return{context:(this.miniShow?"mini":this.store.activePage)+(("home"===this.store.activePage||this.miniShow)&&this.store.isPrivateMode?"_private":"")}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showLive",{get:function(){var t=this.store;return t.isLive&&"text"!==t.mediaType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageClass",{get:function(){var t,e,n,o;return"nn-"+(t=this.store,e=t.homeFrame,n=t.authFrame,("home"===(o=t.activePage)?e||o:"auth"===o&&n||o)+"-page")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"info",{get:function(){var t=this.overlay||{isVisible:!0,sideBySideLayout:!1,docked:!0,locked:!0,isDragged:!1,wasDragged:!1,wasResized:!1,top:0,left:0,zIndex:0,offset:void 0};return{is_open:this.isOpen,is_visible:t.isVisible,upgrades:this.upgraded,can_show:this.canShow,is_phone:this.platform.phone,is_tablet:this.platform.tablet,is_small_screen:this.platform.smallScreen,is_mini:this.miniShow,is_kuku:this.miniKukuMode,is_minibar_shown:this.minibarShow,is_sbs_layout:t.sideBySideLayout,is_form_open:this.someFormOpen,is_phone_form_open:this.phoneFormOpenView,is_first_show:this.firstShow,is_docked:t.docked,is_locked:t.locked,is_dragged:t.isDragged,was_dragged:t.wasDragged,was_resized:t.wasResized,is_cta_active:this.ctaActive,is_interactive:this.store.interactiveMode,active_page:this.store.activePage,size:this.containerElement?{width:this.containerElement.offsetWidth,height:this.containerElement.offsetHeight}:void 0,position:{position:this.api.position,top:t.top,left:t.left,z_index:t.zIndex,offset:t.offset,scroll_left:this.scrollLeft,scroll_top:this.scrollTop}}},enumerable:!1,configurable:!0}),t.prototype.updateSignal=function(){this.signaler.signal("annoto-widget-update")},t.instanceCounter=0,x([Object(o.m)({defaultBindingMode:o.n.toView}),E("design:type",c.b)],t.prototype,"api",void 0),x([Object(o.m)({defaultBindingMode:o.n.toView}),E("design:type",Object)],t.prototype,"overlay",void 0),x([Object(o.m)({defaultBindingMode:o.n.fromView}),E("design:type",Object)],t.prototype,"onShow",void 0),x([Object(o.m)({defaultBindingMode:o.n.fromView}),E("design:type",Object)],t.prototype,"onHide",void 0),x([Object(o.m)({defaultBindingMode:o.n.fromView}),E("design:type",Object)],t.prototype,"onDetached",void 0),x([Object(o.m)({defaultBindingMode:o.n.fromView}),E("design:type",Object)],t.prototype,"onAttached",void 0),x([Object(o.m)({defaultBindingMode:o.n.fromView}),E("design:type",y.a)],t.prototype,"store",void 0),x([Object(o.o)("nn-minibar"),E("design:type",Object)],t.prototype,"minibar",void 0),x([Object(o.p)("overlay"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"isOverlay",null),x([Object(o.p)("serviceInitializer.settings"),E("design:type",w.a),E("design:paramtypes",[])],t.prototype,"settings",null),x([Object(o.p)("serviceInitializer.user"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"user",null),x([Object(o.p)("serviceInitializer.apiService"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"apiService",null),x([Object(o.p)("serviceInitializer.loader"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"loader",null),x([Object(o.p)("someFormOpen","platform.phone"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"phoneFormOpenView",null),x([Object(o.p)("closed","threadController","settings.hasUGC"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"hasLayout",null),x([Object(o.p)("overlay","overlay.isDark","store.ux.theme"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"isDark",null),x([Object(o.p)("platform.phone"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"pausePlayerOnShow",null),x([Object(o.p)("closed","isOpen","miniShow","canShow","settings.hasUGC","settings.minibarEnabled"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"minibarShow",null),x([Object(o.p)("closed","canShow","isOpen","settings.hasUGC","settings.interactiveEnabled","store.interactiveMode"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"miniShow",null),x([Object(o.p)("platform.phone","playerHeight","isInner"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"miniKukuMode",null),x([Object(o.p)("closed","isOpen","store.interactiveMode"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"layoutShow",null),x([Object(o.p)("isOverlay","overlay.isResized"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"isResized",null),x([Object(o.p)("isOverlay","overlay.isDragged"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"isDragged",null),x([Object(o.p)("isInner","playerHeight"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"isSmallPlayer",null),x([Object(o.p)("isOverlay","overlay.isInner"),E("design:type",Boolean),E("design:paramtypes",[])],t.prototype,"isInner",null),x([Object(o.p)("isOverlay","overlay.wasDragged"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"wasDragged",null),x([Object(o.p)("isOverlay","overlay.draggableNotPermitted"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"draggableNotPermitted",null),x([Object(o.p)("isOverlay","overlay.sideBySideLayout"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"sideBySideLayout",null),x([Object(o.p)("store.activePage","store.isPrivateMode","miniShow"),E("design:type",Object),E("design:paramtypes",[])],t.prototype,"aaaTrOptions",null),x([Object(o.p)("store.isLive","store.mediaType"),E("design:type",Boolean),E("design:paramtypes",[])],t.prototype,"showLive",null),x([Object(o.p)("store.activePage","store.homeFrame","store.authFrame"),E("design:type",String),E("design:paramtypes",[])],t.prototype,"pageClass",null),t=e=x([Object(o.s)("nn-widget"),Object(o.t)(i.EventAggregator,r.BindingSignaler,o.b,o.c,f.a,g.a,v,O.DialogService),E("design:paramtypes",[i.EventAggregator,r.BindingSignaler,o.b,o.c,f.a,g.a,v,O.DialogService])],t)}()},"organs/widget/nn-widget-overlay":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoWidgetOverlay",(function(){return b}));var o=n("aurelia-framework"),i=n("aurelia-event-aggregator"),r=n(32),a=n(29),s=n(76),c=n(31),l=n(79),u=n(66),p=n(44),d=n(50),h=n(43),m=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},f=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=r.a.$,b=function(){function t(t,e,n,i){this.platform=n,this.offset={top:0,left:0},this.size=y(),this.autohideTimedout=!1,this.isMouseOver=!1,this.disposables=[],this.widgetDisposables=[],this.vm=this,this.element=t,this.logger=o.h.getLogger("Annoto-widget-overlay"),this.eventAggregator=e,this.serviceInitializer=i,this.reset()}return t.prototype.reset=function(){this.draggable=void 0,this.resizable=void 0,this.container=void 0,this.scrollParent=void 0,this.isVisible=!0,this.sideBySideLayout=!1,this.locked=!1,this.docked=!1,this.isDragged=!1,this.wasDragged=!1,this.isResized=!1,this.wasResized=!1,this.playerFullScreen=!1,this.upgraded={draggable:!1,resizable:!1},this.offset={top:0,left:0},this.left=0,this.top=0,this.size={width:g(this.element).width(),height:g(this.element).height(),maxHeight:r.a.widget.defaultMaxHeight,minHeight:r.a.widget.minHeight,maxWidth:r.a.widget.defaultMaxWidth,minWidth:r.a.widget.minWidth,margins:{top:0,bottom:0,left:0,right:0}},this.transformation={translation:{ty:0,tx:0}}},t.prototype.activate=function(t){this.api=t},t.prototype.bind=function(){this.api instanceof s.b||this.logger.error("AnnotoWidgetAPI must be bound to api")},t.prototype.attached=function(){var t=this;this.widgetVm.closed?this.logger.debug("widget is closed, cancel attaching"):(this.draggable=g(this.draggableElement),this.resizable=g(this.resizableElement),this.container=g(this.containerElement),this.scrollParent=g(this.element).scrollParent(),this.offset=this.container.offset(),this.upgradeDraggable(),this.upgradeResizable(),this.disposables.push(this.eventAggregator.subscribe(c.a.SCREEN_PARAMS_CHANGE,(function(){t.resizeViewHandle()}))),this.disposables.push(Object(h.a)(this.resizableElement,"mouseenter",(function(){t.isMouseOver=!0}),!1)),this.disposables.push(Object(h.a)(this.resizableElement,"mouseleave",(function(){t.isMouseOver=!1,t.clearAutohide(),t.restartAutohide()}),!1)))},t.prototype.unbind=function(){this.reset()},t.prototype.detached=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose();this.disposables=[],this.upgraded.resizable=!1,this.upgraded.draggable=!1},t.prototype.widgetAttachedHandle=function(){var t=this,e=this.store;e.player.onOneTime(p.b.READY,(function(){t.widgetDisposables.push(e.player.on(p.b.FULL_SCREEN_CHANGE,(function(){return t.playerFullscreenChangeHandle()}))),t.widgetDisposables.push(e.player.on(p.b.SIZE_CHANGE,(function(){return t.playerSizeChangeHandle()}))),t.widgetDisposables.push(e.player.on(p.b.READY,(function(){t.playerFullScreenFix(),t.playerFullScreen=t.isPlayerFullscreenLayout(),t.playerFullScreenSupported=e.player.fullScreenSupported(),t.autoResize(),t.autoPosition()})))}));var n=this.relativeElement;n&&(this.widgetDisposables.push(Object(h.a)(n,"mousemove",(function(){t.clearAutohide(),t.restartAutohide()}),!1)),this.widgetDisposables.push(Object(h.a)(n,"mouseleave",(function(){return t.restartAutohide(!0)}),!1))),this.widgetIsAttached=!0},t.prototype.widgetDetachedHandle=function(){this.widgetIsAttached=!1;for(var t=0;t<this.widgetDisposables.length;t++)this.widgetDisposables[t].dispose();this.widgetDisposables=[]},t.prototype.widgetHideHandle=function(){this.platform.isPhone()||this.draggableEnable(),this.resizableDisable(),this.autoResize(),this.autoPosition(),this.restartAutohide()},t.prototype.widgetShowHandle=function(){var t=this;return Promise.resolve().then((function(){if(t.platform.isPhone()&&t.store.interactiveMode&&!t.playerFullScreen&&!t.platform.isLandscape())return t.autoScroll().catch((function(e){t.logger.warn("auto scroll animation failed",e)})).then((function(){t.isVisible=!1,t.autoResize(),t.autoPosition(),t.isVisible=!0}));t.isVisible=!1,t.resizableEnable(),!t.draggableUxDisabled||t.store.interactiveMode||t.playerFullScreen&&!t.isSidePanelFs?t.draggableEnable():t.draggableDisable(),t.autoResize(),t.autoPosition(),t.isVisible=!0}))},t.prototype.lock=function(){this.locked=!0,this.draggableDisable(),this.resizableDisable()},t.prototype.unlock=function(){this.locked=!1,this.draggableEnable(),this.resizableEnable()},t.prototype.isFullPlayerSize=function(){var t=this.widgetVm;return Boolean(t.isOpen&&!this.store.interactiveMode&&(t.isSmallPlayer&&this.isInner||this.platform.phone))},Object.defineProperty(t.prototype,"settings",{get:function(){return this.serviceInitializer.settings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this.playerFullScreen||this.platform.phone?this.settings.fsZIndex:this.settings.zIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showWidget",{get:function(){return Boolean(this.widgetIsAttached&&this.store.player.ready&&(!this.playerFullScreen||this.playerFullScreenSupported))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showBody",{get:function(){return Boolean(this.settings.hasUGC&&(this.widgetVm.layoutShow||this.widgetVm.minibarShow||this.widgetVm.miniShow))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autohide",{get:function(){return this.autohideTimedout&&!this.isMouseOver&&this.widgetVm.minibarShow&&this.isInner&&this.store.player&&!this.store.player.isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showResizableHandleN",{get:function(){return Boolean(this.widgetVm.layoutShow)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showResizableHandleS",{get:function(){return Boolean(!this.widgetVm.minibarShow)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showResizableHandleW",{get:function(){var t=this.widgetVm,e=t.miniShow,n="right"===this.api.position,o=this.isInner;return Boolean(!t.minibarShow&&(!this.docked||o&&n||e&&!o&&!n||!e&&!o&&n))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showResizableHandleE",{get:function(){var t=this.widgetVm,e=t.miniShow,n="right"===this.api.position,o=this.isInner;return Boolean(!t.minibarShow&&(!this.docked||o&&!n||e&&!o&&n||!e&&!o&&!n))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showResizableHandleSW",{get:function(){return this.showResizableHandleW},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showResizableHandleSE",{get:function(){return this.showResizableHandleE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"draggableUxDisabled",{get:function(){return Boolean(this.ux.draggableDisabled||this.isSidePanel)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"draggableNotPermitted",{get:function(){return Boolean(!this.draggable||this.platform.phone||this.locked||this.widgetVm.layoutShow&&this.draggableUxDisabled&&(!this.playerFullScreen||this.isSidePanelFs))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizableNotPermitted",{get:function(){return Boolean(!this.resizable||this.platform.phone||this.locked)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"undockNotPermitted",{get:function(){return Boolean(this.platform.phone||this.store.interactiveMode||this.isSidePanelOverlay||!this.widgetVm.isOpen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"relativeElement",{get:function(){return"string"==typeof this.api.element?document.getElementById(this.api.element):this.api.element},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isInner",{get:function(){var t=this.store;if(!t||!t.player||!this.relativeElement)return!1;var e=this.api.align.horizontal,n=t.platform.windowWidth-t.player.w,o=n>=r.a.minibar.width||this.widgetVm.isOpen&&n>r.a.widget.minWidth;return Boolean(this.isSidePanelOverlay||!o&&"screen_edge"!==e||this.playerFullScreen&&!this.isSidePanelFs||"inner"===e&&!this.isSidePanel)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDark",{get:function(){return Boolean(this.settings.darkThemeEnabled&&(this.isInner||this.isSidePanelFs&&this.playerFullScreen)&&!(this.platform.phone&&!this.playerFullScreen))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ux",{get:function(){return this.store?this.store.ux:{}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSidePanel",{get:function(){return Boolean(this.ux.sidePanelLayout)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSidePanelOverlay",{get:function(){return Boolean(this.isSidePanel&&this.ux.sidePanelOverlay)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSidePanelFs",{get:function(){return Boolean(this.isSidePanel&&this.ux.sidePanelFullScreen)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playerRatio",{get:function(){return this.api.player.wide?r.a.widget.playerRatioWide:r.a.widget.playerRatio},enumerable:!1,configurable:!0}),t.prototype.calcRightMargin=function(){var t=this.api.margins,e=r.a.widget.margins;if(this.playerFullScreen||this.isInner||this.isSidePanel)return 0;var n=window.innerWidth,o=Math.max(this.platform.isDesktop()?e.desktopScroll:e.border,t.right);if(n){if(n>this.platform.windowWidth)return e.border;var i=Math.round(n-this.platform.rootElement.offsetWidth);o=i>0?Math.max(i,e.border):o}return o},Object.defineProperty(t.prototype,"computedTop",{get:function(){return this.draggableElement?parseInt(window.getComputedStyle(this.draggableElement).top):0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedLeft",{get:function(){return this.draggableElement?parseInt(window.getComputedStyle(this.draggableElement).left):0},enumerable:!1,configurable:!0}),t.prototype.resizeViewHandle=function(){var t=this;this.isVisible=!1,this.platform.isPhone()?(this.resizableDisable(),this.draggableDisable()):this.platform.wasPhone&&(this.resizableEnable(),this.draggableEnable()),this.autoResize(),this.autoPosition(),setTimeout((function(){t.isVisible=!0}),200)},t.prototype.playerFullScreenFix=function(){var t=this.store.player,e=t.embeddableElement();t.fixFullScreen()&&t.isEmbeddableElement(e)&&(t.fullScreen()?this.store.app.appendAppContainerAsChildOf(e):this.store.app.appendAppContainerElToDefaultParent())},t.prototype.playerFullscreenChangeHandle=function(){var t=this;this.playerFullScreenFix(),this.playerFullScreen=this.isPlayerFullscreenLayout(),Object(a.c)().then((function(){var e=t.playerFullScreen;return t.platform.isPhone()&&e&&t.widgetVm.isOpen&&!t.store.interactiveMode?t.widgetVm.hide():(t.isVisible=!1,t.autoResize(),t.autoPosition(),e&&!t.isSidePanelFs?t.draggableEnable():t.draggableUxDisabled&&!t.store.interactiveMode&&t.draggableDisable(),Object(a.c)())})).then((function(){t.isVisible=!0}))},t.prototype.isPlayerFullscreenLayout=function(){var t=this.store;return t.player.fullScreen()||t.platform.isPhone()&&t.platform.isLandscape()&&t.player.isFullInIframe()},t.prototype.playerSizeChangeHandle=function(){this.widgetIsAttached&&this.store.player&&this.store.player.ready&&(this.autoResize(),this.autoPosition())},t.prototype.dragStartHandle=function(t,e){var n=this;g("iframe").css("pointer-events","none"),this.isDragged=!0,this.wasDragged=!0,Object(a.c)().then((function(){return n.transformationUpdate()})),this.store.interactiveController.recordUserAction()},t.prototype.dragHandle=function(t,e){var n=this.size,o=n.margins,i=o.top,r=o.left,a=this.transformation.translation,s=o.top,c=o.left,l="fixed"===this.bodyElement.style.position;l?(i=e.position.top,r=e.position.left,s-=a.ty,c-=a.tx):(this.offsetUpdate(),i=e.offset.top-g(window).scrollTop(),r=e.offset.left-g(window).scrollLeft());var u=i+n.height,p=this.platform.windowHeight-u,d=r+n.width,h=this.platform.windowWidth-d;l&&(p-=a.ty,h-=a.tx),i<s?e.position.top+=s-i:p<o.bottom&&(e.position.top-=o.bottom-p),r<c?e.position.left+=c-r:h<o.right&&(e.position.left-=o.right-h)},t.prototype.dragStopHandle=function(t,e){g("iframe").css("pointer-events","auto"),this.isDragged=!1,this.left=this.computedLeft,this.top=this.computedTop;var n=this.widgetVm.isOpen?this.store.interactiveMode?"mini":"widget":"minibar";return this.store.analyticsController.recordWidgetInteraction("dragged",{element:n},{label:n})},t.prototype.resizeHandle=function(t,e){var n=this.size,o=e.originalPosition.left-e.position.left,i=this.left-o,r=this.platform.windowWidth-(i+e.size.width);r<n.margins.right&&(e.size.width-=n.margins.right-r,e.helper.width(e.size.width)),this.draggable.width(e.size.width),this.draggable.height(e.size.height),o<0&&(this.resizable.width(e.size.width),n.width=this.resizable.width());var a=e.originalPosition.top-e.position.top,s=this.top-a;a<0&&(this.resizable.height(e.size.height),n.height=this.resizable.height()),this.draggable.css({top:s+"px",left:i+"px"})},t.prototype.resizeStartHandle=function(t,e){var n=this.size,o=n.margins,i=this.platform.windowHeight,r=this.platform.windowWidth;if(this.isInner&&!this.playerFullScreen){var a=this.relativeElement;i=a.offsetHeight,r=a.offsetWidth}i-=o.top+o.bottom,r-=o.left+o.right,g("iframe").css("pointer-events","none"),this.resizable.resizable("option","maxHeight",i),this.resizable.resizable("option","maxWidth",r),n.maxHeight=i,n.maxWidth=r,this.isResized=!0,this.wasResized=!0,this.transformationUpdate(),this.store.interactiveController.recordUserAction()},t.prototype.resizeStopHandle=function(t,e){var n=this;g("iframe").css("pointer-events","auto"),g(t.target).queue((function(){n.resizeCompleteHandle(t,e),g(this).dequeue()}))},t.prototype.resizeCompleteHandle=function(t,e){var n=this.size;this.isResized=!1,n.height=this.resizable.height(),n.width=this.resizable.width(),this.draggable.height(n.height),this.draggable.width(n.width),this.left=this.computedLeft,this.top=this.computedTop,this.sizeUpdatedHandle();var o=this.widgetVm.isOpen?this.store.interactiveMode?"mini":"widget":"minibar";return this.store.analyticsController.recordWidgetInteraction("resized",{element:o},{label:o})},t.prototype.keydownHandle=function(t){var e=this;return!(Object(h.e)(t,"esc")&&this.widgetVm&&this.widgetVm.isOpen)||(this.widgetVm.hide().then((function(){e.widgetVm.setFocus()})),!1)},t.prototype.dock=function(){this.draggable.draggable("option","axis","y"),this.docked=!0},t.prototype.undock=function(){this.undockNotPermitted||(this.draggable.draggable("option","axis","xy"),this.docked=!1)},t.prototype.autoResize=function(){var t=this.widgetVm.isOpen?this.store.interactiveMode?this.calcMiniSize():this.calcSize():this.calcMinibarSize();this.updateSize(t)},t.prototype.autoPosition=function(){var t=this.size,e=this.api,n=this.widgetVm,o=t.margins,i=this.relativeElement,r=this.platform,s=this.playerFullScreen,c=0,l=0,u=0,p=r.windowHeight,d=r.windowWidth,h=this.isInner,m=!h&&i&&"screen_edge"!==e.align.horizontal,f=(m||h)&&!s,g="absolute",b=this.store.interactiveMode,y=n.isOpen;if(r.isPhone())this.dock(),this.left="left"===e.phonePosition?o.left:Math.max(o.left,Math.round(d-(t.width+o.right))),this.top=Math.max(o.top,Math.round(p-(t.height+o.bottom))),s&&(this.top=o.top),g="fixed";else{if(!y||b||this.isSidePanelOverlay||this.isSidePanel&&!h||!s&&("screen_edge"===e.align.horizontal||i===document.body)?this.dock():this.undock(),this.docked&&!f&&(g="fixed"),f){var v=Object(a.h)(i,r.rootElement,this.containerElement);c=v.top,l=v.left,u=v.offsetPos.left}if(this.isFullPlayerSize()&&f)this.left=Math.max(0,Math.round(l)),this.top=Math.max(0,c);else if("left"===e.position?this.left=f&&m?Math.max(o.left,Math.round(l-(t.width+o.left))):f&&h?Math.max(o.left,Math.round(l+o.left)):Math.round(o.left-u):this.left=f&&m?Math.max(o.left,Math.round(Math.min(d-t.width-o.left-u,l+i.offsetWidth+o.left))):f&&h?Math.max(o.left,Math.round(l+i.offsetWidth-(o.left+t.width))):Math.max(o.left,Math.round(d-(t.width+o.right+u))),f){var w=i.offsetHeight;if("top"===e.align.vertical)this.top=h?Math.max(o.top,c+o.top):Math.max(o.top,c);else if("bottom"===e.align.vertical)this.top=h?Math.max(o.top,c+Math.round(w-t.height-o.bottom)):Math.max(o.top,c+Math.round(w-t.height));else{O=0;h&&(O=o.top-o.bottom),this.top=Math.max(o.top,c+Math.round((w-t.height+O)/2))}}else if("top"===e.align.vertical)this.top=o.top;else if("bottom"===e.align.vertical)this.top=Math.round(p-t.height-o.bottom);else{var O=o.top-o.bottom;this.top=Math.max(o.top,Math.round((p-t.height+O)/2))}}if(this.bodyElement.style.position=g,"fixed"===g){this.transformationUpdate();var _=this.transformation.translation;this.left-=_.tx,this.top-=_.ty}else this.offsetUpdate();this.draggable.css({left:this.left,top:this.top})},t.prototype.upgradeDraggable=function(){if(this.draggable)if("function"==typeof g().draggable){var t=r.a.widget;this.draggable.hasClass("ui-draggable")||g(this.draggable).draggable({containment:t.containment,scope:t.scope,cancel:t.draggable.cancel,handle:t.draggable.handle,cursor:t.draggable.cursor,opacity:t.draggable.opacity,scroll:t.draggable.scroll,start:this.dragStartHandle.bind(this),drag:this.dragHandle.bind(this),stop:this.dragStopHandle.bind(this)}),this.draggable.draggable=g(this.draggable).draggable,this.draggableNotPermitted&&this.draggableDisable(),this.upgraded.draggable=!0}else this.draggable.draggable=function(){}},t.prototype.upgradeResizable=function(){var t=this.size;if(this.resizable)if("function"==typeof g().resizable){var e=r.a.widget;this.resizable.hasClass("ui-resizable")||g(this.resizable).resizable({containment:e.containment,ghost:e.resizable.ghost,animate:e.resizable.animate,animateDuration:e.resizable.animateDuration,minHeight:t.minHeight,minWidth:t.minWidth,maxHeight:t.maxHeight,maxWidth:t.maxWidth,handles:{n:this.resizable.find(".ui-resizable-n"),e:this.resizable.find(".ui-resizable-e"),s:this.resizable.find(".ui-resizable-s"),w:this.resizable.find(".ui-resizable-w"),sw:this.resizable.find(".ui-resizable-sw"),se:this.resizable.find(".ui-resizable-se")},helper:e.resizable.helper,start:this.resizeStartHandle.bind(this),resize:this.resizeHandle.bind(this),stop:this.resizeStopHandle.bind(this)}),this.resizable.resizable=g(this.resizable).resizable,this.resizableNotPermitted&&this.resizableDisable(),this.upgraded.resizable=!0}else this.resizable.resizable=function(){}},t.prototype.draggableEnable=function(){this.draggableNotPermitted||this.draggable.draggable("enable")},t.prototype.draggableDisable=function(){this.draggable&&this.draggable.draggable("disable")},t.prototype.resizableEnable=function(){this.resizableNotPermitted||this.resizable.resizable("enable")},t.prototype.resizableDisable=function(){this.resizable&&this.resizable.resizable("disable")},t.prototype.offsetUpdate=function(){if(this.offset=this.container.offset(),this.scrollTop=0,this.scrollLeft=0,this.scrollParent){for(var t=this.scrollParent;!1===t.is(document);)this.scrollTop+=t.scrollTop(),this.scrollLeft+=t.scrollLeft(),t=t.scrollParent();this.scrollTop+=t.scrollTop(),this.scrollLeft+=t.scrollLeft()}},t.prototype.transformationUpdate=function(){var t=this.transformation;if(this.docked){var e=Object(a.e)(this.containerElement);if(e.matrix){var n=Object(a.s)(e.matrix);return t.translation.tx=n.tx,void(t.translation.ty=n.ty)}}t.translation.tx=0,t.translation.ty=0},t.prototype.updateSize=function(t){this.size=t,t.height=Math.max(t.height,t.minHeight),t.width=Math.max(t.width,t.minWidth),t.maxHeight=Math.max(t.maxHeight,t.minHeight),t.maxWidth=Math.max(t.maxWidth,t.minWidth),t.height=Math.min(t.maxHeight,t.height),t.width=Math.min(t.maxWidth,t.width),this.resizable&&(this.resizable.resizable("option","maxHeight",t.maxHeight),this.resizable.resizable("option","maxWidth",t.maxWidth),this.resizable.resizable("option","minHeight",t.minHeight),this.resizable.resizable("option","minWidth",t.minWidth),this.resizable.height(Math.min(t.maxHeight,t.height)),this.resizable.width(Math.min(t.maxWidth,t.width))),this.draggable&&(this.draggable.height(t.height),this.draggable.width(t.width)),this.sizeUpdatedHandle()},t.prototype.calcSize=function(){var t=r.a.widget,e=this.api,n=this.store,o=this.ux,i=e.margins,s=this.relativeElement,c=y(),l=c.margins,u=this.platform,p=u.isPhone(),d=this.isFullPlayerSize(),h=this.playerFullScreen,m=this.isInner,f=this.isSidePanel,g=t.margins.border;if(p?(c.minHeight=t.minHeight,c.minWidth=t.minWidth):(c.minHeight=t.minHeightLarge,c.minWidth=t.minWidthLarge),h||m||f||p||d||(l.top=i.top,l.bottom=i.bottom,l.right=this.calcRightMargin(),l.left=i.left),p)h||(l.left=g,l.right=g,l.top=Math.max(i.top,g),l.bottom=Math.max(i.bottom,g)),c.height=Math.round(u.windowHeight-l.top-l.bottom),c.width=Math.max(0,u.windowWidth-l.right-l.left),c.maxHeight=Math.min(u.windowHeight,c.height),c.maxWidth=Math.min(u.windowWidth,c.width);else if(this.isSidePanelOverlay)h?(c.height=u.windowHeight,c.width=Math.min(u.windowWidth,o.sidePanelOverlayWidth)):(c.height=s.offsetHeight,c.width=Math.min(s.offsetWidth,o.sidePanelOverlayWidth)),c.maxHeight=c.height,c.maxWidth=c.width;else if(h){if(this.isSidePanelFs)c.height=u.windowHeight,c.width=o.sidePanelFullScreenWidth;else{var b=n.player.controlsHeight()+e.timeline.height+r.a.timeline.progressLineHeight;l.bottom=b+g,l.top=t.margins.fsTop;var v=u.windowHeight-(l.bottom+l.top);c.width=c.minWidth,c.height=Math.floor(v)}c.maxHeight=Math.min(u.windowHeight,c.height),c.maxWidth=Math.min(u.windowWidth,c.width)}else if(d)c.width=s.offsetWidth,c.height=s.offsetHeight,c.maxHeight=c.height,c.maxWidth=c.width;else if(s&&"screen_edge"!==e.align.horizontal&&s!==document.body){var w=Object(a.g)(s,u.rootElement).left;c.height=s.offsetHeight,m?(l.top=t.margins.innerTop,l.bottom=n.player.controlsHeight()+e.timeline.height+r.a.timeline.progressLineHeight,c.height-=l.bottom+l.top,c.width=c.minWidth,c.maxWidth=c.width,c.maxHeight=t.defaultMaxHeight):("left"===e.position?(f||(l.left+=t.margins.screenBorder),c.width=w-l.left):(f||(l.right+=t.margins.screenBorder),c.width=u.windowWidth-(w+s.offsetWidth)-l.right),c.maxHeight=c.height,c.maxWidth=o.maxWidth?Math.min(c.width,o.maxWidth):c.width)}else c.height=Math.round(u.windowHeight*t.sizeHighMult),c.width=Math.round(u.windowWidth*t.sizeLowMult),c.maxHeight=c.height,c.maxWidth=o.maxWidth?Math.min(c.width,o.maxWidth):c.width,l.top=Math.max(l.top,t.margins.screenBorder),l.bottom=Math.max(l.bottom,t.margins.screenBorder),l.left=Math.max(l.left,t.margins.screenBorder);return c},t.prototype.calcMinibarSize=function(){var t=r.a.minibar,e=y(),n=this.platform.isPhone(),o=this.playerFullScreen,i=this.isInner;return n||i&&!o?(e.height=t.phoneHeight,e.width=t.phoneWidth):(e.height=t.height,e.width=t.width),e.minHeight=e.height,e.minWidth=e.width,e.maxHeight=e.height,e.maxWidth=e.width,this.setMiniMinibarMargins(e),e},t.prototype.calcMiniSize=function(){var t=r.a.mini,e=this.playerFullScreen,n=y(),o=t.minHeight,i=t.minWidth;return this.widgetVm.miniKukuMode?(n.height=t.kukuHeight,n.width=t.kukuWidth,o=t.kukuHeight,i=t.kukuWidth):e?(n.height=t.fullScreenHeight,n.width=t.fullScreenWidth):(n.height=t.height,n.width=t.width),n.minHeight=o,n.minWidth=i,n.maxHeight=n.height,n.maxWidth=n.width,this.setMiniMinibarMargins(n),n},t.prototype.setMiniMinibarMargins=function(t){var e=t.margins,n=this.platform.isPhone(),o=r.a.widget,i=this.playerFullScreen,a=this.isInner,s=this.api,c=s.margins,l=this.store;n?i?e.top=o.margins.fsTop:(e.left=e.right=o.margins.screenBorder,e.top=Math.max(c.top,o.margins.screenBorder),e.bottom=Math.max(c.bottom,o.margins.screenBorder)):(i?e.top=o.margins.fsTop:a?e.top=o.margins.innerTop:"screen_edge"===s.align.horizontal&&(e.top=Math.max(c.top,o.margins.screenBorder),e.bottom=Math.max(c.bottom,o.margins.screenBorder),e.left=Math.max(c.left,o.margins.screenBorder),e.right=this.calcRightMargin()),a&&(e.bottom=l.player.controlsHeight()+s.timeline.height+r.a.timeline.progressLineHeight))},t.prototype.autoScroll=function(){var t=this;return new Promise((function(e,n){var o=t.store.player.element||t.relativeElement,i=Math.round(g(o).offset().top),a=Math.min(o.offsetWidth*t.playerRatio,o.offsetHeight),s=i+Math.round((o.offsetHeight-a)/2),c=s;0===s&&e();for(var l=g(o).scrollParent();l&&1===l.length&&!l.is(document)&&l.scrollParent().length&&l.height()>t.platform.windowHeight;)l=l.scrollParent();return l&&1===l.length?(l.is(document)?l=g("body"):c=s+l.scrollTop(),l.animate({scrollTop:c},{duration:r.a.widget.autoScrollSpeed,complete:function(){return e()},fail:function(t){return n(t)}})):n(new Error("Scrollable parent not found"))}))},t.prototype.sizeUpdatedHandle=function(){var t=this.size,e=r.a.thread,n=!1;t.width/t.height>e.SBSLayoutRatioThreshold&&t.width>=e.SBSLayoutWidthThreshold&&(n=!0),this.sideBySideLayout=n},t.prototype.restartAutohide=function(t){var e=this;void 0===t&&(t=!1),clearTimeout(this.hideTimer),this.hideTimer=setTimeout((function(){e.store.player&&e.store.player.element&&"IFRAME"!==e.store.player.element.tagName&&(e.autohideTimedout=!0)}),t?500:2500)},t.prototype.clearAutohide=function(){clearTimeout(this.hideTimer),this.autohideTimedout=!1},m([Object(o.p)("serviceInitializer.settings"),f("design:type",d.a),f("design:paramtypes",[])],t.prototype,"settings",null),m([Object(o.p)("playerFullScreen","platform.phone"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"zIndex",null),m([Object(o.p)("widgetIsAttached","store.player","store.player.ready","playerFullScreen","playerFullScreenSupported"),f("design:type",Boolean),f("design:paramtypes",[])],t.prototype,"showWidget",null),m([Object(o.p)("settings.hasUGC","widgetVm.layoutShow","widgetVm.minibarShow","widgetVm.miniShow"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showBody",null),m([Object(o.p)("autohideTimedout","isMouseOver","widgetVm.minibarShow","store.player.isPaused","isInner"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"autohide",null),m([Object(o.p)("widgetVm","widgetVm.layoutShow"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showResizableHandleN",null),m([Object(o.p)("widgetVm","widgetVm.minibarShow"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showResizableHandleS",null),m([Object(o.p)("widgetVm","widgetVm.minibarShow","widgetVm.miniShow","docked","api.position","isInner"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showResizableHandleW",null),m([Object(o.p)("widgetVm","widgetVm.minibarShow","widgetVm.miniShow","docked","api.position","isInner"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showResizableHandleE",null),m([Object(o.p)("showResizableHandleW"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showResizableHandleSW",null),m([Object(o.p)("showResizableHandleE"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"showResizableHandleSE",null),m([Object(o.p)("ux","ux.draggableDisabled","isSidePanel"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"draggableUxDisabled",null),m([Object(o.p)("draggable","platform.phone","widgetVm.layoutShow","draggableUxDisabled","locked","playerFullScreen","isSidePanelFs"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"draggableNotPermitted",null),m([Object(o.p)("resizable","platform.phone","locked"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"resizableNotPermitted",null),m([Object(o.p)("platform.phone","widgetVm","widgetVm.isOpen","store.interactiveMode","isSidePanelOverlay"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"undockNotPermitted",null),m([Object(o.p)("api","api.element"),f("design:type",HTMLElement),f("design:paramtypes",[])],t.prototype,"relativeElement",null),m([Object(o.p)("relativeElement","api","api.align.horizontal","store.platform.windowWidth","widgetVm.isOpen","store.player.w","playerFullScreen"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"isInner",null),m([Object(o.p)("settings.darkThemeEnabled","isInner","platform.phone","playerFullScreen","isSidePanelFs","playerFullScreen"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"isDark",null),m([Object(o.p)("store.ux"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"ux",null),m([Object(o.p)("ux.sidePanelLayout"),f("design:type",Boolean),f("design:paramtypes",[])],t.prototype,"isSidePanel",null),m([Object(o.p)("isSidePanel","ux.sidePanelOverlay"),f("design:type",Boolean),f("design:paramtypes",[])],t.prototype,"isSidePanelOverlay",null),m([Object(o.p)("isSidePanel","ux.sidePanelFullScreen"),f("design:type",Boolean),f("design:paramtypes",[])],t.prototype,"isSidePanelFs",null),m([Object(o.p)("api","api.player.wide"),f("design:type",Object),f("design:paramtypes",[])],t.prototype,"playerRatio",null),t=m([Object(o.s)("nn-widget-overlay"),Object(o.t)(o.d.Element,i.EventAggregator,u.a,l.a),f("design:paramtypes",[Object,i.EventAggregator,u.a,l.a])],t)}(),y=function(){return{height:0,width:0,minHeight:0,minWidth:0,maxHeight:0,maxWidth:0,margins:{top:0,bottom:0,left:0,right:0}}}},"organs/widget/nn-widget-overlay.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-widget-overlay.scss"></require>\n    <require from="./nn-widget"></require>\n\n    <div css="position: absolute; top: 0; left: 0; z-index: ${zIndex};">\n        <div show.bind="showWidget"\n             class="annoto-overlay\n                    ${platform.phone ? \'nnc-mobile\' : \'\'}\n                    ${sideBySideLayout ? \'side-by-side-layout\' : \'\'}\n                    ${draggableNotPermitted ? \'not-draggable\' : \'\'}\n                    ${isResized ? \'resizing\' : \'\'}\n                    ${isDragged ? \'dragging\' : \'\'}"\n             ref="containerElement"\n             keydown.delegate="keydownHandle($event)">\n            <div class="annoto-html amdl-html ${isVisible && !autohide ? \'\' : \'nn-hidden\'}">\n                <div class="annoto-body amdl-body"\n                     show.bind="showBody"\n                     ref="bodyElement"\n                     css="position: absolute;">\n                    <div class="annoto-draggable ${docked ? \'annoto-dock-\' + api.position : \'\'}"\n                         ref="draggableElement">\n                        <div\n                            class="annoto-resizable ${locked && (docked === false) ? \'\' : isDragged ? \'amdl-shadow--16dp\' : \'annoto-shadow-6dp\'}"\n                            ref="resizableElement">\n                            <nn-widget api.bind="api" overlay.bind="vm" store.bind="store" view-model.ref="widgetVm"\n                            on-show.call="widgetShowHandle()" on-hide.call="widgetHideHandle()" on-detached.call="widgetDetachedHandle()" on-attached.call="widgetAttachedHandle()"></nn-widget>\n\n                            <div show.bind="showResizableHandleN" class="ui-resizable-handle ui-resizable-n"></div>\n                            <div show.bind="showResizableHandleS" class="ui-resizable-handle ui-resizable-s"></div>\n                            <div show.bind="showResizableHandleE" class="ui-resizable-handle ui-resizable-e"></div>\n                            <div show.bind="showResizableHandleW" class="ui-resizable-handle ui-resizable-w"></div>\n                            <div show.bind="showResizableHandleSW" class="ui-resizable-handle ui-resizable-sw"></div>\n                            <div show.bind="showResizableHandleSE" class="ui-resizable-handle ui-resizable-se"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n'},"organs/widget/nn-widget.html":function(t,e,n){t.exports="<template>\n    <require from=\"./css/nn-widget.scss\"></require>\n    <require from=\"./nn-layout\"></require>\n    <require from=\"./nn-minibar\"></require>\n    <require from=\"../mini/nn-mini\"></require>\n\n    <div show.bind=\"player.ready\"\n        nn-focusable=\"label.bind: 'aaa.widget.section' & t: aaaTrOptions; index.bind: isOpen ? 0 : -1\"\n        nn-focusable.ref=\"focusable\"\n        role=\"region\"\n        aria-expanded.bind=\"isOpen\"\n        class=\"annoto annoto-widget-container\n                annoto-${api.position}\n                ${platform.phone ? 'nnc-mobile' : ''}\n                ${platform.touchScreen ? 'is-touch' : ''}\n                ${playerFullScreen ? 'nn-player-fs' : ''}\n                ${showLive ? 'is-live' : ''}\n                ${layoutShow ? 'nn-is-open' : ''}\n                ${platform.landscape ? 'is-landscape' : ''}\n                ${store.rtl ? 'nnc-rtl' : ''}\n                ${user.ssoNotAuthenticated && user.authActionsDisabled && !user.anonymousEnabled ? 'sso-noauth' : ''}\n                ${pageClass}\n                ${phoneFormOpenView ? 'phone-form-open' : ''}\n                ${isDark ? 'nnc-dark-theme' : ''}\n                ${store.drawerEnabled ? '' : 'no-drawer'}\n                ${store.tabsEnabled ? 'has-tabs' : ''}\n                ${store.voteEmotionsDisabled ? 'no-vote-emotions' : ''}\">\n                \n        <div ref=\"containerElement\">\n             <nn-layout if.bind=\"hasLayout & oneTime & signal:'annoto-widget-update'\"\n                        show.bind=\"layoutShow & oneTime & signal:'annoto-widget-update'\"\n                        on-ready.call=\"layoutReady()\"></nn-layout>\n            <nn-minibar if.bind=\"minibarShow & oneTime & signal:'annoto-widget-update'\"></nn-minibar>\n            <nn-mini if.bind=\"hasLayout & oneTime & signal:'annoto-widget-update'\"\n                     show.bind=\"miniShow & oneTime & signal:'annoto-widget-update'\"></nn-mini>\n        </div>\n    </div>\n</template>\n"},"pages/css/nn-auth.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-auth{overflow-y:auto;overflow-x:hidden;width:calc(100% - 8px) !important;height:calc(100% - 8px) !important}.annoto .annoto-auth .annoto-auth-consent-text>p{margin:auto;max-width:260px;text-align:center;direction:ltr}.annoto .annoto-auth .annoto-auth-error{color:var(--nnc-color-danger, #d3411d)}.annoto.nnc-rtl .annoto-auth-title>p,.annoto.nnc-rtl .annoto-auth-consent-text>p,.annoto.nnc-rtl .annoto-auth-error>p{direction:rtl}.annoto.nnc-rtl .annoto-auth-consent{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.annoto.nnc-rtl .annoto-auth-consent .annoto-auth-consent-ck{margin-left:8px}",""]),e.default=i},"pages/css/nn-home.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-home{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-flow:row-reverse;flex-flow:row-reverse;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;-webkit-box-pack:stretch;-ms-flex-pack:stretch;justify-content:stretch}.annoto .annoto-home .annoto-home-cell{height:100%;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;max-width:100%}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto .annoto-home .annoto-home-cell{width:100%}}.annoto .annoto-home-wireframe>img{width:100%;height:100%;-webkit-box-sizing:border-box;box-sizing:border-box;padding:16px}.annoto .annoto-home-resizing,.annoto .annoto-home-dragging{position:relative}.annoto .annoto-home-resizing p,.annoto .annoto-home-dragging p{position:absolute;left:0;right:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);margin:auto;padding:0 8px;overflow:hidden;-webkit-box-sizing:border-box;box-sizing:border-box;text-align:center;white-space:pre-wrap;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.annoto .annoto-home-resizing p>.annoto-icon,.annoto .annoto-home-dragging p>.annoto-icon{font-size:28px}.annoto.has-tabs .annoto-home .annoto-home-cell{max-width:calc(100% - 30px);margin:0}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.annoto.has-tabs .annoto-home .annoto-home-cell{width:calc(100% - 30px)}}.annoto.has-tabs .annoto-home .annoto-side-tabs-container{display:block;position:relative;height:100%;width:30px;-ms-flex-negative:0;flex-shrink:0;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:100}",""]),e.default=i},"pages/css/nn-preferences.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-preferences{width:calc(100% - 16px);height:calc(100% - 8px);padding:0 8px;-webkit-box-sizing:border-box;box-sizing:border-box;overflow-y:auto;overflow-x:hidden;max-width:400px;margin:auto}.annoto .annoto-preferences .nn-preferences-nav-back-btn{margin-left:12px;margin-right:12px;margin-top:4px;margin-bottom:4px}@supports((-webkit-margin-start: 0) or (margin-inline-start: 0)) or (-webkit-margin-start: 0){.annoto .annoto-preferences .nn-preferences-nav-back-btn{margin-left:unset;margin-right:unset;-webkit-margin-start:12px;margin-inline-start:12px;-webkit-margin-end:12px;margin-inline-end:12px}}.annoto .annoto-preferences .nn-list{margin:0}.annoto .annoto-preferences .nn-list .nn-list-item-content{padding-right:16px}",""]),e.default=i},"pages/css/nn-signup-welcome.scss":function(t,e,n){"use strict";n.r(e);var o=n(30),i=n.n(o)()((function(t){return t[1]}));i.push([t.i,".annoto .annoto-signup-welcome{overflow-y:auto;overflow-x:hidden;width:calc(100% - 8px) !important;height:calc(100% - 8px) !important}.annoto .annoto-signup-welcome .annoto-signup-welcome-title{color:var(--nnc-color-secondary, #00a9a4);padding-top:40px}.annoto .annoto-signup-welcome .annoto-signup-welcome-message{max-width:460px;margin:auto}.annoto .annoto-signup-welcome .annoto-signup-welcome-button{display:block;margin-bottom:40px}.annoto.nnc-rtl .annoto-signup-welcome .annoto-signup-welcome-title>p,.annoto.nnc-rtl .annoto-signup-welcome .annoto-signup-welcome-message>p{direction:rtl}",""]),e.default=i},"pages/nn-auth":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoAuth",(function(){return h}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(166),a=n(35),s=n(49),c=n(32),l=n(31),u=n(250),p=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},h=function(){function t(t,e){var n;this.widget=e,this.titles=((n={})[r.a.WELCOME]="auth.title.welcome",n[r.a.SIGNUP]="auth.title.signup",n[r.a.LOGIN]="auth.title.login",n),this.consent=!0,this.providers=r.c,this.store=e.store,this.imagesUrl=c.a.imagesUrl,this.user=t,this.widget=e,this.logger=o.h.getLogger("Annoto-auth-page"),this.authService=t.authService}return t.prototype.bind=function(t,e){var n=this;this.disposable=this.widget.pubSub.subscribe(l.a.PAGES_SHOW,(function(t){return n.showPageHandle(t)})),this.showWelcome()},t.prototype.unbind=function(){this.disposable&&(this.disposable.dispose(),this.disposable=void 0)},t.prototype.showPageHandle=function(t,e){if("auth"===t.page){switch(t.frame){case"welcome":this.showWelcome(e);break;case"login":this.showLogin(e);break;case"signup":this.showSignup(e);break;default:this.logger.error("Unknown Auth Frame: "+t.frame),this.showWelcome()}this.store.authFrame=t.frame}},t.prototype.showWelcome=function(t){this.action=r.a.WELCOME,this.title=this.titles[this.action],this.error=t,this.consent=!0},t.prototype.showSignup=function(t){this.action=r.a.SIGNUP,this.title=this.titles[this.action],this.error=t,this.consent=!0},t.prototype.showLogin=function(t){this.action=r.a.LOGIN,this.title=this.titles[this.action],this.error=t,this.consent=!0},t.prototype.authGoogle=function(){this._auth(r.c.google)},t.prototype.authFacebook=function(){this._auth(r.c.facebook)},t.prototype.authLinkedIn=function(){this._auth(r.c.linkedin)},t.prototype.authTwitter=function(){this._auth(r.c.twitter)},Object.defineProperty(t.prototype,"showGlobalTerms",{get:function(){return this.action===r.a.WELCOME},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showSignupTerms",{get:function(){return this.action===r.a.SIGNUP},enumerable:!1,configurable:!0}),t.prototype._auth=function(t){var e=this;this.user.authenticate(t).then((function(){e.widget.pubSub.publish(l.a.PAGES_SHOW,{page:"home"})})).catch((function(t){e._errorHandle(t,"welcome")}))},t.prototype._errorHandle=function(t,e){var n=this,o="Oops, that`s embarrassing",i=t instanceof Response?t.status:0,r=t.error,a=t.data;switch(i){case u.d:return this.showPageHandle({page:"auth",frame:"signup"});case u.c:o="Account is not verified, please visit your email to finish registration";break;case u.e:o="Email or password mismatch";break;case u.f:case u.a:return t.json().then((function(t){return n.showPageHandle({page:"auth",frame:e},t.message)})).catch((function(){return n.showPageHandle({page:"auth",frame:e},o)}));default:if("string"==typeof a&&(o=a),r instanceof Error){this.logger.error("popup error: ",r);break}this.logger.error("unhandled error: ",t)}return this.showPageHandle({page:"auth",frame:e},o)},p([o.m,d("design:type",Object)],t.prototype,"consent",void 0),p([Object(o.p)("action"),d("design:type",Object),d("design:paramtypes",[])],t.prototype,"showGlobalTerms",null),p([Object(o.p)("action"),d("design:type",Object),d("design:paramtypes",[])],t.prototype,"showSignupTerms",null),t=p([Object(o.s)("nn-auth"),Object(o.t)(s.a,a.a.of(i.AnnotoWidget,!0)),d("design:paramtypes",[s.a,i.AnnotoWidget])],t)}()},"pages/nn-auth.html":function(t,e,n){t.exports='<template>\n  <require from="./css/nn-auth.scss"></require>\n  <require from="../organs/auth/nn-auth-title.html"></require>\n  \x3c!-- <require from="../organs/auth/nn-auth-form"></require> --\x3e\n  <require from="../organs/auth/nn-auth-social-button"></require>\n  \x3c!-- <require from="../organs/auth/nn-auth-separator.html"></require> --\x3e\n\n  <div class="annoto-auth annoto-page-grid nn-scrollbar" amdl-grid="align-content:center">\n\n    <nn-auth-title text="${title & t}" amdl-cell="col:12;"></nn-auth-title>\n\n\n    \x3c!-- <nn-auth-form amdl-cell="col:12" func.bind="action" submit.call="submit(credentials)" error.bind="error"></nn-auth-form> --\x3e\n\n    \x3c!-- <div if.bind="showSignupTerms"\n         amdl-cell="col:12" class="annoto-auth-consent annoto-flex-row-nowrap annoto-flex-align-center annoto-flex-justify-center">\n      <amdl-checkbox class="annoto-auth-consent-ck" checked.bind="consent"></amdl-checkbox>\n      <div class="annoto-auth-consent-text">\n        <p amdl-text="caption">${\'auth.consent\' & t}</p>\n        <p amdl-text="caption">\n          <a target="_blank" href="http://annoto.net/terms">${\'auth.terms\' & t}</a> & <a target="_blank" href="http://annoto.net/privacy">${\'auth.privacy\' & t}</a>\n        </p>\n      </div>\n    </div>\n    <nn-auth-separator amdl-cell="col:12"></nn-auth-separator> --\x3e\n\n    <nn-auth-social-button amdl-cell="col:12" click.call="authGoogle()" provider.one-time="providers.google"></nn-auth-social-button>\n    <nn-auth-social-button amdl-cell="col:12" click.call="authFacebook()" provider.one-time="providers.facebook"></nn-auth-social-button>\n    \x3c!-- <nn-auth-social-button amdl-cell="col:12" click.call="authLinkedIn()" provider.one-time="providers.linkedin"></nn-auth-social-button>\n    <nn-auth-social-button amdl-cell="col:12" click.call="authTwitter()" provider.one-time="providers.twitter"></nn-auth-social-button> --\x3e\n\n    <div if.bind="showGlobalTerms"\n         amdl-cell="col:12" class="annoto-auth-consent">\n      <div class="annoto-auth-consent-text">\n        <p amdl-text="caption">${\'auth.consent\' & t}</p>\n        <p amdl-text="caption">\n          <a target="_blank" href="http://annoto.net/terms">${\'auth.terms\' & t}</a> & <a target="_blank" href="http://annoto.net/privacy">${\'auth.privacy\' & t}</a>\n        </p>\n      </div>\n    </div>\n\n  </div>\n\n</template>\n'},"pages/nn-home":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoHome",(function(){return p}));var o=n("aurelia-framework"),i=n("aurelia-i18n"),r=n("organs/widget/nn-widget"),a=n(35),s=n(11),c=n(31),l=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},p=function(){function t(t,e){this.widget=t,this.tabs=[],this.disposables=[],this.widget=t,this.store=t.store,this.i18n=e}return t.prototype.bind=function(){var t=this,e=this.i18n,n=this.store,o=[];n.commentsEnabled&&o.push({icon:"comments",text:e.tr("widget.tabs.comments"),fill:s.a.PRIMARY,color:"white",active:!1,disabled:!n.commentsEnabled,aaaControls:"nn-thread-comments-id-"+n.id,data:"comments"}),n.settings.peopleEnabled&&o.push({icon:"people",text:e.tr("widget.tabs.people"),fill:s.a.TERTIARY,color:"white",active:!1,get disabled(){return n.peopleDisabled},aaaControls:"nn-thread-people-id-"+n.id,data:"people"}),n.privateNotesEnabled&&o.push({icon:"notebook",text:e.tr("widget.tabs.notes"),fill:s.a.ACCENT,color:"white",active:!1,disabled:!n.privateNotesEnabled,aaaControls:"nn-thread-notes-id-"+n.id,data:"notes"}),this.tabs=o,this.disposables.push(n.pubSub.subscribe(c.a.PAGES_NAV_COMPLETE,(function(){var e=t.tabsVm;if("home"===n.activePage&&e){var o=n.homeFrame,i=t.tabs.findIndex((function(t){return t.data===o}));-1!==i&&(e.activeTab=i)}})))},t.prototype.unbind=function(){for(var t=0;t<this.disposables.length;t++)this.disposables[t].dispose()},t.prototype.tabChangeHandle=function(t){var e=this.store,n={page:"home",frame:t.data};e.pubSub.publish(c.a.PAGES_SHOW,n)},Object.defineProperty(t.prototype,"isAnimating",{get:function(){return this.widget.isDragged||this.widget.isResized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDragging",{get:function(){return this.widget.isDragged},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isResizing",{get:function(){return this.widget.isResized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showPeople",{get:function(){return"people"===this.store.homeFrame},enumerable:!1,configurable:!0}),l([Object(o.p)("widget.isDragged","widget.isResized"),u("design:type",Object),u("design:paramtypes",[])],t.prototype,"isAnimating",null),l([Object(o.p)("widget.isDragged"),u("design:type",Object),u("design:paramtypes",[])],t.prototype,"isDragging",null),l([Object(o.p)("widget.isResized"),u("design:type",Object),u("design:paramtypes",[])],t.prototype,"isResizing",null),l([Object(o.p)("store.homeFrame"),u("design:type",Object),u("design:paramtypes",[])],t.prototype,"showPeople",null),t=l([Object(o.s)("nn-home"),Object(o.t)(a.a.of(r.AnnotoWidget,!0),i.I18N),u("design:paramtypes",[r.AnnotoWidget,Object])],t)}()},"pages/nn-home.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-home.scss"></require>\n    <require from="../organs/thread/nn-thread"></require>\n    <require from="../organs/side-tabs/nn-side-tabs"></require>\n    <require from="../organs/people/nn-people"></require>\n\n    <div show.bind="!isAnimating"\n         class="annoto-home annoto-page-grid">\n\n        <nn-side-tabs if.bind="store.tabsEnabled"\n                      view-model.ref="tabsVm"\n                      class="annoto-side-tabs-container"\n                      tabs.bind="tabs"\n                      on-active-tab-change.call="tabChangeHandle(tab)"></nn-side-tabs>\n\n        <nn-thread if.bind="!showPeople" class="annoto-home-cell"></nn-thread>\n        <nn-people else class="annoto-home-cell"></nn-people>\n    </div>\n\n    <div show.bind="isDragging" class="annoto-home-dragging annoto-page-grid ">\n            <p class="nn-text-body nn-color-grey-heavy">${\'tut.dragging\' | t}</p>\n    </div>\n\n    <div show.bind="isResizing" class="annoto-home-resizing annoto-page-grid ">\n        <p class="nn-text-body nn-color-grey-heavy">\n            <i class="annoto-icon annoto-icon-resize_drag nn-icon-resize_drag"></i>  ${\'tut.resizing\' | t}</p>\n    </div>\n</template>\n'},"pages/nn-preferences":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoPreferences",(function(){return u}));var o=n("aurelia-framework"),i=n(36),r=n(93),a=n(29),s=n(31),c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t,e){this.store=t,this.userSettings=e,this.id=Object(a.i)(),this.logger=o.h.getLogger("Annoto-preferences-page")}return t.prototype.bind=function(){this.updateNotifications()},Object.defineProperty(t.prototype,"showNotifications",{get:function(){return Boolean(this.userSettings.preferences.notifications&&this.email)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roleText",{get:function(){return"comment.moderator_text"+(this.store.isELearning?"_ld":"")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roleIcon",{get:function(){return this.store.isELearning?"annoto-icon-school":"annoto-icon-stars"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isModerator",{get:function(){return this.store.user.isModerator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAnonymous",{get:function(){return this.store.user.anonymousEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"navBackColor",{get:function(){var t=this.store.homeFrame;return"comments"===t?"primary":"people"===t?"tertiary":"notes"===t?"secondary":"medium"},enumerable:!1,configurable:!0}),t.prototype.groupNtChanged=function(t,e){if(this.showNotifications){var n=this.userSettings.preferences.notifications;t!==e&&t!==n.comment_post_group&&this.patchNotificationsPreference("comment_post_group",t,{option:"group_notifications"})}},t.prototype.threadNtChanged=function(t,e){if(this.showNotifications){var n=this.userSettings.preferences.notifications;t!==e&&t!==n.comment_post_th&&this.patchNotificationsPreference("comment_post_th",t,{option:"thread_notifications"})}},t.prototype.replyNtChanged=function(t,e){if(this.showNotifications){var n=this.userSettings.preferences.notifications;t!==e&&t!==n.comment_post_cmnt&&this.patchNotificationsPreference("comment_post_cmnt",t,{option:"reply_notifications"})}},t.prototype.commentNtChanged=function(t,e){if(this.showNotifications){var n=this.userSettings.preferences.notifications;t!==e&&t!==n.comment_post_cnv&&this.patchNotificationsPreference("comment_post_cnv",t,{option:"comment_notifications"})}},t.prototype.navBack=function(){var t=this.store;Object(a.c)(200).then((function(){t.pubSub.publish(s.a.PAGES_SHOW,{page:"home",frame:t.homeFrame})}))},t.prototype.patchNotificationsPreference=function(t,e,n){var o=this,i=Boolean(e);this.store.authService.patchNotificationsPreference(t,i).then((function(t){o.userSettings.setNotificationsPreferences(t),o.updateNotifications()})).catch((function(t){o.logger.warn("patchNotificationsPreference: ",t)})),this.store.analyticsController.recordMenuInteraction("option_tap",{option:n.option,option_bool:i},{label:n.option,value:i?1:0})},t.prototype.updateNotifications=function(){var t=this.userSettings.preferences;if(t.notifications){var e=t.notifications;this.groupNt!==e.comment_post_group&&(this.groupNt=e.comment_post_group),this.threadNt!==e.comment_post_th&&(this.threadNt=e.comment_post_th),this.replyNt!==e.comment_post_cmnt&&(this.replyNt=e.comment_post_cmnt),this.commentNt!==e.comment_post_cnv&&(this.commentNt=e.comment_post_cnv),this.email=this.store.user.anonymousEnabled&&e.email?e.email.replace(/@.*$/,""):e.email}},c([Object(o.v)(),l("design:type",Boolean)],t.prototype,"groupNt",void 0),c([Object(o.v)(),l("design:type",Boolean)],t.prototype,"threadNt",void 0),c([Object(o.v)(),l("design:type",Boolean)],t.prototype,"replyNt",void 0),c([Object(o.v)(),l("design:type",Boolean)],t.prototype,"commentNt",void 0),c([Object(o.p)("userSettings.preferences.notifications","email"),l("design:type",Boolean),l("design:paramtypes",[])],t.prototype,"showNotifications",null),c([Object(o.p)("store.isELearning"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"roleText",null),c([Object(o.p)("store.isELearning"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"roleIcon",null),c([Object(o.p)("store.user.isModerator"),l("design:type",Object),l("design:paramtypes",[])],t.prototype,"isModerator",null),c([Object(o.p)("store.user.anonymousEnabled"),l("design:type",Boolean),l("design:paramtypes",[])],t.prototype,"isAnonymous",null),c([Object(o.p)("store.homeFrame"),l("design:type",String),l("design:paramtypes",[])],t.prototype,"navBackColor",null),t=c([Object(o.s)("nn-preferences"),Object(o.t)(i.a,r.a),l("design:paramtypes",[i.a,r.a])],t)}()},"pages/nn-preferences.html":function(t,e,n){t.exports='<template>\n    <require from="./css/nn-preferences.scss"></require>\n\n    <div class="annoto-preferences nn-scrollbar">\n\n        <nnc-button class="nn-preferences-nav-back-btn" click.trigger="navBack()" color.bind="navBackColor" size="sm" fill="raised">\n            <nnc-icon slot="icon" name="navigate-before"></nnc-icon>\n        </nnc-button>\n        <amdl-list>\n            <amdl-list-item>\n                ${store.user.name}\n                <span slot="subtitle">${email}</span>\n                <div if.one-time="isModerator" slot="end" id="annoto-preferences-role-${id & oneTime}">\n                    <i class="annoto-icon annoto-20 ${roleIcon & oneTime} nn-icon-moderator nn-color-grey" aria-hidden="true"></i>\n                    <span class="nn-aaa-hidden-info">${roleText & t & oneTime}</span>\n                    <nnc-tooltip for="annoto-preferences-role-${id & oneTime}">${roleText & t & oneTime}</nnc-tooltip>\n                </div>\n            </amdl-list-item>\n            <amdl-list-header if.bind="showNotifications">\n                ${\'preferences.section.notifications\' & t & oneTime}\n            </amdl-list-header>\n            <amdl-list-item if.bind="showNotifications" disabled.bind="isAnonymous">\n                ${\'preferences.thread_notifications.title\' & t & oneTime}\n                <span slot="subtitle">${\'preferences.thread_notifications.subtitle\' & t & oneTime}</span>\n                <amdl-switch slot="end"\n                    checked.bind="threadNt"\n                    disabled.bind="isAnonymous"\n                    ripple.one-time="true"\n                    label="${\'preferences.thread_notifications.subtitle\' & t & oneTime}">\n                </amdl-switch>\n            </amdl-list-item>\n            \x3c!-- <amdl-list-item if.bind="showNotifications">\n                ${\'preferences.comment_notifications.title\' & t & oneTime}\n                <span slot="subtitle">${\'preferences.comment_notifications.subtitle\' & t & oneTime}</span>\n                <amdl-switch slot="end" checked.bind="commentNt" ripple.one-time="true"></amdl-switch>\n            </amdl-list-item> --\x3e\n            <amdl-list-item if.bind="showNotifications" disabled.bind="isAnonymous">\n                ${\'preferences.reply_notifications.title\' & t & oneTime}\n                <span slot="subtitle">${\'preferences.reply_notifications.subtitle\' & t & oneTime}</span>\n                <amdl-switch slot="end"\n                    checked.bind="replyNt"\n                    disabled.bind="isAnonymous"\n                    ripple.one-time="true"\n                    label="${\'preferences.reply_notifications.subtitle\' & t & oneTime}">\n                </amdl-switch>\n            </amdl-list-item>\n\n            <amdl-list-item if.bind="isModerator && showNotifications" disabled.bind="isAnonymous">\n                ${\'preferences.group_notifications.title\' & t & oneTime}\n                <span slot="subtitle">${\'preferences.group_notifications.subtitle\' & t & oneTime}</span>\n                <amdl-switch slot="end"\n                    checked.bind="groupNt"\n                    disabled.bind="isAnonymous"\n                    ripple.one-time="true"\n                    label="${\'preferences.group_notifications.subtitle\' & t & oneTime}">\n                </amdl-switch>\n            </amdl-list-item>\n        </amdl-list>\n    </div>\n</template>'},"pages/nn-signup-welcome":function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoSignupWelcome",(function(){return u}));var o=n("aurelia-framework"),i=n("organs/widget/nn-widget"),r=n(35),a=n(11),s=n(31),c=function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},u=function(){function t(t){this.titleColor=a.a.ACCENT,this.widget=t}return t.prototype.showHome=function(){this.widget.pubSub.publish(s.a.PAGES_SHOW,{page:"home"})},t.prototype.showWelcome=function(){this.widget.pubSub.publish(s.a.PAGES_SHOW,{page:"auth",frame:"login"})},t=c([Object(o.s)("nn-signup-welcome"),Object(o.t)(r.a.of(i.AnnotoWidget,!0)),l("design:paramtypes",[i.AnnotoWidget])],t)}()},"pages/nn-signup-welcome.html":function(t,e,n){t.exports='<template>\n  <require from="./css/nn-signup-welcome.scss"></require>\n\n  <div class="annoto-signup-welcome annoto-page-grid nn-scrollbar" amdl-grid="align-content:start; no-spacing:true">\n    <div class="annoto-signup-welcome-title" amdl-cell="col:12">\n      <p amdl-text="headline" class="nn-text-center">${\'auth.welcome.title\' & t}</p>\n    </div>\n\n    <div class="annoto-signup-welcome-message" amdl-cell="col:12">\n      <p amdl-text="subhead" class="nn-text-center">${\'auth.welcome.msg\' & t}</p>\n    </div>\n\n    <amdl-button class="annoto-signup-welcome-button" amdl-cell="col:12"\n               text="${\'auth.welcome.button\' & t}" click.call="showWelcome()" color-class="primary" type="raised" ripple="true" align="center"></amdl-button>\n\n    <div class="annoto-signup-welcome-message" amdl-cell="col:12">\n      <p amdl-text="body-1" class="nn-text-center">\n        ${\'auth.welcome.footer\' & t} <a href="mailto:support@annoto.net">support@annoto.net</a>.\n      </p>\n    </div>\n  </div>\n</template>\n'},"vc/array-clone":function(t,e,n){"use strict";n.r(e),n.d(e,"ArrayCloneValueConverter",(function(){return o}));var o=function(){function t(){}return t.prototype.toView=function(t){return(t||[]).slice()},t}()},"vc/array-filter":function(t,e,n){"use strict";n.r(e),n.d(e,"ArrayFilterValueConverter",(function(){return o}));var o=function(){function t(){}return t.prototype.toView=function(t,e){if(!e||0===t.length||!e.enabled||!e.enabled)return t;var n=this[e.comparison+"Filter"];return"function"!=typeof n?t:void 0===e.object?t.filter((function(t,o,i){return n(t,e.property,e.value)})):t.filter((function(t,o,i){return n(t[e.object],e.property,e.value)}))},t.prototype.ordinalFilter=function(t,e,n){return!(!t||t[e]!==n)},t}()},"vc/array-head":function(t,e,n){"use strict";n.r(e),n.d(e,"ArrayHeadValueConverter",(function(){return o}));var o=function(){function t(){}return t.prototype.toView=function(t){if(t&&0!==t.length)return t[0]},t}()},"vc/array-reverse":function(t,e,n){"use strict";n.r(e),n.d(e,"ArrayReverseValueConverter",(function(){return o}));var o=function(){function t(){}return t.prototype.toView=function(t,e){return t&&0!==t.length&&e&&"false"!==e?t.slice().reverse():(t||[]).slice()},t}()},"vc/array-sort":function(t,e,n){"use strict";n.r(e),n.d(e,"ArraySortValueConverter",(function(){return i}));var o=n(173),i=function(){function t(){}return t.prototype.toView=function(t,e){if(!t)return t;if(!e||0===t.length||!e.enabled)return t.slice();var n="asc"===e.order?1:-1;e.flipOrder&&(n=1===n?-1:1);var o=this[e.comparison+"Comparison"];return"function"!=typeof o?t.slice():void 0===e.property?t.slice().sort((function(t,e){return o(t,e)*n})):t.slice().sort((function(t,i){return o(t[e.property],i[e.property])*n}))},t.prototype.ordinalIgnoreCaseComparison=function(t,e){return null==t&&null==e?0:null==t?-1:null==e?1:(t=t.toString().toLowerCase())<(e=e.toString().toLowerCase())?-1:t>e?1:0},t.prototype.ordinalComparison=function(t,e){return null==t&&null==e?0:null==t?-1:null==e?1:(t=t.toString())<(e=e.toString())?-1:t>e?1:0},t.prototype.dateComparison=function(t,e){if(null==t&&null==e)return 0;if(null==t)return-1;if(null==e)return 1;var n=t,i=e;try{"string"==typeof t&&(n=new Date(t)),"string"==typeof e&&(i=new Date(e))}catch(t){}return Object(o.a)(n,i)},t.prototype.numberComparison=function(t,e){return null==t&&null==e?0:null==t?-1:null==e?1:t-e},t}()},"vc/capitalize":function(t,e,n){"use strict";n.r(e),n.d(e,"CapitalizeValueConverter",(function(){return o}));var o=function(){function t(){}return t.prototype.toView=function(t){return"string"!=typeof t||t.length<1?t:t.charAt(0).toUpperCase()+t.slice(1)},t}()},"vc/date":function(t,e,n){"use strict";n.r(e),n.d(e,"DateValueConverter",(function(){return i}));var o=n(264),i=function(){function t(){}return t.prototype.toView=function(t,e){return t?Object(o.a)(new Date(t),e||"dd MMM, y"):t},t}()},"vc/escape":function(t,e,n){"use strict";n.r(e),n.d(e,"EscapeValueConverter",(function(){return i}));var o=n(97),i=function(){function t(){}return t.prototype.toView=function(t){return t&&"string"==typeof t?Object(o.a)(t):""},t}()},"vc/from-now":function(t,e,n){"use strict";n.r(e),n.d(e,"FromNowValueConverter",(function(){return i}));var o=n(266),i=function(){function t(){}return t.prototype.toView=function(t){return t?Object(o.a)(t,{locale:{formatDistance:a}}):null},t}(),r={xSeconds:{one:"1s",other:"{{count}}s"},xMinutes:{one:"1m",other:"{{count}}m"},xHours:{one:"1h",other:"{{count}}h"},xDays:{one:"1d",other:"{{count}}d"},xWeeks:{one:"1w",other:"{{count}}w"},xMonths:{one:"1mo",other:"{{count}}mo"},xYears:{one:"1y",other:"{{count}}y"}},a=function(t,e){return r[t]?1===e?r[t].one:r[t].other.replace("{{count}}",e):""}},"vc/hyperlink":function(t,e,n){"use strict";function o(t,e,n){if(!t||"string"!=typeof t)return-1;for(var o=0;o<e.length;o++){var i=e[o],r=t.indexOf(i,n);if(-1!==r)return r}return-1}function i(t,e,n,o){if(!t||"string"!=typeof t)return-1;var i="number"==typeof o?o:t.length;return""+t.slice(0,n)+e+t.slice(i)}n.r(e),n.d(e,"HyperlinkValueConverter",(function(){return s}));var r=n(97);function a(t,e){if(e&&!0===e.yt){var n=Object(r.b)(t.slice());if(function(t){return t.match(/(http:|https:)?\/\/(www\.)?(youtube.com|youtu.be)\/(watch)?(\?v=)?(\S+)?/)}(n))return function(t){var e=function(t){var e=/(?:youtube\.com\/\S*(?:(?:\/e(?:mbed))?\/|watch\/?\?(?:\S*?&?v\=))|youtu\.be\/)([a-zA-Z0-9_-]{6,11})/g.exec(t);return!(!e||!e[1])&&e[1]}(t);if(!1===e)return t;return'<iframe class="nn-media-embed"\n            src="https://www.youtube.com/embed/'+e+'?modestbranding=1&rel=0"\n            frameborder="0"\n            allowfullscreen></iframe>'}(n)}return'<a href="'+t+'" target="_blank" rel=\'noreferrer\'>'+t+"</a>"}var s=function(){function t(){}return t.prototype.toView=function(t,e){if(!t||"string"!=typeof t)return null;for(var n=0,r=t;n<r.length;){var s=o(r,["http://","https://","https:&#x2F;&#x2F;","http:&#x2F;&#x2F;"],n);if(-1===s)return r;var c=o(r,[" ","\r","\n","\t",","],s);if(-1===c)return i(r,a(r.slice(s),e),s);var l=a(r.slice(s,c),e),u=i(r,l,s,c);"string"==typeof u&&(r=u),n=c+1+(l.length-(c-s))}return r},t}()},"vc/index":function(t,e,n){"use strict";n.r(e),n.d(e,"configure",(function(){return o}));n("aurelia-framework");function o(t){t.globalResources(["./array-filter","./array-head","./array-sort","./from-now","./hyperlink","./number","./to-lower-case","./escape","./array-reverse","./array-clone","./date","./capitalize"])}},"vc/number":function(t,e,n){"use strict";n.r(e),n.d(e,"NumberValueConverter",(function(){return r}));var o=n(84),i=n.n(o),r=function(){function t(){}return t.prototype.toView=function(t,e){return isNaN(t)?t:i()(t).format(e)},t}()},"vc/to-lower-case":function(t,e,n){"use strict";n.r(e),n.d(e,"ToLowerCaseValueConverter",(function(){return o}));var o=function(){function t(){}return t.prototype.toView=function(t){return"string"!=typeof t?t:t.toLowerCase()},t.prototype.fromView=function(t){return"string"!=typeof t?t:t.toLowerCase()},t}()}}]);